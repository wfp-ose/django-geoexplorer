var OpenLayers={VERSION_NUMBER:"Release 2.13 dev",singleFile:!0,_getScriptLocation:function(){for(var c,d,a=new RegExp("(^|(.*?\\/))(OpenLayers[^\\/]*?\\.js)(\\?|$)"),b=document.getElementsByTagName("script"),e="",f=0,g=b.length;f<g;f++)if(c=b[f].getAttribute("src"),c&&(d=c.match(a))){e=d[1];break}return function(){return e}}(),ImgPath:""};OpenLayers.Class=function(){var a=arguments.length,b=arguments[0],c=arguments[a-1],d="function"==typeof c.initialize?c.initialize:function(){b.prototype.initialize.apply(this,arguments)};if(a>1){var e=[d,b].concat(Array.prototype.slice.call(arguments).slice(1,a-1),c);OpenLayers.inherit.apply(null,e)}else d.prototype=c;return d},OpenLayers.inherit=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c;var d,e,f;for(d=2,e=arguments.length;d<e;d++)f=arguments[d],"function"==typeof f&&(f=f.prototype),OpenLayers.Util.extend(a.prototype,f)},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.extend=function(a,b){if(a=a||{},b){for(var c in b){var d=b[c];void 0!==d&&(a[c]=d)}var e="function"==typeof window.Event&&b instanceof window.Event;!e&&b.hasOwnProperty&&b.hasOwnProperty("toString")&&(a.toString=b.toString)}return a},OpenLayers.String={startsWith:function(a,b){return 0==a.indexOf(b)},contains:function(a,b){return a.indexOf(b)!=-1},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(a){for(var b=a.split("-"),c=b[0],d=1,e=b.length;d<e;d++){var f=b[d];c+=f.charAt(0).toUpperCase()+f.substring(1)}return c},format:function(a,b,c){b||(b=window);var d=function(a,d){for(var e,f=d.split(/\.+/),g=0;g<f.length&&(0==g&&(e=b),void 0!==e);g++)e=e[f[g]];return"function"==typeof e&&(e=c?e.apply(null,c):e()),"undefined"==typeof e?"undefined":e};return a.replace(OpenLayers.String.tokenRegEx,d)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(a){return OpenLayers.String.numberRegEx.test(a)},numericIf:function(a,b){var c=a;return b===!0&&null!=a&&a.replace&&(a=a.replace(/^\s*|\s*$/g,"")),OpenLayers.String.isNumeric(a)?parseFloat(a):c}},OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(a,b){var c=0;return b>0&&(c=parseFloat(a.toPrecision(b))),c},format:function(a,b,c,d){b="undefined"!=typeof b?b:0,c="undefined"!=typeof c?c:OpenLayers.Number.thousandsSeparator,d="undefined"!=typeof d?d:OpenLayers.Number.decimalSeparator,null!=b&&(a=parseFloat(a.toFixed(b)));var e=a.toString().split(".");1==e.length&&null==b&&(b=0);var f=e[0];if(c)for(var g=/(-?[0-9]+)([0-9]{3})/;g.test(f);)f=f.replace(g,"$1"+c+"$2");var h;if(0==b)h=f;else{var i=e.length>1?e[1]:"0";null!=b&&(i+=new Array(b-i.length+1).join("0")),h=f+d+i}return h},zeroPad:function(a,b,c){for(var d=a.toString(c||10);d.length<b;)d="0"+d;return d}},OpenLayers.Function={bind:function(a,b){var c=Array.prototype.slice.apply(arguments,[2]);return function(){var d=c.concat(Array.prototype.slice.apply(arguments,[0]));return a.apply(b,d)}},bindAsEventListener:function(a,b){return function(c){return a.call(b,c||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},OpenLayers.Array={filter:function(a,b,c){var d=[];if(Array.prototype.filter)d=a.filter(b,c);else{var e=a.length;if("function"!=typeof b)throw new TypeError;for(var f=0;f<e;f++)if(f in a){var g=a[f];b.call(c,g,f,a)&&d.push(g)}}return d}},OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(a,b,c,d){OpenLayers.Util.isArray(a)&&(d=a[3],c=a[2],b=a[1],a=a[0]),null!=a&&(this.left=OpenLayers.Util.toFloat(a)),null!=b&&(this.bottom=OpenLayers.Util.toFloat(b)),null!=c&&(this.right=OpenLayers.Util.toFloat(c)),null!=d&&(this.top=OpenLayers.Util.toFloat(d))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(a){var b=!1;return null!=a&&(b=this.left==a.left&&this.right==a.right&&this.top==a.top&&this.bottom==a.bottom),b},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(a){return a===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(a,b){null==a&&(a=6);var c=Math.pow(10,a),d=Math.round(this.left*c)/c,e=Math.round(this.bottom*c)/c,f=Math.round(this.right*c)/c,g=Math.round(this.top*c)/c;return b===!0?e+","+d+","+g+","+f:d+","+e+","+f+","+g},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(a,b){null==b&&(b=this.getCenterLonLat());var c,d;"OpenLayers.LonLat"==b.CLASS_NAME?(c=b.lon,d=b.lat):(c=b.x,d=b.y);var e=(this.left-c)*a+c,f=(this.bottom-d)*a+d,g=(this.right-c)*a+c,h=(this.top-d)*a+d;return new OpenLayers.Bounds(e,f,g,h)},add:function(a,b){if(null==a||null==b)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+a,this.bottom+b,this.right+a,this.top+b)},extend:function(a){if(a)switch(a.CLASS_NAME){case"OpenLayers.LonLat":this.extendXY(a.lon,a.lat);break;case"OpenLayers.Geometry.Point":this.extendXY(a.x,a.y);break;case"OpenLayers.Bounds":this.centerLonLat=null,(null==this.left||a.left<this.left)&&(this.left=a.left),(null==this.bottom||a.bottom<this.bottom)&&(this.bottom=a.bottom),(null==this.right||a.right>this.right)&&(this.right=a.right),(null==this.top||a.top>this.top)&&(this.top=a.top)}},extendXY:function(a,b){this.centerLonLat=null,(null==this.left||a<this.left)&&(this.left=a),(null==this.bottom||b<this.bottom)&&(this.bottom=b),(null==this.right||a>this.right)&&(this.right=a),(null==this.top||b>this.top)&&(this.top=b)},containsLonLat:function(a,b){"boolean"==typeof b&&(b={inclusive:b}),b=b||{};var c=this.contains(a.lon,a.lat,b.inclusive),d=b.worldBounds;if(d&&!c){var e=d.getWidth(),f=(d.left+d.right)/2,g=Math.round((a.lon-f)/e);c=this.containsLonLat({lon:a.lon-g*e,lat:a.lat},{inclusive:b.inclusive})}return c},containsPixel:function(a,b){return this.contains(a.x,a.y,b)},contains:function(a,b,c){if(null==c&&(c=!0),null==a||null==b)return!1;a=OpenLayers.Util.toFloat(a),b=OpenLayers.Util.toFloat(b);var d=!1;return d=c?a>=this.left&&a<=this.right&&b>=this.bottom&&b<=this.top:a>this.left&&a<this.right&&b>this.bottom&&b<this.top},intersectsBounds:function(a,b){if("boolean"==typeof b&&(b={inclusive:b}),b=b||{},b.worldBounds){var c=this.wrapDateLine(b.worldBounds);a=a.wrapDateLine(b.worldBounds)}else c=this;null==b.inclusive&&(b.inclusive=!0);var d=!1,e=c.left==a.right||c.right==a.left||c.top==a.bottom||c.bottom==a.top;if(b.inclusive||!e){var f=a.bottom>=c.bottom&&a.bottom<=c.top||c.bottom>=a.bottom&&c.bottom<=a.top,g=a.top>=c.bottom&&a.top<=c.top||c.top>a.bottom&&c.top<a.top,h=a.left>=c.left&&a.left<=c.right||c.left>=a.left&&c.left<=a.right,i=a.right>=c.left&&a.right<=c.right||c.right>=a.left&&c.right<=a.right;d=(f||g)&&(h||i)}if(b.worldBounds&&!d){var j=b.worldBounds,k=j.getWidth(),l=!j.containsBounds(c),m=!j.containsBounds(a);l&&!m?(a=a.add(-k,0),d=c.intersectsBounds(a,{inclusive:b.inclusive})):m&&!l&&(c=c.add(-k,0),d=a.intersectsBounds(c,{inclusive:b.inclusive}))}return d},containsBounds:function(a,b,c){null==b&&(b=!1),null==c&&(c=!0);var d=this.contains(a.left,a.bottom,c),e=this.contains(a.right,a.bottom,c),f=this.contains(a.left,a.top,c),g=this.contains(a.right,a.top,c);return b?d||e||f||g:d&&e&&f&&g},determineQuadrant:function(a){var b="",c=this.getCenterLonLat();return b+=a.lat<c.lat?"b":"t",b+=a.lon<c.lon?"l":"r"},transform:function(a,b){this.centerLonLat=null;var c=OpenLayers.Projection.transform({x:this.left,y:this.bottom},a,b),d=OpenLayers.Projection.transform({x:this.right,y:this.bottom},a,b),e=OpenLayers.Projection.transform({x:this.left,y:this.top},a,b),f=OpenLayers.Projection.transform({x:this.right,y:this.top},a,b);return this.left=Math.min(c.x,e.x),this.bottom=Math.min(c.y,d.y),this.right=Math.max(d.x,f.x),this.top=Math.max(e.y,f.y),this},wrapDateLine:function(a,b){b=b||{};var c=b.leftTolerance||0,d=b.rightTolerance||0,e=this.clone();if(a){for(var f=a.getWidth();e.left<a.left&&e.right-d<=a.left;)e=e.add(f,0);for(;e.left+c>=a.right&&e.right>a.right;)e=e.add(-f,0);var g=e.left+c;g<a.right&&g>a.left&&e.right-d>a.right&&(e=e.add(-f,0))}return e},CLASS_NAME:"OpenLayers.Bounds"}),OpenLayers.Bounds.fromString=function(a,b){var c=a.split(",");return OpenLayers.Bounds.fromArray(c,b)},OpenLayers.Bounds.fromArray=function(a,b){return b===!0?new OpenLayers.Bounds(a[1],a[0],a[3],a[2]):new OpenLayers.Bounds(a[0],a[1],a[2],a[3])},OpenLayers.Bounds.fromSize=function(a){return new OpenLayers.Bounds(0,a.h,a.w,0)},OpenLayers.Bounds.oppositeQuadrant=function(a){var b="";return b+="t"==a.charAt(0)?"b":"t",b+="l"==a.charAt(1)?"r":"l"},OpenLayers.Element={visible:function(a){return"none"!=OpenLayers.Util.getElement(a).style.display},toggle:function(){for(var a=0,b=arguments.length;a<b;a++){var c=OpenLayers.Util.getElement(arguments[a]),d=OpenLayers.Element.visible(c)?"none":"";c.style.display=d}},remove:function(a){a=OpenLayers.Util.getElement(a),a.parentNode.removeChild(a)},getHeight:function(a){return a=OpenLayers.Util.getElement(a),a.offsetHeight},hasClass:function(a,b){var c=a.className;return!!c&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(c)},addClass:function(a,b){return OpenLayers.Element.hasClass(a,b)||(a.className+=(a.className?" ":"")+b),a},removeClass:function(a,b){var c=a.className;return c&&(a.className=OpenLayers.String.trim(c.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," "))),a},toggleClass:function(a,b){return OpenLayers.Element.hasClass(a,b)?OpenLayers.Element.removeClass(a,b):OpenLayers.Element.addClass(a,b),a},getStyle:function(a,b){a=OpenLayers.Util.getElement(a);var c=null;if(a&&a.style){if(c=a.style[OpenLayers.String.camelize(b)],!c)if(document.defaultView&&document.defaultView.getComputedStyle){var d=document.defaultView.getComputedStyle(a,null);c=d?d.getPropertyValue(b):null}else a.currentStyle&&(c=a.currentStyle[OpenLayers.String.camelize(b)]);var e=["left","top","right","bottom"];window.opera&&OpenLayers.Util.indexOf(e,b)!=-1&&"static"==OpenLayers.Element.getStyle(a,"position")&&(c="auto")}return"auto"==c?null:c}},OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(a,b){OpenLayers.Util.isArray(a)&&(b=a[1],a=a[0]),this.lon=OpenLayers.Util.toFloat(a),this.lat=OpenLayers.Util.toFloat(b)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(a,b){if(null==a||null==b)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(a),this.lat+OpenLayers.Util.toFloat(b))},equals:function(a){var b=!1;return null!=a&&(b=this.lon==a.lon&&this.lat==a.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(a.lon)&&isNaN(a.lat)),b},transform:function(a,b){var c=OpenLayers.Projection.transform({x:this.lon,y:this.lat},a,b);return this.lon=c.x,this.lat=c.y,this},wrapDateLine:function(a){var b=this.clone();if(a){for(;b.lon<a.left;)b.lon+=a.getWidth();for(;b.lon>a.right;)b.lon-=a.getWidth()}return b},CLASS_NAME:"OpenLayers.LonLat"}),OpenLayers.LonLat.fromString=function(a){var b=a.split(",");return new OpenLayers.LonLat(b[0],b[1])},OpenLayers.LonLat.fromArray=function(a){var b=OpenLayers.Util.isArray(a),c=b&&a[0],d=b&&a[1];return new OpenLayers.LonLat(c,d)},OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(a,b){this.x=parseFloat(a),this.y=parseFloat(b)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(a){var b=!1;return null!=a&&(b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)),b},distanceTo:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},add:function(a,b){if(null==a||null==b)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+a,this.y+b)},offset:function(a){var b=this.clone();return a&&(b=this.add(a.x,a.y)),b},CLASS_NAME:"OpenLayers.Pixel"}),OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(a,b){this.w=parseFloat(a),this.h=parseFloat(b)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(a){var b=!1;return null!=a&&(b=this.w==a.w&&this.h==a.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(a.w)&&isNaN(a.h)),b},CLASS_NAME:"OpenLayers.Size"}),OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(a){alert(a)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var a=document.getElementsByTagName("script"),b=0,c=a.length;b<c;++b)if(a[b].src.indexOf("firebug.js")!=-1&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}(),OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(a){var b;a||(a="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);var c=a.split("-");if(c[0]=c[0].toLowerCase(),"object"==typeof OpenLayers.Lang[c[0]]&&(b=c[0]),c[1]){var d=c[0]+"-"+c[1].toUpperCase();"object"==typeof OpenLayers.Lang[d]&&(b=d)}b||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+c.join("-")+" dictionary, falling back to default language"),b=OpenLayers.Lang.defaultCode),OpenLayers.Lang.code=b},translate:function(a,b){var c=OpenLayers.Lang[OpenLayers.Lang.getCode()],d=c&&c[a];return d||(d=a),b&&(d=OpenLayers.String.format(d,b)),d}},OpenLayers.i18n=OpenLayers.Lang.translate,OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.getElement=function(){for(var a=[],b=0,c=arguments.length;b<c;b++){var d=arguments[b];if("string"==typeof d&&(d=document.getElementById(d)),1==arguments.length)return d;a.push(d)}return a},OpenLayers.Util.isElement=function(a){return!(!a||1!==a.nodeType)},OpenLayers.Util.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},OpenLayers.Util.removeItem=function(a,b){for(var c=a.length-1;c>=0;c--)a[c]==b&&a.splice(c,1);return a},OpenLayers.Util.indexOf=function(a,b){if("function"==typeof a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;c<d;c++)if(a[c]==b)return c;return-1},OpenLayers.Util.dotless=/\./g,OpenLayers.Util.modifyDOMElement=function(a,b,c,d,e,f,g,h){b&&(a.id=b.replace(OpenLayers.Util.dotless,"_")),c&&(a.style.left=c.x+"px",a.style.top=c.y+"px"),d&&(a.style.width=d.w+"px",a.style.height=d.h+"px"),e&&(a.style.position=e),f&&(a.style.border=f),g&&(a.style.overflow=g),parseFloat(h)>=0&&parseFloat(h)<1?(a.style.filter="alpha(opacity="+100*h+")",a.style.opacity=h):1==parseFloat(h)&&(a.style.filter="",a.style.opacity="")},OpenLayers.Util.createDiv=function(a,b,c,d,e,f,g,h){var i=document.createElement("div");return d&&(i.style.backgroundImage="url("+d+")"),a||(a=OpenLayers.Util.createUniqueID("OpenLayersDiv")),e||(e="absolute"),OpenLayers.Util.modifyDOMElement(i,a,b,c,e,f,g,h),i},OpenLayers.Util.createImage=function(a,b,c,d,e,f,g,h){function j(){i.style.display="",OpenLayers.Event.stopObservingElement(i)}var i=document.createElement("img");return a||(a=OpenLayers.Util.createUniqueID("OpenLayersDiv")),e||(e="relative"),OpenLayers.Util.modifyDOMElement(i,a,b,c,e,f,null,g),h&&(i.style.display="none",OpenLayers.Event.observe(i,"load",j),OpenLayers.Event.observe(i,"error",j)),i.style.alt=a,i.galleryImg="no",d&&(i.src=d),i},OpenLayers.IMAGE_RELOAD_ATTEMPTS=0,OpenLayers.Util.alphaHackNeeded=null,OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var a=navigator.appVersion.split("MSIE"),b=parseFloat(a[1]),c=!1;try{c=!!document.body.filters}catch(a){}OpenLayers.Util.alphaHackNeeded=c&&b>=5.5&&b<7}return OpenLayers.Util.alphaHackNeeded},OpenLayers.Util.modifyAlphaImageDiv=function(a,b,c,d,e,f,g,h,i){OpenLayers.Util.modifyDOMElement(a,b,c,d,f,null,null,i);var j=a.childNodes[0];e&&(j.src=e),OpenLayers.Util.modifyDOMElement(j,a.id+"_innerImage",null,d,"relative",g),OpenLayers.Util.alphaHack()&&("none"!=a.style.display&&(a.style.display="inline-block"),null==h&&(h="scale"),a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+j.src+"', sizingMethod='"+h+"')",parseFloat(a.style.opacity)>=0&&parseFloat(a.style.opacity)<1&&(a.style.filter+=" alpha(opacity="+100*a.style.opacity+")"),j.style.filter="alpha(opacity=0)")},OpenLayers.Util.createAlphaImageDiv=function(a,b,c,d,e,f,g,h,i){var j=OpenLayers.Util.createDiv(),k=OpenLayers.Util.createImage(null,null,null,null,null,null,null,i);return k.className="olAlphaImg",j.appendChild(k),OpenLayers.Util.modifyAlphaImageDiv(j,a,b,c,d,e,f,g,h),j},OpenLayers.Util.upperCaseObject=function(a){var b={};for(var c in a)b[c.toUpperCase()]=a[c];return b},OpenLayers.Util.applyDefaults=function(a,b){a=a||{};var c="function"==typeof window.Event&&b instanceof window.Event;for(var d in b)(void 0===a[d]||!c&&b.hasOwnProperty&&b.hasOwnProperty(d)&&!a.hasOwnProperty(d))&&(a[d]=b[d]);return!c&&b&&b.hasOwnProperty&&b.hasOwnProperty("toString")&&!a.hasOwnProperty("toString")&&(a.toString=b.toString),a},OpenLayers.Util.getParameterString=function(a){var b=[];for(var c in a){var d=a[c];if(null!=d&&"function"!=typeof d){var e;if("object"==typeof d&&d.constructor==Array){for(var g,f=[],h=0,i=d.length;h<i;h++)g=d[h],f.push(encodeURIComponent(null===g||void 0===g?"":g));e=f.join(",")}else e=encodeURIComponent(d);b.push(encodeURIComponent(c)+"="+e)}}return b.join("&")},OpenLayers.Util.urlAppend=function(a,b){var c=a;if(b){var d=(a+" ").split(/[?&]/);c+=" "===d.pop()?b:d.length?"&"+b:"?"+b}return c},OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"},OpenLayers.Util.getImageLocation=function(a){return OpenLayers.Util.getImagesLocation()+a},OpenLayers.Util.Try=function(){for(var a=null,b=0,c=arguments.length;b<c;b++){var d=arguments[b];try{a=d();break}catch(a){}}return a},OpenLayers.Util.getXmlNodeValue=function(a){var b=null;return OpenLayers.Util.Try(function(){b=a.text,b||(b=a.textContent),b||(b=a.firstChild.nodeValue)},function(){b=a.textContent}),b},OpenLayers.Util.mouseLeft=function(a,b){for(var c=a.relatedTarget?a.relatedTarget:a.toElement;c!=b&&null!=c;)c=c.parentNode;return c!=b},OpenLayers.Util.DEFAULT_PRECISION=14,OpenLayers.Util.toFloat=function(a,b){return null==b&&(b=OpenLayers.Util.DEFAULT_PRECISION),"number"!=typeof a&&(a=parseFloat(a)),0===b?a:parseFloat(a.toPrecision(b))},OpenLayers.Util.rad=function(a){return a*Math.PI/180},OpenLayers.Util.deg=function(a){return 180*a/Math.PI},OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},OpenLayers.Util.distVincenty=function(a,b){for(var c=OpenLayers.Util.VincentyConstants,d=c.a,e=c.b,f=c.f,g=OpenLayers.Util.rad(b.lon-a.lon),h=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(a.lat))),i=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(b.lat))),j=Math.sin(h),k=Math.cos(h),l=Math.sin(i),m=Math.cos(i),n=g,o=2*Math.PI,p=20;Math.abs(n-o)>1e-12&&--p>0;){var q=Math.sin(n),r=Math.cos(n),s=Math.sqrt(m*q*(m*q)+(k*l-j*m*r)*(k*l-j*m*r));if(0==s)return 0;var t=j*l+k*m*r,u=Math.atan2(s,t),v=Math.asin(k*m*q/s),w=Math.cos(v)*Math.cos(v),x=t-2*j*l/w,y=f/16*w*(4+f*(4-3*w));o=n,n=g+(1-y)*f*Math.sin(v)*(u+y*s*(x+y*t*(-1+2*x*x)))}if(0==p)return NaN;var z=w*(d*d-e*e)/(e*e),A=1+z/16384*(4096+z*(-768+z*(320-175*z))),B=z/1024*(256+z*(-128+z*(74-47*z))),C=B*s*(x+B/4*(t*(-1+2*x*x)-B/6*x*(-3+4*s*s)*(-3+4*x*x))),D=e*A*(u-C),E=D.toFixed(3)/1e3;return E},OpenLayers.Util.destinationVincenty=function(a,b,c){for(var d=OpenLayers.Util,e=d.VincentyConstants,f=e.a,g=e.b,h=e.f,i=a.lon,j=a.lat,k=c,l=d.rad(b),m=Math.sin(l),n=Math.cos(l),o=(1-h)*Math.tan(d.rad(j)),p=1/Math.sqrt(1+o*o),q=o*p,r=Math.atan2(o,n),s=p*m,t=1-s*s,u=t*(f*f-g*g)/(g*g),v=1+u/16384*(4096+u*(-768+u*(320-175*u))),w=u/1024*(256+u*(-128+u*(74-47*u))),x=k/(g*v),y=2*Math.PI;Math.abs(x-y)>1e-12;){var z=Math.cos(2*r+x),A=Math.sin(x),B=Math.cos(x),C=w*A*(z+w/4*(B*(-1+2*z*z)-w/6*z*(-3+4*A*A)*(-3+4*z*z)));y=x,x=k/(g*v)+C}var D=q*A-p*B*n,E=Math.atan2(q*B+p*A*n,(1-h)*Math.sqrt(s*s+D*D)),F=Math.atan2(A*m,p*B-q*A*n),G=h/16*t*(4+h*(4-3*t)),H=F-(1-G)*h*s*(x+G*A*(z+G*B*(-1+2*z*z)));Math.atan2(s,-D);return new OpenLayers.LonLat(i+d.deg(H),d.deg(E))},OpenLayers.Util.getParameters=function(a,b){b=b||{},a=null===a||void 0===a?window.location.href:a;var c="";if(OpenLayers.String.contains(a,"?")){var d=a.indexOf("?")+1,e=OpenLayers.String.contains(a,"#")?a.indexOf("#"):a.length;c=a.substring(d,e)}for(var f={},g=c.split(/[&;]/),h=0,i=g.length;h<i;++h){var j=g[h].split("=");if(j[0]){var k=j[0];try{k=decodeURIComponent(k)}catch(a){k=unescape(k)}var l=(j[1]||"").replace(/\+/g," ");try{l=decodeURIComponent(l)}catch(a){l=unescape(l)}b.splitArgs!==!1&&(l=l.split(",")),1==l.length&&(l=l[0]),f[k]=l}}return f},OpenLayers.Util.lastSeqID=0,OpenLayers.Util.createUniqueID=function(a){return a=null==a?"id_":a.replace(OpenLayers.Util.dotless,"_"),OpenLayers.Util.lastSeqID+=1,a+OpenLayers.Util.lastSeqID},OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36},OpenLayers.INCHES_PER_UNIT.in=OpenLayers.INCHES_PER_UNIT.inches,OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd,OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m,OpenLayers.METERS_PER_INCH=.0254000508001016,OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH}),OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH}),OpenLayers.DOTS_PER_INCH=72,OpenLayers.Util.normalizeScale=function(a){var b=a>1?1/a:a;return b},OpenLayers.Util.getResolutionFromScale=function(a,b){var c;if(a){null==b&&(b="degrees");var d=OpenLayers.Util.normalizeScale(a);c=1/(d*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH)}return c},OpenLayers.Util.getScaleFromResolution=function(a,b){null==b&&(b="degrees");var c=a*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH;return c},OpenLayers.Util.pagePosition=function(a){var b=[0,0],c=OpenLayers.Util.getViewportElement();if(!a||a==window||a==c)return b;var f,d=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(a,"position")&&(""==a.style.top||""==a.style.left),e=null;if(a.getBoundingClientRect){f=a.getBoundingClientRect();var g=window.pageYOffset||c.scrollTop,h=window.pageXOffset||c.scrollLeft;b[0]=f.left+h,b[1]=f.top+g}else if(document.getBoxObjectFor&&!d){f=document.getBoxObjectFor(a);var i=document.getBoxObjectFor(c);b[0]=f.screenX-i.screenX,b[1]=f.screenY-i.screenY}else{if(b[0]=a.offsetLeft,b[1]=a.offsetTop,e=a.offsetParent,e!=a)for(;e;)b[0]+=e.offsetLeft,b[1]+=e.offsetTop,e=e.offsetParent;var j=OpenLayers.BROWSER_NAME;for(("opera"==j||"safari"==j&&"absolute"==OpenLayers.Element.getStyle(a,"position"))&&(b[1]-=document.body.offsetTop),e=a.offsetParent;e&&e!=document.body;)b[0]-=e.scrollLeft,"opera"==j&&"TR"==e.tagName||(b[1]-=e.scrollTop),e=e.offsetParent}return b},OpenLayers.Util.getViewportElement=function(){var a=arguments.callee.viewportElement;return void 0==a&&(a="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=a),a},OpenLayers.Util.isEquivalentUrl=function(a,b,c){c=c||{},OpenLayers.Util.applyDefaults(c,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});var d=OpenLayers.Util.createUrlObject(a,c),e=OpenLayers.Util.createUrlObject(b,c);for(var f in d)if("args"!==f&&d[f]!=e[f])return!1;for(var f in d.args){if(d.args[f]!=e.args[f])return!1;delete e.args[f]}for(var f in e.args)return!1;return!0},OpenLayers.Util.createUrlObject=function(a,b){if(b=b||{},!/^\w+:\/\//.test(a)){var c=window.location,d=c.port?":"+c.port:"",e=c.protocol+"//"+c.host.split(":").shift()+d;if(0===a.indexOf("/"))a=e+a;else{var f=c.pathname.split("/");f.pop(),a=e+f.join("/")+"/"+a}}b.ignoreCase&&(a=a.toLowerCase());var g=document.createElement("a");g.href=a;var h={};h.host=g.host.split(":").shift(),h.protocol=g.protocol,b.ignorePort80?h.port="80"==g.port||"0"==g.port?"":g.port:h.port=""==g.port||"0"==g.port?"80":g.port,h.hash=b.ignoreHash||"#"===g.hash?"":g.hash;var i=g.search;if(!i){var j=a.indexOf("?");i=j!=-1?a.substr(j):""}return h.args=OpenLayers.Util.getParameters(i,{splitArgs:b.splitArgs}),h.pathname="/"==g.pathname.charAt(0)?g.pathname:"/"+g.pathname,h},OpenLayers.Util.removeTail=function(a){var b=null,c=a.indexOf("?"),d=a.indexOf("#");return b=c==-1?d!=-1?a.substr(0,d):a:d!=-1?a.substr(0,Math.min(c,d)):a.substr(0,c)},OpenLayers.IS_GECKO=function(){var a=navigator.userAgent.toLowerCase();return a.indexOf("webkit")==-1&&a.indexOf("gecko")!=-1}(),OpenLayers.CANVAS_SUPPORTED=function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}(),OpenLayers.BROWSER_NAME=function(){var a="",b=navigator.userAgent.toLowerCase();return b.indexOf("opera")!=-1?a="opera":b.indexOf("msie")!=-1?a="msie":b.indexOf("safari")!=-1?a="safari":b.indexOf("mozilla")!=-1&&(a=b.indexOf("firefox")!=-1?"firefox":"mozilla"),a}(),OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME},OpenLayers.Util.getRenderedDimensions=function(a,b,c){var d,e,f=document.createElement("div");f.style.visibility="hidden";for(var g=c&&c.containerElement?c.containerElement:document.body,h=!1,i=null,j=g;j&&"body"!=j.tagName.toLowerCase();){var k=OpenLayers.Element.getStyle(j,"position");if("absolute"==k){h=!0;break}if(k&&"static"!=k)break;j=j.parentNode}!h||0!==g.clientHeight&&0!==g.clientWidth||(i=document.createElement("div"),i.style.visibility="hidden",i.style.position="absolute",i.style.overflow="visible",i.style.width=document.body.clientWidth+"px",i.style.height=document.body.clientHeight+"px",i.appendChild(f)),f.style.position="absolute",b&&(b.w?(d=b.w,f.style.width=d+"px"):b.h&&(e=b.h,f.style.height=e+"px")),c&&c.displayClass&&(f.className=c.displayClass);var l=document.createElement("div");if(l.innerHTML=a,l.style.overflow="visible",l.childNodes)for(var m=0,n=l.childNodes.length;m<n;m++)l.childNodes[m].style&&(l.childNodes[m].style.overflow="visible");return f.appendChild(l),i?g.appendChild(i):g.appendChild(f),d||(d=parseInt(l.scrollWidth),f.style.width=d+"px"),e||(e=parseInt(l.scrollHeight)),f.removeChild(l),i?(i.removeChild(f),g.removeChild(i)):g.removeChild(f),new OpenLayers.Size(d,e)},OpenLayers.Util.getScrollbarWidth=function(){var a=OpenLayers.Util._scrollbarWidth;if(null==a){var b=null,c=null,d=0,e=0;b=document.createElement("div"),b.style.position="absolute",b.style.top="-1000px",b.style.left="-1000px",b.style.width="100px",b.style.height="50px",b.style.overflow="hidden",c=document.createElement("div"),c.style.width="100%",c.style.height="200px",b.appendChild(c),document.body.appendChild(b),d=c.offsetWidth,b.style.overflow="scroll",e=c.offsetWidth,document.body.removeChild(document.body.lastChild),OpenLayers.Util._scrollbarWidth=d-e,a=OpenLayers.Util._scrollbarWidth}return a},OpenLayers.Util.getFormattedLonLat=function(a,b,c){c||(c="dms"),a=(a+540)%360-180;var d=Math.abs(a),e=Math.floor(d),f=(d-e)/(1/60),g=f;f=Math.floor(f);var h=(g-f)/(1/60);h=Math.round(10*h),h/=10,h>=60&&(h-=60,f+=1,f>=60&&(f-=60,e+=1)),e<10&&(e="0"+e);var i=e+"°";return c.indexOf("dm")>=0&&(f<10&&(f="0"+f),i+=f+"'",c.indexOf("dms")>=0&&(h<10&&(h="0"+h),i+=h+'"')),i+="lon"==b?a<0?OpenLayers.i18n("W"):OpenLayers.i18n("E"):a<0?OpenLayers.i18n("S"):OpenLayers.i18n("N")},OpenLayers.Util.getConstructor=function(a){var b,c=a.split(".");b="OpenLayers"===c[0]?OpenLayers:window[c[0]];for(var d=1,e=c.length;d<e;++d)b=b[c[d]];return b},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.vendorPrefix=function(){"use strict";function e(a){return a?a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function f(a){if(void 0===c[a]){var b=a.replace(/(-[\s\S])/g,function(a){
return a.charAt(1).toUpperCase()}),d=h(b);c[a]=e(d)}return c[a]}function g(b,c){if(void 0===d[c]){var e,h,f=0,g=a.length,i="undefined"!=typeof b.cssText;for(d[c]=null;f<g;f++)if(h=a[f],h?(i||(h=h.toLowerCase()),e=h+c.charAt(0).toUpperCase()+c.slice(1)):e=c,void 0!==b[e]){d[c]=e;break}}return d[c]}function h(a){return g(b,a)}var a=["","O","ms","Moz","Webkit"],b=document.createElement("div").style,c={},d={};return{css:f,js:g,style:h,cssCache:c,jsCache:d}}(),OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},isSingleTouch:function(a){return a.touches&&1==a.touches.length},isMultiTouch:function(a){return a.touches&&a.touches.length>1},isLeftClick:function(a){return a.which&&1==a.which||a.button&&1==a.button},isRightClick:function(a){return a.which&&3==a.which||a.button&&2==a.button},stop:function(a,b){b||OpenLayers.Event.preventDefault(a),a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},findElement:function(a,b){for(var c=OpenLayers.Event.element(a);c.parentNode&&(!c.tagName||c.tagName.toUpperCase()!=b.toUpperCase());)c=c.parentNode;return c},observe:function(a,b,c,d){var e=OpenLayers.Util.getElement(a);if(d=d||!1,"keypress"==b&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.attachEvent)&&(b="keydown"),this.observers||(this.observers={}),!e._eventCacheID){var f="eventCacheID_";e.id&&(f=e.id+"_"+f),e._eventCacheID=OpenLayers.Util.createUniqueID(f)}var g=e._eventCacheID;this.observers[g]||(this.observers[g]=[]),this.observers[g].push({element:e,name:b,observer:c,useCapture:d}),e.addEventListener?e.addEventListener(b,c,d):e.attachEvent&&e.attachEvent("on"+b,c)},stopObservingElement:function(a){var b=OpenLayers.Util.getElement(a),c=b._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[c])},_removeElementObservers:function(a){if(a)for(var b=a.length-1;b>=0;b--){var c=a[b];OpenLayers.Event.stopObserving.apply(this,[c.element,c.name,c.observer,c.useCapture])}},stopObserving:function(a,b,c,d){d=d||!1;var e=OpenLayers.Util.getElement(a),f=e._eventCacheID;"keypress"==b&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.detachEvent)&&(b="keydown");var g=!1,h=OpenLayers.Event.observers[f];if(h)for(var i=0;!g&&i<h.length;){var j=h[i];if(j.name==b&&j.observer==c&&j.useCapture==d){h.splice(i,1),0==h.length&&delete OpenLayers.Event.observers[f],g=!0;break}i++}return g&&(e.removeEventListener?e.removeEventListener(b,c,d):e&&e.detachEvent&&e.detachEvent("on"+b,c)),g},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var a in OpenLayers.Event.observers){var b=OpenLayers.Event.observers[a];OpenLayers.Event._removeElementObservers.apply(this,[b])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(a,b,c,d,e){OpenLayers.Util.extend(this,e),this.object=a,this.fallThrough=d,this.listeners={},this.extensions={},this.extensionCount={},this._msTouches=[],null!=b&&this.attachToElement(b)},destroy:function(){for(var a in this.extensions)"boolean"!=typeof this.extensions[a]&&this.extensions[a].destroy();this.extensions=null,this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.fallThrough=null,this.eventHandler=null},addEventType:function(a){},attachToElement:function(a){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)),this.element=a;for(var c,b=!!window.navigator.msMaxTouchPoints,d=0,e=this.BROWSER_EVENTS.length;d<e;d++)c=this.BROWSER_EVENTS[d],OpenLayers.Event.observe(a,c,this.eventHandler),b&&0===c.indexOf("touch")&&this.addMsTouchListener(a,c,this.eventHandler);OpenLayers.Event.observe(a,"dragstart",OpenLayers.Event.stop)},on:function(a){for(var b in a)"scope"!=b&&a.hasOwnProperty(b)&&this.register(b,a.scope,a[b])},register:function(a,b,c,d){if(a in OpenLayers.Events&&!this.extensions[a]&&(this.extensions[a]=new OpenLayers.Events[a](this)),null!=c){null==b&&(b=this.object);var e=this.listeners[a];e||(e=[],this.listeners[a]=e,this.extensionCount[a]=0);var f={obj:b,func:c};d?(e.splice(this.extensionCount[a],0,f),"object"==typeof d&&d.extension&&this.extensionCount[a]++):e.push(f)}},registerPriority:function(a,b,c){this.register(a,b,c,!0)},un:function(a){for(var b in a)"scope"!=b&&a.hasOwnProperty(b)&&this.unregister(b,a.scope,a[b])},unregister:function(a,b,c){null==b&&(b=this.object);var d=this.listeners[a];if(null!=d)for(var e=0,f=d.length;e<f;e++)if(d[e].obj==b&&d[e].func==c){d.splice(e,1);break}},remove:function(a){null!=this.listeners[a]&&(this.listeners[a]=[])},triggerEvent:function(a,b){var c=this.listeners[a];if(c&&0!=c.length){null==b&&(b={}),b.object=this.object,b.element=this.element,b.type||(b.type=a),c=c.slice();for(var d,e=0,f=c.length;e<f;e++){var g=c[e];if(d=g.func.apply(g.obj,[b]),void 0!=d&&0==d)break}return this.fallThrough||OpenLayers.Event.stop(b,!0),d}},handleBrowserEvent:function(a){var b=a.type,c=this.listeners[b];if(c&&0!=c.length){var d=a.touches;if(d&&d[0]){for(var h,e=0,f=0,g=d.length,i=0;i<g;++i)h=this.getTouchClientXY(d[i]),e+=h.clientX,f+=h.clientY;a.clientX=e/g,a.clientY=f/g}this.includeXY&&(a.xy=this.getMousePosition(a)),this.triggerEvent(b,a)}},getTouchClientXY:function(a){var b=window.olMockWin||window,c=b.pageXOffset,d=b.pageYOffset,e=a.clientX,f=a.clientY;return 0===a.pageY&&Math.floor(f)>Math.floor(a.pageY)||0===a.pageX&&Math.floor(e)>Math.floor(a.pageX)?(e-=c,f-=d):(f<a.pageY-d||e<a.pageX-c)&&(e=a.pageX-c,f=a.pageY-d),a.olClientX=e,a.olClientY=f,{clientX:e,clientY:f}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null,this.element.offsets=null},getMousePosition:function(a){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var b=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||b.scrollLeft,window.pageYOffset||b.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(a.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],a.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(a,b,c){function f(a){c(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var a=e.length-1;a>=0;--a)e[a].stopPropagation()},preventDefault:function(){for(var a=e.length-1;a>=0;--a)e[a].preventDefault()},type:b},a))}var e=(this.eventHandler,this._msTouches);switch(b){case"touchstart":return this.addMsTouchListenerStart(a,b,f);case"touchend":return this.addMsTouchListenerEnd(a,b,f);case"touchmove":return this.addMsTouchListenerMove(a,b,f);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(a,b,c){var d=this._msTouches,e=function(a){for(var b=!1,e=0,f=d.length;e<f;++e)if(d[e].pointerId==a.pointerId){b=!0;break}b||d.push(a),a.touches=d.slice(),c(a)};OpenLayers.Event.observe(a,"MSPointerDown",e);var f=function(a){for(var b=0,c=d.length;b<c;++b)if(d[b].pointerId==a.pointerId){d.splice(b,1);break}};OpenLayers.Event.observe(a,"MSPointerUp",f)},addMsTouchListenerMove:function(a,b,c){var d=this._msTouches,e=function(a){if(!(a.pointerType==a.MSPOINTER_TYPE_MOUSE&&0==a.buttons||1==d.length&&d[0].pageX==a.pageX&&d[0].pageY==a.pageY)){for(var b=0,e=d.length;b<e;++b)if(d[b].pointerId==a.pointerId){d[b]=a;break}a.touches=d.slice(),c(a)}};OpenLayers.Event.observe(a,"MSPointerMove",e)},addMsTouchListenerEnd:function(a,b,c){var d=this._msTouches,e=function(a){for(var b=0,e=d.length;b<e;++b)if(d[b].pointerId==a.pointerId){d.splice(b,1);break}a.touches=d.slice(),c(a)};OpenLayers.Event.observe(a,"MSPointerUp",e)},CLASS_NAME:"OpenLayers.Events"}),OpenLayers.Animation=function(a){function g(a,b,c){b=b>0?b:Number.POSITIVE_INFINITY;var g=++e,h=+new Date;return f[g]=function(){f[g]&&+new Date-h<=b?(a(),f[g]&&d(f[g],c)):delete f[g]},d(f[g],c),g}function h(a){delete f[a]}var b=OpenLayers.Util.vendorPrefix.js(a,"requestAnimationFrame"),c=!!b,d=function(){var c=a[b]||function(b,c){a.setTimeout(b,16)};return function(b,d){c.apply(a,[b,d])}}(),e=0,f={};return{isNative:c,requestFrame:d,start:g,stop:h}}(window),OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(a){this.easing=a?a:OpenLayers.Easing.Expo.easeOut},start:function(a,b,c,d){this.playing=!0,this.begin=a,this.finish=b,this.duration=c,this.callbacks=d.callbacks,this.minFrameRate=d.minFrameRate||30,this.time=0,this.startTime=(new Date).getTime(),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin),this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var a={};for(var b in this.begin){var c=this.begin[b],d=this.finish[b];if(null==c||null==d||isNaN(c)||isNaN(d))throw new TypeError("invalid value for Tween");var e=d-c;a[b]=this.easing.apply(this,[this.time,c,e,this.duration])}this.time++,this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1e3/this.minFrameRate&&this.callbacks.eachStep.call(this,a),this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"}),OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"},OpenLayers.Easing.Linear={easeIn:function(a,b,c,d){return c*a/d+b},easeOut:function(a,b,c,d){return c*a/d+b},easeInOut:function(a,b,c,d){return c*a/d+b},CLASS_NAME:"OpenLayers.Easing.Linear"},OpenLayers.Easing.Expo={easeIn:function(a,b,c,d){return 0==a?b:c*Math.pow(2,10*(a/d-1))+b},easeOut:function(a,b,c,d){return a==d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b},easeInOut:function(a,b,c,d){return 0==a?b:a==d?b+c:(a/=d/2)<1?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b},CLASS_NAME:"OpenLayers.Easing.Expo"},OpenLayers.Easing.Quad={easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},CLASS_NAME:"OpenLayers.Easing.Quad"},OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(a,b){OpenLayers.Util.extend(this,b),this.projCode=a,"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(a))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(a){var b=a,c=!1;if(b)if(b instanceof OpenLayers.Projection||(b=new OpenLayers.Projection(b)),"object"==typeof Proj4js&&this.proj.defData&&b.proj.defData)c=this.proj.defData.replace(this.titleRegEx,"")==b.proj.defData.replace(this.titleRegEx,"");else if(b.getCode){var d=this.getCode(),e=b.getCode();c=d==e||!!OpenLayers.Projection.transforms[d]&&OpenLayers.Projection.transforms[d][e]===OpenLayers.Projection.nullTransform}return c},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"OpenLayers.Projection"}),OpenLayers.Projection.transforms={},OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}},OpenLayers.Projection.addTransform=function(a,b,c){if(c===OpenLayers.Projection.nullTransform){var d=OpenLayers.Projection.defaults[a];d&&!OpenLayers.Projection.defaults[b]&&(OpenLayers.Projection.defaults[b]=d)}OpenLayers.Projection.transforms[a]||(OpenLayers.Projection.transforms[a]={}),OpenLayers.Projection.transforms[a][b]=c},OpenLayers.Projection.transform=function(a,b,c){if(b&&c)if(b instanceof OpenLayers.Projection||(b=new OpenLayers.Projection(b)),c instanceof OpenLayers.Projection||(c=new OpenLayers.Projection(c)),b.proj&&c.proj)a=Proj4js.transform(b.proj,c.proj,a);else{var d=b.getCode(),e=c.getCode(),f=OpenLayers.Projection.transforms;f[d]&&f[d][e]&&f[d][e](a)}return a},OpenLayers.Projection.nullTransform=function(a){return a},function(){function b(b){return b.x=180*b.x/a,b.y=180/Math.PI*(2*Math.atan(Math.exp(b.y/a*Math.PI))-Math.PI/2),b}function c(b){b.x=b.x*a/180;var c=Math.log(Math.tan((90+b.y)*Math.PI/360))/Math.PI*a;return b.y=Math.max(-20037508.34,Math.min(c,20037508.34)),b}function d(a,d){var g,h,i,j,k,e=OpenLayers.Projection.addTransform,f=OpenLayers.Projection.nullTransform;for(g=0,h=d.length;g<h;++g)for(i=d[g],e(a,i,c),e(i,a,b),k=g+1;k<h;++k)j=d[k],e(i,j,f),e(j,i,f)}var g,a=20037508.34,e=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100","OSGEO:41001"],f=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(g=e.length-1;g>=0;--g)d(e[g],f);for(g=f.length-1;g>=0;--g)d(f[g],e)}(),OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(a,b){1===arguments.length&&"object"==typeof a&&(b=a,a=b&&b.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15),this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css",this.options=OpenLayers.Util.extend({},b),OpenLayers.Util.extend(this,b);var c=this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection;OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[c]),!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent)),!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent)),!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent)),!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center)),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(a),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap");var d=this.id+"_OpenLayers_ViewPort";if(this.viewPortDiv=OpenLayers.Util.createDiv(d,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv),this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0}),OpenLayers.TileManager&&null!==this.tileManager&&(this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager)),this.tileManager.addMap(this)),d=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(d),this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1,this.layerContainerOriginPx={x:0,y:0},this.applyTransform(),this.viewPortDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),this.autoUpdateSize===!0&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(var e=!0,f=document.getElementsByTagName("link"),g=0,h=f.length;g<h;++g)if(OpenLayers.Util.isEquivalentUrl(f.item(g).href,this.theme)){e=!1;break}if(e){var i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(i)}}null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)));for(var g=0,h=this.controls.length;g<h;g++)this.addControlToMap(this.controls[g]);this.popups=[],this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this),OpenLayers.Event.observe(window,"unload",this.unloadDestroy),b&&b.layers&&(delete this.center,delete this.zoom,this.addLayers(b.layers),b.center&&!this.getCenter()&&this.setCenter(b.center,b.zoom)),this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod)),this.zoomMethod&&this.applyTransform.transform&&(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(a){this.div=OpenLayers.Util.getElement(a),OpenLayers.Element.addClass(this.div,"olMap"),this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.div.appendChild(this.viewPortDiv),this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),this.zoomTween&&(this.zoomTween.stop(),this.zoomTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy),this.paddingForPopups=null,null!=this.controls){for(var a=this.controls.length-1;a>=0;--a)this.controls[a].destroy();this.controls=null}if(null!=this.layers){for(var a=this.layers.length-1;a>=0;--a)this.layers[a].destroy(!1);this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.viewPortDiv=null,this.tileManager&&(this.tileManager.removeMap(this),this.tileManager=null),this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null),this.events.destroy(),this.events=null,this.options=null},setOptions:function(a){var b=this.minPx&&a.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,a),b&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(a,b,c){var d="function"==typeof c.test,e=OpenLayers.Array.filter(this[a],function(a){return a[b]==c||d&&c.test(a[b])});return e},getLayersBy:function(a,b){return this.getBy("layers",a,b)},getLayersByName:function(a){return this.getLayersBy("name",a)},getLayersByClass:function(a){return this.getLayersBy("CLASS_NAME",a)},getControlsBy:function(a,b){return this.getBy("controls",a,b)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},getLayer:function(a){for(var b=null,c=0,d=this.layers.length;c<d;c++){var e=this.layers[c];if(e.id==a){b=e;break}}return b},setLayerZIndex:function(a,b){a.setZIndex(this.Z_INDEX_BASE[a.isBaseLayer?"BaseLayer":"Overlay"]+5*b)},resetLayersZIndex:function(){for(var a=0,b=this.layers.length;a<b;a++){var c=this.layers[a];this.setLayerZIndex(c,a)}},addLayer:function(a){for(var b=0,c=this.layers.length;b<c;b++)if(this.layers[b]==a)return!1;return this.events.triggerEvent("preaddlayer",{layer:a})!==!1&&(this.allOverlays&&(a.isBaseLayer=!1),a.div.className="olLayerDiv",a.div.style.overflow="",this.setLayerZIndex(a,this.layers.length),a.isFixed?this.viewPortDiv.appendChild(a.div):this.layerContainerDiv.appendChild(a.div),this.layers.push(a),a.setMap(this),a.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(a):a.setVisibility(!1):a.redraw(),this.events.triggerEvent("addlayer",{layer:a}),a.events.triggerEvent("added",{map:this,layer:a}),a.afterAdd(),!0)},addLayers:function(a){for(var b=0,c=a.length;b<c;b++)this.addLayer(a[b])},removeLayer:function(a,b){if(this.events.triggerEvent("preremovelayer",{layer:a})!==!1){if(null==b&&(b=!0),a.isFixed?this.viewPortDiv.removeChild(a.div):this.layerContainerDiv.removeChild(a.div),OpenLayers.Util.removeItem(this.layers,a),a.removeMap(this),a.map=null,this.baseLayer==a&&(this.baseLayer=null,b))for(var c=0,d=this.layers.length;c<d;c++){var e=this.layers[c];if(e.isBaseLayer||this.allOverlays){this.setBaseLayer(e);break}}this.resetLayersZIndex(),this.events.triggerEvent("removelayer",{layer:a}),a.events.triggerEvent("removed",{map:this,layer:a})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(a){return OpenLayers.Util.indexOf(this.layers,a)},setLayerIndex:function(a,b){var c=this.getLayerIndex(a);if(b<0?b=0:b>this.layers.length&&(b=this.layers.length),c!=b){this.layers.splice(c,1),this.layers.splice(b,0,a);for(var d=0,e=this.layers.length;d<e;d++)this.setLayerZIndex(this.layers[d],d);this.events.triggerEvent("changelayer",{layer:a,property:"order"}),this.allOverlays&&(0===b?this.setBaseLayer(a):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(a,b){var c=this.getLayerIndex(a)+b;this.setLayerIndex(a,c)},setBaseLayer:function(a){if(a!=this.baseLayer&&OpenLayers.Util.indexOf(this.layers,a)!=-1){var b=this.getCachedCenter(),c=OpenLayers.Util.getResolutionFromScale(this.getScale(),a.units);if(null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1),this.baseLayer=a,this.allOverlays&&!this.baseLayer.visibility||(this.baseLayer.setVisibility(!0),this.baseLayer.inRange===!1&&this.baseLayer.redraw()),null!=b){var d=this.getZoomForResolution(c||this.resolution,!0);this.setCenter(b,d,!1,!0)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(a,b){this.controls.push(a),this.addControlToMap(a,b)},addControls:function(a,b){for(var c=1===arguments.length?[]:b,d=0,e=a.length;d<e;d++){var f=a[d],g=c[d]?c[d]:null;this.addControl(f,g)}},addControlToMap:function(a,b){a.outsideViewport=null!=a.div,this.displayProjection&&!a.displayProjection&&(a.displayProjection=this.displayProjection),a.setMap(this);var c=a.draw(b);c&&(a.outsideViewport||(c.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(c))),a.autoActivate&&a.activate()},getControl:function(a){for(var b=null,c=0,d=this.controls.length;c<d;c++){var e=this.controls[c];if(e.id==a){b=e;break}}return b},removeControl:function(a){a&&a==this.getControl(a.id)&&(a.div&&a.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(a.div),OpenLayers.Util.removeItem(this.controls,a))},addPopup:function(a,b){if(b)for(var c=this.popups.length-1;c>=0;--c)this.removePopup(this.popups[c]);a.map=this,this.popups.push(a);var d=a.draw();d&&(d.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(d))},removePopup:function(a){if(OpenLayers.Util.removeItem(this.popups,a),a.div)try{this.layerContainerDiv.removeChild(a.div)}catch(a){}a.map=null},getSize:function(){var a=null;return null!=this.size&&(a=this.size.clone()),a},updateSize:function(){var a=this.getCurrentSize();if(a&&!isNaN(a.h)&&!isNaN(a.w)){this.events.clearMouseCache();var b=this.getSize();if(null==b&&(this.size=b=a),!a.equals(b)){this.size=a;for(var c=0,d=this.layers.length;c<d;c++)this.layers[c].onMapResize();var e=this.getCachedCenter();if(null!=this.baseLayer&&null!=e){var f=this.getZoom();this.zoom=null,this.setCenter(e,f)}}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var a=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(0==a.w&&0==a.h||isNaN(a.w)&&isNaN(a.h))&&(a.w=this.div.offsetWidth,a.h=this.div.offsetHeight),(0==a.w&&0==a.h||isNaN(a.w)&&isNaN(a.h))&&(a.w=parseInt(this.div.style.width),a.h=parseInt(this.div.style.height)),a},calculateBounds:function(a,b){var c=null;if(null==a&&(a=this.getCachedCenter()),null==b&&(b=this.getResolution()),null!=a&&null!=b){var d=this.size.w*b/2,e=this.size.h*b/2;c=new OpenLayers.Bounds(a.lon-d,a.lat-e,a.lon+d,a.lat+e)}return c},getCenter:function(){var a=null,b=this.getCachedCenter();return b&&(a=b.clone()),a},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})),this.center},getZoom:function(){return this.zoom},pan:function(a,b,c){if(c=OpenLayers.Util.applyDefaults(c,{animate:!0,dragging:!1}),c.dragging)0==a&&0==b||this.moveByPx(a,b);else{var d=this.getViewPortPxFromLonLat(this.getCachedCenter()),e=d.add(a,b);if(this.dragging||!e.equals(d)){var f=this.getLonLatFromViewPortPx(e);c.animate?this.panTo(f):(this.moveTo(f),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend")))}}},panTo:function(a){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(a)){var b=this.getCachedCenter();if(a.equals(b))return;var c=this.getPixelFromLonLat(b),d=this.getPixelFromLonLat(a),e={x:d.x-c.x,y:d.y-c.y},f={x:0,y:0};this.panTween.start({x:0,y:0},e,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(a){var b=a.x-f.x,c=a.y-f.y;this.moveByPx(b,c),f.x=Math.round(a.x),f.y=Math.round(a.y)},this),done:OpenLayers.Function.bind(function(b){this.moveTo(a),this.dragging=!1,this.events.triggerEvent("moveend")},this)}})}else this.setCenter(a)},setCenter:function(a,b,c,d){this.panTween&&this.panTween.stop(),this.zoomTween&&this.zoomTween.stop(),this.moveTo(a,b,{dragging:c,forceZoomChange:d})},moveByPx:function(a,b){var c=this.size.w/2,d=this.size.h/2,e=c+a,f=d+b,g=this.baseLayer.wrapDateLine,h=0,i=0;if(this.restrictedExtent&&(h=c,i=d,g=!1),a=g||e<=this.maxPx.x-h&&e>=this.minPx.x+h?Math.round(a):0,b=f<=this.maxPx.y-i&&f>=this.minPx.y+i?Math.round(b):0,a||b){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,a&&(this.layerContainerOriginPx.x-=a,this.minPx.x-=a,this.maxPx.x-=a),b&&(this.layerContainerOriginPx.y-=b,this.minPx.y-=b,this.maxPx.y-=b),this.applyTransform();var j,k,l;for(k=0,l=this.layers.length;k<l;++k)j=this.layers[k],j.visibility&&(j===this.baseLayer||j.inRange)&&(j.moveByPx(a,b),j.events.triggerEvent("move"));this.events.triggerEvent("move")}},adjustZoom:function(a){if(this.baseLayer&&this.baseLayer.wrapDateLine){var c=this.baseLayer.resolutions,d=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(a)>d)if(this.fractionalZoom)a=this.getZoomForResolution(d);else for(var e=0|a,f=c.length;e<f;++e)if(c[e]<=d){a=e;break}}return a},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(a,b,c){null==a||a instanceof OpenLayers.LonLat||(a=new OpenLayers.LonLat(a)),c||(c={}),null!=b&&(b=parseFloat(b),this.fractionalZoom||(b=Math.round(b)));var d=b;b=this.adjustZoom(b),b!==d&&(a=this.getCenter());var e=c.dragging||this.dragging,f=c.forceZoomChange;if(this.getCachedCenter()||this.isValidLonLat(a)||(a=this.maxExtent.getCenterLonLat(),this.center=a.clone()),null!=this.restrictedExtent){null==a&&(a=this.center),null==b&&(b=this.getZoom());var g=this.getResolutionForZoom(b),h=this.calculateBounds(a,g);if(!this.restrictedExtent.containsBounds(h)){var i=this.restrictedExtent.getCenterLonLat();h.getWidth()>this.restrictedExtent.getWidth()?a=new OpenLayers.LonLat(i.lon,a.lat):h.left<this.restrictedExtent.left?a=a.add(this.restrictedExtent.left-h.left,0):h.right>this.restrictedExtent.right&&(a=a.add(this.restrictedExtent.right-h.right,0)),h.getHeight()>this.restrictedExtent.getHeight()?a=new OpenLayers.LonLat(a.lon,i.lat):h.bottom<this.restrictedExtent.bottom?a=a.add(0,this.restrictedExtent.bottom-h.bottom):h.top>this.restrictedExtent.top&&(a=a.add(0,this.restrictedExtent.top-h.top))}}var j=f||this.isValidZoomLevel(b)&&b!=this.getZoom(),k=this.isValidLonLat(a)&&!a.equals(this.center);if(j||k||e){e||this.events.triggerEvent("movestart",{zoomChanged:j}),k&&(!j&&this.center&&this.centerLayerContainer(a),this.center=a.clone());var l=j?this.getResolutionForZoom(b):this.getResolution();if(j||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter(),this.layerContainerOriginPx.x=0,this.layerContainerOriginPx.y=0,this.applyTransform();var m=this.getMaxExtent({restricted:!0}),n=m.getCenterLonLat(),o=this.center.lon-n.lon,p=n.lat-this.center.lat,q=Math.round(m.getWidth()/l),r=Math.round(m.getHeight()/l);this.minPx={x:(this.size.w-q)/2-o/l,y:(this.size.h-r)/2-p/l},this.maxPx={x:this.minPx.x+Math.round(m.getWidth()/l),y:this.minPx.y+Math.round(m.getHeight()/l)}}j&&(this.zoom=b,this.resolution=l);var s=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(s,j,c.dragging),c.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:j})),s=this.baseLayer.getExtent();for(var t=this.layers.length-1;t>=0;--t){var u=this.layers[t];if(u!==this.baseLayer&&!u.isBaseLayer){var v=u.calculateInRange();u.inRange!=v&&(u.inRange=v,v||u.display(!1),this.events.triggerEvent("changelayer",{layer:u,property:"visibility"})),v&&u.visibility&&(u.moveTo(s,j,c.dragging),c.dragging||u.events.triggerEvent("moveend",{zoomChanged:j}))}}if(this.events.triggerEvent("move"),e||this.events.triggerEvent("moveend"),j){for(var t=0,w=this.popups.length;t<w;t++)this.popups[t].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(a){var b=this.getViewPortPxFromLonLat(this.layerContainerOrigin),c=this.getViewPortPxFromLonLat(a);if(null!=b&&null!=c){var d=this.layerContainerOriginPx.x,e=this.layerContainerOriginPx.y,f=Math.round(b.x-c.x),g=Math.round(b.y-c.y);this.applyTransform(this.layerContainerOriginPx.x=f,this.layerContainerOriginPx.y=g);var h=d-f,i=e-g;this.minPx.x-=h,this.maxPx.x-=h,this.minPx.y-=i,this.maxPx.y-=i}},isValidZoomLevel:function(a){return null!=a&&a>=0&&a<this.getNumZoomLevels()},isValidLonLat:function(a){var b=!1;if(null!=a){var c=this.getMaxExtent(),d=this.baseLayer.wrapDateLine&&c;b=c.containsLonLat(a,{worldBounds:d})}return b},getProjection:function(){var a=this.getProjectionObject();return a?a.getCode():null},getProjectionObject:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.projection),a},getMaxResolution:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.maxResolution),a},getMaxExtent:function(a){var b=null;return a&&a.restricted&&this.restrictedExtent?b=this.restrictedExtent:null!=this.baseLayer&&(b=this.baseLayer.maxExtent),
b},getNumZoomLevels:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.numZoomLevels),a},getExtent:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.getExtent()),a},getResolution:function(){var a=null;return null!=this.baseLayer?a=this.baseLayer.getResolution():this.allOverlays===!0&&this.layers.length>0&&(a=this.layers[0].getResolution()),a},getUnits:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.units),a},getScale:function(){var a=null;if(null!=this.baseLayer){var b=this.getResolution(),c=this.baseLayer.units;a=OpenLayers.Util.getScaleFromResolution(b,c)}return a},getZoomForExtent:function(a,b){var c=null;return null!=this.baseLayer&&(c=this.baseLayer.getZoomForExtent(a,b)),c},getResolutionForZoom:function(a){var b=null;return this.baseLayer&&(b=this.baseLayer.getResolutionForZoom(a)),b},getZoomForResolution:function(a,b){var c=null;return null!=this.baseLayer&&(c=this.baseLayer.getZoomForResolution(a,b)),c},zoomTo:function(a,b){var c=this;if(c.isValidZoomLevel(a))if(c.baseLayer.wrapDateLine&&(a=c.adjustZoom(a)),c.zoomTween){var d=c.getResolution(),e=c.getResolutionForZoom(a),f={scale:1},g={scale:d/e};if(c.zoomTween.playing&&c.zoomTween.duration<3*c.zoomDuration)c.zoomTween.finish={scale:c.zoomTween.finish.scale*g.scale};else{if(!b){var h=c.getSize();b={x:h.w/2,y:h.h/2}}c.zoomTween.start(f,g,c.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(a){var d=c.layerContainerOriginPx,e=a.scale,f=(e-1)*(d.x-b.x)|0,g=(e-1)*(d.y-b.y)|0;c.applyTransform(d.x+f,d.y+g,e)},done:function(a){c.applyTransform();var d=c.getResolution()/a.scale,e=c.getZoomForResolution(d,!0);c.moveTo(c.getZoomTargetCenter(b,d),e,!0)}}})}}else{var i=b?c.getZoomTargetCenter(b,c.getResolutionForZoom(a)):null;c.setCenter(i,a)}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(a,b){a instanceof OpenLayers.Bounds||(a=new OpenLayers.Bounds(a));var c=a.getCenterLonLat();if(this.baseLayer.wrapDateLine){var d=this.getMaxExtent();for(a=a.clone();a.right<a.left;)a.right+=d.getWidth();c=a.getCenterLonLat().wrapDateLine(d)}this.setCenter(c,this.getZoomForExtent(a,b))},zoomToMaxExtent:function(a){var b=!a||a.restricted,c=this.getMaxExtent({restricted:b});this.zoomToExtent(c)},zoomToScale:function(a,b){var c=OpenLayers.Util.getResolutionFromScale(a,this.baseLayer.units),d=this.size.w*c/2,e=this.size.h*c/2,f=this.getCachedCenter(),g=new OpenLayers.Bounds(f.lon-d,f.lat-e,f.lon+d,f.lat+e);this.zoomToExtent(g,b)},getLonLatFromViewPortPx:function(a){var b=null;return null!=this.baseLayer&&(b=this.baseLayer.getLonLatFromViewPortPx(a)),b},getViewPortPxFromLonLat:function(a){var b=null;return null!=this.baseLayer&&(b=this.baseLayer.getViewPortPxFromLonLat(a)),b},getZoomTargetCenter:function(a,b){var c=null,d=this.getSize(),e=d.w/2-a.x,f=a.y-d.h/2,g=this.getLonLatFromPixel(a);return g&&(c=new OpenLayers.LonLat(g.lon+e*b,g.lat+f*b)),c},getLonLatFromPixel:function(a){return this.getLonLatFromViewPortPx(a)},getPixelFromLonLat:function(a){var b=this.getViewPortPxFromLonLat(a);return b.x=Math.round(b.x),b.y=Math.round(b.y),b},getGeodesicPixelSize:function(a){var b=a?this.getLonLatFromPixel(a):this.getCachedCenter()||new OpenLayers.LonLat(0,0),c=this.getResolution(),d=b.add(-c/2,0),e=b.add(c/2,0),f=b.add(0,-c/2),g=b.add(0,c/2),h=new OpenLayers.Projection("EPSG:4326"),i=this.getProjectionObject()||h;return i.equals(h)||(d.transform(i,h),e.transform(i,h),f.transform(i,h),g.transform(i,h)),new OpenLayers.Size(OpenLayers.Util.distVincenty(d,e),OpenLayers.Util.distVincenty(f,g))},getViewPortPxFromLayerPx:function(a){var b=null;if(null!=a){var c=this.layerContainerOriginPx.x,d=this.layerContainerOriginPx.y;b=a.add(c,d)}return b},getLayerPxFromViewPortPx:function(a){var b=null;if(null!=a){var c=-this.layerContainerOriginPx.x,d=-this.layerContainerOriginPx.y;b=a.add(c,d),(isNaN(b.x)||isNaN(b.y))&&(b=null)}return b},getLonLatFromLayerPx:function(a){return a=this.getViewPortPxFromLayerPx(a),this.getLonLatFromViewPortPx(a)},getLayerPxFromLonLat:function(a){var b=this.getPixelFromLonLat(a);return this.getLayerPxFromViewPortPx(b)},applyTransform:function(a,b,c){c=c||1;var d=this.layerContainerOriginPx,e=1!==c;a=a||d.x,b=b||d.y;var f=this.layerContainerDiv.style,g=this.applyTransform.transform,h=this.applyTransform.template;if(void 0===g&&(g=OpenLayers.Util.vendorPrefix.style("transform"),this.applyTransform.transform=g,g)){var i=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));i&&"none"===i||(h=["translate3d(",",0) ","scale3d(",",1)"],f[g]=[h[0],"0,0",h[1]].join("")),h&&~f[g].indexOf(h[0])||(h=["translate(",") ","scale(",")"]),this.applyTransform.template=h}null===g||"translate3d("!==h[0]&&e!==!0?(f.left=a+"px",f.top=b+"px",null!==g&&(f[g]="")):(e===!0&&"translate("===h[0]&&(a-=d.x,b-=d.y,f.left=d.x+"px",f.top=d.y+"px"),f[g]=[h[0],a,"px,",b,"px",h[1],h[2],c,",",c,h[3]].join(""))},CLASS_NAME:"OpenLayers.Map"}),OpenLayers.Map.TILE_WIDTH=256,OpenLayers.Map.TILE_HEIGHT=256,OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(a,b,c){this.layer=a,this.lonlat=b,this.data=null!=c?c:{},this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup),null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker),this.layer=null,this.id=null,this.lonlat=null,this.data=null,null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null),null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var a=!1;if(null!=this.layer&&null!=this.layer.map){var b=this.layer.map.getExtent();a=b.containsLonLat(this.lonlat)}return a},createMarker:function(){return null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(a){if(null!=this.lonlat){if(!this.popup){var b=this.marker?this.marker.icon:null,c=this.popupClass?this.popupClass:OpenLayers.Popup.Anchored;this.popup=new c(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,b,a)}null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this}return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"}),OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(a,b,c){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,b]),this.lonlat=null,this.geometry=a?a:null,this.state=null,this.attributes={},b&&(this.attributes=OpenLayers.Util.extend(this.attributes,b)),this.style=c?c:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,this.modified=null,OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(a){var b=!1;if(this.layer&&this.layer.map){var c=this.layer.map.getExtent();if(a){var d=this.geometry.getBounds();b=c.intersectsBounds(d)}else{var e=c.toGeometry();b=e.intersects(this.geometry)}}return b},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(a,b,c){var d=!1;return this.geometry&&(d=this.geometry.atPoint(a,b,c)),d},destroyPopup:function(){},move:function(a){if(this.layer&&this.geometry.move){var b;b="OpenLayers.LonLat"==a.CLASS_NAME?this.layer.getViewPortPxFromLonLat(a):a;var c=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),d=this.layer.map.getResolution();return this.geometry.move(d*(b.x-c.x),d*(c.y-b.y)),this.layer.drawFeature(this),c}},toState:function(a){if(a==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=a;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:}else if(a==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=a}else if(a==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=a}else a==OpenLayers.State.UNKNOWN&&(this.state=a)},CLASS_NAME:"OpenLayers.Feature.Vector"}),OpenLayers.Feature.Vector.style={default:{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},delete:{display:"none"}},OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(a,b){OpenLayers.Util.extend(this,b),this.rules=[],b&&b.rules&&this.addRules(b.rules),this.setDefaultStyle(a||OpenLayers.Feature.Vector.style.default),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a=0,b=this.rules.length;a<b;a++)this.rules[a].destroy(),this.rules[a]=null;this.rules=null,this.defaultStyle=null},createSymbolizer:function(a){for(var d,b=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),a),c=this.rules,f=[],g=!1,h=0,i=c.length;h<i;h++){d=c[h];var j=d.evaluate(a);j&&(d instanceof OpenLayers.Rule&&d.elseFilter?f.push(d):(g=!0,this.applySymbolizer(d,b,a)))}if(0==g&&f.length>0){g=!0;for(var h=0,i=f.length;h<i;h++)this.applySymbolizer(f[h],b,a)}return c.length>0&&0==g&&(b.display="none"),null!=b.label&&"string"!=typeof b.label&&(b.label=String(b.label)),b},applySymbolizer:function(a,b,c){var d=c.geometry?this.getSymbolizerPrefix(c.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],e=a.symbolizer[d]||a.symbolizer;if(this.defaultsPerSymbolizer===!0){var f=this.defaultStyle;OpenLayers.Util.applyDefaults(e,{pointRadius:f.pointRadius}),e.stroke!==!0&&e.graphic!==!0||OpenLayers.Util.applyDefaults(e,{strokeWidth:f.strokeWidth,strokeColor:f.strokeColor,strokeOpacity:f.strokeOpacity,strokeDashstyle:f.strokeDashstyle,strokeLinecap:f.strokeLinecap}),e.fill!==!0&&e.graphic!==!0||OpenLayers.Util.applyDefaults(e,{fillColor:f.fillColor,fillOpacity:f.fillOpacity}),e.graphic===!0&&OpenLayers.Util.applyDefaults(e,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}return this.createLiterals(OpenLayers.Util.extend(b,e),c)},createLiterals:function(a,b){var c=OpenLayers.Util.extend({},b.attributes||b.data);OpenLayers.Util.extend(c,this.context);for(var d in this.propertyStyles)a[d]=OpenLayers.Style.createLiteral(a[d],c,b,d);return a},findPropertyStyles:function(){var a={},b=this.defaultStyle;this.addPropertyStyles(a,b);for(var d,e,c=this.rules,f=0,g=c.length;f<g;f++){d=c[f].symbolizer;for(var h in d){if(e=d[h],"object"!=typeof e){this.addPropertyStyles(a,d);break}this.addPropertyStyles(a,e)}}return a},addPropertyStyles:function(a,b){var c;for(var d in b)c=b[d],"string"==typeof c&&c.match(/\$\{\w+\}/)&&(a[d]=!0);return a},addRules:function(a){Array.prototype.push.apply(this.rules,a),this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(a){this.defaultStyle=a,this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(a){for(var b=OpenLayers.Style.SYMBOLIZER_PREFIXES,c=0,d=b.length;c<d;c++)if(a.CLASS_NAME.indexOf(b[c])!=-1)return b[c]},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.rules){a.rules=[];for(var b=0,c=this.rules.length;b<c;++b)a.rules.push(this.rules[b].clone())}a.context=this.context&&OpenLayers.Util.extend({},this.context);var d=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(d,a)},CLASS_NAME:"OpenLayers.Style"}),OpenLayers.Style.createLiteral=function(a,b,c,d){return"string"==typeof a&&a.indexOf("${")!=-1&&(a=OpenLayers.String.format(a,b,[c,d]),a=isNaN(a)||!a?a:parseFloat(a)),a},OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"],OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(a){this.symbolizer={},OpenLayers.Util.extend(this,a),this.symbolizers&&delete this.symbolizer,this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a in this.symbolizer)this.symbolizer[a]=null;this.symbolizer=null,delete this.symbolizers},evaluate:function(a){var b=this.getContext(a),c=!0;if(this.minScaleDenominator||this.maxScaleDenominator)var d=a.layer.map.getScale();return this.minScaleDenominator&&(c=d>=OpenLayers.Style.createLiteral(this.minScaleDenominator,b)),c&&this.maxScaleDenominator&&(c=d<OpenLayers.Style.createLiteral(this.maxScaleDenominator,b)),c&&this.filter&&(c="OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?this.filter.evaluate(a):this.filter.evaluate(b)),c},getContext:function(a){var b=this.context;return b||(b=a.attributes||a.data),"function"==typeof this.context&&(b=this.context(a)),b},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.symbolizers){var b=this.symbolizers.length;a.symbolizers=new Array(b);for(var c=0;c<b;++c)a.symbolizers[c]=this.symbolizers[c].clone()}else{a.symbolizer={};var d,e;for(var f in this.symbolizer)d=this.symbolizer[f],e=typeof d,"object"===e?a.symbolizer[f]=OpenLayers.Util.extend({},d):"string"===e&&(a.symbolizer[f]=d)}return a.filter=this.filter&&this.filter.clone(),a.context=this.context&&OpenLayers.Util.extend({},this.context),new OpenLayers.Rule(a)},CLASS_NAME:"OpenLayers.Rule"}),OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(a){OpenLayers.Util.extend(this,a)},clone:function(){var a=OpenLayers.Util.getConstructor(this.CLASS_NAME);return new a(OpenLayers.Util.extend({},this))},CLASS_NAME:"OpenLayers.Symbolizer"}),OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"}),OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"}),OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"}),OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"}),OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Raster"}),OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,initialize:function(a){OpenLayers.Util.extend(this,a),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a=0,b=this.rules.length;a<b;a++)this.rules[a].destroy();delete this.rules},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.rules){a.rules=[];for(var b=0,c=this.rules.length;b<c;++b)a.rules.push(this.rules[b].clone())}return new OpenLayers.Style2(a)},CLASS_NAME:"OpenLayers.Style2"}),OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(a){OpenLayers.Util.extend(this,a),this.options=a},destroy:function(){},read:function(a){throw new Error("Read not implemented.")},write:function(a){throw new Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"}),OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(a){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),OpenLayers.Format.prototype.initialize.apply(this,[a]),this.namespaces=OpenLayers.Util.extend({},this.namespaces),this.namespaceAlias={};for(var b in this.namespaces)this.namespaceAlias[this.namespaces[b]]=b},destroy:function(){this.xmldom=null,OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(a,b){this.namespaces[a]=b,this.namespaceAlias[b]=a},read:function(a){var b=a.indexOf("<");b>0&&(a=a.substring(b));var c=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var b;return b=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom,b.loadXML(a),b},this),function(){return(new DOMParser).parseFromString(a,"text/xml")},function(){var b=new XMLHttpRequest;return b.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(a),!1),b.overrideMimeType&&b.overrideMimeType("text/xml"),b.send(null),b.responseXML});return this.keepData&&(this.data=c),c},write:function(a){var b;if(this.xmldom)b=a.xml;else{var c=new XMLSerializer;if(1==a.nodeType){var d=document.implementation.createDocument("","",null);d.importNode&&(a=d.importNode(a,!0)),d.appendChild(a),b=c.serializeToString(d)}else b=c.serializeToString(a)}return b},createElementNS:function(a,b){var c;return c=this.xmldom?"string"==typeof a?this.xmldom.createNode(1,b,a):this.xmldom.createNode(1,b,""):document.createElementNS(a,b)},createDocumentFragment:function(){var a;return a=this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment()},createTextNode:function(a){var b;return"string"!=typeof a&&(a=String(a)),b=this.xmldom?this.xmldom.createTextNode(a):document.createTextNode(a)},getElementsByTagNameNS:function(a,b,c){var d=[];if(a.getElementsByTagNameNS)d=a.getElementsByTagNameNS(b,c);else for(var f,g,e=a.getElementsByTagName("*"),h=0,i=e.length;h<i;++h)f=e[h],g=f.prefix?f.prefix+":"+c:c,"*"!=c&&g!=f.nodeName||"*"!=b&&b!=f.namespaceURI||d.push(f);return d},getAttributeNodeNS:function(a,b,c){var d=null;if(a.getAttributeNodeNS)d=a.getAttributeNodeNS(b,c);else for(var f,g,e=a.attributes,h=0,i=e.length;h<i;++h)if(f=e[h],f.namespaceURI==b&&(g=f.prefix?f.prefix+":"+c:c,g==f.nodeName)){d=f;break}return d},getAttributeNS:function(a,b,c){var d="";if(a.getAttributeNS)d=a.getAttributeNS(b,c)||"";else{var e=this.getAttributeNodeNS(a,b,c);e&&(d=e.nodeValue)}return d},getChildValue:function(a,b){var c=b||"";if(a)for(var d=a.firstChild;d;d=d.nextSibling)switch(d.nodeType){case 3:case 4:c+=d.nodeValue}return c},isSimpleContent:function(a){for(var b=!0,c=a.firstChild;c;c=c.nextSibling)if(1===c.nodeType){b=!1;break}return b},contentType:function(a){for(var b=!1,c=!1,d=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,e=a.firstChild;e;e=e.nextSibling){switch(e.nodeType){case 1:c=!0;break;case 8:break;default:b=!0}if(c&&b)break}if(c&&b)d=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(c)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(b)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return d},hasAttributeNS:function(a,b,c){var d=!1;return d=a.hasAttributeNS?a.hasAttributeNS(b,c):!!this.getAttributeNodeNS(a,b,c)},setAttributeNS:function(a,b,c,d){if(a.setAttributeNS)a.setAttributeNS(b,c,d);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(b){var e=a.ownerDocument.createNode(2,c,b);e.nodeValue=d,a.setAttributeNode(e)}else a.setAttribute(c,d)}},createElementNSPlus:function(a,b){b=b||{};var c=b.uri||this.namespaces[b.prefix];if(!c){var d=a.indexOf(":");c=this.namespaces[a.substring(0,d)]}c||(c=this.namespaces[this.defaultPrefix]);var e=this.createElementNS(c,a);b.attributes&&this.setAttributes(e,b.attributes);var f=b.value;return null!=f&&e.appendChild(this.createTextNode(f)),e},setAttributes:function(a,b){var c,d;for(var e in b)null!=b[e]&&b[e].toString&&(c=b[e].toString(),d=this.namespaces[e.substring(0,e.indexOf(":"))]||null,this.setAttributeNS(a,d,e,c))},readNode:function(a,b){b||(b={});var c=this.readers[a.namespaceURI?this.namespaceAlias[a.namespaceURI]:this.defaultPrefix];if(c){var d=a.localName||a.nodeName.split(":").pop(),e=c[d]||c["*"];e&&e.apply(this,[a,b])}return b},readChildNodes:function(a,b){b||(b={});for(var d,c=a.childNodes,e=0,f=c.length;e<f;++e)d=c[e],1==d.nodeType&&this.readNode(d,b);return b},writeNode:function(a,b,c){var d,e,f=a.indexOf(":");f>0?(d=a.substring(0,f),e=a.substring(f+1)):(d=c?this.namespaceAlias[c.namespaceURI]:this.defaultPrefix,e=a);var g=this.writers[d][e].apply(this,[b]);return c&&c.appendChild(g),g},getChildEl:function(a,b,c){return a&&this.getThisOrNextEl(a.firstChild,b,c)},getNextEl:function(a,b,c){return a&&this.getThisOrNextEl(a.nextSibling,b,c)},getThisOrNextEl:function(a,b,c){a:for(var d=a;d;d=d.nextSibling)switch(d.nodeType){case 1:if(!(b&&b!==(d.localName||d.nodeName.split(":").pop())||c&&c!==d.namespaceURI))break a;d=null;break a;case 3:if(/^\s*$/.test(d.nodeValue))break;case 4:case 6:case 12:case 10:case 11:d=null;break a}return d||null},lookupNamespaceURI:function(a,b){var c=null;if(a)if(a.lookupNamespaceURI)c=a.lookupNamespaceURI(b);else a:switch(a.nodeType){case 1:if(null!==a.namespaceURI&&a.prefix===b){c=a.namespaceURI;break a}var d=a.attributes.length;if(d)for(var e,f=0;f<d;++f){if(e=a.attributes[f],"xmlns"===e.prefix&&e.name==="xmlns:"+b){c=e.value||null;break a}if("xmlns"===e.name&&null===b){c=e.value||null;break a}}c=this.lookupNamespaceURI(a.parentNode,b);break a;case 2:c=this.lookupNamespaceURI(a.ownerElement,b);break a;case 9:c=this.lookupNamespaceURI(a.documentElement,b);break a;case 6:case 12:case 10:case 11:break a;default:c=this.lookupNamespaceURI(a.parentNode,b)}return c},getXMLDoc:function(){return OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"))),OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"}),OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3},OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype),OpenLayers.Format.XML.document=null,OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null,this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(a){a&&(this.bounds=a.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(a){var b=this.getBounds();b?this.bounds.extend(a):this.setBounds(a)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(a,b){},getVertices:function(a){},atPoint:function(a,b,c){var d=!1,e=this.getBounds();if(null!=e&&null!=a){var f=null!=b?b:0,g=null!=c?c:0,h=new OpenLayers.Bounds(this.bounds.left-f,this.bounds.bottom-g,this.bounds.right+f,this.bounds.top+g);d=h.containsLonLat(a)}return d},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){var a;return a=OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"}),OpenLayers.Geometry.fromWKT=function(a){var b;if(OpenLayers.Format&&OpenLayers.Format.WKT){var c=OpenLayers.Geometry.fromWKT.format;c||(c=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=c);var d=c.read(a);if(d instanceof OpenLayers.Feature.Vector)b=d.geometry;else if(OpenLayers.Util.isArray(d)){for(var e=d.length,f=new Array(e),g=0;g<e;++g)f[g]=d[g].geometry;b=new OpenLayers.Geometry.Collection(f)}}return b},OpenLayers.Geometry.segmentsIntersect=function(a,b,c){var d=c&&c.point,e=c&&c.tolerance,f=!1,g=a.x1-b.x1,h=a.y1-b.y1,i=a.x2-a.x1,j=a.y2-a.y1,k=b.y2-b.y1,l=b.x2-b.x1,m=k*i-l*j,n=l*h-k*g,o=i*h-j*g;if(0==m)0==n&&0==o&&(f=!0);else{var p=n/m,q=o/m;if(p>=0&&p<=1&&q>=0&&q<=1)if(d){var r=a.x1+p*i,s=a.y1+p*j;f=new OpenLayers.Geometry.Point(r,s)}else f=!0}if(e){var t;if(f){if(d){var v,r,s,u=[a,b];a:for(var w=0;w<2;++w){v=u[w];for(var x=1;x<3;++x)if(r=v["x"+x],s=v["y"+x],t=Math.sqrt(Math.pow(r-f.x,2)+Math.pow(s-f.y,2)),t<e){f.x=r,f.y=s;break a}}}}else{var y,z,r,s,A,B,u=[a,b];a:for(var w=0;w<2;++w){y=u[w],z=u[(w+1)%2];for(var x=1;x<3;++x)if(A={x:y["x"+x],y:y["y"+x]},B=OpenLayers.Geometry.distanceToSegment(A,z),B.distance<e){f=!d||new OpenLayers.Geometry.Point(A.x,A.y);break a}}}}return f},OpenLayers.Geometry.distanceToSegment=function(a,b){var c=OpenLayers.Geometry.distanceSquaredToSegment(a,b);return c.distance=Math.sqrt(c.distance),c},OpenLayers.Geometry.distanceSquaredToSegment=function(a,b){var l,m,c=a.x,d=a.y,e=b.x1,f=b.y1,g=b.x2,h=b.y2,i=g-e,j=h-f,k=(i*(c-e)+j*(d-f))/(Math.pow(i,2)+Math.pow(j,2));return k<=0?(l=e,m=f):k>=1?(l=g,m=h):(l=e+k*i,m=f+k*j),{distance:Math.pow(l-c,2)+Math.pow(m-d,2),x:l,y:m,along:k}},OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(a,b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=parseFloat(a),this.y=parseFloat(b)},clone:function(a){return null==a&&(a=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(a,this),a},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(a,b){var e,f,g,h,i,j,c=!(b&&b.edge===!1),d=c&&b&&b.details;return a instanceof OpenLayers.Geometry.Point?(f=this.x,g=this.y,h=a.x,i=a.y,e=Math.sqrt(Math.pow(f-h,2)+Math.pow(g-i,2)),j=d?{x0:f,y0:g,x1:h,y1:i,distance:e}:e):(j=a.distanceTo(this,b),d&&(j={x0:j.x1,y0:j.y1,x1:j.x0,y1:j.y0,distance:j.distance})),j},equals:function(a){var b=!1;return null!=a&&(b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)),b},toShortString:function(){return this.x+", "+this.y},move:function(a,b){this.x=this.x+a,this.y=this.y+b,this.clearBounds()},rotate:function(a,b){a*=Math.PI/180;var c=this.distanceTo(b),d=a+Math.atan2(this.y-b.y,this.x-b.x);this.x=b.x+c*Math.cos(d),this.y=b.y+c*Math.sin(d),this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(a,b,c){return c=void 0==c?1:c,this.x=b.x+a*c*(this.x-b.x),this.y=b.y+a*(this.y-b.y),this.clearBounds(),this},intersects:function(a){var b=!1;return b="OpenLayers.Geometry.Point"==a.CLASS_NAME?this.equals(a):a.intersects(this)},transform:function(a,b){return a&&b&&(OpenLayers.Projection.transform(this,a,b),this.bounds=null),this},getVertices:function(a){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=a&&this.addComponents(a)},destroy:function(){this.components.length=0,this.components=null,OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var a=OpenLayers.Util.getConstructor(this.CLASS_NAME),b=new a,c=0,d=this.components.length;c<d;c++)b.addComponent(this.components[c].clone());return OpenLayers.Util.applyDefaults(b,this),b},getComponentsString:function(){for(var a=[],b=0,c=this.components.length;b<c;b++)a.push(this.components[b].toShortString());return a.join(",")},calculateBounds:function(){this.bounds=null;var a=new OpenLayers.Bounds,b=this.components;if(b)for(var c=0,d=b.length;c<d;c++)a.extend(b[c].getBounds());null!=a.left&&null!=a.bottom&&null!=a.right&&null!=a.top&&this.setBounds(a)},addComponents:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0,c=a.length;b<c;b++)this.addComponent(a[b])},addComponent:function(a,b){var c=!1;if(a&&(null==this.componentTypes||OpenLayers.Util.indexOf(this.componentTypes,a.CLASS_NAME)>-1)){if(null!=b&&b<this.components.length){var d=this.components.slice(0,b),e=this.components.slice(b,this.components.length);d.push(a),this.components=d.concat(e)}else this.components.push(a);a.parent=this,this.clearBounds(),c=!0}return c},removeComponents:function(a){var b=!1;OpenLayers.Util.isArray(a)||(a=[a]);for(var c=a.length-1;c>=0;--c)b=this.removeComponent(a[c])||b;return b},removeComponent:function(a){return OpenLayers.Util.removeItem(this.components,a),this.clearBounds(),!0},getLength:function(){for(var a=0,b=0,c=this.components.length;b<c;b++)a+=this.components[b].getLength();return a},getArea:function(){for(var a=0,b=0,c=this.components.length;b<c;b++)a+=this.components[b].getArea();return a},getGeodesicArea:function(a){for(var b=0,c=0,d=this.components.length;c<d;c++)b+=this.components[c].getGeodesicArea(a);return b},getCentroid:function(a){if(!a)return this.components.length&&this.components[0].getCentroid();var b=this.components.length;if(!b)return!1;for(var g,c=[],d=[],e=0,f=Number.MAX_VALUE,h=0;h<b;++h){g=this.components[h];var i=g.getArea(),j=g.getCentroid(!0);isNaN(i)||isNaN(j.x)||isNaN(j.y)||(c.push(i),e+=i,f=i<f&&i>0?i:f,d.push(j))}if(b=c.length,0===e){for(var h=0;h<b;++h)c[h]=1;e=c.length}else{for(var h=0;h<b;++h)c[h]/=f;e/=f}for(var j,i,k=0,l=0,h=0;h<b;++h)j=d[h],i=c[h],k+=j.x*i,l+=j.y*i;return new OpenLayers.Geometry.Point(k/e,l/e)},getGeodesicLength:function(a){for(var b=0,c=0,d=this.components.length;c<d;c++)b+=this.components[c].getGeodesicLength(a);return b},move:function(a,b){for(var c=0,d=this.components.length;c<d;c++)this.components[c].move(a,b)},rotate:function(a,b){for(var c=0,d=this.components.length;c<d;++c)this.components[c].rotate(a,b)},resize:function(a,b,c){for(var d=0;d<this.components.length;++d)this.components[d].resize(a,b,c);return this},distanceTo:function(a,b){for(var e,f,g,c=!(b&&b.edge===!1),d=c&&b&&b.details,h=Number.POSITIVE_INFINITY,i=0,j=this.components.length;i<j&&(e=this.components[i].distanceTo(a,b),
g=d?e.distance:e,!(g<h&&(h=g,f=e,0==h)));++i);return f},equals:function(a){var b=!0;if(a&&a.CLASS_NAME&&this.CLASS_NAME==a.CLASS_NAME)if(OpenLayers.Util.isArray(a.components)&&a.components.length==this.components.length){for(var c=0,d=this.components.length;c<d;++c)if(!this.components[c].equals(a.components[c])){b=!1;break}}else b=!1;else b=!1;return b},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;c<d;c++){var e=this.components[c];e.transform(a,b)}this.bounds=null}return this},intersects:function(a){for(var b=!1,c=0,d=this.components.length;c<d&&!(b=a.intersects(this.components[c]));++c);return b},getVertices:function(a){for(var b=[],c=0,d=this.components.length;c<d;++c)Array.prototype.push.apply(b,this.components[c].getVertices(a));return b},CLASS_NAME:"OpenLayers.Geometry.Collection"}),OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(a,b){this.addComponent(a,b)},removePoint:function(a){this.removeComponent(a)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"}),OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var a=0;if(this.components&&this.components.length>1)for(var b=1,c=this.components.length;b<c;b++)a+=this.components[b-1].distanceTo(this.components[b]);return a},getGeodesicLength:function(a){var b=this;if(a){var c=new OpenLayers.Projection("EPSG:4326");c.equals(a)||(b=this.clone().transform(a,c))}var d=0;if(b.components&&b.components.length>1)for(var e,f,g=1,h=b.components.length;g<h;g++)e=b.components[g-1],f=b.components[g],d+=OpenLayers.Util.distVincenty({lon:e.x,lat:e.y},{lon:f.x,lat:f.y});return 1e3*d},CLASS_NAME:"OpenLayers.Geometry.Curve"}),OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(a){var b=this.components&&this.components.length>2;return b&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),b},intersects:function(a){var b=!1,c=a.CLASS_NAME;if("OpenLayers.Geometry.LineString"==c||"OpenLayers.Geometry.LinearRing"==c||"OpenLayers.Geometry.Point"==c){var e,d=this.getSortedSegments();e="OpenLayers.Geometry.Point"==c?[{x1:a.x,y1:a.y,x2:a.x,y2:a.y}]:a.getSortedSegments();var f,g,h,i,j,k,l,m;a:for(var n=0,o=d.length;n<o;++n){f=d[n],g=f.x1,h=f.x2,i=f.y1,j=f.y2;for(var p=0,q=e.length;p<q&&(k=e[p],!(k.x1>h));++p)if(!(k.x2<g)&&(l=k.y1,m=k.y2,!(Math.min(l,m)>Math.max(i,j))&&!(Math.max(l,m)<Math.min(i,j))&&OpenLayers.Geometry.segmentsIntersect(f,k))){b=!0;break a}}}else b=a.intersects(this);return b},getSortedSegments:function(){function f(a,b){return a.x1-b.x1}for(var c,d,a=this.components.length-1,b=new Array(a),e=0;e<a;++e)c=this.components[e],d=this.components[e+1],c.x<d.x?b[e]={x1:c.x,y1:c.y,x2:d.x,y2:d.y}:b[e]={x1:d.x,y1:d.y,x2:c.x,y2:c.y};return b.sort(f)},splitWithSegment:function(a,b){for(var j,k,l,n,o,c=!(b&&b.edge===!1),d=b&&b.tolerance,e=[],f=this.getVertices(),g=[],h=[],i=!1,p={point:!0,tolerance:d},q=null,r=0,s=f.length-2;r<=s;++r)if(j=f[r],g.push(j.clone()),k=f[r+1],o={x1:j.x,y1:j.y,x2:k.x,y2:k.y},l=OpenLayers.Geometry.segmentsIntersect(a,o,p),l instanceof OpenLayers.Geometry.Point&&(n=!!(l.x===a.x1&&l.y===a.y1||l.x===a.x2&&l.y===a.y2||l.equals(j)||l.equals(k)),n||c)){if(l.equals(h[h.length-1])||h.push(l.clone()),0===r&&l.equals(j))continue;if(l.equals(k))continue;i=!0,l.equals(j)||g.push(l),e.push(new OpenLayers.Geometry.LineString(g)),g=[l.clone()]}if(i&&(g.push(k.clone()),e.push(new OpenLayers.Geometry.LineString(g))),h.length>0){var t=a.x1<a.x2?1:-1,u=a.y1<a.y2?1:-1;q={lines:e,points:h.sort(function(a,b){return t*a.x-t*b.x||u*a.y-u*b.y})}}return q},split:function(a,b){var e,f,g,h,c=null,d=b&&b.mutual;if(a instanceof OpenLayers.Geometry.LineString){var j,k,l,m,n,o,i=this.getVertices(),p=[];g=[];for(var q=0,r=i.length-2;q<=r;++q){j=i[q],k=i[q+1],l={x1:j.x,y1:j.y,x2:k.x,y2:k.y},h=h||[a],d&&p.push(j.clone());for(var s=0;s<h.length;++s)if(m=h[s].splitWithSegment(l,b),m&&(n=m.lines,n.length>0&&(n.unshift(s,1),Array.prototype.splice.apply(h,n),s+=n.length-2),d))for(var t=0,u=m.points.length;t<u;++t)o=m.points[t],o.equals(j)||(p.push(o),g.push(new OpenLayers.Geometry.LineString(p)),p=o.equals(k)?[]:[o.clone()])}d&&g.length>0&&p.length>0&&(p.push(k.clone()),g.push(new OpenLayers.Geometry.LineString(p)))}else c=a.splitWith(this,b);return h&&h.length>1?f=!0:h=[],g&&g.length>1?e=!0:g=[],(f||e)&&(c=d?[g,h]:h),c},splitWith:function(a,b){return a.split(this,b)},getVertices:function(a){var b;return b=a===!0?[this.components[0],this.components[this.components.length-1]]:a===!1?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(a,b){var e,c=!(b&&b.edge===!1),d=c&&b&&b.details,f={},g=Number.POSITIVE_INFINITY;if(a instanceof OpenLayers.Geometry.Point){for(var k,h=this.getSortedSegments(),i=a.x,j=a.y,l=0,m=h.length;l<m;++l)if(k=h[l],e=OpenLayers.Geometry.distanceToSegment(a,k),e.distance<g){if(g=e.distance,f=e,0===g)break}else if(k.x2>i&&(j>k.y1&&j<k.y2||j<k.y1&&j>k.y2))break;f=d?{distance:f.distance,x0:f.x,y0:f.y,x1:i,y1:j}:f.distance}else if(a instanceof OpenLayers.Geometry.LineString){var p,q,r,s,t,n=this.getSortedSegments(),o=a.getSortedSegments(),u=o.length,v={point:!0};a:for(var l=0,m=n.length;l<m;++l){p=n[l],s=p.x1,t=p.y1;for(var w=0;w<u;++w){if(q=o[w],r=OpenLayers.Geometry.segmentsIntersect(p,q,v)){g=0,f={distance:0,x0:r.x,y0:r.y,x1:r.x,y1:r.y};break a}e=OpenLayers.Geometry.distanceToSegment({x:s,y:t},q),e.distance<g&&(g=e.distance,f={distance:g,x0:s,y0:t,x1:e.x,y1:e.y})}}if(d||(f=f.distance),0!==g&&p){e=a.distanceTo(new OpenLayers.Geometry.Point(p.x2,p.y2),b);var x=d?e.distance:e;x<g&&(f=d?{distance:g,x0:e.x1,y0:e.y1,x1:e.x0,y1:e.y0}:x)}}else f=a.distanceTo(this,b),d&&(f={distance:f.distance,x0:f.x1,y0:f.y1,x1:f.x0,y1:f.y0});return f},simplify:function(a){if(this&&null!==this){var b=this.getVertices();if(b.length<3)return this;var c=function(a,b){return a-b},d=function(a,b,c,f){for(var k,g=0,i=0,j=b;j<c;j++)k=e(a[b],a[c],a[j]),k>g&&(g=k,i=j);g>f&&i!=b&&(h.push(i),d(a,b,i,f),d(a,i,c,f))},e=function(a,b,c){var d=Math.abs(.5*(a.x*b.y+b.x*c.y+c.x*a.y-b.x*a.y-c.x*b.y-a.x*c.y)),e=Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)),f=d/e*2;return f},f=0,g=b.length-1,h=[];for(h.push(f),h.push(g);b[f].equals(b[g]);)g--,h.push(g);d(b,f,g,a);var i=[];h.sort(c);for(var j=0;j<h.length;j++)i.push(b[h[j]]);return new OpenLayers.Geometry.LineString(i)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"}),OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(a,b){for(var e,f,g,h,i,c=null,d=b&&b.mutual,j=[],k=[a],l=0,m=this.components.length;l<m;++l){f=this.components[l],h=!1;for(var n=0;n<k.length;++n)if(e=f.split(k[n],b)){if(d){g=e[0];for(var o=0,p=g.length;o<p;++o)0===o&&j.length?j[j.length-1].addComponent(g[o]):j.push(new OpenLayers.Geometry.MultiLineString([g[o]]));h=!0,e=e[1]}if(e.length){e.unshift(n,1),Array.prototype.splice.apply(k,e);break}}h||(j.length?j[j.length-1].addComponent(f.clone()):j=[new OpenLayers.Geometry.MultiLineString(f.clone())])}return j&&j.length>1?h=!0:j=[],k&&k.length>1?i=!0:k=[],(h||i)&&(c=d?[j,k]:k),c},splitWith:function(a,b){var e,f,g,h,i,j,k,c=null,d=b&&b.mutual;if(a instanceof OpenLayers.Geometry.LineString){k=[],j=[a];for(var l=0,m=this.components.length;l<m;++l){i=!1,f=this.components[l];for(var n=0;n<j.length;++n)if(e=j[n].split(f,b)){d&&(g=e[0],g.length&&(g.unshift(n,1),Array.prototype.splice.apply(j,g),n+=g.length-2),e=e[1],0===e.length&&(e=[f.clone()]));for(var o=0,p=e.length;o<p;++o)0===o&&k.length?k[k.length-1].addComponent(e[o]):k.push(new OpenLayers.Geometry.MultiLineString([e[o]]));i=!0}i||(k.length?k[k.length-1].addComponent(f.clone()):k=[new OpenLayers.Geometry.MultiLineString([f.clone()])])}}else c=a.split(this);return j&&j.length>1?h=!0:j=[],k&&k.length>1?i=!0:k=[],(h||i)&&(c=d?[j,k]:k),c},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"}),OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(a,b){var c=!1,d=this.components.pop();null==b&&a.equals(d)||(c=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));var e=this.components[0];return OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[e]),c},removeComponent:function(a){var b=this.components&&this.components.length>3;if(b){this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var c=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[c])}return b},move:function(a,b){for(var c=0,d=this.components.length;c<d-1;c++)this.components[c].move(a,b)},rotate:function(a,b){for(var c=0,d=this.components.length;c<d-1;++c)this.components[c].rotate(a,b)},resize:function(a,b,c){for(var d=0,e=this.components.length;d<e-1;++d)this.components[d].resize(a,b,c);return this},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;c<d-1;c++){var e=this.components[c];e.transform(a,b)}this.bounds=null}return this},getCentroid:function(){if(this.components){var a=this.components.length;if(a>0&&a<=2)return this.components[0].clone();if(a>2){var b=0,c=0,d=this.components[0].x,e=this.components[0].y,f=-1*this.getArea();if(0!=f){for(var g=0;g<a-1;g++){var h=this.components[g],i=this.components[g+1];b+=(h.x+i.x-2*d)*((h.x-d)*(i.y-e)-(i.x-d)*(h.y-e)),c+=(h.y+i.y-2*e)*((h.x-d)*(i.y-e)-(i.x-d)*(h.y-e))}var j=d+b/(6*f),k=e+c/(6*f)}else{for(var g=0;g<a-1;g++)b+=this.components[g].x,c+=this.components[g].y;var j=b/(a-1),k=c/(a-1)}return new OpenLayers.Geometry.Point(j,k)}return null}},getArea:function(){var a=0;if(this.components&&this.components.length>2){for(var b=0,c=0,d=this.components.length;c<d-1;c++){var e=this.components[c],f=this.components[c+1];b+=(e.x+f.x)*(f.y-e.y)}a=-b/2}return a},getGeodesicArea:function(a){var b=this;if(a){var c=new OpenLayers.Projection("EPSG:4326");c.equals(a)||(b=this.clone().transform(a,c))}var d=0,e=b.components&&b.components.length;if(e>2){for(var f,g,h=0;h<e-1;h++)f=b.components[h],g=b.components[h+1],d+=OpenLayers.Util.rad(g.x-f.x)*(2+Math.sin(OpenLayers.Util.rad(f.y))+Math.sin(OpenLayers.Util.rad(g.y)));d=6378137*d*6378137/2}return d},containsPoint:function(a){function f(a,b,c,d,e){return(a-e)*((d-b)/(e-c))+d}for(var h,i,j,k,l,m,n,b=OpenLayers.Number.limitSigDigs,c=14,d=b(a.x,c),e=b(a.y,c),g=this.components.length-1,p=0,q=0;q<g;++q)if(h=this.components[q],j=b(h.x,c),k=b(h.y,c),i=this.components[q+1],l=b(i.x,c),m=b(i.y,c),k!=m){if(n=b(f(e,j,k,l,m),c),n==d&&(k<m&&e>=k&&e<=m||k>m&&e<=k&&e>=m)){p=-1;break}n<=d||j!=l&&(n<Math.min(j,l)||n>Math.max(j,l))||(k<m&&e>=k&&e<m||k>m&&e<k&&e>=m)&&++p}else if(e==k&&(j<=l&&d>=j&&d<=l||j>=l&&d<=j&&d>=l)){p=-1;break}var r=p==-1?1:!!(1&p);return r},intersects:function(a){var b=!1;if("OpenLayers.Geometry.Point"==a.CLASS_NAME)b=this.containsPoint(a);else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME)b=a.intersects(this);else if("OpenLayers.Geometry.LinearRing"==a.CLASS_NAME)b=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[a]);else for(var c=0,d=a.components.length;c<d&&!(b=a.components[c].intersects(this));++c);return b},getVertices:function(a){return a===!0?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"}),OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var a=0;if(this.components&&this.components.length>0){a+=Math.abs(this.components[0].getArea());for(var b=1,c=this.components.length;b<c;b++)a-=Math.abs(this.components[b].getArea())}return a},getGeodesicArea:function(a){var b=0;if(this.components&&this.components.length>0){b+=Math.abs(this.components[0].getGeodesicArea(a));for(var c=1,d=this.components.length;c<d;c++)b-=Math.abs(this.components[c].getGeodesicArea(a))}return b},containsPoint:function(a){var b=this.components.length,c=!1;if(b>0&&(c=this.components[0].containsPoint(a),1!==c&&c&&b>1))for(var d,e=1;e<b;++e)if(d=this.components[e].containsPoint(a)){c=1===d&&1;break}return c},intersects:function(a){var c,d,b=!1;if("OpenLayers.Geometry.Point"==a.CLASS_NAME)b=this.containsPoint(a);else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==a.CLASS_NAME){for(c=0,d=this.components.length;c<d&&!(b=a.intersects(this.components[c]));++c);if(!b)for(c=0,d=a.components.length;c<d&&!(b=this.containsPoint(a.components[c]));++c);}else for(c=0,d=a.components.length;c<d&&!(b=this.intersects(a.components[c]));++c);if(!b&&"OpenLayers.Geometry.Polygon"==a.CLASS_NAME){var e=this.components[0];for(c=0,d=e.components.length;c<d&&!(b=a.containsPoint(e.components[c]));++c);}return b},distanceTo:function(a,b){var d,c=!(b&&b.edge===!1);return d=!c&&this.intersects(a)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[a,b])},CLASS_NAME:"OpenLayers.Geometry.Polygon"}),OpenLayers.Geometry.Polygon.createRegularPolygon=function(a,b,c,d){var e=Math.PI*(1/c-.5);d&&(e+=d/180*Math.PI);for(var f,g,h,i=[],j=0;j<c;++j)f=e+2*j*Math.PI/c,g=a.x+b*Math.cos(f),h=a.y+b*Math.sin(f),i.push(new OpenLayers.Geometry.Point(g,h));var k=new OpenLayers.Geometry.LinearRing(i);return new OpenLayers.Geometry.Polygon([k])},OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"}),OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(a){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var b=this.getElementsByTagNameNS(a.documentElement,this.gmlns,this.featureName),c=[],d=0;d<b.length;d++){var e=this.parseFeature(b[d]);e&&c.push(e)}return c},parseFeature:function(a){for(var c,d,e,f,b=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],g=0;g<b.length;++g)if(c=b[g],d=this.getElementsByTagNameNS(a,this.gmlns,c),d.length>0){if(f=this.parseGeometry[c.toLowerCase()],!f)throw new TypeError("Unsupported geometry type: "+c);e=f.apply(this,[d[0]]),this.internalProjection&&this.externalProjection&&e.transform(this.externalProjection,this.internalProjection);break}var h,i=this.getElementsByTagNameNS(a,this.gmlns,"Box");for(g=0;g<i.length;++g){var j=i[g],k=this.parseGeometry.box.apply(this,[j]),l=j.parentNode,m=l.localName||l.nodeName.split(":").pop();"boundedBy"===m?h=k:e=k.toGeometry()}var n;this.extractAttributes&&(n=this.parseAttributes(a));var o=new OpenLayers.Feature.Vector(e,n);o.bounds=h,o.gml={featureType:a.firstChild.nodeName.split(":")[1],featureNS:a.firstChild.namespaceURI,featureNSPrefix:a.firstChild.prefix};for(var q,p=a.firstChild;p&&(1!=p.nodeType||!(q=p.getAttribute("fid")||p.getAttribute("id")));)p=p.nextSibling;return o.fid=q,o},parseGeometry:{point:function(a){var b,c,d=[],b=this.getElementsByTagNameNS(a,this.gmlns,"pos");if(b.length>0&&(c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.trimSpace,""),d=c.split(this.regExes.splitSpace)),0==d.length&&(b=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),b.length>0&&(c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.removeSpace,""),d=c.split(","))),0==d.length&&(b=this.getElementsByTagNameNS(a,this.gmlns,"coord"),b.length>0)){var e=this.getElementsByTagNameNS(b[0],this.gmlns,"X"),f=this.getElementsByTagNameNS(b[0],this.gmlns,"Y");e.length>0&&f.length>0&&(d=[e[0].firstChild.nodeValue,f[0].firstChild.nodeValue])}return 2==d.length&&(d[2]=null),this.xy?new OpenLayers.Geometry.Point(d[0],d[1],d[2]):new OpenLayers.Geometry.Point(d[1],d[0],d[2])},multipoint:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"Point"),c=[];if(b.length>0)for(var d,e=0;e<b.length;++e)d=this.parseGeometry.point.apply(this,[b[e]]),d&&c.push(d);return new OpenLayers.Geometry.MultiPoint(c)},linestring:function(a,b){var c,d,e=[],f=[];if(c=this.getElementsByTagNameNS(a,this.gmlns,"posList"),c.length>0){d=this.getChildValue(c[0]),d=d.replace(this.regExes.trimSpace,""),e=d.split(this.regExes.splitSpace);for(var h,i,j,k,g=parseInt(c[0].getAttribute("dimension")),l=0;l<e.length/g;++l)h=l*g,i=e[h],j=e[h+1],k=2==g?null:e[h+2],this.xy?f.push(new OpenLayers.Geometry.Point(i,j,k)):f.push(new OpenLayers.Geometry.Point(j,i,k))}if(0==e.length&&(c=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),c.length>0)){d=this.getChildValue(c[0]),d=d.replace(this.regExes.trimSpace,""),d=d.replace(this.regExes.trimComma,",");for(var m=d.split(this.regExes.splitSpace),l=0;l<m.length;++l)e=m[l].split(","),2==e.length&&(e[2]=null),this.xy?f.push(new OpenLayers.Geometry.Point(e[0],e[1],e[2])):f.push(new OpenLayers.Geometry.Point(e[1],e[0],e[2]))}var n=null;return 0!=f.length&&(n=b?new OpenLayers.Geometry.LinearRing(f):new OpenLayers.Geometry.LineString(f)),n},multilinestring:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"LineString"),c=[];if(b.length>0)for(var d,e=0;e<b.length;++e)d=this.parseGeometry.linestring.apply(this,[b[e]]),d&&c.push(d);return new OpenLayers.Geometry.MultiLineString(c)},polygon:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"LinearRing"),c=[];if(b.length>0)for(var d,e=0;e<b.length;++e)d=this.parseGeometry.linestring.apply(this,[b[e],!0]),d&&c.push(d);return new OpenLayers.Geometry.Polygon(c)},multipolygon:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"Polygon"),c=[];if(b.length>0)for(var d,e=0;e<b.length;++e)d=this.parseGeometry.polygon.apply(this,[b[e]]),d&&c.push(d);return new OpenLayers.Geometry.MultiPolygon(c)},envelope:function(a){var c,d,b=[],e=this.getElementsByTagNameNS(a,this.gmlns,"lowerCorner");if(e.length>0){var f=[];if(e.length>0&&(c=e[0].firstChild.nodeValue,c=c.replace(this.regExes.trimSpace,""),f=c.split(this.regExes.splitSpace)),2==f.length&&(f[2]=null),this.xy)var g=new OpenLayers.Geometry.Point(f[0],f[1],f[2]);else var g=new OpenLayers.Geometry.Point(f[1],f[0],f[2])}var h=this.getElementsByTagNameNS(a,this.gmlns,"upperCorner");if(h.length>0){var f=[];if(h.length>0&&(c=h[0].firstChild.nodeValue,c=c.replace(this.regExes.trimSpace,""),f=c.split(this.regExes.splitSpace)),2==f.length&&(f[2]=null),this.xy)var i=new OpenLayers.Geometry.Point(f[0],f[1],f[2]);else var i=new OpenLayers.Geometry.Point(f[1],f[0],f[2])}if(g&&i){b.push(new OpenLayers.Geometry.Point(g.x,g.y)),b.push(new OpenLayers.Geometry.Point(i.x,g.y)),b.push(new OpenLayers.Geometry.Point(i.x,i.y)),b.push(new OpenLayers.Geometry.Point(g.x,i.y)),b.push(new OpenLayers.Geometry.Point(g.x,g.y));var j=new OpenLayers.Geometry.LinearRing(b);d=new OpenLayers.Geometry.Polygon([j])}return d},box:function(a){var c,d,b=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),e=null,f=null;if(b.length>0&&(c=b[0].firstChild.nodeValue,d=c.split(" "),2==d.length&&(e=d[0].split(","),f=d[1].split(","))),null!==e&&null!==f)return new OpenLayers.Bounds(parseFloat(e[0]),parseFloat(e[1]),parseFloat(f[0]),parseFloat(f[1]))}},parseAttributes:function(a){for(var d,e,f,g,h,i,j,b={},c=a.firstChild;c;){if(1==c.nodeType){for(d=c.childNodes,e=0;e<d.length;++e)f=d[e],1==f.nodeType&&(g=f.childNodes,1==g.length?(h=g[0],3!=h.nodeType&&4!=h.nodeType||(i=f.prefix?f.nodeName.split(":")[1]:f.nodeName,j=h.nodeValue.replace(this.regExes.trimSpace,""),b[i]=j)):b[f.nodeName.split(":").pop()]=null);break}c=c.nextSibling}return b},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),c=0;c<a.length;c++)b.appendChild(this.createFeatureXML(a[c]));return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=a.geometry,c=this.buildGeometryNode(b),d=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);d.appendChild(c);var e=this.createElementNS(this.gmlns,"gml:"+this.featureName),f=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName),g=a.fid||a.id;f.setAttribute("fid",g),f.appendChild(d);for(var h in a.attributes){var i=this.createTextNode(a.attributes[h]),j=h.substring(h.lastIndexOf(":")+1),k=this.createElementNS(this.featureNS,this.featurePrefix+":"+j);k.appendChild(i),f.appendChild(k)}return e.appendChild(f),e},buildGeometryNode:function(a){this.externalProjection&&this.internalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b=a.CLASS_NAME,c=b.substring(b.lastIndexOf(".")+1),d=this.buildGeometry[c.toLowerCase()];return d.apply(this,[a])},buildGeometry:{point:function(a){var b=this.createElementNS(this.gmlns,"gml:Point");return b.appendChild(this.buildCoordinatesNode(a)),b},multipoint:function(a){for(var d,e,b=this.createElementNS(this.gmlns,"gml:MultiPoint"),c=a.components,f=0;f<c.length;f++)d=this.createElementNS(this.gmlns,"gml:pointMember"),e=this.buildGeometry.point.apply(this,[c[f]]),d.appendChild(e),b.appendChild(d);return b},linestring:function(a){var b=this.createElementNS(this.gmlns,"gml:LineString");return b.appendChild(this.buildCoordinatesNode(a)),b},multilinestring:function(a){for(var d,e,b=this.createElementNS(this.gmlns,"gml:MultiLineString"),c=a.components,f=0;f<c.length;++f)d=this.createElementNS(this.gmlns,"gml:lineStringMember"),e=this.buildGeometry.linestring.apply(this,[c[f]]),d.appendChild(e),b.appendChild(d);return b},linearring:function(a){var b=this.createElementNS(this.gmlns,"gml:LinearRing");return b.appendChild(this.buildCoordinatesNode(a)),b},polygon:function(a){for(var d,e,f,b=this.createElementNS(this.gmlns,"gml:Polygon"),c=a.components,g=0;g<c.length;++g)f=0==g?"outerBoundaryIs":"innerBoundaryIs",d=this.createElementNS(this.gmlns,"gml:"+f),e=this.buildGeometry.linearring.apply(this,[c[g]]),d.appendChild(e),b.appendChild(d);return b},multipolygon:function(a){for(var d,e,b=this.createElementNS(this.gmlns,"gml:MultiPolygon"),c=a.components,f=0;f<c.length;++f)d=this.createElementNS(this.gmlns,"gml:polygonMember"),e=this.buildGeometry.polygon.apply(this,[c[f]]),d.appendChild(e),b.appendChild(d);return b},bounds:function(a){var b=this.createElementNS(this.gmlns,"gml:Box");return b.appendChild(this.buildCoordinatesNode(a)),b}},buildCoordinatesNode:function(a){var b=this.createElementNS(this.gmlns,"gml:coordinates");b.setAttribute("decimal","."),b.setAttribute("cs",","),b.setAttribute("ts"," ");var c=[];if(a instanceof OpenLayers.Bounds)c.push(a.left+","+a.bottom),c.push(a.right+","+a.top);else for(var d=a.components?a.components:[a],e=0;e<d.length;e++)c.push(d[e].x+","+d[e].y);var f=this.createTextNode(c.join(" "));return b.appendChild(f),b},CLASS_NAME:"OpenLayers.Format.GML"}),OpenLayers.Format.GML||(OpenLayers.Format.GML={}),OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]),this.setGeometryTypes(),a&&a.featureNS&&this.setNamespace("feature",a.featureNS),this.singleFeatureType=!a||"string"==typeof a.featureType},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b=[];if(this.readNode(a,{features:b},!0),0==b.length){var c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMember");if(c.length)for(var d=0,e=c.length;d<e;++d)this.readNode(c[d],{features:b},!0);else{var c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMembers");c.length&&this.readNode(c[0],{features:b},!0)}}return b},readNode:function(a,b,c){return c===!0&&this.autoConfig===!0&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null),this.featureNS||a.prefix in this.namespaces||a.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(a.parentNode.nodeName)||(this.featureType=a.nodeName.split(":").pop(),this.setNamespace("feature",a.namespaceURI),this.featureNS=a.namespaceURI,this.autoConfig=!0),OpenLayers.Format.XML.prototype.readNode.apply(this,[a,b])},readers:{gml:{_inherit:function(a,b,c){},featureMember:function(a,b){this.readChildNodes(a,b)},featureMembers:function(a,b){this.readChildNodes(a,b)},name:function(a,b){b.name=this.getChildValue(a)},boundedBy:function(a,b){var c={};this.readChildNodes(a,c),c.components&&c.components.length>0&&(b.bounds=c.components[0])},Point:function(a,b){var c={points:[]};this.readChildNodes(a,c),b.components||(b.components=[]),b.components.push(c.points[0])},coordinates:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"");c=c.replace(this.regExes.trimComma,",");for(var e,d=c.split(this.regExes.splitSpace),f=d.length,g=new Array(f),h=0;h<f;++h)e=d[h].split(","),this.xy?g[h]=new OpenLayers.Geometry.Point(e[0],e[1],e[2]):g[h]=new OpenLayers.Geometry.Point(e[1],e[0],e[2]);b.points=g},coord:function(a,b){var c={};this.readChildNodes(a,c),b.points||(b.points=[]),b.points.push(new OpenLayers.Geometry.Point(c.x,c.y,c.z))},X:function(a,b){b.x=this.getChildValue(a)},Y:function(a,b){b.y=this.getChildValue(a)},Z:function(a,b){b.z=this.getChildValue(a)},MultiPoint:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.MultiPoint(c.components)]},pointMember:function(a,b){this.readChildNodes(a,b)},LineString:function(a,b){var c={};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components||(b.components=[]),b.components.push(new OpenLayers.Geometry.LineString(c.points))},MultiLineString:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.MultiLineString(c.components)]},lineStringMember:function(a,b){this.readChildNodes(a,b)},Polygon:function(a,b){var c={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),c.inner.unshift(c.outer),b.components||(b.components=[]),b.components.push(new OpenLayers.Geometry.Polygon(c.inner))},LinearRing:function(a,b){var c={};this.readers.gml._inherit.apply(this,[a,c]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.LinearRing(c.points)]},MultiPolygon:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)]},polygonMember:function(a,b){this.readChildNodes(a,b)},GeometryCollection:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.Collection(c.components)]},geometryMember:function(a,b){this.readChildNodes(a,b)}},feature:{"*":function(a,b){var c,d=a.localName||a.nodeName.split(":").pop();b.features?this.singleFeatureType||OpenLayers.Util.indexOf(this.featureType,d)===-1?d===this.featureType&&(c="_typeName"):c="_typeName":0==a.childNodes.length||1==a.childNodes.length&&3==a.firstChild.nodeType?this.extractAttributes&&(c="_attribute"):c="_geometry",c&&this.readers.feature[c].apply(this,[a,b])},_typeName:function(a,b){var c={components:[],attributes:{}};this.readChildNodes(a,c),c.name&&(c.attributes.name=c.name);var d=new OpenLayers.Feature.Vector(c.components[0],c.attributes);this.singleFeatureType||(d.type=a.nodeName.split(":").pop(),d.namespace=a.namespaceURI);var e=a.getAttribute("fid")||this.getAttributeNS(a,this.namespaces.gml,"id");e&&(d.fid=e),this.internalProjection&&this.externalProjection&&d.geometry&&d.geometry.transform(this.externalProjection,this.internalProjection),c.bounds&&(d.bounds=c.bounds),b.features.push(d)},_geometry:function(a,b){this.geometryName||(this.geometryName=a.nodeName.split(":").pop()),this.readChildNodes(a,b)},_attribute:function(a,b){var c=a.localName||a.nodeName.split(":").pop(),d=this.getChildValue(a);b.attributes[c]=d}},wfs:{FeatureCollection:function(a,b){this.readChildNodes(a,b)}}},write:function(a){var b;b=OpenLayers.Util.isArray(a)?"featureMembers":"featureMember";var c=this.writeNode("gml:"+b,a);return this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:{featureMember:function(a){var b=this.createElementNSPlus("gml:featureMember");return this.writeNode("feature:_typeName",a,b),b},MultiPoint:function(a){for(var b=this.createElementNSPlus("gml:MultiPoint"),c=a.components||[a],d=0,e=c.length;d<e;++d)this.writeNode("pointMember",c[d],b);return b},pointMember:function(a){var b=this.createElementNSPlus("gml:pointMember");return this.writeNode("Point",a,b),b},MultiLineString:function(a){for(var b=this.createElementNSPlus("gml:MultiLineString"),c=a.components||[a],d=0,e=c.length;d<e;++d)this.writeNode("lineStringMember",c[d],b);return b},lineStringMember:function(a){var b=this.createElementNSPlus("gml:lineStringMember");return this.writeNode("LineString",a,b),b},MultiPolygon:function(a){for(var b=this.createElementNSPlus("gml:MultiPolygon"),c=a.components||[a],d=0,e=c.length;d<e;++d)this.writeNode("polygonMember",c[d],b);return b},polygonMember:function(a){var b=this.createElementNSPlus("gml:polygonMember");return this.writeNode("Polygon",a,b),b},GeometryCollection:function(a){for(var b=this.createElementNSPlus("gml:GeometryCollection"),c=0,d=a.components.length;c<d;++c)this.writeNode("geometryMember",a.components[c],b);return b},geometryMember:function(a){var b=this.createElementNSPlus("gml:geometryMember"),c=this.writeNode("feature:_geometry",a);return b.appendChild(c.firstChild),b}},feature:{_typeName:function(a){var b=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:a.fid}});a.geometry&&this.writeNode("feature:_geometry",a.geometry,b);for(var c in a.attributes){var d=a.attributes[c];null!=d&&this.writeNode("feature:_attribute",{name:c,value:d},b)}return b},_geometry:function(a){this.externalProjection&&this.internalProjection&&(a=a.clone().transform(this.internalProjection,this.externalProjection));var b=this.createElementNSPlus("feature:"+this.geometryName),c=this.geometryTypes[a.CLASS_NAME],d=this.writeNode("gml:"+c,a,b);return this.srsName&&d.setAttribute("srsName",this.srsName),b},_attribute:function(a){return this.createElementNSPlus("feature:"+a.name,{value:a.value})}},wfs:{FeatureCollection:function(a){for(var b=this.createElementNSPlus("wfs:FeatureCollection"),c=0,d=a.length;c<d;++c)this.writeNode("gml:featureMember",a[c],b);return b}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"}),OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a]);
},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(a,b){var c={};this.readChildNodes(a,c),b.outer=c.components[0]},innerBoundaryIs:function(a,b){var c={};this.readChildNodes(a,c),b.inner.push(c.components[0])},Box:function(a,b){var c={};this.readChildNodes(a,c),b.components||(b.components=[]);var d=c.points[0],e=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,e.x,e.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(a){var b;b=OpenLayers.Util.isArray(a)?"wfs:FeatureCollection":"gml:featureMember";var c=this.writeNode(b,a);return this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(a){var b=this.createElementNSPlus("gml:Point");return this.writeNode("coordinates",[a],b),b},coordinates:function(a){for(var d,b=a.length,c=new Array(b),e=0;e<b;++e)d=a[e],this.xy?c[e]=d.x+","+d.y:c[e]=d.y+","+d.x,void 0!=d.z&&(c[e]+=","+d.z);return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==b?c[0]:c.join(" ")})},LineString:function(a){var b=this.createElementNSPlus("gml:LineString");return this.writeNode("coordinates",a.components,b),b},Polygon:function(a){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",a.components[0],b);for(var c=1;c<a.components.length;++c)this.writeNode("innerBoundaryIs",a.components[c],b);return b},outerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:outerBoundaryIs");return this.writeNode("LinearRing",a,b),b},innerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:innerBoundaryIs");return this.writeNode("LinearRing",a,b),b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");return this.writeNode("coordinates",a.components,b),b},Box:function(a){var b=this.createElementNSPlus("gml:Box");return this.writeNode("coordinates",[{x:a.left,y:a.bottom},{x:a.right,y:a.top}],b),this.srsName&&b.setAttribute("srsName",this.srsName),b}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"}),OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(a,b,c){var d=parseInt(a.getAttribute("srsDimension"),10)||c&&c.srsDimension;d&&(b.srsDimension=d)},featureMembers:function(a,b){this.readChildNodes(a,b)},Curve:function(a,b){var c={points:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components||(b.components=[]),b.components.push(new OpenLayers.Geometry.LineString(c.points))},segments:function(a,b){this.readChildNodes(a,b)},LineStringSegment:function(a,b){var c={};this.readChildNodes(a,c),c.points&&Array.prototype.push.apply(b.points,c.points)},pos:function(a,b){var e,c=this.getChildValue(a).replace(this.regExes.trimSpace,""),d=c.split(this.regExes.splitSpace);e=this.xy?new OpenLayers.Geometry.Point(d[0],d[1],d[2]):new OpenLayers.Geometry.Point(d[1],d[0],d[2]),b.points=[e]},posList:function(a,b){for(var g,h,i,c=this.getChildValue(a).replace(this.regExes.trimSpace,""),d=c.split(this.regExes.splitSpace),e=b.srsDimension||parseInt(a.getAttribute("srsDimension")||a.getAttribute("dimension"),10)||2,j=d.length/e,k=new Array(j),l=0,m=d.length;l<m;l+=e)g=d[l],h=d[l+1],i=2==e?void 0:d[l+2],this.xy?k[l/e]=new OpenLayers.Geometry.Point(g,h,i):k[l/e]=new OpenLayers.Geometry.Point(h,g,i);b.points=k},Surface:function(a,b){this.readChildNodes(a,b)},patches:function(a,b){this.readChildNodes(a,b)},PolygonPatch:function(a,b){this.readers.gml.Polygon.apply(this,[a,b])},exterior:function(a,b){var c={};this.readChildNodes(a,c),b.outer=c.components[0]},interior:function(a,b){var c={};this.readChildNodes(a,c),b.inner.push(c.components[0])},MultiCurve:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),c.components.length>0&&(b.components=[new OpenLayers.Geometry.MultiLineString(c.components)])},curveMember:function(a,b){this.readChildNodes(a,b)},MultiSurface:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),c.components.length>0&&(b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)])},surfaceMember:function(a,b){this.readChildNodes(a,b)},surfaceMembers:function(a,b){this.readChildNodes(a,b)},pointMembers:function(a,b){this.readChildNodes(a,b)},lineStringMembers:function(a,b){this.readChildNodes(a,b)},polygonMembers:function(a,b){this.readChildNodes(a,b)},geometryMembers:function(a,b){this.readChildNodes(a,b)},Envelope:function(a,b){var c={points:new Array(2)};this.readChildNodes(a,c),b.components||(b.components=[]);var d=c.points[0],e=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,e.x,e.y))},lowerCorner:function(a,b){var c={};this.readers.gml.pos.apply(this,[a,c]),b.points[0]=c.points[0]},upperCorner:function(a,b){var c={};this.readers.gml.pos.apply(this,[a,c]),b.points[1]=c.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(a){var b;b=OpenLayers.Util.isArray(a)?"featureMembers":"featureMember";var c=this.writeNode("gml:"+b,a);return this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a){for(var b=this.createElementNSPlus("gml:featureMembers"),c=0,d=a.length;c<d;++c)this.writeNode("feature:_typeName",a[c],b);return b},Point:function(a){var b=this.createElementNSPlus("gml:Point");return this.writeNode("pos",a,b),b},pos:function(a){var b=this.xy?a.x+" "+a.y:a.y+" "+a.x;return this.createElementNSPlus("gml:pos",{value:b})},LineString:function(a){var b=this.createElementNSPlus("gml:LineString");return this.writeNode("posList",a.components,b),b},Curve:function(a){var b=this.createElementNSPlus("gml:Curve");return this.writeNode("segments",a,b),b},segments:function(a){var b=this.createElementNSPlus("gml:segments");return this.writeNode("LineStringSegment",a,b),b},LineStringSegment:function(a){var b=this.createElementNSPlus("gml:LineStringSegment");return this.writeNode("posList",a.components,b),b},posList:function(a){for(var d,b=a.length,c=new Array(b),e=0;e<b;++e)d=a[e],this.xy?c[e]=d.x+" "+d.y:c[e]=d.y+" "+d.x;return this.createElementNSPlus("gml:posList",{value:c.join(" ")})},Surface:function(a){var b=this.createElementNSPlus("gml:Surface");return this.writeNode("patches",a,b),b},patches:function(a){var b=this.createElementNSPlus("gml:patches");return this.writeNode("PolygonPatch",a,b),b},PolygonPatch:function(a){var b=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",a.components[0],b);for(var c=1,d=a.components.length;c<d;++c)this.writeNode("interior",a.components[c],b);return b},Polygon:function(a){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",a.components[0],b);for(var c=1,d=a.components.length;c<d;++c)this.writeNode("interior",a.components[c],b);return b},exterior:function(a){var b=this.createElementNSPlus("gml:exterior");return this.writeNode("LinearRing",a,b),b},interior:function(a){var b=this.createElementNSPlus("gml:interior");return this.writeNode("LinearRing",a,b),b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");return this.writeNode("posList",a.components,b),b},MultiCurve:function(a){for(var b=this.createElementNSPlus("gml:MultiCurve"),c=a.components||[a],d=0,e=c.length;d<e;++d)this.writeNode("curveMember",c[d],b);return b},curveMember:function(a){var b=this.createElementNSPlus("gml:curveMember");return this.curve?this.writeNode("Curve",a,b):this.writeNode("LineString",a,b),b},MultiSurface:function(a){for(var b=this.createElementNSPlus("gml:MultiSurface"),c=a.components||[a],d=0,e=c.length;d<e;++d)this.writeNode("surfaceMember",c[d],b);return b},surfaceMember:function(a){var b=this.createElementNSPlus("gml:surfaceMember");return this.surface?this.writeNode("Surface",a,b):this.writeNode("Polygon",a,b),b},Envelope:function(a){var b=this.createElementNSPlus("gml:Envelope");return this.writeNode("lowerCorner",a,b),this.writeNode("upperCorner",a,b),this.srsName&&b.setAttribute("srsName",this.srsName),b},lowerCorner:function(a){var b=this.xy?a.left+" "+a.bottom:a.bottom+" "+a.left;return this.createElementNSPlus("gml:lowerCorner",{value:b})},upperCorner:function(a){var b=this.xy?a.right+" "+a.top:a.top+" "+a.right;return this.createElementNSPlus("gml:upperCorner",{value:b})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":this.curve===!0?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":this.multiCurve===!1?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":this.surface===!0?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":this.multiSurface===!1?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"}),OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var c=a.documentElement,d={exceptionReport:null};return c&&(this.readChildNodes(a,d),null===d.exceptionReport&&(d=(new OpenLayers.Format.OWSCommon).read(a))),d},readers:{ogc:{ServiceExceptionReport:function(a,b){b.exceptionReport={exceptions:[]},this.readChildNodes(a,b.exceptionReport)},ServiceException:function(a,b){var c={code:a.getAttribute("code"),locator:a.getAttribute("locator"),text:this.getChildValue(a)};b.exceptions.push(c)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"}),OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);var b=this.CLASS_NAME;this.name=b.substring(b.lastIndexOf(".")+1)},getVersion:function(a,b){var c;return a?(c=this.version,c||(c=a.getAttribute("version"),c||(c=this.defaultVersion))):c=b&&b.version||this.version||this.defaultVersion,c},getParser:function(a){a=a||this.defaultVersion;var b=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=a){var c=OpenLayers.Format[this.name]["v"+a.replace(/\./g,"_")+b];if(!c&&(""!==b&&this.allowFallback&&(b="",c=OpenLayers.Format[this.name]["v"+a.replace(/\./g,"_")]),!c))throw"Can't find a "+this.name+" parser for version "+a+b;this.parser=new c(this.options)}return this.parser},write:function(a,b){var c=this.getVersion(null,b);this.parser=this.getParser(c);var d=this.parser.write(a,b);return this.stringifyOutput===!1?d:OpenLayers.Format.XML.prototype.write.apply(this,[d])},read:function(a,b){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var c=a.documentElement,d=this.getVersion(c);this.parser=this.getParser(d);var e=this.parser.read(a,b),f=this.parser.errorProperty||null;if(null!==f&&void 0===e[f]){var g=new OpenLayers.Format.OGCExceptionReport;e.error=g.read(a)}return e.version=d,e},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"}),OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"}),OpenLayers.Format.WMSDescribeLayer.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(a){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var e,f,b=a.documentElement,c=b.childNodes,d={layerDescriptions:[]},g=0;g<c.length;++g)if(e=c[g],f=e.nodeName,"LayerDescription"==f){var h=e.getAttribute("name"),i="",j="",k="";e.getAttribute("owsType")?(i=e.getAttribute("owsType"),j=e.getAttribute("owsURL")):""!=e.getAttribute("wfs")?(i="WFS",j=e.getAttribute("wfs")):""!=e.getAttribute("wcs")&&(i="WCS",j=e.getAttribute("wcs"));var l=e.getElementsByTagName("Query");l.length>0&&(k=l[0].getAttribute("typeName"),k||(k=l[0].getAttribute("typename")));var m={layerName:h,owsType:i,owsURL:j,typeName:k};d.layerDescriptions.push(m),d.length=d.layerDescriptions.length,d[d.length-1]=m}else if("ServiceException"==f){var n=new OpenLayers.Format.OGCExceptionReport;return{error:n.read(a)}}return d},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1_1"}),OpenLayers.Format.WMSDescribeLayer.v1_1_0=OpenLayers.Format.WMSDescribeLayer.v1_1_1,OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g},namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(a,b){var f,g,c=[],d={},e={complexTypes:c,customTypes:d};this.readChildNodes(a,e);var i,j,h=a.attributes;for(f=0,g=h.length;f<g;++f)i=h[f],j=i.name,0===j.indexOf("xmlns")?this.setNamespace(j.split(":")[1]||"",i.value):b[j]=i.value;b.featureTypes=c,b.targetPrefix=this.namespaceAlias[b.targetNamespace];var k,l;for(f=0,g=c.length;f<g;++f)k=c[f],l=d[k.typeName],d[k.typeName]&&(k.typeName=l.name)},complexType:function(a,b){var c={typeName:a.getAttribute("name")};this.readChildNodes(a,c),b.complexTypes.push(c)},complexContent:function(a,b){this.readChildNodes(a,b)},extension:function(a,b){this.readChildNodes(a,b)},sequence:function(a,b){var c={elements:[]};this.readChildNodes(a,c),b.properties=c.elements},element:function(a,b){var c;if(b.elements){for(var f,d={},e=a.attributes,g=0,h=e.length;g<h;++g)f=e[g],d[f.name]=f.value;c=d.type,c||(c={},this.readChildNodes(a,c),d.restriction=c,d.type=c.base);var i=c.base||c;d.localType=i.split(":").pop(),b.elements.push(d),this.readChildNodes(a,d)}if(b.complexTypes){c=a.getAttribute("type");var j=c.split(":").pop();b.customTypes[j]={name:a.getAttribute("name"),type:c}}},annotation:function(a,b){b.annotation={},this.readChildNodes(a,b.annotation)},appinfo:function(a,b){b.appinfo||(b.appinfo=[]),b.appinfo.push(this.getChildValue(a))},documentation:function(a,b){b.documentation||(b.documentation=[]);var c=this.getChildValue(a);b.documentation.push({lang:a.getAttribute("xml:lang"),textContent:c.replace(this.regExes.trimSpace,"")})},simpleType:function(a,b){this.readChildNodes(a,b)},restriction:function(a,b){b.base=a.getAttribute("base"),this.readRestriction(a,b)}}},readRestriction:function(a,b){for(var d,e,f,c=a.childNodes,g=0,h=c.length;g<h;++g)d=c[g],1==d.nodeType&&(e=d.nodeName.split(":").pop(),f=d.getAttribute("value"),b[e]?("string"==typeof b[e]&&(b[e]=[b[e]]),b[e].push(f)):b[e]=f)},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};if("ExceptionReport"===a.nodeName.split(":").pop()){var c=new OpenLayers.Format.OGCExceptionReport;b.error=c.read(a)}else this.readNode(a,b);return b},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"}),OpenLayers.Filter=OpenLayers.Class({initialize:function(a){OpenLayers.Util.extend(this,a)},destroy:function(){},evaluate:function(a){return!0},clone:function(){return null},toString:function(){var a;return a=OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"}),OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(a){this.fids=[],OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(a){for(var b=0,c=this.fids.length;b<c;b++){var d=a.fid||a.id;if(d==this.fids[b])return!0}return!1},clone:function(){var a=new OpenLayers.Filter.FeatureId;return OpenLayers.Util.extend(a,this),a.fids=this.fids.slice(),a},CLASS_NAME:"OpenLayers.Filter.FeatureId"}),OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(a){this.filters=[],OpenLayers.Filter.prototype.initialize.apply(this,[a])},destroy:function(){this.filters=null,OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(a){var b,c;switch(this.type){case OpenLayers.Filter.Logical.AND:for(b=0,c=this.filters.length;b<c;b++)if(0==this.filters[b].evaluate(a))return!1;return!0;case OpenLayers.Filter.Logical.OR:for(b=0,c=this.filters.length;b<c;b++)if(1==this.filters[b].evaluate(a))return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(a)}},clone:function(){for(var a=[],b=0,c=this.filters.length;b<c;++b)a.push(this.filters[b].clone());return new OpenLayers.Filter.Logical({type:this.type,filters:a})},CLASS_NAME:"OpenLayers.Filter.Logical"}),OpenLayers.Filter.Logical.AND="&&",OpenLayers.Filter.Logical.OR="||",OpenLayers.Filter.Logical.NOT="!",OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a]),this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===a.matchCase&&(this.matchCase=null)},evaluate:function(a){a instanceof OpenLayers.Feature.Vector&&(a=a.attributes);var d,b=!1,c=a[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:d=this.value,b=this.matchCase||"string"!=typeof c||"string"!=typeof d?c==d:c.toUpperCase()==d.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:d=this.value,b=this.matchCase||"string"!=typeof c||"string"!=typeof d?c!=d:c.toUpperCase()!=d.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:b=c<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:b=c>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:b=c<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:b=c>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:b=c>=this.lowerBoundary&&c<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:var e=new RegExp(this.value,"gi");b=e.test(c);break;case OpenLayers.Filter.Comparison.IS_NULL:b=null===c}return b},value2regex:function(a,b,c){if("."==a)throw new Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");return a=a?a:"*",b=b?b:".",c=c?c:"!",this.value=this.value.replace(new RegExp("\\"+c+"(.|$)","g"),"\\$1"),this.value=this.value.replace(new RegExp("\\"+b,"g"),"."),this.value=this.value.replace(new RegExp("\\"+a,"g"),".*"),this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+a),this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+b),this.value},regex2value:function(){var a=this.value;return a=a.replace(/!/g,"!!"),a=a.replace(/(\\)?\\\./g,function(a,b){return b?a:"!."}),a=a.replace(/(\\)?\\\*/g,function(a,b){return b?a:"!*"}),a=a.replace(/\\\\/g,"\\"),a=a.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"}),OpenLayers.Filter.Comparison.EQUAL_TO="==",OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=",OpenLayers.Filter.Comparison.LESS_THAN="<",OpenLayers.Filter.Comparison.GREATER_THAN=">",OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=",OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=",OpenLayers.Filter.Comparison.BETWEEN="..",OpenLayers.Filter.Comparison.LIKE="~",OpenLayers.Filter.Comparison.IS_NULL="NULL",OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(a){var b=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(a.geometry){var c=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&&(c=this.value.toGeometry()),a.geometry.intersects(c)&&(b=!0)}break;default:throw new Error("evaluate is not implemented for this filter type.")}return b},clone:function(){var a=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(a)},CLASS_NAME:"OpenLayers.Filter.Spatial"}),OpenLayers.Filter.Spatial.BBOX="BBOX",OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS",OpenLayers.Filter.Spatial.DWITHIN="DWITHIN",OpenLayers.Filter.Spatial.WITHIN="WITHIN",OpenLayers.Filter.Spatial.CONTAINS="CONTAINS",OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:!0,namedLayersAsArray:!1,CLASS_NAME:"OpenLayers.Format.SLD"}),OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"}),OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"}),OpenLayers.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:function(){return"toISOString"in Date.prototype?function(a){return a.toISOString()}:function(a){var b;return b=isNaN(a.getTime())?"Invalid Date":a.getUTCFullYear()+"-"+OpenLayers.Number.zeroPad(a.getUTCMonth()+1,2)+"-"+OpenLayers.Number.zeroPad(a.getUTCDate(),2)+"T"+OpenLayers.Number.zeroPad(a.getUTCHours(),2)+":"+OpenLayers.Number.zeroPad(a.getUTCMinutes(),2)+":"+OpenLayers.Number.zeroPad(a.getUTCSeconds(),2)+"."+OpenLayers.Number.zeroPad(a.getUTCMilliseconds(),3)+"Z"}}(),parse:function(a){var b,c=a.match(this.dateRegEx);if(c&&(c[1]||c[7])){var d=parseInt(c[1],10)||0,e=parseInt(c[2],10)-1||0,f=parseInt(c[3],10)||1;b=new Date(Date.UTC(d,e,f));var g=c[7];if(g){var h=parseInt(c[4],10),i=parseInt(c[5],10),j=parseFloat(c[6]),k=0|j,l=Math.round(1e3*(j-k));if(b.setUTCHours(h,i,k,l),"Z"!==g){var m=parseInt(g,10),n=parseInt(c[8],10)||0,o=-1e3*(60*(60*m)+60*n);b=new Date(b.getTime()+o)}}}else b=new Date("invalid");return b}},OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){var b={};return this.readers.ogc.Filter.apply(this,[a,b]),b.filter},readers:{ogc:{_expression:function(a){for(var b,c="",d=a.firstChild;d;d=d.nextSibling)switch(d.nodeType){case 1:b=this.readNode(d),b.property?c+="${"+b.property+"}":void 0!==b.value&&(c+=b.value);break;case 3:case 4:c+=d.nodeValue}return c},Filter:function(a,b){var c={fids:[],filters:[]};this.readChildNodes(a,c),c.fids.length>0?b.filter=new OpenLayers.Filter.FeatureId({fids:c.fids}):c.filters.length>0&&(b.filter=c.filters[0])},FeatureId:function(a,b){var c=a.getAttribute("fid");c&&b.fids.push(c)},And:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(a,c),b.filters.push(c)},Or:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(a,c),b.filters.push(c)},Not:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLessThan:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsGreaterThan:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLessThanOrEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsGreaterThanOrEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsBetween:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(a,c),b.filters.push(c)},Literal:function(a,b){b.value=OpenLayers.String.numericIf(this.getChildValue(a),!0)},PropertyName:function(a,b){b.property=this.getChildValue(a)},LowerBoundary:function(a,b){b.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,a),!0)},UpperBoundary:function(a,b){b.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,a),!0)},Intersects:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(a,b){b.distance=parseInt(this.getChildValue(a)),b.distanceUnits=a.getAttribute("units")},Function:function(a,b){},PropertyIsNull:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL});this.readChildNodes(a,c),b.filters.push(c)}}},readSpatial:function(a,b,c){var d=new OpenLayers.Filter.Spatial({type:c});this.readChildNodes(a,d),d.value=d.components[0],delete d.components,b.filters.push(d)},encodeLiteral:function(a){return a instanceof Date&&(a=OpenLayers.Date.toISOString(a)),a},writeOgcExpression:function(a,b){return a instanceof OpenLayers.Filter.Function?this.writeNode("Function",a,b):this.writeNode("Literal",a,b),b},write:function(a){return this.writers.ogc.Filter.apply(this,[a])},writers:{ogc:{Filter:function(a){var b=this.createElementNSPlus("ogc:Filter");return this.writeNode(this.getFilterType(a),a,b),b},_featureIds:function(a){for(var b=this.createDocumentFragment(),c=0,d=a.fids.length;c<d;++c)this.writeNode("ogc:FeatureId",a.fids[c],b);return b},FeatureId:function(a){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:a}})},And:function(a){for(var c,b=this.createElementNSPlus("ogc:And"),d=0,e=a.filters.length;d<e;++d)c=a.filters[d],this.writeNode(this.getFilterType(c),c,b);return b},Or:function(a){for(var c,b=this.createElementNSPlus("ogc:Or"),d=0,e=a.filters.length;d<e;++d)c=a.filters[d],this.writeNode(this.getFilterType(c),c,b);return b},Not:function(a){var b=this.createElementNSPlus("ogc:Not"),c=a.filters[0];return this.writeNode(this.getFilterType(c),c,b),b},PropertyIsLessThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThan");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsGreaterThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThan");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsLessThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsGreaterThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsBetween:function(a){var b=this.createElementNSPlus("ogc:PropertyIsBetween");return this.writeNode("PropertyName",a,b),this.writeNode("LowerBoundary",a,b),this.writeNode("UpperBoundary",a,b),b},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property})},Literal:function(a){var b=this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral;return this.createElementNSPlus("ogc:Literal",{value:b(a)})},LowerBoundary:function(a){var b=this.createElementNSPlus("ogc:LowerBoundary");return this.writeOgcExpression(a.lowerBoundary,b),b},UpperBoundary:function(a){var b=this.createElementNSPlus("ogc:UpperBoundary");return this.writeNode("Literal",a.upperBoundary,b),b},INTERSECTS:function(a){return this.writeSpatial(a,"Intersects")},WITHIN:function(a){return this.writeSpatial(a,"Within")},CONTAINS:function(a){return this.writeSpatial(a,"Contains")},DWITHIN:function(a){var b=this.writeSpatial(a,"DWithin");return this.writeNode("Distance",a,b),b},Distance:function(a){return this.createElementNSPlus("ogc:Distance",{attributes:{units:a.distanceUnits},value:a.distance})},Function:function(a){for(var b=this.createElementNSPlus("ogc:Function",{attributes:{name:a.name}}),c=a.params,d=0,e=c.length;d<e;d++)this.writeOgcExpression(c[d],b);return b},PropertyIsNull:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNull");return this.writeNode("PropertyName",a,b),b}}},getFilterType:function(a){var b=this.filterMap[a.type];if(!b)throw"Filter writing not supported for rule type: "+a.type;return b},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"OpenLayers.Format.Filter.v1"}),OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsNotEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLike:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(a,c);var d=a.getAttribute("wildCard"),e=a.getAttribute("singleChar"),f=a.getAttribute("escape");c.value2regex(d,e,f),b.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});return this.writeNode("PropertyName",a,b),this.writeNode("Literal",a.regex2value(),b),b},BBOX:function(a){var b=this.createElementNSPlus("ogc:BBOX");a.property&&this.writeNode("PropertyName",a,b);var c=this.writeNode("gml:Box",a.value,b);return a.projection&&c.setAttribute("srsName",a.projection),b}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(a,b){
var c=this.createElementNSPlus("ogc:"+b);if(this.writeNode("PropertyName",a,c),a.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",a.value,c);else{var d;d=a.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",a.value).firstChild:this.writeNode("gml:Box",a.value),a.projection&&d.setAttribute("srsName",a.projection),c.appendChild(d)}return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"}),OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:!1,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},read:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c={namedLayers:b.namedLayersAsArray===!0?[]:{}};return this.readChildNodes(a,c),c},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(a,b){b.version=a.getAttribute("version"),this.readChildNodes(a,b)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.description=this.getChildValue(a)},NamedLayer:function(a,b){var c={userStyles:[],namedStyles:[]};this.readChildNodes(a,c);for(var d=0,e=c.userStyles.length;d<e;++d)c.userStyles[d].layerName=c.name;OpenLayers.Util.isArray(b.namedLayers)?b.namedLayers.push(c):b.namedLayers[c.name]=c},NamedStyle:function(a,b){b.namedStyles.push(this.getChildName(a.firstChild))},UserStyle:function(a,b){var c={defaultsPerSymbolizer:!0,rules:[]};this.featureTypeCounter=-1,this.readChildNodes(a,c);var d;this.multipleSymbolizers?(delete c.defaultsPerSymbolizer,d=new OpenLayers.Style2(c)):d=new OpenLayers.Style(this.defaultSymbolizer,c),b.userStyles.push(d)},IsDefault:function(a,b){"1"==this.getChildValue(a)&&(b.isDefault=!0)},FeatureTypeStyle:function(a,b){++this.featureTypeCounter;var c={rules:this.multipleSymbolizers?b.rules:[]};this.readChildNodes(a,c),this.multipleSymbolizers||(b.rules=c.rules)},Rule:function(a,b){var c;this.multipleSymbolizers&&(c={symbolizers:[]});var d=new OpenLayers.Rule(c);this.readChildNodes(a,d),b.rules.push(d)},ElseFilter:function(a,b){b.elseFilter=!0},MinScaleDenominator:function(a,b){b.minScaleDenominator=parseFloat(this.getChildValue(a))},MaxScaleDenominator:function(a,b){b.maxScaleDenominator=parseFloat(this.getChildValue(a))},TextSymbolizer:function(a,b){var c={};this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Text(c))):b.symbolizer.Text=OpenLayers.Util.applyDefaults(c,b.symbolizer.Text)},LabelPlacement:function(a,b){this.readChildNodes(a,b)},PointPlacement:function(a,b){var c={};this.readChildNodes(a,c),c.labelRotation=c.rotation,delete c.rotation;var d,e=b.labelAnchorPointX,f=b.labelAnchorPointY;e<=1/3?d="l":e>1/3&&e<2/3?d="c":e>=2/3&&(d="r"),f<=1/3?d+="b":f>1/3&&f<2/3?d+="m":f>=2/3&&(d+="t"),c.labelAlign=d,OpenLayers.Util.applyDefaults(b,c)},AnchorPoint:function(a,b){this.readChildNodes(a,b)},AnchorPointX:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelAnchorPointX=c)},AnchorPointY:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelAnchorPointY=c)},Displacement:function(a,b){this.readChildNodes(a,b)},DisplacementX:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelXOffset=c)},DisplacementY:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelYOffset=c)},LinePlacement:function(a,b){this.readChildNodes(a,b)},PerpendicularOffset:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelPerpendicularOffset=c)},Label:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.label=c)},Font:function(a,b){this.readChildNodes(a,b)},Halo:function(a,b){var c={};this.readChildNodes(a,c),b.haloRadius=c.haloRadius,b.haloColor=c.fillColor,b.haloOpacity=c.fillOpacity},Radius:function(a,b){var c=this.readers.ogc._expression.call(this,a);null!=c&&(b.haloRadius=c)},RasterSymbolizer:function(a,b){var c={};this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Raster(c))):b.symbolizer.Raster=OpenLayers.Util.applyDefaults(c,b.symbolizer.Raster)},Geometry:function(a,b){b.geometry={},this.readChildNodes(a,b.geometry)},ColorMap:function(a,b){b.colorMap=[],this.readChildNodes(a,b.colorMap)},ColorMapEntry:function(a,b){var c=a.getAttribute("quantity"),d=a.getAttribute("opacity");b.push({color:a.getAttribute("color"),quantity:null!==c?parseFloat(c):void 0,label:a.getAttribute("label")||void 0,opacity:null!==d?parseFloat(d):void 0})},LineSymbolizer:function(a,b){var c={};this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Line(c))):b.symbolizer.Line=OpenLayers.Util.applyDefaults(c,b.symbolizer.Line)},PolygonSymbolizer:function(a,b){var c={fill:!1,stroke:!1};this.multipleSymbolizers||(c=b.symbolizer.Polygon||c),this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Polygon(c))):b.symbolizer.Polygon=c},PointSymbolizer:function(a,b){var c={fill:!1,stroke:!1,graphic:!1};this.multipleSymbolizers||(c=b.symbolizer.Point||c),this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Point(c))):b.symbolizer.Point=c},Stroke:function(a,b){b.stroke=!0,this.readChildNodes(a,b)},Fill:function(a,b){b.fill=!0,this.readChildNodes(a,b)},CssParameter:function(a,b){var c=a.getAttribute("name"),d=this.cssMap[c];if(b.label&&("fill"===c?d="fontColor":"fill-opacity"===c&&(d="fontOpacity")),d){var e=this.readers.ogc._expression.call(this,a);e&&(b[d]=e)}},Graphic:function(a,b){b.graphic=!0;var c={};this.readChildNodes(a,c);for(var e,f,d=["stroke","strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fill","fillColor","fillOpacity","graphicName","rotation","graphicFormat"],g=0,h=d.length;g<h;++g)e=d[g],f=c[e],void 0!=f&&(b[e]=f);if(void 0!=c.opacity&&(b.graphicOpacity=c.opacity),void 0!=c.size){var i=c.size/2;isNaN(i)?b.graphicWidth=c.size:b.pointRadius=c.size/2}void 0!=c.href&&(b.externalGraphic=c.href),void 0!=c.rotation&&(b.rotation=c.rotation)},ExternalGraphic:function(a,b){this.readChildNodes(a,b)},Mark:function(a,b){this.readChildNodes(a,b)},WellKnownName:function(a,b){b.graphicName=this.getChildValue(a)},Opacity:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.opacity=c)},Size:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.size=c)},Rotation:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.rotation=c)},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},Format:function(a,b){b.graphicFormat=this.getChildValue(a)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(a){var b=null;for(var c in this.cssMap)if(this.cssMap[c]==a){b=c;break}return b},getGraphicFormat:function(a){var b;for(var d in this.graphicFormats)if(this.graphicFormats[d].test(a)){b=d;break}return b||this.defaultGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(a){return this.writers.sld.StyledLayerDescriptor.apply(this,[a])},writers:OpenLayers.Util.applyDefaults({sld:{_OGCExpression:function(a,b){var c=this.createElementNSPlus(a),d="string"==typeof b?b.split("${"):[b];c.appendChild(this.createTextNode(d[0]));for(var e,f,g=1,h=d.length;g<h;g++)e=d[g],f=e.indexOf("}"),f>0?(this.writeNode("ogc:PropertyName",{property:e.substring(0,f)},c),c.appendChild(this.createTextNode(e.substring(++f)))):c.appendChild(this.createTextNode("${"+e));return c},StyledLayerDescriptor:function(a){var b=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});if(b.setAttribute("xmlns:ogc",this.namespaces.ogc),b.setAttribute("xmlns:gml",this.namespaces.gml),a.name&&this.writeNode("Name",a.name,b),a.title&&this.writeNode("Title",a.title,b),a.description&&this.writeNode("Abstract",a.description,b),OpenLayers.Util.isArray(a.namedLayers))for(var c=0,d=a.namedLayers.length;c<d;++c)this.writeNode("NamedLayer",a.namedLayers[c],b);else for(var e in a.namedLayers)this.writeNode("NamedLayer",a.namedLayers[e],b);return b},Name:function(a){return this.createElementNSPlus("sld:Name",{value:a})},Title:function(a){return this.createElementNSPlus("sld:Title",{value:a})},Abstract:function(a){return this.createElementNSPlus("sld:Abstract",{value:a})},NamedLayer:function(a){var b=this.createElementNSPlus("sld:NamedLayer");if(this.writeNode("Name",a.name,b),a.namedStyles)for(var c=0,d=a.namedStyles.length;c<d;++c)this.writeNode("NamedStyle",a.namedStyles[c],b);if(a.userStyles)for(var c=0,d=a.userStyles.length;c<d;++c)this.writeNode("UserStyle",a.userStyles[c],b);return b},NamedStyle:function(a){var b=this.createElementNSPlus("sld:NamedStyle");return this.writeNode("Name",a,b),b},UserStyle:function(a){var b=this.createElementNSPlus("sld:UserStyle");if(a.name&&this.writeNode("Name",a.name,b),a.title&&this.writeNode("Title",a.title,b),a.description&&this.writeNode("Abstract",a.description,b),a.isDefault&&this.writeNode("IsDefault",a.isDefault,b),this.multipleSymbolizers&&a.rules){for(var e,f,g,h,i,c={0:[]},d=[0],j=0,k=a.rules.length;j<k;++j)if(e=a.rules[j],e.symbolizers){f={};for(var l=0,m=e.symbolizers.length;l<m;++l)g=e.symbolizers[l],h=g.zIndex,h in f||(i=e.clone(),i.symbolizers=[],f[h]=i),f[h].symbolizers.push(g.clone());for(h in f)h in c||(d.push(h),c[h]=[]),c[h].push(f[h])}else c[0].push(e.clone());d.sort();for(var n,j=0,k=d.length;j<k;++j)n=c[d[j]],n.length>0&&(i=a.clone(),i.rules=c[d[j]],this.writeNode("FeatureTypeStyle",i,b))}else this.writeNode("FeatureTypeStyle",a,b);return b},IsDefault:function(a){return this.createElementNSPlus("sld:IsDefault",{value:a?"1":"0"})},FeatureTypeStyle:function(a){for(var b=this.createElementNSPlus("sld:FeatureTypeStyle"),c=0,d=a.rules.length;c<d;++c)this.writeNode("Rule",a.rules[c],b);return b},Rule:function(a){var b=this.createElementNSPlus("sld:Rule");a.name&&this.writeNode("Name",a.name,b),a.title&&this.writeNode("Title",a.title,b),a.description&&this.writeNode("Abstract",a.description,b),a.elseFilter?this.writeNode("ElseFilter",null,b):a.filter&&this.writeNode("ogc:Filter",a.filter,b),void 0!=a.minScaleDenominator&&this.writeNode("MinScaleDenominator",a.minScaleDenominator,b),void 0!=a.maxScaleDenominator&&this.writeNode("MaxScaleDenominator",a.maxScaleDenominator,b);var c,d;if(this.multipleSymbolizers&&a.symbolizers)for(var d,e=0,f=a.symbolizers.length;e<f;++e)d=a.symbolizers[e],c=d.CLASS_NAME.split(".").pop(),this.writeNode(c+"Symbolizer",d,b);else for(var g=OpenLayers.Style.SYMBOLIZER_PREFIXES,e=0,h=g.length;e<h;++e)c=g[e],d=a.symbolizer[c],d&&this.writeNode(c+"Symbolizer",d,b);return b},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(a){return this.createElementNSPlus("sld:MinScaleDenominator",{value:a})},MaxScaleDenominator:function(a){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:a})},LineSymbolizer:function(a){var b=this.createElementNSPlus("sld:LineSymbolizer");return this.writeNode("Stroke",a,b),b},Stroke:function(a){var b=this.createElementNSPlus("sld:Stroke");return void 0!=a.strokeColor&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeColor"},b),void 0!=a.strokeOpacity&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeOpacity"},b),void 0!=a.strokeWidth&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeWidth"},b),void 0!=a.strokeDashstyle&&"solid"!==a.strokeDashstyle&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeDashstyle"},b),void 0!=a.strokeLinecap&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeLinecap"},b),b},CssParameter:function(a){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(a.key)},value:a.symbolizer[a.key]})},TextSymbolizer:function(a){var b=this.createElementNSPlus("sld:TextSymbolizer");return null!=a.label&&this.writeNode("Label",a.label,b),null==a.fontFamily&&null==a.fontSize&&null==a.fontWeight&&null==a.fontStyle||this.writeNode("Font",a,b),null==a.labelAnchorPointX&&null==a.labelAnchorPointY&&null==a.labelAlign&&null==a.labelXOffset&&null==a.labelYOffset&&null==a.labelRotation&&null==a.labelPerpendicularOffset||this.writeNode("LabelPlacement",a,b),null==a.haloRadius&&null==a.haloColor&&null==a.haloOpacity||this.writeNode("Halo",a,b),null==a.fontColor&&null==a.fontOpacity||this.writeNode("Fill",{fillColor:a.fontColor,fillOpacity:a.fontOpacity},b),b},LabelPlacement:function(a){var b=this.createElementNSPlus("sld:LabelPlacement");return null==a.labelAnchorPointX&&null==a.labelAnchorPointY&&null==a.labelAlign&&null==a.labelXOffset&&null==a.labelYOffset&&null==a.labelRotation||null!=a.labelPerpendicularOffset||this.writeNode("PointPlacement",a,b),null!=a.labelPerpendicularOffset&&this.writeNode("LinePlacement",a,b),b},LinePlacement:function(a){var b=this.createElementNSPlus("sld:LinePlacement");return this.writeNode("PerpendicularOffset",a.labelPerpendicularOffset,b),b},PerpendicularOffset:function(a){return this.createElementNSPlus("sld:PerpendicularOffset",{value:a})},PointPlacement:function(a){var b=this.createElementNSPlus("sld:PointPlacement");return null==a.labelAnchorPointX&&null==a.labelAnchorPointY&&null==a.labelAlign||this.writeNode("AnchorPoint",a,b),null==a.labelXOffset&&null==a.labelYOffset||this.writeNode("Displacement",a,b),null!=a.labelRotation&&this.writeNode("Rotation",a.labelRotation,b),b},AnchorPoint:function(a){var b=this.createElementNSPlus("sld:AnchorPoint"),c=a.labelAnchorPointX,d=a.labelAnchorPointY;if(null!=c&&this.writeNode("AnchorPointX",c,b),null!=d&&this.writeNode("AnchorPointY",d,b),null==c&&null==d){var e=a.labelAlign.substr(0,1),f=a.labelAlign.substr(1,1);"l"===e?c=0:"c"===e?c=.5:"r"===e&&(c=1),"b"===f?d=0:"m"===f?d=.5:"t"===f&&(d=1),this.writeNode("AnchorPointX",c,b),this.writeNode("AnchorPointY",d,b)}return b},AnchorPointX:function(a){return this.createElementNSPlus("sld:AnchorPointX",{value:a})},AnchorPointY:function(a){return this.createElementNSPlus("sld:AnchorPointY",{value:a})},Displacement:function(a){var b=this.createElementNSPlus("sld:Displacement");return null!=a.labelXOffset&&this.writeNode("DisplacementX",a.labelXOffset,b),null!=a.labelYOffset&&this.writeNode("DisplacementY",a.labelYOffset,b),b},DisplacementX:function(a){return this.createElementNSPlus("sld:DisplacementX",{value:a})},DisplacementY:function(a){return this.createElementNSPlus("sld:DisplacementY",{value:a})},Font:function(a){var b=this.createElementNSPlus("sld:Font");return a.fontFamily&&this.writeNode("CssParameter",{symbolizer:a,key:"fontFamily"},b),a.fontSize&&this.writeNode("CssParameter",{symbolizer:a,key:"fontSize"},b),a.fontWeight&&this.writeNode("CssParameter",{symbolizer:a,key:"fontWeight"},b),a.fontStyle&&this.writeNode("CssParameter",{symbolizer:a,key:"fontStyle"},b),b},Label:function(a){return this.writers.sld._OGCExpression.call(this,"sld:Label",a)},Halo:function(a){var b=this.createElementNSPlus("sld:Halo");return a.haloRadius&&this.writeNode("Radius",a.haloRadius,b),(a.haloColor||a.haloOpacity)&&this.writeNode("Fill",{fillColor:a.haloColor,fillOpacity:a.haloOpacity},b),b},Radius:function(a){return this.createElementNSPlus("sld:Radius",{value:a})},RasterSymbolizer:function(a){var b=this.createElementNSPlus("sld:RasterSymbolizer");return a.geometry&&this.writeNode("Geometry",a.geometry,b),a.opacity&&this.writeNode("Opacity",a.opacity,b),a.colorMap&&this.writeNode("ColorMap",a.colorMap,b),b},Geometry:function(a){var b=this.createElementNSPlus("sld:Geometry");return a.property&&this.writeNode("ogc:PropertyName",a,b),b},ColorMap:function(a){for(var b=this.createElementNSPlus("sld:ColorMap"),c=0,d=a.length;c<d;++c)this.writeNode("ColorMapEntry",a[c],b);return b},ColorMapEntry:function(a){var b=this.createElementNSPlus("sld:ColorMapEntry"),c=a;return b.setAttribute("color",c.color),void 0!==c.opacity&&b.setAttribute("opacity",parseFloat(c.opacity)),void 0!==c.quantity&&b.setAttribute("quantity",parseFloat(c.quantity)),void 0!==c.label&&b.setAttribute("label",c.label),b},PolygonSymbolizer:function(a){var b=this.createElementNSPlus("sld:PolygonSymbolizer");return a.fill!==!1&&this.writeNode("Fill",a,b),a.stroke!==!1&&this.writeNode("Stroke",a,b),b},Fill:function(a){var b=this.createElementNSPlus("sld:Fill");return a.fillColor&&this.writeNode("CssParameter",{symbolizer:a,key:"fillColor"},b),null!=a.fillOpacity&&this.writeNode("CssParameter",{symbolizer:a,key:"fillOpacity"},b),b},PointSymbolizer:function(a){var b=this.createElementNSPlus("sld:PointSymbolizer");return this.writeNode("Graphic",a,b),b},Graphic:function(a){var b=this.createElementNSPlus("sld:Graphic");return void 0!=a.externalGraphic?this.writeNode("ExternalGraphic",a,b):this.writeNode("Mark",a,b),void 0!=a.graphicOpacity&&this.writeNode("Opacity",a.graphicOpacity,b),void 0!=a.pointRadius?this.writeNode("Size",2*a.pointRadius,b):void 0!=a.graphicWidth&&this.writeNode("Size",a.graphicWidth,b),void 0!=a.rotation&&this.writeNode("Rotation",a.rotation,b),b},ExternalGraphic:function(a){var b=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",a.externalGraphic,b);var c=a.graphicFormat||this.getGraphicFormat(a.externalGraphic);return this.writeNode("Format",c,b),b},Mark:function(a){var b=this.createElementNSPlus("sld:Mark");return a.graphicName&&this.writeNode("WellKnownName",a.graphicName,b),a.fill!==!1&&this.writeNode("Fill",a,b),a.stroke!==!1&&this.writeNode("Stroke",a,b),b},WellKnownName:function(a){return this.createElementNSPlus("sld:WellKnownName",{value:a})},Opacity:function(a){return this.createElementNSPlus("sld:Opacity",{value:a})},Size:function(a){return this.writers.sld._OGCExpression.call(this,"sld:Size",a)},Rotation:function(a){return this.createElementNSPlus("sld:Rotation",{value:a})},OnlineResource:function(a){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":a}})},Format:function(a){return this.createElementNSPlus("sld:Format",{value:a})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"}),OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"}),OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(a){a=a||{},OpenLayers.Util.extend(this,a),this.options=a},mergeWithDefaultFilter:function(a){var b;return b=a&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,a]}):a||this.defaultFilter||void 0},destroy:function(){this.options=null,this.format=null},read:function(a){a=a||{},a.filter=this.mergeWithDefaultFilter(a.filter)},create:function(){},update:function(){},delete:function(){},commit:function(){},abort:function(a){},createCallback:function(a,b,c){return OpenLayers.Function.bind(function(){a.apply(this,[b,c])},this)},CLASS_NAME:"OpenLayers.Protocol"}),OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(a){OpenLayers.Util.extend(this,a)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"}),OpenLayers.Protocol.Response.SUCCESS=1,OpenLayers.Protocol.Response.FAILURE=0,OpenLayers.ProxyHost="",OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(a,b){var c=0!==a.indexOf("http"),d=!c&&a.match(this.URL_SPLIT_REGEX);if(d){var e=window.location;c=d[1]==e.protocol&&d[3]==e.hostname;var f=d[4],g=e.port;(80!=f&&""!=f||"80"!=g&&""!=g)&&(c=c&&f==g)}return c||b&&(a="function"==typeof b?b(a):b+encodeURIComponent(a)),a},issue:function(a){var b=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});a=a||{},a.headers=a.headers||{},a=OpenLayers.Util.applyDefaults(a,b),a.headers=OpenLayers.Util.applyDefaults(a.headers,b.headers);var d,c=!1;for(d in a.headers)a.headers.hasOwnProperty(d)&&"x-requested-with"===d.toLowerCase()&&(c=!0);c===!1&&(a.headers["X-Requested-With"]="XMLHttpRequest");var e=new OpenLayers.Request.XMLHttpRequest,f=OpenLayers.Util.urlAppend(a.url,OpenLayers.Util.getParameterString(a.params||{}));f=OpenLayers.Request.makeSameOrigin(f,a.proxy),e.open(a.method,f,a.async,a.user,a.password);for(var g in a.headers)e.setRequestHeader(g,a.headers[g]);var h=this.events,i=this;return e.onreadystatechange=function(){if(e.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var b=h.triggerEvent("complete",{request:e,config:a,requestUrl:f});b!==!1&&i.runCallbacks({request:e,config:a,requestUrl:f})}},a.async===!1?e.send(a.data):window.setTimeout(function(){0!==e.readyState&&e.send(a.data)},0),e},runCallbacks:function(a){var e,b=a.request,c=a.config,d=c.scope?OpenLayers.Function.bind(c.callback,c.scope):c.callback;c.success&&(e=c.scope?OpenLayers.Function.bind(c.success,c.scope):c.success);var f;c.failure&&(f=c.scope?OpenLayers.Function.bind(c.failure,c.scope):c.failure),"file:"==OpenLayers.Util.createUrlObject(c.url).protocol&&b.responseText&&(b.status=200),d(b),(!b.status||b.status>=200&&b.status<300)&&(this.events.triggerEvent("success",a),e&&e(b)),b.status&&(b.status<200||b.status>=300)&&(this.events.triggerEvent("failure",a),f&&f(b))},GET:function(a){return a=OpenLayers.Util.extend(a,{method:"GET"}),OpenLayers.Request.issue(a)},POST:function(a){return a=OpenLayers.Util.extend(a,{method:"POST"}),a.headers=a.headers?a.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(a.headers)||(a.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(a)},PUT:function(a){return a=OpenLayers.Util.extend(a,{method:"PUT"}),a.headers=a.headers?a.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(a.headers)||(a.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(a)},DELETE:function(a){return a=OpenLayers.Util.extend(a,{method:"DELETE"}),OpenLayers.Request.issue(a)},HEAD:function(a){return a=OpenLayers.Util.extend(a,{method:"HEAD"}),OpenLayers.Request.issue(a)},OPTIONS:function(a){return a=OpenLayers.Util.extend(a,{method:"OPTIONS"}),OpenLayers.Request.issue(a)}}),function(){function e(){this._object=a&&!d?new a:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function f(){return new e}function g(a){if(a._object.send(a._data),b&&!a._async)for(a.readyState=f.OPENED,j(a);a.readyState<f.DONE;)if(a.readyState++,h(a),a._aborted)return}function h(a){f.onreadystatechange&&f.onreadystatechange.apply(a),a.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function i(a){var b=a.responseXML,d=a.responseText;return c&&d&&b&&!b.documentElement&&a.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(b=new window.ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.validateOnParse=!1,b.loadXML(d)),b&&(c&&0!=b.parseError||!b.documentElement||b.documentElement&&"parsererror"==b.documentElement.tagName)?null:b}function j(a){try{a.responseText=a._object.responseText}catch(a){}try{a.responseXML=i(a._object)}catch(a){}try{a.status=a._object.status}catch(a){}try{a.statusText=a._object.statusText}catch(a){}}function k(a){a._object.onreadystatechange=new window.Function}var a=window.XMLHttpRequest,b=!!window.controllers,c=window.document.all&&!window.opera,d=c&&window.navigator.userAgent.match(/MSIE 7.0/);f.prototype=e.prototype,b&&a.wrapped&&(f.wrapped=a.wrapped),f.UNSENT=0,f.OPENED=1,f.HEADERS_RECEIVED=2,f.LOADING=3,f.DONE=4,f.prototype.readyState=f.UNSENT,f.prototype.responseText="",f.prototype.responseXML=null,f.prototype.status=0,f.prototype.statusText="",f.prototype.priority="NORMAL",f.prototype.onreadystatechange=null,f.onreadystatechange=null,f.onopen=null,f.onsend=null,f.onabort=null,f.prototype.open=function(a,d,e,g,i){delete this._headers,arguments.length<3&&(e=!0),this._async=e;var n,l=this,m=this.readyState;c&&e&&(n=function(){m!=f.DONE&&(k(l),l.abort())},window.attachEvent("onunload",n)),f.onopen&&f.onopen.apply(this,arguments),arguments.length>4?this._object.open(a,d,e,g,i):arguments.length>3?this._object.open(a,d,e,g):this._object.open(a,d,e),this.readyState=f.OPENED,h(this),this._object.onreadystatechange=function(){if(!b||e){if(l.readyState=l._object.readyState,j(l),l._aborted)return void(l.readyState=f.UNSENT);l.readyState==f.DONE&&(delete l._data,k(l),c&&e&&window.detachEvent("onunload",n)),m!=l.readyState&&h(l),m=l.readyState}}},f.prototype.send=function(a){f.onsend&&f.onsend.apply(this,arguments),arguments.length||(a=null),a&&a.nodeType&&(a=window.XMLSerializer?(new window.XMLSerializer).serializeToString(a):a.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=a,g(this)},f.prototype.abort=function(){f.onabort&&f.onabort.apply(this,arguments),this.readyState>f.UNSENT&&(this._aborted=!0),this._object.abort(),k(this),this.readyState=f.UNSENT,delete this._data},f.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},f.prototype.getResponseHeader=function(a){return this._object.getResponseHeader(a)},f.prototype.setRequestHeader=function(a,b){return this._headers||(this._headers={}),this._headers[a]=b,this._object.setRequestHeader(a,b)},f.prototype.addEventListener=function(a,b,c){for(var e,d=0;e=this._listeners[d];d++)if(e[0]==a&&e[1]==b&&e[2]==c)return;this._listeners.push([a,b,c])},f.prototype.removeEventListener=function(a,b,c){for(var e,d=0;(e=this._listeners[d])&&(e[0]!=a||e[1]!=b||e[2]!=c);d++);e&&this._listeners.splice(d,1)},f.prototype.dispatchEvent=function(a){var b={type:a.type,target:this,currentTarget:this,eventPhase:2,bubbles:a.bubbles,cancelable:a.cancelable,timeStamp:a.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==b.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[b]);for(var d,c=0;d=this._listeners[c];c++)d[0]!=b.type||d[2]||(d[1].handleEvent||d[1]).apply(this,[b])},f.prototype.toString=function(){return"[object XMLHttpRequest]"},f.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(a,b){b||(b=[]),a.__func=this,a.__func(b[0],b[1],b[2],b[3],b[4]),delete a.__func}),OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Request.XMLHttpRequest=f}(),OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(a){if(a=a||{},this.params={},this.headers={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var b=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(a,c){return b.write(a,c)}}},destroy:function(){this.params=null,this.headers=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments),a=a||{},a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params),a=OpenLayers.Util.applyDefaults(a,this.options),a.filter&&this.filterToParams&&(a.params=this.filterToParams(a.filter,a.params));var b=void 0!==a.readWithPOST?a.readWithPOST:this.readWithPOST,c=new OpenLayers.Protocol.Response({requestType:"read"});if(b){var d=a.headers||{};d["Content-Type"]="application/x-www-form-urlencoded",c.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,c,a),data:OpenLayers.Util.getParameterString(a.params),headers:d})}else c.priv=OpenLayers.Request.GET({url:a.url,callback:this.createCallback(this.handleRead,c,a),params:a.params,headers:a.headers});return c},handleRead:function(a,b){this.handleResponse(a,b)},create:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"create"});return c.priv=OpenLayers.Request.POST({url:b.url,callback:this.createCallback(this.handleCreate,c,b),headers:b.headers,data:this.format.write(a)}),c},handleCreate:function(a,b){this.handleResponse(a,b)},update:function(a,b){b=b||{};var c=b.url||a.url||this.options.url+"/"+a.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"update"}),e=this.updateWithPOST?"POST":"PUT";return d.priv=OpenLayers.Request[e]({url:c,callback:this.createCallback(this.handleUpdate,d,b),headers:b.headers,data:this.format.write(a)}),d},handleUpdate:function(a,b){this.handleResponse(a,b)},delete:function(a,b){b=b||{};var c=b.url||a.url||this.options.url+"/"+a.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"delete"}),e=this.deleteWithPOST?"POST":"DELETE",f={url:c,callback:this.createCallback(this.handleDelete,d,b),headers:b.headers};return this.deleteWithPOST&&(f.data=this.format.write(a)),d.priv=OpenLayers.Request[e](f),d},handleDelete:function(a,b){this.handleResponse(a,b)},handleResponse:function(a,b){var c=a.priv;b.callback&&(c.status>=200&&c.status<300?("delete"!=a.requestType&&(a.features=this.parseFeatures(c)),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,b.callback.call(b.scope,a))},parseFeatures:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),!b||b.length<=0?null:this.format.read(b)},commit:function(a,b){function n(a){for(var b=a.features?a.features.length:0,c=new Array(b),d=0;d<b;++d)c[d]=a.features[d].fid;m.insertIds=c,o.apply(this,[a])}function o(a){this.callUserCallback(a,b),l=l&&a.success(),d++,d>=k&&b.callback&&(m.code=l?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,b.callback.apply(b.scope,[m]))}b=OpenLayers.Util.applyDefaults(b,this.options);var c=[],d=0,e={};e[OpenLayers.State.INSERT]=[],e[OpenLayers.State.UPDATE]=[],e[OpenLayers.State.DELETE]=[];for(var f,g,h=[],i=0,j=a.length;i<j;++i)f=a[i],g=e[f.state],g&&(g.push(f),h.push(f));var k=(e[OpenLayers.State.INSERT].length>0?1:0)+e[OpenLayers.State.UPDATE].length+e[OpenLayers.State.DELETE].length,l=!0,m=new OpenLayers.Protocol.Response({reqFeatures:h}),p=e[OpenLayers.State.INSERT];p.length>0&&c.push(this.create(p,OpenLayers.Util.applyDefaults({callback:n,scope:this},b.create))),p=e[OpenLayers.State.UPDATE];for(var i=p.length-1;i>=0;--i)c.push(this.update(p[i],OpenLayers.Util.applyDefaults({callback:o,scope:this},b.update)));p=e[OpenLayers.State.DELETE];for(var i=p.length-1;i>=0;--i)c.push(this.delete(p[i],OpenLayers.Util.applyDefaults({callback:o,scope:this},b.delete)));
return c},abort:function(a){a&&a.priv.abort()},callUserCallback:function(a,b){var c=b[a.requestType];c&&c.callback&&c.callback.call(c.scope,a)},CLASS_NAME:"OpenLayers.Protocol.HTTP"}),OpenLayers.Protocol.WFS=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.WFS.DEFAULTS);var b=OpenLayers.Protocol.WFS["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported WFS version: "+a.version;return new b(a)},OpenLayers.Protocol.WFS.fromWMSLayer=function(a,b){var c,d,e=a.params.LAYERS,f=(OpenLayers.Util.isArray(e)?e[0]:e).split(":");f.length>1&&(d=f[0]),c=f.pop();var g={url:a.url,featureType:c,featurePrefix:d,srsName:a.projection&&a.projection.getCode()||a.map&&a.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(b,g))},OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"},OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]),a.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))),!a.geometryName&&parseFloat(this.format.version)>1&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments),a=OpenLayers.Util.extend({},a),OpenLayers.Util.applyDefaults(a,this.options||{});var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",a)]);return b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers,data:c}),b},setFeatureType:function(a){this.featureType=a,this.format.featureType=a},setGeometryName:function(a){this.geometryName=a,this.format.geometryName=a},handleRead:function(a,b){if(b=OpenLayers.Util.extend({},b),OpenLayers.Util.applyDefaults(b,this.options),b.callback){var c=a.priv;if(c.status>=200&&c.status<300){var d=this.parseResponse(c,b.readOptions);d&&d.success!==!1?(b.readOptions&&"object"==b.readOptions.output?OpenLayers.Util.extend(a,d):a.features=d,a.code=OpenLayers.Protocol.Response.SUCCESS):(a.code=OpenLayers.Protocol.Response.FAILURE,a.error=d)}else a.code=OpenLayers.Protocol.Response.FAILURE;b.callback.call(b.scope,a)}},parseResponse:function(a,b){var c=a.responseXML;if(c&&c.documentElement||(c=a.responseText),!c||c.length<=0)return null;var d=null!==this.readFormat?this.readFormat.read(c):this.format.read(c,b);if(!this.featureNS){var e=this.readFormat||this.format;this.featureNS=e.featureNS,e.autoConfig=!1,this.geometryName||this.setGeometryName(e.geometryName)}return d},commit:function(a,b){b=OpenLayers.Util.extend({},b),OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:a});return c.priv=OpenLayers.Request.POST({url:b.url,headers:b.headers,data:this.format.write(a,b),callback:this.createCallback(this.handleCommit,c,b)}),c},handleCommit:function(a,b){if(b.callback){var c=a.priv,d=c.responseXML;d&&d.documentElement||(d=c.responseText);var e=this.format.read(d)||{};a.insertIds=e.insertIds||[],e.success?a.code=OpenLayers.Protocol.Response.SUCCESS:(a.code=OpenLayers.Protocol.Response.FAILURE,a.error=e),b.callback.call(b.scope,a)}},filterDelete:function(a,b){b=OpenLayers.Util.extend({},b),OpenLayers.Util.applyDefaults(b,this.options);var d=(new OpenLayers.Protocol.Response({requestType:"commit"}),this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}})),e=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(b.featureNS?this.featurePrefix+":":"")+b.featureType}});b.featureNS&&e.setAttribute("xmlns:"+this.featurePrefix,b.featureNS);var f=this.format.writeNode("ogc:Filter",a);e.appendChild(f),d.appendChild(e);var g=OpenLayers.Format.XML.prototype.write.apply(this.format,[d]);return OpenLayers.Request.POST({url:this.url,callback:b.callback||function(){},data:g})},abort:function(a){a&&a.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"}),OpenLayers.Format.WFST=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.WFST.DEFAULTS);var b=OpenLayers.Format.WFST["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported WFST version: "+a.version;return new b(a)},OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"},OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xmlns:"http://www.w3.org/2000/xmlns/"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(a){this.stateName={},this.stateName[OpenLayers.State.INSERT]="wfs:Insert",this.stateName[OpenLayers.State.UPDATE]="wfs:Update",this.stateName[OpenLayers.State.DELETE]="wfs:Delete",OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},getSrsName:function(a,b){var c=b&&b.srsName;return c||(c=a&&a.layer?a.layer.projection.getCode():this.srsName),c},read:function(a,b){b=b||{},OpenLayers.Util.applyDefaults(b,{output:"features"}),"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var c={};return a&&this.readNode(a,c,!0),c.features&&"features"===b.output&&(c=c.features),c},readers:{wfs:{FeatureCollection:function(a,b){b.features=[],this.readChildNodes(a,b)}}},write:function(a,b){var c=this.writeNode("wfs:Transaction",{features:a,options:b}),d=this.schemaLocationAttr();return d&&this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",d),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{wfs:{GetFeature:function(a){var b=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:a&&a.handle,outputFormat:a&&a.outputFormat,maxFeatures:a&&a.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(a)}});if("string"==typeof this.featureType)this.writeNode("Query",a,b);else for(var c=0,d=this.featureType.length;c<d;c++)a.featureType=this.featureType[c],this.writeNode("Query",a,b);return b},Transaction:function(a){a=a||{};var d,e,b=a.options||{},c=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:b.handle}}),f=a.features;if(f){b.multi===!0&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":this.multiCurve===!0?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":this.multiSurface===!0?"MultiSurface":"MultiPolygon"});var g,h;for(d=0,e=f.length;d<e;++d)h=f[d],g=this.stateName[h.state],g&&this.writeNode(g,{feature:h,options:b},c);b.multi===!0&&this.setGeometryTypes()}if(b.nativeElements)for(d=0,e=b.nativeElements.length;d<e;++d)this.writeNode("wfs:Native",b.nativeElements[d],c);return c},Native:function(a){var b=this.createElementNSPlus("wfs:Native",{attributes:{vendorId:a.vendorId,safeToIgnore:a.safeToIgnore},value:a.value});return b},Insert:function(a){var b=a.feature,c=a.options,d=this.createElementNSPlus("wfs:Insert",{attributes:{handle:c&&c.handle}});return this.srsName=this.getSrsName(b),this.writeNode("feature:_typeName",b,d),d},Update:function(a){var b=a.feature,c=a.options,d=this.createElementNSPlus("wfs:Update",{attributes:{handle:c&&c.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&this.setAttributeNS(d,this.namespaces.xmlns,"xmlns:"+this.featurePrefix,this.featureNS);var e=b.modified;null===this.geometryName||e&&void 0===e.geometry||(this.srsName=this.getSrsName(b),this.writeNode("Property",{name:this.geometryName,value:b.geometry},d));for(var f in b.attributes)void 0===b.attributes[f]||e&&e.attributes&&(!e.attributes||void 0===e.attributes[f])||this.writeNode("Property",{name:f,value:b.attributes[f]},d);return this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[b.fid]}),d),d},Property:function(a){var b=this.createElementNSPlus("wfs:Property");return this.writeNode("Name",a.name,b),null!==a.value&&this.writeNode("Value",a.value,b),b},Name:function(a){return this.createElementNSPlus("wfs:Name",{value:a})},Value:function(a){var b;if(a instanceof OpenLayers.Geometry){b=this.createElementNSPlus("wfs:Value");var c=this.writeNode("feature:_geometry",a).firstChild;b.appendChild(c)}else b=this.createElementNSPlus("wfs:Value",{value:a});return b},Delete:function(a){var b=a.feature,c=a.options,d=this.createElementNSPlus("wfs:Delete",{attributes:{handle:c&&c.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});return this.featureNS&&this.setAttributeNS(d,this.namespaces.xmlns,"xmlns:"+this.featurePrefix,this.featureNS),this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[b.fid]}),d),d}}},schemaLocationAttr:function(a){a=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},a);var b=OpenLayers.Util.extend({},this.schemaLocations);a.schema&&(b[a.featurePrefix]=a.schema);var d,c=[];for(var e in b)d=this.namespaces[e],d&&c.push(d+" "+b[e]);var f=c.join(" ")||void 0;return f},setFilterProperty:function(a){if(a.filters)for(var b=0,c=a.filters.length;b<c;++b)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,a.filters[b]);else a instanceof OpenLayers.Filter.Spatial&&!a.property&&(a.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"}),OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a,b){var c=a.getAttribute("matchCase"),d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===c||"0"===c)});this.readChildNodes(a,d),b.filters.push(d)},PropertyIsNotEqualTo:function(a,b){var c=a.getAttribute("matchCase"),d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===c||"0"===c)});this.readChildNodes(a,d),b.filters.push(d)},PropertyIsLike:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(a,c);var d=a.getAttribute("wildCard"),e=a.getAttribute("singleChar"),f=a.getAttribute("escapeChar");c.value2regex(d,e,f),b.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:a.matchCase}});return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:a.matchCase}});return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:a.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});return this.writeNode("PropertyName",a,b),this.writeNode("Literal",a.regex2value(),b),b},BBOX:function(a){var b=this.createElementNSPlus("ogc:BBOX");a.property&&this.writeNode("PropertyName",a,b);var c=this.writeNode("gml:Envelope",a.value);return a.projection&&c.setAttribute("srsName",a.projection),b.appendChild(c),b},SortBy:function(a){for(var b=this.createElementNSPlus("ogc:SortBy"),c=0,d=a.length;c<d;c++)this.writeNode("ogc:SortProperty",a[c],b);return b},SortProperty:function(a){var b=this.createElementNSPlus("ogc:SortProperty");return this.writeNode("ogc:PropertyName",a,b),this.writeNode("ogc:SortOrder","DESC"==a.order?"DESC":"ASC",b),b},SortOrder:function(a){var b=this.createElementNSPlus("ogc:SortOrder",{value:a});return b}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(a,b){var c=this.createElementNSPlus("ogc:"+b);if(this.writeNode("PropertyName",a,c),a.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",a.value,c);else{var d;d=a.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",a.value).firstChild:this.writeNode("gml:Envelope",a.value),a.projection&&d.setAttribute("srsName",a.projection),c.appendChild(d)}return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"}),OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(a,b){var c=this.version;if(!c){var d=a.getAttribute("xmlns:ows");d&&"1.1"===d.substring(d.lastIndexOf("/")+1)&&(c="1.1.0"),c||(c=this.defaultVersion)}return c},CLASS_NAME:"OpenLayers.Format.OWSCommon"}),OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c={};return this.readChildNodes(a,c),c},readers:{ows:{Exception:function(a,b){var c={code:a.getAttribute("exceptionCode"),locator:a.getAttribute("locator"),texts:[]};b.exceptions.push(c),this.readChildNodes(a,c)},ExceptionText:function(a,b){var c=this.getChildValue(a);b.texts.push(c)},ServiceIdentification:function(a,b){b.serviceIdentification={},this.readChildNodes(a,b.serviceIdentification)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.abstract=this.getChildValue(a)},Keywords:function(a,b){b.keywords={},this.readChildNodes(a,b.keywords)},Keyword:function(a,b){b[this.getChildValue(a)]=!0},ServiceType:function(a,b){b.serviceType={codeSpace:a.getAttribute("codeSpace"),value:this.getChildValue(a)}},ServiceTypeVersion:function(a,b){b.serviceTypeVersion=this.getChildValue(a)},Fees:function(a,b){b.fees=this.getChildValue(a)},AccessConstraints:function(a,b){b.accessConstraints=this.getChildValue(a)},ServiceProvider:function(a,b){b.serviceProvider={},this.readChildNodes(a,b.serviceProvider)},ProviderName:function(a,b){b.providerName=this.getChildValue(a)},ProviderSite:function(a,b){b.providerSite=this.getAttributeNS(a,this.namespaces.xlink,"href")},ServiceContact:function(a,b){b.serviceContact={},this.readChildNodes(a,b.serviceContact)},IndividualName:function(a,b){b.individualName=this.getChildValue(a)},PositionName:function(a,b){b.positionName=this.getChildValue(a)},ContactInfo:function(a,b){b.contactInfo={},this.readChildNodes(a,b.contactInfo)},Phone:function(a,b){b.phone={},this.readChildNodes(a,b.phone)},Voice:function(a,b){b.voice=this.getChildValue(a)},Address:function(a,b){b.address={},this.readChildNodes(a,b.address)},DeliveryPoint:function(a,b){b.deliveryPoint=this.getChildValue(a)},City:function(a,b){b.city=this.getChildValue(a)},AdministrativeArea:function(a,b){b.administrativeArea=this.getChildValue(a)},PostalCode:function(a,b){b.postalCode=this.getChildValue(a)},Country:function(a,b){b.country=this.getChildValue(a)},ElectronicMailAddress:function(a,b){b.electronicMailAddress=this.getChildValue(a)},Role:function(a,b){b.role=this.getChildValue(a)},OperationsMetadata:function(a,b){b.operationsMetadata={},this.readChildNodes(a,b.operationsMetadata)},Operation:function(a,b){var c=a.getAttribute("name");b[c]={},this.readChildNodes(a,b[c])},DCP:function(a,b){b.dcp={},this.readChildNodes(a,b.dcp)},HTTP:function(a,b){b.http={},this.readChildNodes(a,b.http)},Get:function(a,b){b.get||(b.get=[]);var c={url:this.getAttributeNS(a,this.namespaces.xlink,"href")};this.readChildNodes(a,c),b.get.push(c)},Post:function(a,b){b.post||(b.post=[]);var c={url:this.getAttributeNS(a,this.namespaces.xlink,"href")};this.readChildNodes(a,c),b.post.push(c)},Parameter:function(a,b){b.parameters||(b.parameters={});var c=a.getAttribute("name");b.parameters[c]={},this.readChildNodes(a,b.parameters[c])},Constraint:function(a,b){b.constraints||(b.constraints={});var c=a.getAttribute("name");b.constraints[c]={},this.readChildNodes(a,b.constraints[c])},Value:function(a,b){b[this.getChildValue(a)]=!0},OutputFormat:function(a,b){b.formats.push({value:this.getChildValue(a)}),this.readChildNodes(a,b)},WGS84BoundingBox:function(a,b){var c={};c.crs=a.getAttribute("crs"),b.BoundingBox?b.BoundingBox.push(c):(b.projection=c.crs,c=b),this.readChildNodes(a,c)},BoundingBox:function(a,b){this.readers.ows.WGS84BoundingBox.apply(this,[a,b])},LowerCorner:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"");c=c.replace(this.regExes.trimComma,",");var d=c.split(this.regExes.splitSpace);b.left=d[0],b.bottom=d[1]},UpperCorner:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"");c=c.replace(this.regExes.trimComma,",");var d=c.split(this.regExes.splitSpace);b.right=d[0],b.top=d[1],b.bounds=new OpenLayers.Bounds(b.left,b.bottom,b.right,b.top),delete b.left,delete b.bottom,delete b.right,delete b.top},Language:function(a,b){b.language=this.getChildValue(a)}}},writers:{ows:{BoundingBox:function(a,b){var c=this.createElementNSPlus(b||"ows:BoundingBox",{attributes:{crs:a.projection}});return this.writeNode("ows:LowerCorner",a,c),this.writeNode("ows:UpperCorner",a,c),c},LowerCorner:function(a){var b=this.createElementNSPlus("ows:LowerCorner",{value:a.bounds.left+" "+a.bounds.bottom});return b},UpperCorner:function(a){var b=this.createElementNSPlus("ows:UpperCorner",{value:a.bounds.right+" "+a.bounds.top});return b},Identifier:function(a){var b=this.createElementNSPlus("ows:Identifier",{value:a});return b},Title:function(a){var b=this.createElementNSPlus("ows:Title",{value:a});return b},Abstract:function(a){var b=this.createElementNSPlus("ows:Abstract",{value:a});return b},OutputFormat:function(a){var b=this.createElementNSPlus("ows:OutputFormat",{value:a});return b}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"}),OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(a,b){b.success=!1,b.exceptionReport={version:a.getAttribute("version"),language:a.getAttribute("language"),exceptions:[]},this.readChildNodes(a,b.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"}),OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[a]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readNode:function(a,b,c){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(a,b){b.numberOfFeatures=parseInt(a.getAttribute("numberOfFeatures")),OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(a,b){b.insertIds=[],b.success=!1,this.readChildNodes(a,b)},TransactionSummary:function(a,b){b.success=!0},InsertResults:function(a,b){this.readChildNodes(a,b)},Feature:function(a,b){var c={fids:[]};this.readChildNodes(a,c),b.insertIds.push(c.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(a){var b=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);return a&&this.setAttributes(b,{resultType:a.resultType,startIndex:a.startIndex,count:a.count}),b},Query:function(a){a=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},a);var b=a.featurePrefix,c=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(b?b+":":"")+a.featureType,srsName:a.srsName}});if(a.featureNS&&this.setAttributeNS(c,this.namespaces.xmlns,"xmlns:"+b,a.featureNS),a.propertyNames)for(var d=0,e=a.propertyNames.length;d<e;d++)this.writeNode("wfs:PropertyName",{property:a.propertyNames[d]},c);return a.filter&&(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,a.filter),this.writeNode("ogc:Filter",a.filter,c)),c},PropertyName:function(a){return this.createElementNSPlus("wfs:PropertyName",{value:a.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"}),OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(a){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments),this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"});Ext.namespace("GeoExt.data");GeoExt.data.LayerRecord=Ext.data.Record.create([{name:"layer"},{name:"title",type:"string",mapping:"name"}]),GeoExt.data.LayerRecord.prototype.getLayer=function(){return this.get("layer")},GeoExt.data.LayerRecord.prototype.setLayer=function(a){a!==this.data.layer&&(this.dirty=!0,this.modified||(this.modified={}),void 0===this.modified.layer&&(this.modified.layer=this.data.layer),this.data.layer=a,this.editing||this.afterEdit())},GeoExt.data.LayerRecord.prototype.clone=function(a){var b=this.getLayer()&&this.getLayer().clone();return new this.constructor(Ext.applyIf({layer:b},this.data),a||b.id)},GeoExt.data.LayerRecord.create=function(a){var b=Ext.extend(GeoExt.data.LayerRecord,{}),c=b.prototype;if(c.fields=new Ext.util.MixedCollection(!1,function(a){return a.name}),GeoExt.data.LayerRecord.prototype.fields.each(function(a){c.fields.add(a)}),a)for(var d=0,e=a.length;d<e;d++)c.fields.add(new Ext.data.Field(a[d]));return b.getField=function(a){return c.fields.get(a)},b},Ext.namespace("GeoExt.data"),GeoExt.data.AttributeStoreMixin=function(){return{constructor:function(a){a=a||{},arguments.callee.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(a.data?void 0:new Ext.data.HttpProxy({url:a.url,disableCaching:!1,method:"GET"})),reader:new GeoExt.data.AttributeReader(a,a.fields||["name","type","restriction",{name:"nillable",type:"boolean"},"annotation"])})),this.feature&&this.bind()},bind:function(){this.on({update:this.onUpdate,load:this.onLoad,add:this.onAdd,scope:this});var a=[];this.each(function(b){a.push(b)}),this.updateFeature(a)},onUpdate:function(a,b,c){this.updateFeature([b])},onLoad:function(a,b,c){c&&c.add===!0||this.updateFeature(b)},onAdd:function(a,b,c){this.updateFeature(b)},updateFeature:function(a){var d,e,f,g,h,i,j,b=this.feature,c=b.layer;for(d=0,e=a.length;d<e;d++)f=a[d],g=f.get("name"),h=f.get("value"),i=b.attributes[g],i!==h&&(j=!0);if(j&&c&&c.events&&c.events.triggerEvent("beforefeaturemodified",{feature:b})!==!1){for(d=0,e=a.length;d<e;d++)f=a[d],g=f.get("name"),h=f.get("value"),b.attributes[g]=h;c.events.triggerEvent("featuremodified",{feature:b}),c.drawFeature(b)}}}},GeoExt.data.AttributeStore=Ext.extend(Ext.data.Store,GeoExt.data.AttributeStoreMixin()),Ext.namespace("GeoExt.data"),GeoExt.data.AttributeReader=function(a,b){a=a||{},a.format||(a.format=new OpenLayers.Format.WFSDescribeFeatureType),GeoExt.data.AttributeReader.superclass.constructor.call(this,a,b||a.fields),a.feature&&this.recordType.prototype.fields.add(new Ext.data.Field("value"))},Ext.extend(GeoExt.data.AttributeReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),this.readRecords(b)},readRecords:function(a){var b;if(a instanceof Array)b=a;else{var c=this.meta.format.read(a);if(c.error)throw new Ext.data.DataReader.Error("invalid-response",c.error);b=c.featureTypes[0].properties}for(var h,i,j,l,m,n,d=this.meta.feature,e=this.recordType,f=e.prototype.fields,g=f.length,o=[],p=0,q=b.length;p<q;++p){l=!1,h=b[p],i={};for(var r=0;r<g;++r){if(n=f.items[r],j=n.name,m=n.convert(h[j]),this.ignoreAttribute(j,m)){l=!0;break}i[j]=m}d&&(m=d.attributes[i.name],void 0!==m&&(this.ignoreAttribute("value",m)?l=!0:i.value=m)),l||(o[o.length]=new e(i))}return{success:!0,records:o,totalRecords:o.length}},ignoreAttribute:function(a,b){var c=!1;if(this.meta.ignore&&this.meta.ignore[a]){var d=this.meta.ignore[a];"string"==typeof d?c=d===b:d instanceof Array?c=d.indexOf(b)>-1:d instanceof RegExp&&(c=d.test(b))}return c}}),Ext.namespace("GeoExt","GeoExt.data"),GeoExt.data.ProtocolProxy=function(a){Ext.apply(this,a),GeoExt.data.ProtocolProxy.superclass.constructor.apply(this,arguments)},Ext.extend(GeoExt.data.ProtocolProxy,Ext.data.DataProxy,{protocol:null,abortPrevious:!0,setParamsAsOptions:!1,response:null,load:function(a,b,c,d,e){if(this.fireEvent("beforeload",this,a)!==!1){var f={params:a||{},request:{callback:c,scope:d,arg:e},reader:b},g=OpenLayers.Function.bind(this.loadResponse,this,f);this.abortPrevious&&this.abortRequest();var h={params:a,callback:g,scope:this};Ext.applyIf(h,e),this.setParamsAsOptions===!0&&(Ext.applyIf(h,h.params),delete h.params),this.response=this.protocol.read(h)}else c.call(d||this,null,e,!1)},abortRequest:function(){this.response&&(this.protocol.abort(this.response),this.response=null)},loadResponse:function(a,b){if(b.success()){var c;try{c=a.reader.read(b)}catch(c){return this.fireEvent("loadexception",this,a,b,c),this.fireEvent("exception",this,"response",null,a,b,c),void a.request.callback.call(a.request.scope,null,a.request.arg,!1)}this.fireEvent("load",this,a,a.request.arg),a.request.callback.call(a.request.scope,c,a.request.arg,!0)}else this.fireEvent("loadexception",this,a,b),a.request.callback.call(a.request.scope,null,a.request.arg,!1)}}),Ext.namespace("GeoExt.data"),GeoExt.data.FeatureStoreMixin=function(){return{layer:null,reader:null,featureFilter:null,constructor:function(a){a=a||{},a.reader=a.reader||new GeoExt.data.FeatureReader({},a.fields);var b=a.layer;delete a.layer,a.features&&(a.data=a.features),delete a.features;var c={initDir:a.initDir};delete a.initDir,arguments.callee.superclass.constructor.call(this,a),b&&this.bind(b,c)},bind:function(a,b){if(!this.layer){this.layer=a,b=b||{};var c=b.initDir;void 0==b.initDir&&(c=GeoExt.data.FeatureStore.LAYER_TO_STORE|GeoExt.data.FeatureStore.STORE_TO_LAYER);var d=a.features.slice(0);if(c&GeoExt.data.FeatureStore.STORE_TO_LAYER)for(var e=this.getRange(),f=e.length-1;f>=0;f--)this.layer.addFeatures([e[f].getFeature()]);c&GeoExt.data.FeatureStore.LAYER_TO_STORE&&this.loadData(d,!0),a.events.on({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this}),this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this})}},unbind:function(){this.layer&&(this.layer.events.un({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this}),this.un("load",this.onLoad,this),this.un("clear",this.onClear,this),this.un("add",this.onAdd,this),this.un("remove",this.onRemove,this),this.un("update",this.onUpdate,this),this.layer=null)},getRecordFromFeature:function(a){return this.getByFeature(a)||null},getByFeature:function(a){var b;if(a.state!==OpenLayers.State.INSERT)b=this.getById(a.id);else{var c=this.findBy(function(b){return b.getFeature()===a});c>-1&&(b=this.getAt(c))}return b},onFeaturesAdded:function(a){if(!this._adding){var b=a.features,c=b;if(this.featureFilter){c=[];for(var d,e,f,d=0,e=b.length;d<e;d++)f=b[d],this.featureFilter.evaluate(f)!==!1&&c.push(f)}this._adding=!0,this.loadData(c,!0),delete this._adding}},onFeaturesRemoved:function(a){if(!this._removing){var c,d,e,b=a.features;for(e=b.length-1;e>=0;e--)c=b[e],d=this.getByFeature(c),void 0!==d&&(this._removing=!0,this.remove(d),delete this._removing)}},onFeatureModified:function(a){if(!this._updating){var b=a.feature,c=this.getByFeature(b);if(void 0!==c){c.beginEdit();var d=b.attributes;if(d)for(var e=this.recordType.prototype.fields,f=0,g=e.length;f<g;f++){var h=e.items[f],i=h.mapping||h.name;i in d&&c.set(h.name,h.convert(d[i]))}c.set("state",b.state),c.set("fid",b.fid),c.setFeature(b),this._updating=!0,c.endEdit(),delete this._updating}}},addFeaturesToLayer:function(a){var b,c,d;for(d=new Array(c=a.length),b=0;b<c;b++)d[b]=a[b].getFeature();d.length>0&&(this._adding=!0,this.layer.addFeatures(d),delete this._adding)},onLoad:function(a,b,c){c&&c.add===!0||(this._removing=!0,this.layer.removeFeatures(this.layer.features),delete this._removing,this.addFeaturesToLayer(b))},onClear:function(a){this._removing=!0,this.layer.removeFeatures(this.layer.features),delete this._removing},onAdd:function(a,b,c){this._adding||this.addFeaturesToLayer(b)},onRemove:function(a,b,c){if(!this._removing){var d=b.getFeature();null!=this.layer.getFeatureById(d.id)&&(this._removing=!0,this.layer.removeFeatures([b.getFeature()]),delete this._removing)}},onUpdate:function(a,b,c){if(!this._updating){var d=(new GeoExt.data.FeatureRecord).fields,e=b.getFeature();if(e.state!==OpenLayers.State.INSERT&&(e.state=OpenLayers.State.UPDATE),b.fields){var f=this.layer.events.triggerEvent("beforefeaturemodified",{feature:e});if(f!==!1){var g=e.attributes;b.fields.each(function(a){var c=a.mapping||a.name;d.containsKey(c)||(g[c]=b.get(a.name))}),this._updating=!0,this.layer.events.triggerEvent("featuremodified",{feature:e}),delete this._updating,null!=this.layer.getFeatureById(e.id)&&this.layer.drawFeature(e)}}}},destroy:function(){this.unbind(),GeoExt.data.FeatureStore.superclass.destroy.call(this)}}},GeoExt.data.FeatureStore=Ext.extend(Ext.data.Store,new GeoExt.data.FeatureStoreMixin),GeoExt.data.FeatureStore.LAYER_TO_STORE=1,GeoExt.data.FeatureStore.STORE_TO_LAYER=2,Ext.namespace("GeoExt","GeoExt.data"),GeoExt.data.FeatureReader=function(a,b){a=a||{},b instanceof Function||(b=GeoExt.data.FeatureRecord.create(b||a.fields||{})),GeoExt.data.FeatureReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.FeatureReader,Ext.data.DataReader,{totalRecords:null,read:function(a){return this.readRecords(a.features)},readRecords:function(a){var b=[];if(a){var e,f,g,h,i,j,k,l,c=this.recordType,d=c.prototype.fields;for(e=0,f=a.length;e<f;e++){if(i=a[e],j={},i.attributes)for(g=0,h=d.length;g<h;g++){if(k=d.items[g],/[\[\.]/.test(k.mapping))try{l=new Function("obj","return obj."+k.mapping)(i.attributes)}catch(a){l=k.defaultValue}else l=i.attributes[k.mapping||k.name]||k.defaultValue;k.convert&&(l=k.convert(l,i)),j[k.name]=l}j.feature=i,j.state=i.state,j.fid=i.fid;var m=i.state===OpenLayers.State.INSERT?void 0:i.id;b[b.length]=new c(j,m)}}return{records:b,totalRecords:null!=this.totalRecords?this.totalRecords:b.length}}}),Ext.namespace("GeoExt.data"),
GeoExt.data.FeatureRecord=Ext.data.Record.create([{name:"feature"},{name:"state"},{name:"fid"}]),GeoExt.data.FeatureRecord.prototype.getFeature=function(){return this.get("feature")},GeoExt.data.FeatureRecord.prototype.setFeature=function(a){a!==this.data.feature&&(this.dirty=!0,this.modified||(this.modified={}),void 0===this.modified.feature&&(this.modified.feature=this.data.feature),this.data.feature=a,this.editing||this.afterEdit())},GeoExt.data.FeatureRecord.create=function(a){var b=Ext.extend(GeoExt.data.FeatureRecord,{}),c=b.prototype;if(c.fields=new Ext.util.MixedCollection(!1,function(a){return a.name}),GeoExt.data.FeatureRecord.prototype.fields.each(function(a){c.fields.add(a)}),a)for(var d=0,e=a.length;d<e;d++)c.fields.add(new Ext.data.Field(a[d]));return b.getField=function(a){return c.fields.get(a)},b},Ext.namespace("GeoExt.plugins"),GeoExt.plugins.PrintPageField=Ext.extend(Ext.util.Observable,{printPage:null,target:null,constructor:function(a){this.initialConfig=a,Ext.apply(this,a),GeoExt.plugins.PrintPageField.superclass.constructor.apply(this,arguments)},init:function(a){this.target=a;var b={beforedestroy:this.onBeforeDestroy,scope:this},c=a instanceof Ext.form.ComboBox?"select":a instanceof Ext.form.Checkbox?"check":"valid";b[c]=this.onFieldChange,a.on(b),this.printPage.on({change:this.onPageChange,scope:this}),this.printPage.printProvider.on({layoutchange:this.onLayoutChange,scope:this}),this.setValue(this.printPage)},onFieldChange:function(a,b){var c=this.printPage.printProvider,d=a.getValue();this._updating=!0,a.store===c.scales||"scale"===a.name?this.printPage.setScale(b):"rotation"==a.name?!isNaN(d)&&this.printPage.setRotation(d):this.printPage.customParams[a.name]=d,delete this._updating},onPageChange:function(a){this._updating||this.setValue(a)},onLayoutChange:function(a,b){var c=this.target;"rotation"==c.name&&c.setDisabled(!b.get("rotation"))},setValue:function(a){var b=this.target;b.suspendEvents(),b.store===a.printProvider.scales||"scale"===b.name?a.scale&&b.setValue(a.scale.get(b.displayField)):"rotation"==b.name&&b.setValue(a.rotation),b.resumeEvents()},onBeforeDestroy:function(){this.target.un("beforedestroy",this.onBeforeDestroy,this),this.target.un("select",this.onFieldChange,this),this.target.un("valid",this.onFieldChange,this),this.printPage.un("change",this.onPageChange,this),this.printPage.printProvider.un("layoutchange",this.onLayoutChange,this)}}),Ext.preg("gx_printpagefield",GeoExt.plugins.PrintPageField),Ext.namespace("GeoExt.plugins"),GeoExt.plugins.PrintProviderField=Ext.extend(Ext.util.Observable,{target:null,constructor:function(a){this.initialConfig=a,Ext.apply(this,a),GeoExt.plugins.PrintProviderField.superclass.constructor.apply(this,arguments)},init:function(a){this.target=a;var b={scope:this,render:this.onRender,beforedestroy:this.onBeforeDestroy};b[a instanceof Ext.form.ComboBox?"select":"valid"]=this.onFieldChange,a.on(b)},onRender:function(a){var b=this.printProvider||a.ownerCt.printProvider;a.store===b.layouts?(a.setValue(b.layout.get(a.displayField)),b.on({layoutchange:this.onProviderChange,scope:this})):a.store===b.dpis?(a.setValue(b.dpi.get(a.displayField)),b.on({dpichange:this.onProviderChange,scope:this})):void 0===a.initialConfig.value&&a.setValue(b.customParams[a.name])},onFieldChange:function(a,b){var c=this.printProvider||a.ownerCt.printProvider,d=a.getValue();if(this._updating=!0,b)switch(a.store){case c.layouts:c.setLayout(b);break;case c.dpis:c.setDpi(b)}else c.customParams[a.name]=d;delete this._updating},onProviderChange:function(a,b){this._updating||this.target.setValue(b.get(this.target.displayField))},onBeforeDestroy:function(){var a=this.target;a.un("beforedestroy",this.onBeforeDestroy,this),a.un("render",this.onRender,this),a.un("select",this.onFieldChange,this),a.un("valid",this.onFieldChange,this);var b=this.printProvider||a.ownerCt.printProvider;b.un("layoutchange",this.onProviderChange,this),b.un("dpichange",this.onProviderChange,this)}}),Ext.preg("gx_printproviderfield",GeoExt.plugins.PrintProviderField),OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(a){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,""),OpenLayers.Util.extend(this,a),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null),this.eventListeners=null,this.handler&&(this.handler.destroy(),this.handler=null),this.handlers){for(var a in this.handlers)this.handlers.hasOwnProperty(a)&&"function"==typeof this.handlers[a].destroy&&this.handlers[a].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null),this.div=null},setMap:function(a){this.map=a,this.handler&&this.handler.setMap(a)},draw:function(a){return null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title&&(this.div.title=this.title)),null!=a&&(this.position=a.clone()),this.moveTo(this.position),this.div},moveTo:function(a){null!=a&&null!=this.div&&(this.div.style.left=a.x+"px",this.div.style.top=a.y+"px")},activate:function(){return!this.active&&(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),!0)},deactivate:function(){return!!this.active&&(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0)},CLASS_NAME:"OpenLayers.Control"}),OpenLayers.Control.TYPE_BUTTON=1,OpenLayers.Control.TYPE_TOGGLE=2,OpenLayers.Control.TYPE_TOOL=3,Ext.namespace("GeoExt"),GeoExt.Action=Ext.extend(Ext.Action,{control:null,activateOnEnable:!1,deactivateOnDisable:!1,map:null,uScope:null,uHandler:null,uToggleHandler:null,uCheckHandler:null,constructor:function(a){this.uScope=a.scope,this.uHandler=a.handler,this.uToggleHandler=a.toggleHandler,this.uCheckHandler=a.checkHandler,a.scope=this,a.handler=this.pHandler,a.toggleHandler=this.pToggleHandler,a.checkHandler=this.pCheckHandler;var b=this.control=a.control;delete a.control,this.activateOnEnable=!!a.activateOnEnable,delete a.activateOnEnable,this.deactivateOnDisable=!!a.deactivateOnDisable,delete a.deactivateOnDisable,b&&(a.map&&(a.map.addControl(b),delete a.map),(a.pressed||a.checked)&&b.map&&b.activate(),b.active&&(a.pressed=!0,a.checked=!0),b.events.on({activate:this.onCtrlActivate,deactivate:this.onCtrlDeactivate,scope:this})),arguments.callee.superclass.constructor.call(this,a)},pHandler:function(a){var b=this.control;b&&b.type==OpenLayers.Control.TYPE_BUTTON&&b.trigger(),this.uHandler&&this.uHandler.apply(this.uScope,arguments)},pToggleHandler:function(a,b){this.changeControlState(b),this.uToggleHandler&&this.uToggleHandler.apply(this.uScope,arguments)},pCheckHandler:function(a,b){this.changeControlState(b),this.uCheckHandler&&this.uCheckHandler.apply(this.uScope,arguments)},changeControlState:function(a){a?this._activating||(this._activating=!0,this.control.activate(),this.initialConfig.pressed=!0,this.initialConfig.checked=!0,this._activating=!1):this._deactivating||(this._deactivating=!0,this.control.deactivate(),this.initialConfig.pressed=!1,this.initialConfig.checked=!1,this._deactivating=!1)},onCtrlActivate:function(){var a=this.control;a.type==OpenLayers.Control.TYPE_BUTTON?this.enable():(this.safeCallEach("toggle",[!0]),this.safeCallEach("setChecked",[!0]))},onCtrlDeactivate:function(){var a=this.control;a.type==OpenLayers.Control.TYPE_BUTTON?this.disable():(this.safeCallEach("toggle",[!1]),this.safeCallEach("setChecked",[!1]))},safeCallEach:function(a,b){for(var c=this.items,d=0,e=c.length;d<e;d++)c[d][a]&&(c[d].rendered?c[d][a].apply(c[d],b):c[d].on({render:c[d][a].createDelegate(c[d],b),single:!0}))},setDisabled:function(a){return!a&&this.activateOnEnable&&this.control&&!this.control.active&&this.control.activate(),a&&this.deactivateOnDisable&&this.control&&this.control.active&&this.control.deactivate(),GeoExt.Action.superclass.setDisabled.apply(this,arguments)}}),Ext.namespace("GeoExt.tree"),GeoExt.tree.LayerContainer=Ext.extend(Ext.tree.AsyncTreeNode,{text:"Layers",constructor:function(a){a=Ext.applyIf(a||{},{text:this.text}),this.loader=a.loader instanceof GeoExt.tree.LayerLoader?a.loader:new GeoExt.tree.LayerLoader(Ext.applyIf(a.loader||{},{store:a.layerStore})),GeoExt.tree.LayerContainer.superclass.constructor.call(this,a)},recordIndexToNodeIndex:function(a){for(var b=this.loader.store,c=b.getCount(),d=this.childNodes.length,e=-1,f=c-1;f>=0&&!(this.loader.filter(b.getAt(f))===!0&&(++e,a===f||e>d-1));--f);return e},destroy:function(){delete this.layerStore,GeoExt.tree.LayerContainer.superclass.destroy.apply(this,arguments)}}),Ext.tree.TreePanel.nodeTypes.gx_layercontainer=GeoExt.tree.LayerContainer,Ext.namespace("GeoExt.tree"),GeoExt.tree.LayerLoader=function(a){Ext.apply(this,a),this.addEvents("beforeload","load"),this.iconCls={},GeoExt.tree.LayerLoader.superclass.constructor.call(this)},Ext.extend(GeoExt.tree.LayerLoader,Ext.util.Observable,{store:null,filter:function(a){return 1==a.getLayer().displayInLayerSwitcher},baseAttrs:null,uiProviders:null,load:function(a,b){if(this.fireEvent("beforeload",this,a)){for(this.removeStoreHandlers();a.firstChild;)a.removeChild(a.firstChild);this.uiProviders||(this.uiProviders=a.getOwnerTree().getLoader().uiProviders),this.store||(this.store=GeoExt.MapPanel.guess().layers),this.store.each(function(b){this.addLayerNode(a,b)},this),this.addStoreHandlers(a),"function"==typeof b&&b(),this.fireEvent("load",this,a)}},onStoreAdd:function(a,b,c,d){if(!this._reordering)for(var e=d.recordIndexToNodeIndex(c+b.length-1),f=0;f<b.length;++f)this.addLayerNode(d,b[f],e)},onStoreRemove:function(a,b,c,d){this._reordering||this.removeLayerNode(d,b)},addLayerNode:function(a,b,c){if(c=c||0,this.filter(b)===!0){var d=this.createNode({nodeType:"gx_layer",layer:b.getLayer(),layerStore:this.store,iconCls:this.iconCls[b.id]}),e=a.item(c);e?a.insertBefore(d,e):a.appendChild(d),d.on("move",this.onChildMove,this)}},removeLayerNode:function(a,b){if(this.filter(b)===!0){var c=a.findChildBy(function(a){return a.layer==b.getLayer()});c&&(c.un("move",this.onChildMove,this),c.remove(),a.reload())}},onChildMove:function(a,b,c,d,e){this._reordering=!0;var f=this.store.getByLayer(b.layer);if(delete c.loader.iconCls[f.id],d instanceof GeoExt.tree.LayerContainer&&this.store===d.loader.store){d.loader._reordering=!0,d.loader.iconCls[f.id]=b.attributes.iconCls,this.store.remove(f);var g;if(d.childNodes.length>1){var h=0===e?e+1:e-1;g=this.store.findBy(function(a){return d.childNodes[h].layer===a.getLayer()}),0===e&&g++}else if(c.parentNode===d.parentNode){var i=d;do i=i.previousSibling;while(i&&!(i instanceof GeoExt.tree.LayerContainer&&i.lastChild));if(i)g=this.store.findBy(function(a){return i.lastChild.layer===a.getLayer()});else{var j=d;do j=j.nextSibling;while(j&&!(j instanceof GeoExt.tree.LayerContainer&&j.firstChild));j&&(g=this.store.findBy(function(a){return j.firstChild.layer===a.getLayer()})),g++}}void 0!==g?(this.store.insert(g,[f]),window.setTimeout(function(){d.reload(),c.reload()})):this.store.insert(oldRecordIndex,[f]),delete d.loader._reordering}delete this._reordering},addStoreHandlers:function(a){if(!this._storeHandlers){this._storeHandlers={add:this.onStoreAdd.createDelegate(this,[a],!0),remove:this.onStoreRemove.createDelegate(this,[a],!0)};for(var b in this._storeHandlers)this.store.on(b,this._storeHandlers[b],this)}},removeStoreHandlers:function(){if(this._storeHandlers){for(var a in this._storeHandlers)this.store.un(a,this._storeHandlers[a],this);delete this._storeHandlers}},createNode:function(attr){return this.baseAttrs&&Ext.apply(attr,this.baseAttrs),"string"==typeof attr.uiProvider&&(attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)),attr.nodeType=attr.nodeType||"gx_layer",new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)},destroy:function(){this.removeStoreHandlers(),this.iconCls=null}}),OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(a,b){this.metadata={},b=OpenLayers.Util.extend({},b),null!=this.alwaysInRange&&(b.alwaysInRange=this.alwaysInRange),this.addOptions(b),this.name=a,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object&&this.events.on(this.eventListeners))},destroy:function(a){null==a&&(a=!0),null!=this.map&&this.map.removeLayer(this,a),this.projection=null,this.map=null,this.name=null,this.div=null,this.options=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.eventListeners=null,this.events=null},clone:function(a){return null==a&&(a=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(a,this),a.map=null,a},getOptions:function(){var a={};for(var b in this.options)a[b]=this[b];return a},setName:function(a){a!=this.name&&(this.name=a,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(a,b){if(null==this.options&&(this.options={}),a&&("string"==typeof a.projection&&(a.projection=new OpenLayers.Projection(a.projection)),a.projection&&OpenLayers.Util.applyDefaults(a,OpenLayers.Projection.defaults[a.projection.getCode()]),!a.maxExtent||a.maxExtent instanceof OpenLayers.Bounds||(a.maxExtent=new OpenLayers.Bounds(a.maxExtent)),!a.minExtent||a.minExtent instanceof OpenLayers.Bounds||(a.minExtent=new OpenLayers.Bounds(a.minExtent))),OpenLayers.Util.extend(this.options,a),OpenLayers.Util.extend(this,a),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var c=this.map.getResolution(),d=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var e in a)if(a.hasOwnProperty(e)&&OpenLayers.Util.indexOf(d,e)>=0){this.initResolutions(),b&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(c),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var a=!1;if(this.map){this.inRange=this.calculateInRange();var b=this.getExtent();if(b&&this.inRange&&this.visibility){var c=!0;this.moveTo(b,c,!1),this.events.triggerEvent("moveend",{zoomChanged:c}),a=!0}}return a},moveTo:function(a,b,c){var d=this.visibility;this.isBaseLayer||(d=d&&this.inRange),this.display(d)},moveByPx:function(a,b){},setMap:function(a){if(null==this.map){if(this.map=a,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),!this.isBaseLayer){this.inRange=this.calculateInRange();var b=this.visibility&&this.inRange;this.div.style.display=b?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(a){},getImageSize:function(a){return this.imageSize||this.tileSize},setTileSize:function(a){var b=a?a:this.tileSize?this.tileSize:this.map.getTileSize();this.tileSize=b,this.gutter&&(this.imageSize=new OpenLayers.Size(b.w+2*this.gutter,b.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(a){a!=this.visibility&&(this.visibility=a,this.display(a),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(a){a!=("none"!=this.div.style.display)&&(this.div.style.display=a&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var a=!1;if(this.alwaysInRange)a=!0;else if(this.map){var b=this.map.getResolution();a=b>=this.minResolution&&b<=this.maxResolution}return a},setIsBaseLayer:function(a){a!=this.isBaseLayer&&(this.isBaseLayer=a,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var a,b,c,d={},e=!0;for(a=0,b=this.RESOLUTION_PROPERTIES.length;a<b;a++)c=this.RESOLUTION_PROPERTIES[a],d[c]=this.options[c],e&&this.options[c]&&(e=!1);if(null==this.options.alwaysInRange&&(this.alwaysInRange=e),null==d.resolutions&&(d.resolutions=this.resolutionsFromScales(d.scales)),null==d.resolutions&&(d.resolutions=this.calculateResolutions(d)),null==d.resolutions){for(a=0,b=this.RESOLUTION_PROPERTIES.length;a<b;a++)c=this.RESOLUTION_PROPERTIES[a],d[c]=null!=this.options[c]?this.options[c]:this.map[c];null==d.resolutions&&(d.resolutions=this.resolutionsFromScales(d.scales)),null==d.resolutions&&(d.resolutions=this.calculateResolutions(d))}var f;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(f=this.options.maxResolution),this.options.minScale&&(f=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var g;if(this.options.minResolution&&"auto"!==this.options.minResolution&&(g=this.options.minResolution),this.options.maxScale&&(g=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),d.resolutions&&(d.resolutions.sort(function(a,b){return b-a}),f||(f=d.resolutions[0]),!g)){var h=d.resolutions.length-1;g=d.resolutions[h]}if(this.resolutions=d.resolutions,this.resolutions){for(b=this.resolutions.length,this.scales=new Array(b),a=0;a<b;a++)this.scales[a]=OpenLayers.Util.getScaleFromResolution(this.resolutions[a],this.units);this.numZoomLevels=b}this.minResolution=g,g&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(g,this.units)),this.maxResolution=f,f&&(this.minScale=OpenLayers.Util.getScaleFromResolution(f,this.units))},resolutionsFromScales:function(a){if(null!=a){var b,c,d;for(d=a.length,b=new Array(d),c=0;c<d;c++)b[c]=OpenLayers.Util.getResolutionFromScale(a[c],this.units);return b}},calculateResolutions:function(a){var b,c,d,e=a.maxResolution;null!=a.minScale?e=OpenLayers.Util.getResolutionFromScale(a.minScale,this.units):"auto"==e&&null!=this.maxExtent&&(b=this.map.getSize(),c=this.maxExtent.getWidth()/b.w,d=this.maxExtent.getHeight()/b.h,e=Math.max(c,d));var f=a.minResolution;if(null!=a.maxScale?f=OpenLayers.Util.getResolutionFromScale(a.maxScale,this.units):"auto"==a.minResolution&&null!=this.minExtent&&(b=this.map.getSize(),c=this.minExtent.getWidth()/b.w,d=this.minExtent.getHeight()/b.h,f=Math.max(c,d)),"number"!=typeof e&&"number"!=typeof f&&null!=this.maxExtent){var g=this.map.getTileSize();e=Math.max(this.maxExtent.getWidth()/g.w,this.maxExtent.getHeight()/g.h)}var h=a.maxZoomLevel,i=a.numZoomLevels;if("number"==typeof f&&"number"==typeof e&&void 0===i){var j=e/f;i=Math.floor(Math.log(j)/Math.log(2))+1}else void 0===i&&null!=h&&(i=h+1);if(!("number"!=typeof i||i<=0||"number"!=typeof e&&"number"!=typeof f)){var k=new Array(i),l=2;"number"==typeof f&&"number"==typeof e&&(l=Math.pow(e/f,1/(i-1)));var m;if("number"==typeof e)for(m=0;m<i;m++)k[m]=e/Math.pow(l,m);else for(m=0;m<i;m++)k[i-1-m]=f*Math.pow(l,m);return k}},getResolution:function(){var a=this.map.getZoom();return this.getResolutionForZoom(a)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(a,b){var c=this.map.getSize(),d=Math.max(a.getWidth()/c.w,a.getHeight()/c.h);return this.getZoomForResolution(d,b)},getDataExtent:function(){},getResolutionForZoom:function(a){a=Math.max(0,Math.min(a,this.resolutions.length-1));var b;if(this.map.fractionalZoom){var c=Math.floor(a),d=Math.ceil(a);b=this.resolutions[c]-(a-c)*(this.resolutions[c]-this.resolutions[d])}else b=this.resolutions[Math.round(a)];return b},getZoomForResolution:function(a,b){var c,d,e;if(this.map.fractionalZoom){var j,f=0,g=this.resolutions.length-1,h=this.resolutions[f],i=this.resolutions[g];for(d=0,e=this.resolutions.length;d<e;++d)if(j=this.resolutions[d],j>=a&&(h=j,f=d),j<=a){i=j,g=d;break}var k=h-i;c=k>0?f+(h-a)/k:f}else{var l,m=Number.POSITIVE_INFINITY;for(d=0,e=this.resolutions.length;d<e;d++)if(b){if(l=Math.abs(this.resolutions[d]-a),l>m)break;m=l}else if(this.resolutions[d]<a)break;c=Math.max(0,d-1)}return c},getLonLatFromViewPortPx:function(a){var b=null,c=this.map;if(null!=a&&c.minPx){var d=c.getResolution(),e=c.getMaxExtent({restricted:!0}),f=(a.x-c.minPx.x)*d+e.left,g=(c.minPx.y-a.y)*d+e.top;b=new OpenLayers.LonLat(f,g),this.wrapDateLine&&(b=b.wrapDateLine(this.maxExtent))}return b},getViewPortPxFromLonLat:function(a,b){var c=null;if(null!=a){b=b||this.map.getResolution();var d=this.map.calculateBounds(null,b);c=new OpenLayers.Pixel(1/b*(a.lon-d.left),1/b*(d.top-a.lat))}return c},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;for(var b=this.div.childNodes,c=0,d=b.length;c<d;++c){var e=b[c].firstChild||b[c],f=b[c].lastChild;f&&"iframe"===f.nodeName.toLowerCase()&&(e=f.parentNode),OpenLayers.Util.modifyDOMElement(e,null,null,null,null,null,null,a)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(a){this.div.style.zIndex=a},adjustBounds:function(a){if(this.gutter){var b=this.gutter*this.map.getResolution();a=new OpenLayers.Bounds(a.left-b,a.bottom-b,a.right+b,a.top+b)}if(this.wrapDateLine){var c={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};a=a.wrapDateLine(this.maxExtent,c)}return a},CLASS_NAME:"OpenLayers.Layer"}),Ext.namespace("GeoExt.tree"),GeoExt.tree.LayerNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{constructor:function(a){GeoExt.tree.LayerNodeUI.superclass.constructor.apply(this,arguments)},render:function(a){var b=this.node.attributes;void 0===b.checked&&(b.checked=this.node.layer.getVisibility()),void 0===b.disabled&&this.node.autoDisable&&(this.node.disabled=this.node.layer.inRange===!1||!this.node.layer.calculateInRange()),GeoExt.tree.LayerNodeUI.superclass.render.apply(this,arguments);var c=this.checkbox;if(b.checkedGroup){var d=Ext.DomHelper.insertAfter(c,['<input type="radio" name="',b.checkedGroup,'_checkbox" class="',c.className,c.checked?'" checked="checked"':"",'"></input>'].join(""));d.defaultChecked=c.defaultChecked,Ext.get(c).remove(),this.checkbox=d}this.enforceOneVisible()},onClick:function(a){a.getTarget(".x-tree-node-cb",1)?this.toggleCheck(this.isChecked()):GeoExt.tree.LayerNodeUI.superclass.onClick.apply(this,arguments)},toggleCheck:function(a){a=void 0===a?!this.isChecked():a,GeoExt.tree.LayerNodeUI.superclass.toggleCheck.call(this,a),this.enforceOneVisible()},enforceOneVisible:function(){var a=this.node.attributes,b=a.checkedGroup;if(b&&"gx_baselayer"!==b){var c=this.node.layer,d=this.node.getOwnerTree().getChecked(),e=0;Ext.each(d,function(d){var f=d.layer;d.hidden||d.attributes.checkedGroup!==b||(e++,f!=c&&a.checked&&f.setVisibility(!1))}),0===e&&0==a.checked&&c.setVisibility(!0)}},appendDDGhost:function(a){var b=this.elNode.cloneNode(!0),c=Ext.DomQuery.select("input[type='radio']",b);Ext.each(c,function(a){a.name=a.name+"_clone"}),a.appendChild(b)}}),GeoExt.tree.LayerNode=Ext.extend(Ext.tree.AsyncTreeNode,{layer:null,autoDisable:null,layerStore:null,constructor:function(a){a.leaf=a.leaf||!(a.children||a.loader),a.iconCls||a.children||(a.iconCls="gx-tree-layer-icon"),!a.loader||a.loader instanceof Ext.tree.TreeLoader||(a.loader=new GeoExt.tree.LayerParamLoader(a.loader)),this.defaultUI=this.defaultUI||GeoExt.tree.LayerNodeUI,Ext.apply(this,{layer:a.layer,layerStore:a.layerStore,autoDisable:a.autoDisable}),a.text&&(this.fixedText=!0),GeoExt.tree.LayerNode.superclass.constructor.apply(this,arguments)},render:function(a){var b=this.layer instanceof OpenLayers.Layer&&this.layer;if(!b){this.layerStore&&"auto"!=this.layerStore||(this.layerStore=GeoExt.MapPanel.guess().layers);var c=this.layerStore.findBy(function(a){return a.get("title")==this.layer},this);c!=-1&&(b=this.layerStore.getAt(c).getLayer())}if(!this.rendered||!b){var d=this.getUI();b?(this.layer=b,b.isBaseLayer&&(this.draggable=!1,Ext.applyIf(this.attributes,{checkedGroup:"gx_baselayer"})),this.autoDisable=!(this.autoDisable===!1||this.layer.isBaseLayer||this.layer.alwaysInRange),this.text||(this.text=b.name),d.show(),this.addVisibilityEventHandlers()):d.hide(),this.layerStore instanceof GeoExt.data.LayerStore&&this.addStoreEventHandlers(b)}GeoExt.tree.LayerNode.superclass.render.apply(this,arguments)},addVisibilityEventHandlers:function(){this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this}),this.on({checkchange:this.onCheckChange,scope:this}),this.autoDisable&&(this.layer.map?this.layer.map.events.register("moveend",this,this.onMapMoveend):this.layer.events.register("added",this,function a(){this.layer.events.unregister("added",this,a),this.layer.map.events.register("moveend",this,this.onMapMoveend)}))},onLayerVisibilityChanged:function(){this._visibilityChanging||this.getUI().toggleCheck(this.layer.getVisibility())},onCheckChange:function(a,b){if(b!=this.layer.getVisibility()){this._visibilityChanging=!0;var c=this.layer;b&&c.isBaseLayer&&c.map?c.map.setBaseLayer(c):c.setVisibility(b),delete this._visibilityChanging}},onMapMoveend:function(a){this.autoDisable&&(this.layer.inRange===!1?this.disable():this.enable())},addStoreEventHandlers:function(){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,update:this.onStoreUpdate,scope:this})},onStoreAdd:function(a,b,c){for(var d,e=0;e<b.length;++e){if(d=b[e].getLayer(),this.layer==d){this.getUI().show();break}if(this.layer==d.name){this.render();break}}},onStoreRemove:function(a,b,c){this.layer==b.getLayer()&&this.getUI().hide()},onStoreUpdate:function(a,b,c){var d=b.getLayer();this.fixedText||this.layer!=d||this.text===d.name||this.setText(d.name)},destroy:function(){var a=this.layer;a instanceof OpenLayers.Layer&&(a.map&&a.map.events.unregister("moveend",this,this.onMapMoveend),a.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this})),delete this.layer;var b=this.layerStore;b&&(b.un("add",this.onStoreAdd,this),b.un("remove",this.onStoreRemove,this),b.un("update",this.onStoreUpdate,this)),delete this.layerStore,this.un("checkchange",this.onCheckChange,this),GeoExt.tree.LayerNode.superclass.destroy.apply(this,arguments)}}),Ext.tree.TreePanel.nodeTypes.gx_layer=GeoExt.tree.LayerNode,Ext.namespace("GeoExt.tree"),GeoExt.tree.BaseLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{text:"Base Layer",constructor:function(a){a=Ext.applyIf(a||{},{text:this.text,loader:{}}),a.loader=Ext.applyIf(a.loader,{baseAttrs:Ext.applyIf(a.loader.baseAttrs||{},{iconCls:"gx-tree-baselayer-icon",checkedGroup:"baselayer"}),filter:function(a){var b=a.getLayer();return b.displayInLayerSwitcher===!0&&b.isBaseLayer===!0}}),GeoExt.tree.BaseLayerContainer.superclass.constructor.call(this,a)}}),Ext.tree.TreePanel.nodeTypes.gx_baselayercontainer=GeoExt.tree.BaseLayerContainer,Ext.namespace("GeoExt.tree"),GeoExt.tree.OverlayLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{text:"Overlays",constructor:function(a){a=Ext.applyIf(a||{},{text:this.text}),a.loader=Ext.applyIf(a.loader||{},{filter:function(a){var b=a.getLayer();return b.displayInLayerSwitcher===!0&&b.isBaseLayer===!1}}),GeoExt.tree.OverlayLayerContainer.superclass.constructor.call(this,a)}}),Ext.tree.TreePanel.nodeTypes.gx_overlaylayercontainer=GeoExt.tree.OverlayLayerContainer,Ext.namespace("GeoExt.tree"),GeoExt.tree.TreeNodeUIEventMixin=function(){return{constructor:function(a){a.addEvents("rendernode","rawclicknode"),this.superclass=arguments.callee.superclass,this.superclass.constructor.apply(this,arguments)},render:function(a){this.rendered||(this.superclass.render.apply(this,arguments),this.fireEvent("rendernode",this.node))},onClick:function(a){this.fireEvent("rawclicknode",this.node,a)!==!1&&this.superclass.onClick.apply(this,arguments)}}},Ext.namespace("GeoExt"),GeoExt.Popup=Ext.extend(Ext.Window,{anchored:!0,map:null,panIn:!0,unpinnable:!0,location:null,insideViewport:null,animCollapse:!1,draggable:!1,shadow:!1,popupCls:"gx-popup",ancCls:null,anchorPosition:"auto",initComponent:function(){this.map instanceof GeoExt.MapPanel&&(this.map=this.map.map),!this.map&&this.location instanceof OpenLayers.Feature.Vector&&this.location.layer&&(this.map=this.location.layer.map),this.location instanceof OpenLayers.Feature.Vector&&(this.location=this.location.geometry),this.location instanceof OpenLayers.Geometry?("function"==typeof this.location.getCentroid&&(this.location=this.location.getCentroid()),this.location=this.location.getBounds().getCenterLonLat()):this.location instanceof OpenLayers.Pixel&&(this.location=this.map.getLonLatFromViewPortPx(this.location)),this.location instanceof OpenLayers.LonLat||(this.anchored=!1);var a=this.map.getExtent();a&&this.location&&(this.insideViewport=a.containsLonLat(this.location)),this.anchored?(this.addAnchorEvents(),this.elements+=",anc"):this.unpinnable=!1,this.baseCls=this.popupCls+" "+this.baseCls,GeoExt.Popup.superclass.initComponent.call(this)},onRender:function(a,b){GeoExt.Popup.superclass.onRender.call(this,a,b),this.anchored?(this.ancCls=this.popupCls+"-anc",this.createElement("anc",this.el.dom)):this.makeDraggable()},initTools:function(){this.unpinnable&&this.addTool({id:"unpin",handler:this.unanchorPopup.createDelegate(this,[])}),GeoExt.Popup.superclass.initTools.call(this)},show:function(){GeoExt.Popup.superclass.show.apply(this,arguments),this.anchored&&(this.position(),this.panIn&&!this._mapMove&&this.panIntoView())},maximize:function(){!this.maximized&&this.anc&&this.unanchorPopup(),GeoExt.Popup.superclass.maximize.apply(this,arguments)},setSize:function(a,b){if(this.anc){var c=this.anc.getSize();"object"==typeof a?(b=a.height-c.height,a=a.width):isNaN(b)||(b-=c.height)}GeoExt.Popup.superclass.setSize.call(this,a,b)},position:function(){var a=this;if(a._mapMove===!0&&(a.insideViewport=a.map.getExtent().containsLonLat(a.location),a.insideViewport!==a.isVisible()&&a.setVisible(a.insideViewport)),a.isVisible()){var b=a.map.getPixelFromLonLat(a.location),c=Ext.fly(a.map.div).getBox(!0),d=b.y+c.y,e=b.x+c.x,f=a.el.getSize(),g=a.anc.getSize(),h=a.anchorPosition;if(h.indexOf("right")>-1||b.x>c.width/2){a.anc.addClass("right");var i=a.el.getX(!0)+f.width-a.anc.getX(!0)-g.width;e-=f.width-i-g.width/2}else{a.anc.removeClass("right");var j=a.anc.getLeft(!0);e-=j+g.width/2}h.indexOf("bottom")>-1||b.y>c.height/2?(a.anc.removeClass("top"),d-=f.height+g.height):(a.anc.addClass("top"),d+=g.height),a.setPagePosition(e,d),window.setTimeout(function(){a.el.dom&&a.setPagePosition(e,d)},0)}},makeDraggable:function(){this.draggable=!0,this.header.addClass("x-window-draggable"),this.dd=new Ext.Window.DD(this)},unanchorPopup:function(){this.removeAnchorEvents(),this.makeDraggable(),this.anc.remove(),this.anc=null,
this.tools.unpin.hide()},panIntoView:function(){var a=Ext.fly(this.map.div).getBox(!0),b=this.getPosition(!0);b[0]-=a.x,b[1]-=a.y;var c=[a.width,a.height],d=this.getSize(),e=[b[0],b[1]],f=this.map.paddingForPopups;b[0]<f.left?e[0]=f.left:b[0]+d.width>c[0]-f.right&&(e[0]=c[0]-f.right-d.width),b[1]<f.top?e[1]=f.top:b[1]+d.height>c[1]-f.bottom&&(e[1]=c[1]-f.bottom-d.height);var g=b[0]-e[0],h=b[1]-e[1];this.map.pan(g,h)},onMapMove:function(){this.hidden&&this.insideViewport||(this._mapMove=!0,this.position(),delete this._mapMove)},addAnchorEvents:function(){this.map.events.on({move:this.onMapMove,scope:this}),this.on({resize:this.position,collapse:this.position,expand:this.position,scope:this})},removeAnchorEvents:function(){this.map.events.un({move:this.onMapMove,scope:this}),this.un("resize",this.position,this),this.un("collapse",this.position,this),this.un("expand",this.position,this)},beforeDestroy:function(){this.anchored&&this.removeAnchorEvents(),GeoExt.Popup.superclass.beforeDestroy.call(this)}}),Ext.reg("gx_popup",GeoExt.Popup),Ext.namespace("GeoExt"),GeoExt.MapPanel=Ext.extend(Ext.Panel,{map:null,layers:null,center:null,zoom:null,extent:null,prettyStateKeys:!1,stateEvents:["aftermapmove","afterlayervisibilitychange","afterlayeropacitychange","afterlayerorderchange","afterlayernamechange","afterlayeradd","afterlayerremove"],initComponent:function(){this.map instanceof OpenLayers.Map||(this.map=new OpenLayers.Map(Ext.applyIf(this.map||{},{allOverlays:!0,fallThrough:!0})));var a=this.layers;(!a||a instanceof Array)&&(this.layers=new GeoExt.data.LayerStore({layers:a,map:this.map.layers.length>0?this.map:null})),"string"==typeof this.center?this.center=OpenLayers.LonLat.fromString(this.center):this.center instanceof Array&&(this.center=new OpenLayers.LonLat(this.center[0],this.center[1])),"string"==typeof this.extent?this.extent=OpenLayers.Bounds.fromString(this.extent):this.extent instanceof Array&&(this.extent=OpenLayers.Bounds.fromArray(this.extent)),GeoExt.MapPanel.superclass.initComponent.call(this),this.addEvents("aftermapmove","afterlayervisibilitychange","afterlayeropacitychange","afterlayerorderchange","afterlayernamechange","afterlayeradd","afterlayerremove"),this.map.events.on({moveend:this.onMoveend,changelayer:this.onChangelayer,addlayer:this.onAddlayer,removelayer:this.onRemovelayer,scope:this}),this.on("afterlayout",function(){"function"==typeof this.map.getViewport&&this.items.each(function(a){"function"==typeof a.addToMapPanel&&a.getEl().appendTo(this.map.getViewport())},this)},this)},onMoveend:function(){this.fireEvent("aftermapmove")},onChangelayer:function(a){a.property&&("visibility"===a.property?this.fireEvent("afterlayervisibilitychange"):"order"===a.property?this.fireEvent("afterlayerorderchange"):"name"===a.property?this.fireEvent("afterlayernamechange"):"opacity"===a.property&&this.fireEvent("afterlayeropacitychange"))},onAddlayer:function(){this.fireEvent("afterlayeradd")},onRemovelayer:function(){this.fireEvent("afterlayerremove")},applyState:function(a){this.center=new OpenLayers.LonLat(a.x,a.y),this.zoom=a.zoom;var b,c,d,e,f,g,h=this.map.layers;for(b=0,c=h.length;b<c;b++)d=h[b],e=this.prettyStateKeys?d.name:d.id,f=a["visibility_"+e],void 0!==f&&(f=/^true$/i.test(f),d.isBaseLayer?f&&this.map.setBaseLayer(d):d.setVisibility(f)),g=a["opacity_"+e],void 0!==g&&d.setOpacity(g)},getState:function(){var a;if(this.map){var b=this.map.getCenter();a=b?{x:b.lon,y:b.lat,zoom:this.map.getZoom()}:{};var c,d,e,f,g=this.map.layers;for(c=0,d=g.length;c<d;c++)e=g[c],f=this.prettyStateKeys?e.name:e.id,a["visibility_"+f]=e.getVisibility(),a["opacity_"+f]=null==e.opacity?1:e.opacity;return a}},updateMapSize:function(){this.map&&this.map.updateSize()},renderMap:function(){var a=this.map;a.render(this.body.dom),this.layers.bind(a),a.layers.length>0?this.setInitialExtent():this.layers.on("add",this.setInitialExtent,this,{single:!0})},setInitialExtent:function(){var a=this.map;this.center||null!=this.zoom?a.setCenter(this.center,this.zoom):this.extent?a.zoomToExtent(this.extent):a.zoomToMaxExtent()},afterRender:function(){GeoExt.MapPanel.superclass.afterRender.apply(this,arguments),this.ownerCt?(this.ownerCt.on("move",this.updateMapSize,this),this.ownerCt.on({afterlayout:this.afterLayout,scope:this})):this.renderMap()},afterLayout:function(){var a=this.getInnerWidth()-this.body.getBorderWidth("lr"),b=this.getInnerHeight()-this.body.getBorderWidth("tb");a>0&&b>0&&(this.ownerCt.un("afterlayout",this.afterLayout,this),this.renderMap())},onResize:function(){GeoExt.MapPanel.superclass.onResize.apply(this,arguments),this.updateMapSize()},onBeforeAdd:function(a){"function"==typeof a.addToMapPanel&&a.addToMapPanel(this),GeoExt.MapPanel.superclass.onBeforeAdd.apply(this,arguments)},remove:function(a,b){"function"==typeof a.removeFromMapPanel&&a.removeFromMapPanel(this),GeoExt.MapPanel.superclass.remove.apply(this,arguments)},beforeDestroy:function(){this.ownerCt&&this.ownerCt.un("move",this.updateMapSize,this),this.map&&this.map.events&&this.map.events.un({moveend:this.onMoveend,changelayer:this.onChangelayer,addlayer:this.onAddlayer,removelayer:this.onRemovelayer,scope:this}),this.initialConfig.map&&this.initialConfig.map instanceof OpenLayers.Map||this.map&&this.map.destroy&&this.map.destroy(),delete this.map,GeoExt.MapPanel.superclass.beforeDestroy.apply(this,arguments)}}),GeoExt.MapPanel.guess=function(){return Ext.ComponentMgr.all.find(function(a){return a instanceof GeoExt.MapPanel})},Ext.reg("gx_mappanel",GeoExt.MapPanel),Ext.namespace("GeoExt.data"),GeoExt.data.LayerStoreMixin=function(){return{map:null,reader:null,constructor:function(a){a=a||{},a.reader=a.reader||new GeoExt.data.LayerReader({},a.fields),delete a.fields;var b=a.map instanceof GeoExt.MapPanel?a.map.map:a.map;delete a.map,a.layers&&(a.data=a.layers),delete a.layers;var c={initDir:a.initDir};delete a.initDir,arguments.callee.superclass.constructor.call(this,a),this.addEvents("bind"),b&&this.bind(b,c)},bind:function(a,b){if(!this.map){this.map=a,b=b||{};var c=b.initDir;void 0==b.initDir&&(c=GeoExt.data.LayerStore.MAP_TO_STORE|GeoExt.data.LayerStore.STORE_TO_MAP);var d=a.layers.slice(0);c&GeoExt.data.LayerStore.STORE_TO_MAP&&this.each(function(a){this.map.addLayer(a.getLayer())},this),c&GeoExt.data.LayerStore.MAP_TO_STORE&&this.loadData(d,!0),a.events.on({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this}),this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this}),this.data.on({replace:this.onReplace,scope:this}),this.fireEvent("bind",this,a)}},unbind:function(){this.map&&(this.map.events.un({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this}),this.un("load",this.onLoad,this),this.un("clear",this.onClear,this),this.un("add",this.onAdd,this),this.un("remove",this.onRemove,this),this.data.un("replace",this.onReplace,this),this.map=null)},onChangeLayer:function(a){var b=a.layer,c=this.findBy(function(a,c){return a.getLayer()===b});if(c>-1){var d=this.getAt(c);if("order"===a.property){if(!this._adding&&!this._removing){var e=this.map.getLayerIndex(b);e!==c&&(this._removing=!0,this.remove(d),delete this._removing,this._adding=!0,this.insert(e,[d]),delete this._adding)}}else"name"===a.property?d.set("title",b.name):this.fireEvent("update",this,d,Ext.data.Record.EDIT)}},onAddLayer:function(a){if(!this._adding){var b=a.layer;this._adding=!0,this.loadData([b],!0),delete this._adding}},onRemoveLayer:function(a){if(this.map.unloadDestroy){if(!this._removing){var b=a.layer;this._removing=!0,this.remove(this.getById(b.id)),delete this._removing}}else this.unbind()},onLoad:function(a,b,c){if(Ext.isArray(b)||(b=[b]),c&&!c.add){this._removing=!0;for(var d=this.map.layers.length-1;d>=0;d--)this.map.removeLayer(this.map.layers[d]);delete this._removing;var e=b.length;if(e>0){for(var f=new Array(e),g=0;g<e;g++)f[g]=b[g].getLayer();this._adding=!0,this.map.addLayers(f),delete this._adding}}},onClear:function(a){this._removing=!0;for(var b=this.map.layers.length-1;b>=0;b--)this.map.removeLayer(this.map.layers[b]);delete this._removing},onAdd:function(a,b,c){if(!this._adding){this._adding=!0;for(var d,e=b.length-1;e>=0;--e)d=b[e].getLayer(),this.map.addLayer(d),c!==this.map.layers.length-1&&this.map.setLayerIndex(d,c);delete this._adding}},onRemove:function(a,b,c){if(!this._removing){var d=b.getLayer();null!=this.map.getLayer(d.id)&&(this._removing=!0,this.removeMapLayer(b),delete this._removing)}},onUpdate:function(a,b,c){if(c===Ext.data.Record.EDIT&&b.modified&&b.modified.title){var d=b.getLayer(),e=b.get("title");e!==d.name&&d.setName(e)}},removeMapLayer:function(a){this.map.removeLayer(a.getLayer())},onReplace:function(a,b,c){this.removeMapLayer(b)},getByLayer:function(a){var b=this.findBy(function(b){return b.getLayer()===a});if(b>-1)return this.getAt(b)},destroy:function(){this.unbind(),GeoExt.data.LayerStore.superclass.destroy.call(this)}}},GeoExt.data.LayerStore=Ext.extend(Ext.data.Store,new GeoExt.data.LayerStoreMixin),GeoExt.data.LayerStore.MAP_TO_STORE=1,GeoExt.data.LayerStore.STORE_TO_MAP=2,Ext.namespace("GeoExt","GeoExt.data"),GeoExt.data.LayerReader=function(a,b){a=a||{},b instanceof Function||(b=GeoExt.data.LayerRecord.create(b||a.fields||{})),GeoExt.data.LayerReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.LayerReader,Ext.data.DataReader,{totalRecords:null,readRecords:function(a){var b=[];if(a){var e,f,g,h,i,j,k,l,c=this.recordType,d=c.prototype.fields;for(e=0,f=a.length;e<f;e++){for(i=a[e],j={},g=0,h=d.length;g<h;g++)k=d.items[g],l=i[k.mapping||k.name]||k.defaultValue,l=k.convert(l),j[k.name]=l;j.layer=i,b[b.length]=new c(j,i.id)}}return{records:b,totalRecords:null!=this.totalRecords?this.totalRecords:b.length}}}),Ext.namespace("GeoExt.data"),GeoExt.data.ScaleStore=Ext.extend(Ext.data.Store,{map:null,constructor:function(a){var b=a.map instanceof GeoExt.MapPanel?a.map.map:a.map;delete a.map,a=Ext.applyIf(a,{reader:new Ext.data.JsonReader({},["level","resolution","scale"])}),GeoExt.data.ScaleStore.superclass.constructor.call(this,a),b&&this.bind(b)},bind:function(a,b){this.map=a instanceof GeoExt.MapPanel?a.map:a,this.map.events.register("changebaselayer",this,this.populateFromMap),this.map.baseLayer?this.populateFromMap():this.map.events.register("addlayer",this,this.populateOnAdd)},unbind:function(){this.map&&(this.map.events.unregister("addlayer",this,this.populateOnAdd),this.map.events.unregister("changebaselayer",this,this.populateFromMap),delete this.map)},populateOnAdd:function(a){a.layer.isBaseLayer&&(this.populateFromMap(),this.map.events.unregister("addlayer",this,this.populateOnAdd))},populateFromMap:function(){for(var a=[],b=this.map.baseLayer.resolutions,c=this.map.baseLayer.units,d=b.length-1;d>=0;d--){var e=b[d];a.push({level:d,resolution:e,scale:OpenLayers.Util.getScaleFromResolution(e,c)})}this.loadData(a)},destroy:function(){this.unbind(),GeoExt.data.ScaleStore.superclass.destroy.apply(this,arguments)}}),Ext.namespace("GeoExt.form"),GeoExt.form.toFilter=function(a,b,c){a instanceof Ext.form.FormPanel&&(a=a.getForm());var d=[],e=a.getValues(!1);for(var f in e){var i,g=f.split("__"),h=e[f];if(g.length>1&&void 0!==(i=GeoExt.form.toFilter.FILTER_MAP[g[1]])?f=g[0]:i=OpenLayers.Filter.Comparison.EQUAL_TO,i===OpenLayers.Filter.Comparison.LIKE)switch(c){case GeoExt.form.ENDS_WITH:h=".*"+h;break;case GeoExt.form.STARTS_WITH:h+=".*";break;case GeoExt.form.CONTAINS:h=".*"+h+".*"}d.push(new OpenLayers.Filter.Comparison({type:i,value:h,property:f}))}return 1==d.length&&b!=OpenLayers.Filter.Logical.NOT?d[0]:new OpenLayers.Filter.Logical({type:b||OpenLayers.Filter.Logical.AND,filters:d})},GeoExt.form.toFilter.FILTER_MAP={eq:OpenLayers.Filter.Comparison.EQUAL_TO,ne:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,lt:OpenLayers.Filter.Comparison.LESS_THAN,le:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,gt:OpenLayers.Filter.Comparison.GREATER_THAN,ge:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,like:OpenLayers.Filter.Comparison.LIKE},GeoExt.form.ENDS_WITH=1,GeoExt.form.STARTS_WITH=2,GeoExt.form.CONTAINS=3,GeoExt.form.recordToField=function(a,b){b=b||{};var c=a.get("type");if("object"==typeof c&&c.xtype)return c;c=c.split(":").pop();var d,e=a.get("name"),f=a.get("restriction")||{},g=a.get("nillable")||!1,h=a.get("label"),i=b.labelTpl;if(i){var j=i instanceof Ext.Template?i:new Ext.XTemplate(i);h=j.apply(a.data)}else null==h&&(h=e);var k={name:e,labelStyle:g?"":null!=b.mandatoryFieldLabelStyle?b.mandatoryFieldLabelStyle:"font-weight:bold;"},l=GeoExt.form.recordToField.REGEXES;if(f.enumeration)d=Ext.apply({xtype:"combo",fieldLabel:h,mode:"local",forceSelection:!0,triggerAction:"all",editable:!1,store:f.enumeration},k);else if(c.match(l.text)){var m=void 0!==f.maxLength?parseFloat(f.maxLength):void 0,n=void 0!==f.minLength?parseFloat(f.minLength):void 0;d=Ext.apply({xtype:"textfield",fieldLabel:h,maxLength:m,minLength:n},k)}else if(c.match(l.number)){var o=void 0!==f.maxInclusive?parseFloat(f.maxInclusive):void 0,p=void 0!==f.minInclusive?parseFloat(f.minInclusive):void 0;d=Ext.apply({xtype:"numberfield",fieldLabel:h,maxValue:o,minValue:p},k)}else if(c.match(l.boolean)){d=Ext.apply({xtype:"checkbox"},k);var q=b.checkboxLabelProperty||"boxLabel";d[q]=h}else c.match(l.date)&&(d=Ext.apply({xtype:"datefield",fieldLabel:h,format:"c"},k));return d},GeoExt.form.recordToField.REGEXES={text:new RegExp("^(text|string)$","i"),number:new RegExp("^(number|float|decimal|double|int|long|integer|short)$","i"),boolean:new RegExp("^(boolean)$","i"),date:new RegExp("^(date|dateTime)$","i")},Ext.namespace("GeoExt"),GeoExt.LegendPanel=Ext.extend(Ext.Panel,{dynamic:!0,layerStore:null,preferredTypes:null,filter:function(a){return!0},onRender:function(){GeoExt.LegendPanel.superclass.onRender.apply(this,arguments),this.layerStore||(this.layerStore=GeoExt.MapPanel.guess().layers),this.layerStore.each(function(a){this.addLegend(a)},this),this.dynamic&&this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,clear:this.onStoreClear,scope:this})},recordIndexToPanelIndex:function(a){for(var f,g,b=this.layerStore,c=b.getCount(),d=-1,e=this.items?this.items.length:0,h=c-1;h>=0;--h){f=b.getAt(h),g=f.getLayer();var i=GeoExt.LayerLegend.getTypes(f);if(g.displayInLayerSwitcher&&i.length>0&&b.getAt(h).get("hideInLegend")!==!0&&(++d,a===h||d>e-1))break}return d},getIdForLayer:function(a){return this.id+"-"+a.id},onStoreAdd:function(a,b,c){for(var d=this.recordIndexToPanelIndex(c+b.length-1),e=0,f=b.length;e<f;e++)this.addLegend(b[e],d);this.doLayout()},onStoreRemove:function(a,b,c){this.removeLegend(b)},removeLegend:function(a){if(this.items){var b=this.getComponent(this.getIdForLayer(a.getLayer()));b&&(this.remove(b,!0),this.doLayout())}},onStoreClear:function(a){this.removeAllLegends()},removeAllLegends:function(){this.removeAll(!0),this.doLayout()},addLegend:function(a,b){if(this.filter(a)===!0){var c=a.getLayer();b=b||0;var e=GeoExt.LayerLegend.getTypes(a,this.preferredTypes);c.displayInLayerSwitcher&&!a.get("hideInLegend")&&e.length>0&&this.insert(b,{xtype:e[0],id:this.getIdForLayer(c),layerRecord:a,hidden:!(!c.map&&c.visibility||c.getVisibility()&&c.calculateInRange())})}},onDestroy:function(){this.layerStore&&(this.layerStore.un("add",this.onStoreAdd,this),this.layerStore.un("remove",this.onStoreRemove,this),this.layerStore.un("clear",this.onStoreClear,this)),GeoExt.LegendPanel.superclass.onDestroy.apply(this,arguments)}}),Ext.reg("gx_legendpanel",GeoExt.LegendPanel),Ext.namespace("GeoExt"),GeoExt.LayerLegend=Ext.extend(Ext.Container,{layerRecord:null,showTitle:!0,legendTitle:null,labelCls:null,layerStore:null,initComponent:function(){GeoExt.LayerLegend.superclass.initComponent.call(this),this.autoEl={},this.add({xtype:"label",html:this.getLayerTitle(this.layerRecord),cls:"x-form-item x-form-item-label"+(this.labelCls?" "+this.labelCls:"")}),this.layerRecord&&this.layerRecord.store&&(this.layerStore=this.layerRecord.store,this.layerStore.on("update",this.onStoreUpdate,this),this.layerStore.on("add",this.onStoreAdd,this),this.layerStore.on("remove",this.onStoreRemove,this))},getLabel:function(){var a=this.items.get(0);return a.rendered?a.el.dom.innerHTML:a.html},onStoreRemove:function(a,b,c){},onStoreAdd:function(a,b,c){},onStoreUpdate:function(a,b,c){if(b===this.layerRecord&&this.items.getCount()>0){var d=b.getLayer();this.setVisible(d.getVisibility()&&d.calculateInRange()&&d.displayInLayerSwitcher&&!b.get("hideInLegend")),this.update()}},update:function(){var a=this.getLayerTitle(this.layerRecord),b=this.items.itemAt(0);b instanceof Ext.form.Label&&this.getLabel()!==a&&b.setText(a,!1)},getLayerTitle:function(a){var b=this.legendTitle||"";return this.showTitle&&!b&&a&&!a.get("hideTitle")&&(b=a.get("title")||a.get("name")||a.getLayer().name||""),b},beforeDestroy:function(){this.layerStore&&(this.layerStore.un("update",this.onStoreUpdate,this),this.layerStore.un("remove",this.onStoreRemove,this),this.layerStore.un("add",this.onStoreAdd,this)),GeoExt.LayerLegend.superclass.beforeDestroy.apply(this,arguments)},onDestroy:function(){this.layerRecord=null,this.layerStore=null,GeoExt.LayerLegend.superclass.onDestroy.apply(this,arguments)}}),GeoExt.LayerLegend.getTypes=function(a,b){var e,f,c=(b||[]).concat(),d=[];for(f in GeoExt.LayerLegend.types)e=GeoExt.LayerLegend.types[f].supports(a),e>0?c.indexOf(f)==-1&&d.push({type:f,score:e}):c.remove(f);d.sort(function(a,b){return a.score<b.score?1:a.score==b.score?0:-1});for(var g=d.length,h=new Array(g),i=0;i<g;++i)h[i]=d[i].type;return c.concat(h)},GeoExt.LayerLegend.supports=function(a){},GeoExt.LayerLegend.types={},Ext.namespace("GeoExt"),GeoExt.LegendImage=Ext.extend(Ext.BoxComponent,{url:null,defaultImgSrc:null,imgCls:null,noImgCls:"gx-legend-noimage",initComponent:function(){GeoExt.LegendImage.superclass.initComponent.call(this),null===this.defaultImgSrc&&(this.defaultImgSrc=Ext.BLANK_IMAGE_URL),this.autoEl={tag:"img",class:this.imgCls?this.imgCls+" "+this.noImgCls:this.noImgCls,src:this.defaultImgSrc}},getImgEl:function(){return this.getEl()},setUrl:function(a){this.url=a;var b=this.getImgEl();b&&(b.un("load",this.onImageLoad,this),b.on("load",this.onImageLoad,this,{single:!0}),b.un("error",this.onImageLoadError,this),b.on("error",this.onImageLoadError,this,{single:!0}),b.dom.src=a)},onRender:function(a,b){GeoExt.LegendImage.superclass.onRender.call(this,a,b),this.url&&this.setUrl(this.url)},onDestroy:function(){var a=this.getImgEl();a&&(a.un("load",this.onImageLoad,this),a.un("error",this.onImageLoadError,this)),GeoExt.LegendImage.superclass.onDestroy.apply(this,arguments)},onImageLoadError:function(){var a=this.getImgEl();a.addClass(this.noImgCls),a.dom.src=this.defaultImgSrc},onImageLoad:function(){var a=this.getImgEl();OpenLayers.Util.isEquivalentUrl(a.dom.src,this.defaultImgSrc)||a.removeClass(this.noImgCls)}}),Ext.reg("gx_legendimage",GeoExt.LegendImage),Ext.namespace("GeoExt"),GeoExt.PrintMapPanel=Ext.extend(GeoExt.MapPanel,{sourceMap:null,printProvider:null,printPage:null,previewScales:null,center:null,zoom:null,extent:null,currentZoom:null,initComponent:function(){this.sourceMap instanceof GeoExt.MapPanel&&(this.sourceMap=this.sourceMap.map),this.map||(this.map={}),Ext.applyIf(this.map,{projection:this.sourceMap.getProjection(),maxExtent:this.sourceMap.getMaxExtent(),maxResolution:this.sourceMap.getMaxResolution(),units:this.sourceMap.getUnits()}),this.printProvider instanceof GeoExt.data.PrintProvider||(this.printProvider=new GeoExt.data.PrintProvider(this.printProvider)),this.printPage=new GeoExt.data.PrintPage({printProvider:this.printProvider}),this.previewScales=new Ext.data.Store,this.previewScales.add(this.printProvider.scales.getRange()),this.layers=[];Ext.each(this.sourceMap.layers,function(a){if(a.getVisibility()===!0)if(a instanceof OpenLayers.Layer.Vector){for(var b=a.features,c=new Array(b.length),d=new OpenLayers.Layer.Vector(a.name),e=0,f=b.length;e<f;++e)c[e]=b[e].clone();d.addFeatures(c,{silent:!0}),this.layers.push(d)}else this.layers.push(a.clone())},this),this.extent=this.sourceMap.getExtent(),GeoExt.PrintMapPanel.superclass.initComponent.call(this)},bind:function(){this.printPage.on("change",this.fitZoom,this),this.printProvider.on("layoutchange",this.syncSize,this),this.map.events.register("moveend",this,this.updatePage),this.printPage.fit(this.sourceMap),this.initialConfig.limitScales===!0&&(this.on("resize",this.calculatePreviewScales,this),this.calculatePreviewScales())},afterRender:function(){GeoExt.PrintMapPanel.superclass.afterRender.apply(this,arguments),this.syncSize(),this.ownerCt?this.ownerCt.on({afterlayout:{fn:this.bind,scope:this,single:!0}}):this.bind()},adjustSize:function(a,b){var c=this.printProvider.layout.get("size"),d=c.width/c.height,e=this.ownerCt,f=e&&e.autoWidth?0:a||this.initialConfig.width,g=e&&e.autoHeight?0:b||this.initialConfig.height;return f?(b=f/d,g&&b>g?(b=g,a=b*d):a=f):g&&(a=g*d,b=g),{width:a,height:b}},fitZoom:function(){if(!this._updating&&this.printPage.scale){this._updating=!0;var a=this.printPage.getPrintExtent(this.map);this.currentZoom=this.map.getZoomForExtent(a),this.map.zoomToExtent(a),delete this._updating}},updatePage:function(){if(!this._updating){var a=this.map.getZoom();this._updating=!0,a===this.currentZoom?this.printPage.setCenter(this.map.getCenter()):this.printPage.fit(this.map),delete this._updating,this.currentZoom=a}},calculatePreviewScales:function(){this.previewScales.removeAll(),this.printPage.suspendEvents();var a=this.printPage.scale,b=this.map.getSize(),c={},d=[];this.printProvider.scales.each(function(a){this.printPage.setScale(a);var e=this.printPage.getPrintExtent(this.map),f=this.map.getZoomForExtent(e),g=Math.max(e.getWidth()/b.w,e.getHeight()/b.h),h=this.map.getResolutionForZoom(f),i=Math.abs(g-h);f in c&&!(c[f].diff>i)||(c[f]={rec:a,diff:i},d.indexOf(f)==-1&&d.push(f))},this);for(var e=0,f=d.length;e<f;++e)this.previewScales.add(c[d[e]].rec);if(a&&this.printPage.setScale(a),this.printPage.resumeEvents(),a&&this.previewScales.getCount()>0){var g=this.previewScales.getAt(0),h=this.previewScales.getAt(this.previewScales.getCount()-1);a.get("value")<h.get("value")?this.printPage.setScale(h):a.get("value")>g.get("value")&&this.printPage.setScale(g)}this.fitZoom()},print:function(a){this.printProvider.print(this.map,[this.printPage],a)},beforeDestroy:function(){this.map.events.unregister("moveend",this,this.updatePage),this.printPage.un("change",this.fitZoom,this),this.printProvider.un("layoutchange",this.syncSize,this),GeoExt.PrintMapPanel.superclass.beforeDestroy.apply(this,arguments)}}),Ext.reg("gx_printmappanel",GeoExt.PrintMapPanel),OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(json,filter){function walk(a,b){if(b&&"object"==typeof b)for(var c in b)b.hasOwnProperty(c)&&(b[c]=walk(c,b[c]));return filter(a,b)}var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(object=eval("("+json+")"),"function"==typeof filter&&(object=walk("",object)))}catch(a){}return this.keepData&&(this.data=object),object},write:function(a,b){this.pretty=!!b;var c=null,d=typeof a;if(this.serialize[d])try{c=!this.pretty&&this.nativeJSON?JSON.stringify(a):this.serialize[d].apply(this,[a])}catch(a){OpenLayers.Console.error("Trouble serializing: "+a)}return c},writeIndent:function(){var a=[];if(this.pretty)for(var b=0;b<this.level;++b)a.push(this.indent);return a.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(a){if(null==a)return"null";if(a.constructor==Date)return this.serialize.date.apply(this,[a]);if(a.constructor==Array)return this.serialize.array.apply(this,[a]);var b=["{"];this.level+=1;var c,d,e,f=!1;for(c in a)a.hasOwnProperty(c)&&(d=OpenLayers.Format.JSON.prototype.write.apply(this,[c,this.pretty]),e=OpenLayers.Format.JSON.prototype.write.apply(this,[a[c],this.pretty]),null!=d&&null!=e&&(f&&b.push(","),b.push(this.writeNewline(),this.writeIndent(),d,":",this.writeSpace(),e),f=!0));return this.level-=1,b.push(this.writeNewline(),this.writeIndent(),"}"),b.join("")},array:function(a){var b,c=["["];this.level+=1;for(var d=0,e=a.length;d<e;++d)b=OpenLayers.Format.JSON.prototype.write.apply(this,[a[d],this.pretty]),null!=b&&(d>0&&c.push(","),c.push(this.writeNewline(),this.writeIndent(),b));return this.level-=1,c.push(this.writeNewline(),this.writeIndent(),"]"),c.join("")},string:function(a){var b={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(a)?'"'+a.replace(/([\x00-\x1f\\"])/g,function(a,c){var d=b[c];return d?d:(d=c.charCodeAt(),"\\u00"+Math.floor(d/16).toString(16)+(d%16).toString(16))})+'"':'"'+a+'"'},number:function(a){return isFinite(a)?String(a):"null"},boolean:function(a){return String(a)},date:function(a){function b(a){return a<10?"0"+a:a}return'"'+a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+"T"+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"}),OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(a,b,c){b=b?b:"FeatureCollection";var d=null,e=null;if(e="string"==typeof a?OpenLayers.Format.JSON.prototype.read.apply(this,[a,c]):a){if("string"!=typeof e.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+a);else if(this.isValidType(e,b))switch(b){case"Geometry":try{d=this.parseGeometry(e)}catch(a){OpenLayers.Console.error(a)}break;case"Feature":try{d=this.parseFeature(e),d.type="Feature"}catch(a){OpenLayers.Console.error(a)}break;case"FeatureCollection":switch(d=[],e.type){case"Feature":try{d.push(this.parseFeature(e))}catch(a){d=null,OpenLayers.Console.error(a)}break;case"FeatureCollection":for(var f=0,g=e.features.length;f<g;++f)try{d.push(this.parseFeature(e.features[f]))}catch(a){d=null,OpenLayers.Console.error(a)}break;default:try{var h=this.parseGeometry(e);d.push(new OpenLayers.Feature.Vector(h))}catch(a){d=null,OpenLayers.Console.error(a)}}}}else OpenLayers.Console.error("Bad JSON: "+a);return d},isValidType:function(a,b){var c=!1;switch(b){case"Geometry":OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],a.type)==-1?OpenLayers.Console.error("Unsupported geometry type: "+a.type):c=!0;break;case"FeatureCollection":c=!0;break;default:a.type==b?c=!0:OpenLayers.Console.error("Cannot convert types from "+a.type+" to "+b)}return c},parseFeature:function(a){var b,c,d,e;d=a.properties?a.properties:{},e=a.geometry&&a.geometry.bbox||a.bbox;try{c=this.parseGeometry(a.geometry)}catch(a){throw a}return b=new OpenLayers.Feature.Vector(c,d),e&&(b.bounds=OpenLayers.Bounds.fromArray(e)),a.id&&(b.fid=a.id),b},parseGeometry:function(a){if(null==a)return null;var b,c=!1;if("GeometryCollection"==a.type){if(!OpenLayers.Util.isArray(a.geometries))throw"GeometryCollection must have geometries array: "+a;for(var d=a.geometries.length,e=new Array(d),f=0;f<d;++f)e[f]=this.parseGeometry.apply(this,[a.geometries[f]]);b=new OpenLayers.Geometry.Collection(e),c=!0}else{if(!OpenLayers.Util.isArray(a.coordinates))throw"Geometry must have coordinates array: "+a;if(!this.parseCoords[a.type.toLowerCase()])throw"Unsupported geometry type: "+a.type;try{b=this.parseCoords[a.type.toLowerCase()].apply(this,[a.coordinates])}catch(a){throw a}}return this.internalProjection&&this.externalProjection&&!c&&b.transform(this.externalProjection,this.internalProjection),b},parseCoords:{point:function(a){if(0==this.ignoreExtraDims&&2!=a.length)throw"Only 2D points are supported: "+a;return new OpenLayers.Geometry.Point(a[0],a[1])},multipoint:function(a){for(var b=[],c=null,d=0,e=a.length;d<e;++d){try{c=this.parseCoords.point.apply(this,[a[d]])}catch(a){throw a}b.push(c)}return new OpenLayers.Geometry.MultiPoint(b)},linestring:function(a){for(var b=[],c=null,d=0,e=a.length;d<e;++d){try{c=this.parseCoords.point.apply(this,[a[d]])}catch(a){throw a}b.push(c)}return new OpenLayers.Geometry.LineString(b)},multilinestring:function(a){for(var b=[],c=null,d=0,e=a.length;d<e;++d){try{c=this.parseCoords.linestring.apply(this,[a[d]])}catch(a){throw a}b.push(c)}return new OpenLayers.Geometry.MultiLineString(b)},polygon:function(a){for(var c,d,b=[],e=0,f=a.length;e<f;++e){try{d=this.parseCoords.linestring.apply(this,[a[e]])}catch(a){throw a}c=new OpenLayers.Geometry.LinearRing(d.components),b.push(c)}return new OpenLayers.Geometry.Polygon(b)},multipolygon:function(a){for(var b=[],c=null,d=0,e=a.length;d<e;++d){try{c=this.parseCoords.polygon.apply(this,[a[d]])}catch(a){throw a}b.push(c)}return new OpenLayers.Geometry.MultiPolygon(b)},box:function(a){if(2!=a.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(a[0][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[0][1])])])}},write:function(a,b){var c={type:null};if(OpenLayers.Util.isArray(a)){c.type="FeatureCollection";var d=a.length;c.features=new Array(d);for(var e=0;e<d;++e){var f=a[e];if(!f instanceof OpenLayers.Feature.Vector){var g="FeatureCollection only supports collections of features: "+f;throw g}c.features[e]=this.extract.feature.apply(this,[f])}}else 0==a.CLASS_NAME.indexOf("OpenLayers.Geometry")?c=this.extract.geometry.apply(this,[a]):a instanceof OpenLayers.Feature.Vector&&(c=this.extract.feature.apply(this,[a]),a.layer&&a.layer.projection&&(c.crs=this.createCRSObject(a)));return OpenLayers.Format.JSON.prototype.write.apply(this,[c,b])},createCRSObject:function(a){var b=a.layer.projection.toString(),c={};if(b.match(/epsg:/i)){var d=parseInt(b.substring(b.indexOf(":")+1));c=4326==d?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+d}}}return c},extract:{feature:function(a){var b=this.extract.geometry.apply(this,[a.geometry]),c={type:"Feature",properties:a.attributes,geometry:b};return null!=a.fid&&(c.id=a.fid),c},geometry:function(a){if(null==a)return null;this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var d,b=a.CLASS_NAME.split(".")[2],c=this.extract[b.toLowerCase()].apply(this,[a]);return d="Collection"==b?{type:"GeometryCollection",geometries:c}:{type:b,coordinates:c}},point:function(a){return[a.x,a.y]},multipoint:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b},linestring:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b},multilinestring:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.linestring.apply(this,[a.components[c]]));return b},polygon:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.linestring.apply(this,[a.components[c]]));return b},multipolygon:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.polygon.apply(this,[a.components[c]]));return b},collection:function(a){for(var b=a.components.length,c=new Array(b),d=0;d<b;++d)c[d]=this.extract.geometry.apply(this,[a.components[d]]);return c}},CLASS_NAME:"OpenLayers.Format.GeoJSON"}),Ext.namespace("GeoExt.data"),GeoExt.data.PrintProvider=Ext.extend(Ext.util.Observable,{url:null,capabilities:null,method:"POST",encoding:document.charset||document.characterSet||"UTF-8",
timeout:3e4,customParams:null,scales:null,dpis:null,layouts:null,dpi:null,layout:null,constructor:function(a){this.initialConfig=a,Ext.apply(this,a),this.customParams||(this.customParams={}),this.addEvents("loadcapabilities","layoutchange","dpichange","beforeprint","print","printexception","beforeencodelayer","encodelayer","beforedownload","beforeencodelegend"),GeoExt.data.PrintProvider.superclass.constructor.apply(this,arguments),this.scales=new Ext.data.JsonStore({root:"scales",sortInfo:{field:"value",direction:"DESC"},fields:["name",{name:"value",type:"float"}]}),this.dpis=new Ext.data.JsonStore({root:"dpis",fields:["name",{name:"value",type:"float"}]}),this.layouts=new Ext.data.JsonStore({root:"layouts",fields:["name",{name:"size",mapping:"map"},{name:"rotation",type:"boolean"}]}),a.capabilities?this.loadStores():(this.url.split("/").pop()&&(this.url+="/"),this.initialConfig.autoLoad&&this.loadCapabilities())},setLayout:function(a){this.layout=a,this.fireEvent("layoutchange",this,a)},setDpi:function(a){this.dpi=a,this.fireEvent("dpichange",this,a)},print:function(a,b,c){if(a instanceof GeoExt.MapPanel&&(a=a.map),b=b instanceof Array?b:[b],c=c||{},this.fireEvent("beforeprint",this,a,b,c)!==!1){var d=Ext.apply({units:a.getUnits(),srs:a.baseLayer.projection.getCode(),layout:this.layout.get("name"),dpi:this.dpi.get("value")},this.customParams),e=b[0].feature.layer,f=[],g=a.layers.concat();g.remove(a.baseLayer),g.unshift(a.baseLayer),Ext.each(g,function(a){if(a!==e&&a.getVisibility()===!0){var b=this.encodeLayer(a);b&&f.push(b)}},this),d.layers=f;var h=[];if(Ext.each(b,function(a){h.push(Ext.apply({center:[a.center.lon,a.center.lat],scale:a.scale.get("value"),rotation:a.rotation},a.customParams))},this),d.pages=h,c.overview){var i=[];Ext.each(c.overview.layers,function(a){var b=this.encodeLayer(a);b&&i.push(b)},this),d.overviewLayers=i}if(c.legend&&this.fireEvent("beforeencodelegend",this,d,c.legend)!==!1){var j=c.legend,k=j.rendered;k||(j=j.cloneConfig({renderTo:document.body,hidden:!0}));var l=[];j.items&&j.items.each(function(a){if(!a.hidden){var b=this.encoders.legends[a.getXType()];l=l.concat(b.call(this,a,d.pages[0].scale))}},this),k||j.destroy(),d.legends=l}if("GET"===this.method){var m=Ext.urlAppend(this.capabilities.printURL,"spec="+encodeURIComponent(Ext.encode(d)));this.download(m)}else Ext.Ajax.request({url:this.capabilities.createURL,timeout:this.timeout,jsonData:d,headers:{"Content-Type":"application/json; charset="+this.encoding},success:function(a){var b=Ext.decode(a.responseText).getURL;this.download(b)},failure:function(a){this.fireEvent("printexception",this,a)},params:this.initialConfig.baseParams,scope:this})}},download:function(a){this.fireEvent("beforedownload",this,a)!==!1&&(Ext.isOpera?window.open(a):window.location.href=a),this.fireEvent("print",this,a)},loadCapabilities:function(){if(this.url){var a=this.url+"info.json";Ext.Ajax.request({url:a,method:"GET",disableCaching:!1,success:function(a){this.capabilities=Ext.decode(a.responseText),this.loadStores()},params:this.initialConfig.baseParams,scope:this})}},loadStores:function(){this.scales.loadData(this.capabilities),this.dpis.loadData(this.capabilities),this.layouts.loadData(this.capabilities),this.setLayout(this.layouts.getAt(0)),this.setDpi(this.dpis.getAt(0)),this.fireEvent("loadcapabilities",this,this.capabilities)},encodeLayer:function(a){var b;for(var c in this.encoders.layers)if(OpenLayers.Layer[c]&&a instanceof OpenLayers.Layer[c]){if(this.fireEvent("beforeencodelayer",this,a)===!1)return;b=this.encoders.layers[c].call(this,a),this.fireEvent("encodelayer",this,a,b);break}return b&&b.type?b:null},getAbsoluteUrl:function(a){Ext.isSafari&&(a=a.replace(/{/g,"%7B"),a=a.replace(/}/g,"%7D"));var b;return Ext.isIE6||Ext.isIE7||Ext.isIE8?(b=document.createElement("<a href='"+a+"'/>"),b.style.display="none",document.body.appendChild(b),b.href=b.href,document.body.removeChild(b)):(b=document.createElement("a"),b.href=a),b.href},encoders:{layers:{Layer:function(a){var b={};return a.options&&a.options.maxScale&&(b.minScaleDenominator=a.options.maxScale),a.options&&a.options.minScale&&(b.maxScaleDenominator=a.options.minScale),b},WMS:function(a){var b=this.encoders.layers.HTTPRequest.call(this,a);b.singleTile=a.singleTile,Ext.apply(b,{type:"WMS",layers:[a.params.LAYERS].join(",").split(","),format:a.params.FORMAT,styles:[a.params.STYLES].join(",").split(","),singleTile:a.singleTile});var c;for(var d in a.params)c=d.toLowerCase(),null==a.params[d]||a.DEFAULT_PARAMS[c]||"layers,styles,width,height,srs".indexOf(c)!=-1||(b.customParams||(b.customParams={}),b.customParams[d]=a.params[d]);return b},OSM:function(a){var b=this.encoders.layers.TileCache.call(this,a);return Ext.apply(b,{type:"OSM",baseURL:b.baseURL.substr(0,b.baseURL.indexOf("$")),extension:"png"})},TMS:function(a){var b=this.encoders.layers.TileCache.call(this,a);return Ext.apply(b,{type:"TMS",format:a.type})},TileCache:function(a){var b=this.encoders.layers.HTTPRequest.call(this,a);return Ext.apply(b,{type:"TileCache",layer:a.layername,maxExtent:a.maxExtent.toArray(),tileSize:[a.tileSize.w,a.tileSize.h],extension:a.extension,resolutions:a.serverResolutions||a.resolutions})},WMTS:function(a){var b=this.encoders.layers.HTTPRequest.call(this,a);return b=Ext.apply(b,{type:"WMTS",layer:a.layer,version:a.version,requestEncoding:a.requestEncoding,style:a.style,dimensions:a.dimensions,params:a.params,matrixSet:a.matrixSet}),a.matrixIds?("KVP"==a.requestEncoding&&(b.format=a.format),b.matrixIds=[],Ext.each(a.matrixIds,function(c){b.matrixIds.push({identifier:c.identifier,matrixSize:[c.matrixWidth,c.matrixHeight],resolution:28e-5*c.scaleDenominator/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[a.units],tileSize:[c.tileWidth,c.tileHeight],topLeftCorner:[c.topLeftCorner.lon,c.topLeftCorner.lat]})}),b):Ext.apply(b,{formatSuffix:a.formatSuffix,tileOrigin:[a.tileOrigin.lon,a.tileOrigin.lat],tileSize:[a.tileSize.w,a.tileSize.h],maxExtent:null!=a.tileFullExtent?a.tileFullExtent.toArray():a.maxExtent.toArray(),zoomOffset:a.zoomOffset,resolutions:a.serverResolutions||a.resolutions})},KaMapCache:function(a){var b=this.encoders.layers.KaMap.call(this,a);return Ext.apply(b,{type:"KaMapCache",group:a.params.g,metaTileWidth:a.params.metaTileSize.w,metaTileHeight:a.params.metaTileSize.h})},KaMap:function(a){var b=this.encoders.layers.HTTPRequest.call(this,a);return Ext.apply(b,{type:"KaMap",map:a.params.map,extension:a.params.i,group:a.params.g||"",maxExtent:a.maxExtent.toArray(),tileSize:[a.tileSize.w,a.tileSize.h],resolutions:a.serverResolutions||a.resolutions})},HTTPRequest:function(a){var b=this.encoders.layers.Layer.call(this,a);return Ext.apply(b,{baseURL:this.getAbsoluteUrl(a.url instanceof Array?a.url[0]:a.url),opacity:null!=a.opacity?a.opacity:1})},Image:function(a){var b=this.encoders.layers.Layer.call(this,a);return Ext.apply(b,{type:"Image",baseURL:this.getAbsoluteUrl(a.getURL(a.extent)),opacity:null!=a.opacity?a.opacity:1,extent:a.extent.toArray(),pixelSize:[a.size.w,a.size.h],name:a.name})},Vector:function(a){if(a.features.length){for(var i,j,k,l,m,b=[],c={},d=a.features,e=new OpenLayers.Format.GeoJSON,f=new OpenLayers.Format.JSON,g=1,h={},n=0,o=d.length;n<o;++n)if(i=d[n],j=i.style||a.style||a.styleMap.createSymbolizer(i,i.renderIntent),"none"!=j.display){k=f.write(j),l=h[k],l?m=l:(h[k]=m=g++,j.externalGraphic?c[m]=Ext.applyIf({externalGraphic:this.getAbsoluteUrl(j.externalGraphic)},j):c[m]=j);var p=e.extract.feature.call(e,i);p.properties=OpenLayers.Util.extend({_gx_style:m},p.properties),b.push(p)}var q=this.encoders.layers.Layer.call(this,a);return Ext.apply(q,{type:"Vector",styles:c,styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:b},name:a.name,opacity:null!=a.opacity?a.opacity:1})}},Markers:function(a){for(var b=[],c=0,d=a.markers.length;c<d;c++){var e=a.markers[c],f=new OpenLayers.Geometry.Point(e.lonlat.lon,e.lonlat.lat),g={externalGraphic:e.icon.url,graphicWidth:e.icon.size.w,graphicHeight:e.icon.size.h,graphicXOffset:e.icon.offset.x,graphicYOffset:e.icon.offset.y},h=new OpenLayers.Feature.Vector(f,{},g);b.push(h)}var i=new OpenLayers.Layer.Vector(a.name);i.addFeatures(b);var j=this.encoders.layers.Vector.call(this,i);return i.destroy(),j}},legends:{gx_wmslegend:function(a,b){for(var c=this.encoders.legends.base.call(this,a),d=[],e=1,f=a.items.getCount();e<f;++e){var g=a.items.get(e).url;if(a.useScaleParameter===!0&&g.toLowerCase().indexOf("request=getlegendgraphic")!=-1){var h=g.split("?"),i=Ext.urlDecode(h[1]);i.SCALE=b,g=h[0]+"?"+Ext.urlEncode(i)}d.push(this.getAbsoluteUrl(g))}return c[0].classes[0]={name:"",icons:d},c},gx_wmtslegend:function(a,b){return this.encoders.legends.gx_urllegend.call(this,a)},gx_urllegend:function(a){var b=this.encoders.legends.base.call(this,a);return b[0].classes.push({name:"",icon:this.getAbsoluteUrl(a.items.get(1).url)}),b},base:function(a){return[{name:a.getLabel(),classes:[]}]}}}}),Ext.namespace("GeoExt.data"),GeoExt.data.PrintPage=Ext.extend(Ext.util.Observable,{printProvider:null,feature:null,center:null,scale:null,rotation:0,customParams:null,constructor:function(a){this.initialConfig=a,Ext.apply(this,a),this.customParams||(this.customParams={}),this.addEvents("change"),GeoExt.data.PrintPage.superclass.constructor.apply(this,arguments),this.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(-1,1)])])),this.printProvider.capabilities?this.setScale(this.printProvider.scales.getAt(0)):this.printProvider.on({loadcapabilities:function(){this.setScale(this.printProvider.scales.getAt(0))},scope:this,single:!0}),this.printProvider.on({layoutchange:this.onLayoutChange,scope:this})},getPrintExtent:function(a){return a=a instanceof GeoExt.MapPanel?a.map:a,this.calculatePageBounds(this.scale,a.getUnits())},setScale:function(a,b){var c=this.calculatePageBounds(a,b),d=c.toGeometry(),e=this.rotation;0!=e&&d.rotate(-e,d.getCentroid()),this.updateFeature(d,{scale:a})},setCenter:function(a){var b=this.feature.geometry,c=b.getBounds().getCenterLonLat(),d=a.lon-c.lon,e=a.lat-c.lat;b.move(d,e),this.updateFeature(b,{center:a})},setRotation:function(a,b){if(b||this.printProvider.layout.get("rotation")===!0){var c=this.feature.geometry;c.rotate(this.rotation-a,c.getCentroid()),this.updateFeature(c,{rotation:a})}},fit:function(a,b){b=b||{};var d,c=a;if(a instanceof GeoExt.MapPanel?c=a.map:a instanceof OpenLayers.Feature.Vector&&(c=a.layer.map,d=a.geometry.getBounds()),d||(d=c.getExtent())){this._updating=!0;var e=d.getCenterLonLat();this.setCenter(e);var f=c.getUnits(),g=this.printProvider.scales.getAt(0),h=Number.POSITIVE_INFINITY,i=d.getWidth(),j=d.getHeight();this.printProvider.scales.each(function(a){var c=this.calculatePageBounds(a,f);if("closest"!=b.mode){var k="screen"==b.mode?!d.containsBounds(c):c.containsBounds(d);return(k||"screen"==b.mode&&!k)&&(g=a),k}var e=Math.abs(c.getWidth()-i)+Math.abs(c.getHeight()-j);e<h&&(h=e,g=a)},this),this.setScale(g,f),delete this._updating,this.updateFeature(this.feature.geometry,{center:e,scale:g})}},updateFeature:function(a,b){var c=this.feature,d=c.geometry!==a;if(a.id=c.geometry.id,c.geometry=a,!this._updating){for(var e in b)b[e]===this[e]?delete b[e]:(this[e]=b[e],d=!0);Ext.apply(this,b),c.layer&&c.layer.drawFeature(c),d&&this.fireEvent("change",this,b)}},calculatePageBounds:function(a,b){var c=a.get("value"),d=this.feature,e=this.feature.geometry,f=e.getBounds().getCenterLonLat(),g=this.printProvider.layout.get("size"),b=b||d.layer&&d.layer.map&&d.layer.map.getUnits()||"dd",h=OpenLayers.INCHES_PER_UNIT[b],i=g.width/72/h*c/2,j=g.height/72/h*c/2;return new OpenLayers.Bounds(f.lon-i,f.lat-j,f.lon+i,f.lat+j)},onLayoutChange:function(){this.printProvider.layout.get("rotation")===!1&&this.setRotation(0,!0),this.scale&&this.setScale(this.scale)},destroy:function(){this.printProvider.un("layoutchange",this.onLayoutChange,this)}}),OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(a,b,c,d){OpenLayers.Layer.prototype.initialize.apply(this,[a,d]),this.url=b,this.params||(this.params=OpenLayers.Util.extend({},c))},destroy:function(){this.url=null,this.params=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.prototype.clone.apply(this,[a])},setUrl:function(a){this.url=a},mergeNewParams:function(a){this.params=OpenLayers.Util.extend(this.params,a);var b=this.redraw();return null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),b},redraw:function(a){return a?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(a,b){for(var c=1,d=0,e=a.length;d<e;d++)c*=a.charCodeAt(d)*this.URL_HASH_FACTOR,c-=Math.floor(c);return b[Math.floor(c*b.length)]},getFullRequestString:function(a,b){var c=b||this.url,d=OpenLayers.Util.extend({},this.params);d=OpenLayers.Util.extend(d,a);var e=OpenLayers.Util.getParameterString(d);OpenLayers.Util.isArray(c)&&(c=this.selectUrl(e,c));var f=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c));for(var g in d)g.toUpperCase()in f&&delete d[g];return e=OpenLayers.Util.getParameterString(d),OpenLayers.Util.urlAppend(c,e)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"}),OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(a,b,c,d,e,f){this.layer=a,this.position=b.clone(),this.setBounds(c),this.url=d,e&&(this.size=e.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),OpenLayers.Util.extend(this,f),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.layer=null,this.bounds=null,this.size=null,this.position=null,this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.eventListeners=null,this.events=null},draw:function(a){a||this.clear();var b=this.shouldDraw();return b&&!a&&this.events.triggerEvent("beforedraw")===!1&&(b=null),b},shouldDraw:function(){var a=!1,b=this.layer.maxExtent;if(b){var c=this.layer.map,d=c.baseLayer.wrapDateLine&&c.getMaxExtent();this.bounds.intersectsBounds(b,{inclusive:!1,worldBounds:d})&&(a=!0)}return a||this.layer.displayOutsideMaxExtent},setBounds:function(a){if(a=a.clone(),this.layer.map.baseLayer.wrapDateLine){var b=this.layer.map.getMaxExtent(),c=this.layer.map.getResolution();a=a.wrapDateLine(b,{leftTolerance:c,rightTolerance:c})}this.bounds=a},moveTo:function(a,b,c){null==c&&(c=!0),this.setBounds(a),this.position=b.clone(),c&&this.draw()},clear:function(a){},CLASS_NAME:"OpenLayers.Tile"}),OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(a,b,c,d,e,f){OpenLayers.Tile.prototype.initialize.apply(this,arguments),this.url=d,this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack(),(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)&&(this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"),null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.imgDiv=null,this.frame=null),this.asyncRequestId=null,OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);return a?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.renderTile(),this.positionTile()):a===!1&&this.unload(),a},renderTile:function(){if(this.layer.async){var a=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(b){a==this.asyncRequestId&&(this.url=b,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var a=this.getTile().style,b=this.frame?this.size:this.layer.getImageSize(this.bounds),c=1;this.layer instanceof OpenLayers.Layer.Grid&&(c=this.layer.getServerResolution()/this.layer.map.getResolution()),a.left=this.position.x+"px",a.top=this.position.y+"px",a.width=Math.round(c*b.w)+"px",a.height=Math.round(c*b.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var a=this.imgDiv;if(a){var b=this.getTile();b.parentNode===this.layer.div&&this.layer.div.removeChild(b),this.setImgSrc(),this.layerAlphaHack===!0&&(a.style.filter=""),OpenLayers.Element.removeClass(a,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var a=this.imgDiv.style;if(this.frame){var b=0,c=0;this.layer.gutter&&(b=this.layer.gutter/this.layer.tileSize.w*100,c=this.layer.gutter/this.layer.tileSize.h*100),a.left=-b+"%",a.top=-c+"%",a.width=2*b+100+"%",a.height=2*c+100+"%"}a.visibility="hidden",a.opacity=0,this.layer.opacity<1&&(a.filter="alpha(opacity="+100*this.layer.opacity+")"),a.position="absolute",this.layerAlphaHack&&(a.paddingTop=a.height,a.height="0",a.width="100%"),this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(a){this.imgDiv=a},initImage:function(){this.events.triggerEvent("beforeload"),this.layer.div.appendChild(this.getTile()),this.events.triggerEvent(this._loadEvent);var a=this.getImage();this.url&&OpenLayers.Util.isEquivalentUrl(a.src,this.url)?this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0):(this.stopLoading(),this.crossOriginKeyword&&a.removeAttribute("crossorigin"),OpenLayers.Event.observe(a,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(a,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url))},setImgSrc:function(a){var b=this.imgDiv;a?(b.style.visibility="hidden",b.style.opacity=0,this.crossOriginKeyword&&("data:"!==a.substr(0,5)?b.setAttribute("crossorigin",this.crossOriginKeyword):b.removeAttribute("crossorigin")),b.src=a):(this.stopLoading(),this.imgDiv=null,b.parentNode&&b.parentNode.removeChild(b))},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var a;return this.frame?(a=this.frame.cloneNode(!1),a.appendChild(this.imgDiv)):a=this.imgDiv,this.imgDiv=null,a}},onImageLoad:function(){var a=this.imgDiv;this.stopLoading(),a.style.visibility="inherit",a.style.opacity=this.layer.opacity,this.isLoading=!1,this.canvasContext=null,this.events.triggerEvent("loadend"),this.layerAlphaHack===!0&&(a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a.src+"', sizingMethod='scale')")},onImageError:function(){var a=this.imgDiv;null!=a.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(a,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv),window.clearTimeout(this._loadTimeout),delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var a=document.createElement("canvas");a.width=this.size.w,a.height=this.size.h,this.canvasContext=a.getContext("2d"),this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"}),OpenLayers.Tile.Image.IMAGE=function(){var a=new Image;return a.className="olTileImage",a.galleryImg="no",a}(),OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(a,b,c,d){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.grid=[],this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this),this.initProperties(),this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500),void 0===this.options.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid")},setMap:function(a){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,a),OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(a){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer(),this.clearGrid(),this.grid=null,this.tileSize=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var a=0,b=this.grid.length;a<b;a++)for(var c=this.grid[a],d=0,e=c.length;d<e;d++){var f=c[d];this.destroyTile(f)}this.grid=[],this.gridResolution=null,this.gridLayout=null}},addOptions:function(a,b){var c=void 0!==a.singleTile&&a.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments),this.map&&c&&(this.initProperties(),this.clearGrid(),this.tileSize=this.options.tileSize,this.setTileSize(),this.moveTo(null,!0))},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[a]),null!=this.tileSize&&(a.tileSize=this.tileSize.clone()),a.grid=[],a.gridResolution=null,a.backBuffer=null,a.backBufferTimerId=null,a.loading=!1,a.numLoadingTiles=0,a},moveTo:function(a,b,c){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),a=a||this.map.getExtent(),null!=a){var d=!this.grid.length||b,e=this.getTilesBounds(),f=this.map.getResolution();this.getServerResolution(f);this.singleTile?(d||!c&&!e.containsBounds(a))&&(b&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),b&&"resize"!==this.transitionEffect||this.applyBackBuffer(f),this.initSingleTile(a)):(d=d||!e.intersectsBounds(a,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}),d?(!b||"resize"!==this.transitionEffect&&this.gridResolution!==f||this.applyBackBuffer(f),this.initGriddedTiles(a)):this.moveGriddedTiles())}},getTileData:function(a){var b=null,c=a.lon,d=a.lat,e=this.grid.length;if(this.map&&e){var f=this.map.getResolution(),g=this.tileSize.w,h=this.tileSize.h,i=this.grid[0][0].bounds,j=i.left,k=i.top;if(c<j&&this.map.baseLayer.wrapDateLine){var l=this.map.getMaxExtent().getWidth(),m=Math.ceil((j-c)/l);c+=l*m}var n=(c-j)/(f*g),o=(k-d)/(f*h),p=Math.floor(n),q=Math.floor(o);if(q>=0&&q<e){var r=this.grid[q][p];r&&(b={tile:r,i:Math.floor((n-p)*g),j:Math.floor((o-q)*h)})}}return b},destroyTile:function(a){this.removeTileMonitoringHooks(a),a.destroy()},getServerResolution:function(a){var b=Number.POSITIVE_INFINITY;if(a=a||this.map.getResolution(),this.serverResolutions&&OpenLayers.Util.indexOf(this.serverResolutions,a)===-1){var c,d,e,f;for(c=this.serverResolutions.length-1;c>=0&&(e=this.serverResolutions[c],d=Math.abs(e-a),!(d>b));c--)b=d,f=e;a=f}return a},getServerZoom:function(){var a=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,a):this.map.getZoomForResolution(a)+(this.zoomOffset||0)},applyBackBuffer:function(a){null!==this.backBufferTimerId&&this.removeBackBuffer();var b=this.backBuffer;if(!b){if(b=this.createBackBuffer(),!b)return;a===this.gridResolution?this.div.insertBefore(b,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(b,this.map.baseLayer.div),this.backBuffer=b;var c=this.grid[0][0].bounds;this.backBufferLonLat={lon:c.left,lat:c.top},this.backBufferResolution=this.gridResolution}for(var f,d=this.backBufferResolution/a,e=b.childNodes,g=e.length-1;g>=0;--g)f=e[g],f.style.top=(d*f._i*f._h|0)+"px",f.style.left=(d*f._j*f._w|0)+"px",f.style.width=Math.round(d*f._w)+"px",f.style.height=Math.round(d*f._h)+"px";var h=this.getViewPortPxFromLonLat(this.backBufferLonLat,a),i=this.map.layerContainerOriginPx.x,j=this.map.layerContainerOriginPx.y;b.style.left=Math.round(h.x-i)+"px",b.style.top=Math.round(h.y-j)+"px"},createBackBuffer:function(){var a;if(this.grid.length>0){a=document.createElement("div"),a.id=this.div.id+"_bb",a.className="olBackBuffer",a.style.position="absolute";var b=this.map;a.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:b.Z_INDEX_BASE.BaseLayer-(b.getNumLayers()-b.getLayerIndex(this));for(var c=0,d=this.grid.length;c<d;c++)for(var e=0,f=this.grid[c].length;e<f;e++){var g=this.grid[c][e],h=this.grid[c][e].createBackBuffer();h&&(h._i=c,h._j=e,h._w=g.size.w,h._h=g.size.h,h.id=g.id+"_bb",a.appendChild(h))}}return a},removeBackBuffer:function(){if(this._transitionElement){for(var a=this.transitionendEvents.length-1;a>=0;--a)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[a],this._removeBackBuffer);delete this._transitionElement}this.backBuffer&&(this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer),this.backBuffer=null,this.backBufferResolution=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(a,b){this.singleTile||this.moveGriddedTiles()},setTileSize:function(a){this.singleTile&&(a=this.map.getSize(),a.h=parseInt(a.h*this.ratio,10),a.w=parseInt(a.w*this.ratio,10)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a])},getTilesBounds:function(){var a=null,b=this.grid.length;if(b){var c=this.grid[b-1][0].bounds,d=this.grid[0].length*c.getWidth(),e=this.grid.length*c.getHeight();a=new OpenLayers.Bounds(c.left,c.bottom,c.left+d,c.bottom+e)}return a},initSingleTile:function(a){this.events.triggerEvent("retile");var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio,d=a.getHeight()*this.ratio,e=new OpenLayers.Bounds(b.lon-c/2,b.lat-d/2,b.lon+c/2,b.lat+d/2),f=this.map.getLayerPxFromLonLat({lon:e.left,lat:e.top});this.grid.length||(this.grid[0]=[]);var g=this.grid[0][0];g?g.moveTo(e,f):(g=this.addTile(e,f),this.addTileMonitoringHooks(g),g.draw(),this.grid[0][0]=g),this.removeExcessTiles(1,1),this.gridResolution=this.getServerResolution()},calculateGridLayout:function(a,b,c){var d=c*this.tileSize.w,e=c*this.tileSize.h,f=a.left-b.lon,g=Math.floor(f/d)-this.buffer,h=this.rowSign,i=h*(b.lat-a.top+e),j=Math[~h?"floor":"ceil"](i/e)-this.buffer*h;return{tilelon:d,tilelat:e,startcol:g,startrow:j}},getTileOrigin:function(){var a=this.tileOrigin;if(!a){var b=this.getMaxExtent(),c={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner];a=new OpenLayers.LonLat(b[c[0]],b[c[1]])}return a},getTileBoundsForGridIndex:function(a,b){var c=this.getTileOrigin(),d=this.gridLayout,e=d.tilelon,f=d.tilelat,g=d.startcol,h=d.startrow,i=this.rowSign;return new OpenLayers.Bounds(c.lon+(g+b)*e,c.lat-(h+a*i)*f*i,c.lon+(g+b+1)*e,c.lat-(h+(a-1)*i)*f*i)},initGriddedTiles:function(a){this.events.triggerEvent("retile");var b=this.map.getSize(),c=this.getTileOrigin(),d=this.map.getResolution(),e=this.getServerResolution(),f=d/e,g={w:this.tileSize.w/f,h:this.tileSize.h/f},h=Math.ceil(b.h/g.h)+2*this.buffer+1,i=Math.ceil(b.w/g.w)+2*this.buffer+1,j=this.calculateGridLayout(a,c,e);this.gridLayout=j;var k=j.tilelon,l=j.tilelat,m=this.map.layerContainerOriginPx.x,n=this.map.layerContainerOriginPx.y,o=this.getTileBoundsForGridIndex(0,0),p=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(o.left,o.top));p.x=Math.round(p.x)-m,p.y=Math.round(p.y)-n;var q=[],r=this.map.getCenter(),s=0;do{var t=this.grid[s];t||(t=[],this.grid.push(t));var u=0;do{o=this.getTileBoundsForGridIndex(s,u);var v=p.clone();v.x=v.x+u*Math.round(g.w),v.y=v.y+s*Math.round(g.h);var w=t[u];w?w.moveTo(o,v,!1):(w=this.addTile(o,v),this.addTileMonitoringHooks(w),t.push(w));var x=o.getCenterLonLat();q.push({tile:w,distance:Math.pow(x.lon-r.lon,2)+Math.pow(x.lat-r.lat,2)}),u+=1}while(o.right<=a.right+k*this.buffer||u<i);s+=1}while(o.bottom>=a.bottom-l*this.buffer||s<h);this.removeExcessTiles(s,u);var d=this.getServerResolution();this.gridResolution=d,q.sort(function(a,b){return a.distance-b.distance});for(var y=0,z=q.length;y<z;++y)q[y].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(a,b){var c=new this.tileClass(this,b,a,null,this.tileSize,this.tileOptions);return this.events.triggerEvent("addtile",{tile:c}),c},addTileMonitoringHooks:function(a){var b="olTileReplacing";a.onLoadStart=function(){this.loading===!1&&(this.loading=!0,this.events.triggerEvent("loadstart")),this.events.triggerEvent("tileloadstart",{tile:a}),this.numLoadingTiles++,!this.singleTile&&this.backBuffer&&this.gridResolution===this.backBufferResolution&&OpenLayers.Element.addClass(a.getTile(),b)},a.onLoadEnd=function(c){this.numLoadingTiles--;var d="unload"===c.type;if(this.events.triggerEvent("tileloaded",{tile:a,aborted:d}),!this.singleTile&&!d&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var e=a.getTile();if("none"===OpenLayers.Element.getStyle(e,"display")){var f=document.getElementById(a.id+"_bb");f&&f.parentNode.removeChild(f)}OpenLayers.Element.removeClass(e,b)}if(0===this.numLoadingTiles){if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else{this._transitionElement=d?this.div.lastChild:a.imgDiv;for(var g=this.transitionendEvents,h=g.length-1;h>=0;--h)OpenLayers.Event.observe(this._transitionElement,g[h],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}this.loading=!1,this.events.triggerEvent("loadend")}},a.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:a})},a.events.on({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,loaderror:a.onLoadError,scope:this})},removeTileMonitoringHooks:function(a){a.unload(),a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,loaderror:a.onLoadError,scope:this})},moveGriddedTiles:function(){for(var a=this.buffer+1;;){var b=this.grid[0][0],c={x:b.position.x+this.map.layerContainerOriginPx.x,y:b.position.y+this.map.layerContainerOriginPx.y},d=this.getServerResolution()/this.map.getResolution(),e={w:Math.round(this.tileSize.w*d),h:Math.round(this.tileSize.h*d)};if(c.x>-e.w*(a-1))this.shiftColumn(!0,e);else if(c.x<-e.w*a)this.shiftColumn(!1,e);else if(c.y>-e.h*(a-1))this.shiftRow(!0,e);else{if(!(c.y<-e.h*a))break;this.shiftRow(!1,e)}}},shiftRow:function(a,b){var c=this.grid,d=a?0:c.length-1,e=a?-1:1,f=this.rowSign,g=this.gridLayout;g.startrow+=e*f;for(var h=c[d],i=c[a?"pop":"shift"](),j=0,k=i.length;j<k;j++){var l=i[j],m=h[j].position.clone();m.y+=b.h*e,l.moveTo(this.getTileBoundsForGridIndex(d,j),m)}c[a?"unshift":"push"](i)},shiftColumn:function(a,b){var c=this.grid,d=a?0:c[0].length-1,e=a?-1:1,f=this.gridLayout;f.startcol+=e;for(var g=0,h=c.length;g<h;g++){var i=c[g],j=i[d].position.clone(),k=i[a?"pop":"shift"]();j.x+=b.w*e,k.moveTo(this.getTileBoundsForGridIndex(g,d),j),i[a?"unshift":"push"](k)}},removeExcessTiles:function(a,b){for(var c,d;this.grid.length>a;){
var e=this.grid.pop();for(c=0,d=e.length;c<d;c++){var f=e[c];this.destroyTile(f)}}for(c=0,d=this.grid.length;c<d;c++)for(;this.grid[c].length>b;){var e=this.grid[c],f=e.pop();this.destroyTile(f)}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(a){var b=this.maxExtent,c=this.getResolution(),d=c*this.tileSize.w,e=c*this.tileSize.h,f=this.getLonLatFromViewPortPx(a),g=b.left+d*Math.floor((f.lon-b.left)/d),h=b.bottom+e*Math.floor((f.lat-b.bottom)/e);return new OpenLayers.Bounds(g,h,g+d,h+e)},CLASS_NAME:"OpenLayers.Layer.Grid"}),OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(a,b,c,d){var e=[];c=OpenLayers.Util.upperCaseObject(c),parseFloat(c.VERSION)>=1.3&&!c.EXCEPTIONS&&(c.EXCEPTIONS="INIMAGE"),e.push(a,b,c,d),OpenLayers.Layer.Grid.prototype.initialize.apply(this,e),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=d&&d.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))},clone:function(a){return null==a&&(a=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},reverseAxisOrder:function(){var a=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!!(this.yx[a]||OpenLayers.Projection.defaults[a]&&OpenLayers.Projection.defaults[a].yx)},getURL:function(a){a=this.adjustBounds(a);var b=this.getImageSize(),c={},d=this.reverseAxisOrder();c.BBOX=this.encodeBBOX?a.toBBOX(null,d):a.toArray(d),c.WIDTH=b.w,c.HEIGHT=b.h;var e=this.getFullRequestString(c);return e},mergeNewParams:function(a){var b=OpenLayers.Util.upperCaseObject(a),c=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,c)},getFullRequestString:function(a,b){var c=this.map.getProjectionObject(),d=this.projection&&this.projection.equals(c)?this.projection.getCode():c.getCode(),e="none"==d?null:d;return parseFloat(this.params.VERSION)>=1.3?this.params.CRS=e:this.params.SRS=e,"boolean"==typeof this.params.TRANSPARENT&&(a.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"),OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"}),Ext.namespace("GeoExt"),GeoExt.WMSLegend=Ext.extend(GeoExt.LayerLegend,{defaultStyleIsFirst:!0,useScaleParameter:!0,baseParams:null,itemXType:"gx_legendimage",initComponent:function(){GeoExt.WMSLegend.superclass.initComponent.call(this);var a=this.layerRecord.getLayer();this._noMap=!a.map,a.events.register("moveend",this,this.onLayerMoveend),this.update()},onLayerMoveend:function(a){(a.zoomChanged===!0&&this.useScaleParameter===!0||this._noMap)&&(delete this._noMap,this.update())},getLegendUrl:function(a,b){var d,c=this.layerRecord,e=c&&c.get("styles"),f=c.getLayer();b=b||[f.params.LAYERS].join(",").split(",");var g=f.params.STYLES&&[f.params.STYLES].join(",").split(","),h=b.indexOf(a),i=g&&g[h];e&&e.length>0&&(i?Ext.each(e,function(a){return d=a.name==i&&a.legend&&a.legend.href,!d}):g||f.params.SLD||f.params.SLD_BODY||(Ext.each(e,function(b){return d=b.layerName==a&&b.legend&&b.legend.href,!d}),d||this.defaultStyleIsFirst!==!0||(d=e[0].legend&&e[0].legend.href)),d&&(d=decodeURIComponent(d))),d||(d=f.getFullRequestString({REQUEST:"GetLegendGraphic",WIDTH:null,HEIGHT:null,EXCEPTIONS:"application/vnd.ogc.se_xml",LAYER:a,LAYERS:null,STYLE:""!==i?i:null,STYLES:null,SRS:null,FORMAT:null,TIME:null}));var j=Ext.apply({},this.baseParams);f.params._OLSALT&&(j._OLSALT=f.params._OLSALT);var k=Ext.urlEncode(j),l=/([&\?]?)format=[^&]*&?/i;if(l.test(k)&&l.test(d)&&(d=d.replace(l,"$1")),d=OpenLayers.Util.urlAppend(d,k),d.toLowerCase().indexOf("request=getlegendgraphic")!=-1&&(d.toLowerCase().indexOf("format=")==-1&&(d=Ext.urlAppend(d,"FORMAT=image%2Fgif")),this.useScaleParameter===!0)){var m=f.map.getScale();d=Ext.urlAppend(d,"SCALE="+m)}return d},update:function(){var a=this.layerRecord.getLayer();if(a&&a.map){GeoExt.WMSLegend.superclass.update.apply(this,arguments);var b,c,d,e;b=[a.params.LAYERS].join(",").split(",");var f=[],g=this.items.find(function(a){return a.isXType("label")});for(this.items.each(function(a){if(d=b.indexOf(a.itemId),d<0&&a!=g)f.push(a);else if(a!==g){c=b[d];var e=this.getLegendUrl(c,b);OpenLayers.Util.isEquivalentUrl(e,a.url)||a.setUrl(e)}},this),d=0,e=f.length;d<e;d++){var h=f[d];this.remove(h),h.destroy()}for(d=0,e=b.length;d<e;d++)c=b[d],this.items&&this.getComponent(c)||this.add({xtype:this.itemXType,url:this.getLegendUrl(c,b),itemId:c});this.doLayout()}},beforeDestroy:function(){if(this.useScaleParameter===!0){var a=this.layerRecord.getLayer();a&&a.events&&a.events.unregister("moveend",this,this.onLayerMoveend)}GeoExt.WMSLegend.superclass.beforeDestroy.apply(this,arguments)}}),GeoExt.WMSLegend.supports=function(a){return a.getLayer()instanceof OpenLayers.Layer.WMS?1:0},GeoExt.LayerLegend.types.gx_wmslegend=GeoExt.WMSLegend,Ext.reg("gx_wmslegend",GeoExt.WMSLegend),OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(a,b){this.container=OpenLayers.Util.getElement(a),OpenLayers.Util.extend(this,b)},destroy:function(){this.container=null,this.extent=null,this.size=null,this.resolution=null,this.map=null},supported:function(){return!1},setExtent:function(a,b){if(this.extent=a.clone(),this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var c=a.getWidth()/this.map.getExtent().getWidth(),a=a.scale(1/c);this.extent=a.wrapDateLine(this.map.getMaxExtent()).scale(c)}return b&&(this.resolution=null),!0},setSize:function(a){this.size=a.clone(),this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution(),this.resolution},drawFeature:function(a,b){if(null==b&&(b=a.style),a.geometry){var c=a.geometry.getBounds();if(c){var d;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(d=this.map.getMaxExtent()),c.intersectsBounds(this.extent,{worldBounds:d})?this.calculateFeatureDx(c,d):b={display:"none"};var e=this.drawGeometry(a.geometry,b,a.id);if("none"!=b.display&&b.label&&e!==!1){var f=a.geometry.getCentroid();if(b.labelXOffset||b.labelYOffset){var g=isNaN(b.labelXOffset)?0:b.labelXOffset,h=isNaN(b.labelYOffset)?0:b.labelYOffset,i=this.getResolution();f.move(g*i,h*i)}this.drawText(a.id,b,f)}else this.removeText(a.id);return e}}},calculateFeatureDx:function(a,b){if(this.featureDx=0,b){var c=b.getWidth(),d=(this.extent.left+this.extent.right)/2,e=(a.left+a.right)/2,f=Math.round((e-d)/c);this.featureDx=f*c}},drawGeometry:function(a,b,c){},drawText:function(a,b,c){},removeText:function(a){},clear:function(){},getFeatureIdFromEvent:function(a){},eraseFeatures:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0,c=a.length;b<c;++b){var d=a[b];this.eraseGeometry(d.geometry,d.id),this.removeText(d.id)}},eraseGeometry:function(a,b){},moveRoot:function(a){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(a){var b=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return a.stroke===!1&&(delete b.strokeWidth,delete b.strokeColor),a.fill===!1&&delete b.fillColor,OpenLayers.Util.extend(b,a),b},CLASS_NAME:"OpenLayers.Renderer"}),OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"},OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]},OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(a,b){if(this.styles={default:new OpenLayers.Style(OpenLayers.Feature.Vector.style.default),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),delete:new OpenLayers.Style(OpenLayers.Feature.Vector.style.delete)},a instanceof OpenLayers.Style)this.styles.default=a,this.styles.select=a,this.styles.temporary=a,this.styles.delete=a;else if("object"==typeof a)for(var c in a)if(a[c]instanceof OpenLayers.Style)this.styles[c]=a[c];else{if("object"!=typeof a[c]){this.styles.default=new OpenLayers.Style(a),this.styles.select=new OpenLayers.Style(a),this.styles.temporary=new OpenLayers.Style(a),this.styles.delete=new OpenLayers.Style(a);break}this.styles[c]=new OpenLayers.Style(a[c])}OpenLayers.Util.extend(this,b)},destroy:function(){for(var a in this.styles)this.styles[a].destroy();this.styles=null},createSymbolizer:function(a,b){a||(a=new OpenLayers.Feature.Vector),this.styles[b]||(b="default"),a.renderIntent=b;var c={};return this.extendDefault&&"default"!=b&&(c=this.styles.default.createSymbolizer(a)),OpenLayers.Util.extend(c,this.styles[b].createSymbolizer(a))},addUniqueValueRules:function(a,b,c,d){var e=[];for(var f in c)e.push(new OpenLayers.Rule({symbolizer:c[f],context:d,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:b,value:f})}));this.styles[a].addRules(e)},CLASS_NAME:"OpenLayers.StyleMap"}),OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(a,b){if(OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var c=0,d=this.strategies.length;c<d;c++)this.strategies[c].setLayer(this)},destroy:function(){if(this.strategies){var a,b,c;for(b=0,c=this.strategies.length;b<c;b++)a=this.strategies[b],a.autoDestroy&&a.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null),this.destroyFeatures(),this.features=null,this.selectedFeatures=null,this.unrenderedFeatures=null,this.renderer&&this.renderer.destroy(),this.renderer=null,this.geometryType=null,this.drawn=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){null==a&&(a=new OpenLayers.Layer.Vector(this.name,this.getOptions())),a=OpenLayers.Layer.prototype.clone.apply(this,[a]);for(var b=this.features,c=b.length,d=new Array(c),e=0;e<c;++e)d[e]=b[e].clone();return a.features=d,a},refresh:function(a){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",a)},assignRenderer:function(){for(var a=0,b=this.renderers.length;a<b;a++){var c=this.renderers[a],d="function"==typeof c?c:OpenLayers.Renderer[c];if(d&&d.prototype.supported()){this.renderer=new d(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(a){if(OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer){this.renderer.map=this.map;var b=this.map.getSize();b.w=b.w*this.ratio,b.h=b.h*this.ratio,this.renderer.setSize(b)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var a,b,c;for(b=0,c=this.strategies.length;b<c;b++)a=this.strategies[b],a.autoActivate&&a.activate()}},removeMap:function(a){if(this.drawn=!1,this.strategies){var b,c,d;for(c=0,d=this.strategies.length;c<d;c++)b=this.strategies[c],b.autoActivate&&b.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var a=this.map.getSize();a.w=a.w*this.ratio,a.h=a.h*this.ratio,this.renderer.setSize(a)},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var d=!0;if(!c){this.renderer.root.style.visibility="hidden";var e=this.map.getSize(),f=e.w,g=e.h,h=f/2*this.ratio-f/2,i=g/2*this.ratio-g/2;h+=this.map.layerContainerOriginPx.x,h=-Math.round(h),i+=this.map.layerContainerOriginPx.y,i=-Math.round(i),this.div.style.left=h+"px",this.div.style.top=i+"px";var j=this.map.getExtent().scale(this.ratio);if(d=this.renderer.setExtent(j,b),this.renderer.root.style.visibility="visible",OpenLayers.IS_GECKO===!0&&(this.div.scrollLeft=this.div.scrollLeft),!b&&d)for(var k in this.unrenderedFeatures){var l=this.unrenderedFeatures[k];this.drawFeature(l)}}if(!this.drawn||b||!d){this.drawn=!0;for(var l,k=0,m=this.features.length;k<m;k++)this.renderer.locked=k!==m-1,l=this.features[k],this.drawFeature(l)}},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);var b=this.div.style.display;b!=this.renderer.root.style.display&&(this.renderer.root.style.display=b)},addFeatures:function(a,b){OpenLayers.Util.isArray(a)||(a=[a]);var c=!b||!b.silent;if(c){var d={features:a},e=this.events.triggerEvent("beforefeaturesadded",d);if(e===!1)return;a=d.features}for(var f=[],g=0,h=a.length;g<h;g++){g!=a.length-1?this.renderer.locked=!0:this.renderer.locked=!1;var i=a[g];if(this.geometryType&&!(i.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);if(i.layer=this,!i.style&&this.style&&(i.style=OpenLayers.Util.extend({},this.style)),c){if(this.events.triggerEvent("beforefeatureadded",{feature:i})===!1)continue;this.preFeatureInsert(i)}f.push(i),this.features.push(i),this.drawFeature(i),c&&(this.events.triggerEvent("featureadded",{feature:i}),this.onFeatureInsert(i))}c&&this.events.triggerEvent("featuresadded",{features:f})},removeFeatures:function(a,b){if(a&&0!==a.length){if(a===this.features)return this.removeAllFeatures(b);OpenLayers.Util.isArray(a)||(a=[a]),a===this.selectedFeatures&&(a=a.slice());var c=!b||!b.silent;c&&this.events.triggerEvent("beforefeaturesremoved",{features:a});for(var d=a.length-1;d>=0;d--){0!=d&&a[d-1].geometry?this.renderer.locked=!0:this.renderer.locked=!1;var e=a[d];delete this.unrenderedFeatures[e.id],c&&this.events.triggerEvent("beforefeatureremoved",{feature:e}),this.features=OpenLayers.Util.removeItem(this.features,e),e.layer=null,e.geometry&&this.renderer.eraseFeatures(e),OpenLayers.Util.indexOf(this.selectedFeatures,e)!=-1&&OpenLayers.Util.removeItem(this.selectedFeatures,e),c&&this.events.triggerEvent("featureremoved",{feature:e})}c&&this.events.triggerEvent("featuresremoved",{features:a})}},removeAllFeatures:function(a){var b=!a||!a.silent,c=this.features;b&&this.events.triggerEvent("beforefeaturesremoved",{features:c});for(var d,e=c.length-1;e>=0;e--)d=c[e],b&&this.events.triggerEvent("beforefeatureremoved",{feature:d}),d.layer=null,b&&this.events.triggerEvent("featureremoved",{feature:d});this.renderer.clear(),this.features=[],this.unrenderedFeatures={},this.selectedFeatures=[],b&&this.events.triggerEvent("featuresremoved",{features:c})},destroyFeatures:function(a,b){var c=void 0==a;if(c&&(a=this.features),a){this.removeFeatures(a,b);for(var d=a.length-1;d>=0;d--)a[d].destroy()}},drawFeature:function(a,b){if(this.drawn){if("object"!=typeof b){b||a.state!==OpenLayers.State.DELETE||(b="delete");var c=b||a.renderIntent;b=a.style||this.style,b||(b=this.styleMap.createSymbolizer(a,c))}var d=this.renderer.drawFeature(a,b);d===!1||null===d?this.unrenderedFeatures[a.id]=a:delete this.unrenderedFeatures[a.id]}},eraseFeatures:function(a){this.renderer.eraseFeatures(a)},getFeatureFromEvent:function(a){if(!this.renderer)throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var b=null,c=this.renderer.getFeatureIdFromEvent(a);return c&&(b="string"==typeof c?this.getFeatureById(c):c),b},getFeatureBy:function(a,b){for(var c=null,d=0,e=this.features.length;d<e;++d)if(this.features[d][a]==b){c=this.features[d];break}return c},getFeatureById:function(a){return this.getFeatureBy("id",a)},getFeatureByFid:function(a){return this.getFeatureBy("fid",a)},getFeaturesByAttribute:function(a,b){var c,d,e=this.features.length,f=[];for(c=0;c<e;c++)d=this.features[c],d&&d.attributes&&d.attributes[a]===b&&f.push(d);return f},onFeatureInsert:function(a){},preFeatureInsert:function(a){},getDataExtent:function(){var a=null,b=this.features;if(b&&b.length>0)for(var c=null,d=0,e=b.length;d<e;d++)c=b[d].geometry,c&&(null===a&&(a=new OpenLayers.Bounds),a.extend(c.getBounds()));return a},CLASS_NAME:"OpenLayers.Layer.Vector"}),Ext.namespace("GeoExt"),GeoExt.VectorLegend=Ext.extend(GeoExt.LayerLegend,{layerRecord:null,layer:null,rules:null,symbolType:null,untitledPrefix:"Untitled ",clickableSymbol:!1,clickableTitle:!1,selectOnClick:!1,enableDD:!1,bodyBorder:!1,feature:null,selectedRule:null,currentScaleDenominator:null,initComponent:function(){if(GeoExt.VectorLegend.superclass.initComponent.call(this),this.layerRecord&&(this.layer=this.layerRecord.getLayer(),this.layer.map&&(this.map=this.layer.map,this.currentScaleDenominator=this.layer.map.getScale(),this.layer.map.events.on({zoomend:this.onMapZoom,scope:this}))),!this.symbolType)if(this.feature)this.symbolType=this.symbolTypeFromFeature(this.feature);else if(this.layer)if(this.layer.features.length>0){for(var a,b=0,c=this.layer.features.length;b<c;b++)if(null!==this.layer.features[b].geometry){a=this.layer.features[b].clone();break}a.attributes={},this.feature=a,this.symbolType=this.symbolTypeFromFeature(this.feature)}else this.layer.events.on({featuresadded:this.onFeaturesAdded,scope:this});this.layer&&this.feature&&!this.rules&&this.setRules(),this.rulesContainer=new Ext.Container({autoEl:{}}),this.add(this.rulesContainer),this.addEvents("titleclick","symbolclick","ruleclick","ruleselected","ruleunselected","rulemoved"),this.update()},onMapZoom:function(){this.setCurrentScaleDenominator(this.layer.map.getScale())},symbolTypeFromFeature:function(a){var b=a.geometry.CLASS_NAME.match(/Point|Line|Polygon/);return b&&b[0]||"Point"},onFeaturesAdded:function(a){for(var b=0,c=a.features.length;b<c;++b)if(null!==a.features[b].geometry){this.layer.events.un({featuresadded:this.onFeaturesAdded,scope:this});var d=a.features[b].clone();d.attributes={},this.feature=d,this.symbolType=this.symbolTypeFromFeature(this.feature),this.rules||this.setRules(),this.update();break}},setRules:function(){var a=this.layer.styleMap&&this.layer.styleMap.styles.default;a||(a=new OpenLayers.Style),0===a.rules.length?this.rules=[new OpenLayers.Rule({title:a.title,symbolizer:a.createSymbolizer(this.feature)})]:this.rules=a.rules},setCurrentScaleDenominator:function(a){a!==this.currentScaleDenominator&&(this.currentScaleDenominator=a,this.update())},getRuleEntry:function(a){return this.rulesContainer.items.get(this.rules.indexOf(a))},addRuleEntry:function(a,b){this.rulesContainer.add(this.createRuleEntry(a)),b||this.doLayout()},removeRuleEntry:function(a,b){var c=this.getRuleEntry(a);c&&(this.rulesContainer.remove(c),b||this.doLayout())},selectRuleEntry:function(a){var b=a!=this.selectedRule;if(this.selectedRule&&this.unselect(),b){var c=this.getRuleEntry(a);c.body.addClass("x-grid3-row-selected"),this.selectedRule=a,this.fireEvent("ruleselected",this,a)}},unselect:function(){this.rulesContainer.items.each(function(a,b){this.rules[b]==this.selectedRule&&(a.body.removeClass("x-grid3-row-selected"),this.selectedRule=null,this.fireEvent("ruleunselected",this,this.rules[b]))},this)},createRuleEntry:function(a){var b=!0;return null!=this.currentScaleDenominator&&(a.minScaleDenominator&&(b=b&&this.currentScaleDenominator>=a.minScaleDenominator),a.maxScaleDenominator&&(b=b&&this.currentScaleDenominator<a.maxScaleDenominator)),{xtype:"panel",layout:"column",border:!1,hidden:!b,bodyStyle:this.selectOnClick?{cursor:"pointer"}:void 0,defaults:{border:!1},items:[this.createRuleRenderer(a),this.createRuleTitle(a)],listeners:{render:function(b){this.selectOnClick&&b.getEl().on({click:function(b){this.selectRuleEntry(a)},scope:this}),1==this.enableDD&&this.addDD(b)},scope:this}}},createRuleRenderer:function(a){var c,d,e,f,g,b=[this.symbolType,"Point","Line","Polygon"],h=a.symbolizers;if(h){var j;a:for(e=0,g=b.length;e<g;++e)if(c=b[e],j=OpenLayers.Symbolizer[c])for(var k=0,l=h.length;k<l;++k)if(h[k]instanceof j){d=!0;break a}}else{var i=a.symbolizer;for(e=0,f=b.length;e<f;++e)if(c=b[e],i[c]){i=i[c],d=!0;break}h=[i]}return{xtype:"gx_renderer",labelText:"Ab",symbolType:d?c:this.symbolType,symbolizers:h,style:this.clickableSymbol?{cursor:"pointer"}:void 0,listeners:{click:function(){this.clickableSymbol&&(this.fireEvent("symbolclick",this,a),this.fireEvent("ruleclick",this,a))},scope:this}}},createRuleTitle:function(a){return{cls:"x-form-item",style:"padding: 0.2em 0.5em 0;",bodyStyle:Ext.applyIf({background:"transparent"},this.clickableTitle?{cursor:"pointer"}:void 0),html:this.getRuleTitle(a),listeners:{render:function(b){this.clickableTitle&&b.getEl().on({click:function(){this.fireEvent("titleclick",this,a),this.fireEvent("ruleclick",this,a)},scope:this})},scope:this}}},addDD:function(a){var b=a.ownerCt,c=this;new Ext.dd.DragSource(a.getEl(),{ddGroup:b.id,onDragOut:function(a,b){var c=Ext.getCmp(b);return c.removeClass("gx-ruledrag-insert-above"),c.removeClass("gx-ruledrag-insert-below"),Ext.dd.DragZone.prototype.onDragOut.apply(this,arguments)},onDragEnter:function(c,d){var f,e=Ext.getCmp(d),g=b.items.indexOf(a),h=b.items.indexOf(e);return g>h?f="gx-ruledrag-insert-above":g<h&&(f="gx-ruledrag-insert-below"),f&&e.addClass(f),Ext.dd.DragZone.prototype.onDragEnter.apply(this,arguments)},onDragDrop:function(d,e){return c.moveRule(b.items.indexOf(a),b.items.indexOf(Ext.getCmp(e))),Ext.dd.DragZone.prototype.onDragDrop.apply(this,arguments)},getDragData:function(a){var b=a.getTarget(".x-column-inner");if(b){var c=b.cloneNode(!0);return c.id=Ext.id(),{sourceEl:b,repairXY:Ext.fly(b).getXY(),ddel:c}}}}),new Ext.dd.DropTarget(a.getEl(),{ddGroup:b.id,notifyDrop:function(){return!0}})},update:function(){GeoExt.VectorLegend.superclass.update.apply(this,arguments);var a,b;if(this.symbolType&&this.rules){if(this.rulesContainer.items){var c;for(a=this.rulesContainer.items.length-1;a>=0;--a)c=this.rulesContainer.getComponent(a),this.rulesContainer.remove(c,!0)}for(a=0,b=this.rules.length;a<b;++a)this.addRuleEntry(this.rules[a],!0);this.doLayout(),this.selectedRule&&this.getRuleEntry(this.selectedRule).body.addClass("x-grid3-row-selected")}},updateRuleEntry:function(a){var b=this.getRuleEntry(a);b&&(b.removeAll(),b.add(this.createRuleRenderer(a)),b.add(this.createRuleTitle(a)),b.doLayout())},moveRule:function(a,b){var c=this.rules[a];this.rules.splice(a,1),this.rules.splice(b,0,c),this.update(),this.fireEvent("rulemoved",this,c)},getRuleTitle:function(a){var b=a.title||a.name||"";return!b&&this.untitledPrefix&&(b=this.untitledPrefix+(this.rules.indexOf(a)+1)),b},beforeDestroy:function(){this.layer&&(this.layer.events&&this.layer.events.un({featuresadded:this.onFeaturesAdded,scope:this}),this.layer.map&&this.layer.map.events&&this.layer.map.events.un({zoomend:this.onMapZoom,scope:this})),delete this.layer,delete this.map,delete this.rules,GeoExt.VectorLegend.superclass.beforeDestroy.apply(this,arguments)},onStoreRemove:function(a,b,c){b.getLayer()===this.layer&&this.map&&this.map.events&&this.map.events.un({zoomend:this.onMapZoom,scope:this})},onStoreAdd:function(a,b,c){for(var d=0,e=b.length;d<e;d++){var f=b[d];f.getLayer()===this.layer&&this.layer.map&&this.layer.map.events&&this.layer.map.events.on({zoomend:this.onMapZoom,scope:this})}}}),GeoExt.VectorLegend.supports=function(a){return a.getLayer()instanceof OpenLayers.Layer.Vector?1:0},GeoExt.LayerLegend.types.gx_vectorlegend=GeoExt.VectorLegend,Ext.reg("gx_vectorlegend",GeoExt.VectorLegend),Ext.namespace("GeoExt"),GeoExt.FeatureRenderer=Ext.extend(Ext.BoxComponent,{feature:void 0,symbolizers:[OpenLayers.Feature.Vector.style.default],symbolType:"Polygon",labelText:null,resolution:1,minWidth:20,minHeight:20,renderers:["SVG","VML","Canvas"],rendererOptions:null,pointFeature:void 0,lineFeature:void 0,polygonFeature:void 0,textFeature:void 0,renderer:null,initComponent:function(){GeoExt.FeatureRenderer.superclass.initComponent.apply(this,arguments),Ext.applyIf(this,{pointFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(0,0)),lineFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-8,-3),new OpenLayers.Geometry.Point(-3,3),new OpenLayers.Geometry.Point(3,-3),new OpenLayers.Geometry.Point(8,3)])),polygonFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(-8,-4),new OpenLayers.Geometry.Point(-6,-6),new OpenLayers.Geometry.Point(6,-6),new OpenLayers.Geometry.Point(8,-4),new OpenLayers.Geometry.Point(8,4),new OpenLayers.Geometry.Point(6,6),new OpenLayers.Geometry.Point(-6,6),new OpenLayers.Geometry.Point(-8,4)])])),textFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(0,0))}),this.feature||this.setFeature(null,{draw:!1}),this.addEvents("click")},initCustomEvents:function(){this.clearCustomEvents(),this.el.on("click",this.onClick,this)},clearCustomEvents:function(){this.el&&this.el.removeAllListeners&&this.el.removeAllListeners()},onClick:function(){this.fireEvent("click",this)},onRender:function(a,b){this.el||(this.el=document.createElement("div"),this.el.id=this.getId()),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer.map={getResolution:function(){return this.resolution}.createDelegate(this)},GeoExt.FeatureRenderer.superclass.onRender.apply(this,arguments),this.drawFeature()},afterRender:function(){GeoExt.FeatureRenderer.superclass.afterRender.apply(this,arguments),this.initCustomEvents()},onResize:function(a,b){this.setRendererDimensions(),GeoExt.FeatureRenderer.superclass.onResize.apply(this,arguments)},setRendererDimensions:function(){var a=this.feature.geometry.getBounds(),b=a.getWidth(),c=a.getHeight(),d=this.initialConfig.resolution;d||(d=Math.max(b/this.width||0,c/this.height||0)||1),this.resolution=d;var e=Math.max(this.width||this.minWidth,b/d),f=Math.max(this.height||this.minHeight,c/d),g=a.getCenterPixel(),h=e*d/2,i=f*d/2,j=new OpenLayers.Bounds(g.x-h,g.y-i,g.x+h,g.y+i);this.renderer.setSize(new OpenLayers.Size(Math.round(e),Math.round(f))),this.renderer.setExtent(j,!0)},assignRenderer:function(){for(var a=0,b=this.renderers.length;a<b;++a){var c=OpenLayers.Renderer[this.renderers[a]];if(c&&c.prototype.supported()){this.renderer=new c(this.el,this.rendererOptions);break}}},setSymbolizers:function(a,b){this.symbolizers=a,b&&!b.draw||this.drawFeature()},setSymbolType:function(a,b){this.symbolType=a,this.setFeature(null,b)},setFeature:function(a,b){this.feature=a||this[this.symbolType.toLowerCase()+"Feature"],b&&!b.draw||this.drawFeature()},drawFeature:function(){this.renderer.clear(),this.setRendererDimensions();for(var a,b,c,d=0,e=this.symbolizers.length;d<e;++d)a=this.symbolizers[d],b=this.feature,a instanceof OpenLayers.Symbolizer?(a=a.clone(),OpenLayers.Symbolizer.Text&&a instanceof OpenLayers.Symbolizer.Text&&a.graphic===!1&&(a.fill=a.stroke=!1),this.initialConfig.feature||(c=a.CLASS_NAME.split(".").pop().toLowerCase(),b=this[c+"Feature"])):a=Ext.apply({},a),void 0!==a.label&&null!==this.labelText&&(a.label=this.labelText),this.renderer.drawFeature(b.clone(),a)},update:function(a){a=a||{},a.feature?this.setFeature(a.feature,{draw:!1}):a.symbolType&&this.setSymbolType(a.symbolType,{draw:!1}),a.symbolizers&&this.setSymbolizers(a.symbolizers,{draw:!1}),this.drawFeature()},beforeDestroy:function(){this.clearCustomEvents(),this.renderer&&this.renderer.destroy()}}),Ext.reg("gx_renderer",GeoExt.FeatureRenderer),function(){var a=function(a,b){return function(c){b&&b[a]&&b[a].call(b.scope||window,Ext.applyIf({argument:b.argument},c))}};Ext.apply(Ext.lib.Ajax,{request:function(b,c,d,e,f){f=f||{},b=b||f.method;var g=f.headers;return f.xmlData?(g&&g["Content-Type"]||(g=g||{},g["Content-Type"]="text/xml"),b=b||"POST",e=f.xmlData):f.jsonData&&(g&&g["Content-Type"]||(g=g||{},g["Content-Type"]="application/json"),b=b||"POST",e="object"==typeof f.jsonData?Ext.encode(f.jsonData):f.jsonData),!b||"post"!=b.toLowerCase()||!f.form&&!f.params||g&&g["Content-Type"]||(g=g||{},g["Content-Type"]="application/x-www-form-urlencoded"),OpenLayers.Request.issue({success:a("success",d),failure:a("failure",d),method:b,headers:g,data:e,url:c})},isCallInProgress:function(a){return!0},abort:function(a){a.abort()}})}(),function(){Ext.util.Observable.observeClass(Ext.form.TextField),Ext.form.TextField.on("specialkey",function(a,b){a.hasFocus&&b.getKey()===b.ENTER&&a.blur.defer(10,a)})}(),Ext.namespace("gxp"),gxp.util={_uniqueNames:{},getOGCExceptionText:function(a){var b;return a&&a.exceptions?(b=[],Ext.each(a.exceptions,function(a){Ext.each(a.texts,function(a){b.push(a)})}),b=b.join("\n")):b="Unknown error (no exception report).",b},dispatch:function(a,b,c){function g(){++e,e===d&&b.call(c,f)}function h(b){window.setTimeout(function(){a[b].apply(c,[g,f])})}b=b||Ext.emptyFn,c=c||this;for(var d=a.length,e=0,f={},i=0;i<d;++i)h(i)},uniqueName:function(a,b){b=b||" ";var c=new RegExp(b+"[0-9]*$"),d=a.replace(c,""),e=c.exec(a),f=void 0!==this._uniqueNames[d]?this._uniqueNames[d]:e instanceof Array?Number(e[0]):void 0,g=d;return void 0!==f&&(f++,g+=b+f),this._uniqueNames[d]=f||0,g},getAbsoluteUrl:function(a){var b;return Ext.isIE6||Ext.isIE7||Ext.isIE8?(b=document.createElement("<a href='"+a+"'/>"),b.style.display="none",document.body.appendChild(b),b.href=b.href,document.body.removeChild(b)):(b=document.createElement("a"),b.href=a),b.href},throttle:function(){var a=function(a,b,c){var d,e,f,g,h=function(){a.apply(c||this,f),d=(new Date).getTime()};return function(){e=(new Date).getTime()-d,f=arguments,clearTimeout(g),!d||e>=b?h():g=setTimeout(h,b-e)}};return function(b,c,d){return a(b,c,d)}}(),md5:function(){function f(a,b,c){return a&b|~a&c}function g(a,b,c){return a&c|b&~c}function h(a,b,c){return a^b^c}function i(a,b,c){return b^(a|~c)}function k(a){return String.fromCharCode(255&a)+String.fromCharCode(a>>>8&255)+String.fromCharCode(a>>>16&255)+String.fromCharCode(a>>>24&255)}function m(a){for(;a<0;)a+=4294967296;for(;a>4294967295;)a-=4294967296;return a}function n(b,c,d,e,f){var g,h,i,j,k,l,n,o,p;g=e[0],h=e[1],i=e[2],j=e[3],k=f[0],l=f[1],n=f[2],p=d(c[h],c[i],c[j]),o=c[g]+p+b[k]+a[n],o=m(o),o=o<<l|o>>>32-l,o+=c[h],c[g]=m(o)}function o(a){var b,c,d,e,f,g,h,i,l,o,p,q,r;if(d=[1732584193,4023233417,2562383102,271733878],f=a.length,g=63&f,h=g<56?56-g:120-g,h>0)for(a+="",o=0;o<h-1;o++)a+="\0";for(a+=k(8*f),a+=k(0),f+=h+8,b=[0,1,2,3],c=[16],e=[4],q=0;q<f;q+=64){for(o=0,p=q;o<16;o++,p+=4)c[o]=a.charCodeAt(p)|a.charCodeAt(p+1)<<8|a.charCodeAt(p+2)<<16|a.charCodeAt(p+3)<<24;for(o=0;o<4;o++)e[o]=d[o];for(o=0;o<4;o++)for(i=j[o][0],l=j[o][1],p=0;p<16;p++)n(c,e,i,b,l[p]),r=b[0],b[0]=b[3],b[3]=b[2],b[2]=b[1],b[1]=r;for(o=0;o<4;o++)d[o]+=e[o],d[o]=m(d[o])}return k(d[0])+k(d[1])+k(d[2])+k(d[3])}function p(a){var b,c,d,e;for(e=o(a),c="",b=0;b<16;b++)d=e.charCodeAt(b),c+="0123456789abcdef".charAt(d>>4&15),c+="0123456789abcdef".charAt(15&d);return c}var a=[0,3614090360,3905402710,606105819,3250441966,4118548399,1200080426,2821735955,4249261313,1770035416,2336552879,4294925233,2304563134,1804603682,4254626195,2792965006,1236535329,4129170786,3225465664,643717713,3921069994,3593408605,38016083,3634488961,3889429448,568446438,3275163606,4107603335,1163531501,2850285829,4243563512,1735328473,2368359562,4294588738,2272392833,1839030562,4259657740,2763975236,1272893353,4139469664,3200236656,681279174,3936430074,3572445317,76029189,3654602809,3873151461,530742520,3299628645,4096336452,1126891415,2878612391,4237533241,1700485571,2399980690,4293915773,2240044497,1873313359,4264355552,2734768916,1309151649,4149444226,3174756917,718787259,3951481745],b=[[0,7,1],[1,12,2],[2,17,3],[3,22,4],[4,7,5],[5,12,6],[6,17,7],[7,22,8],[8,7,9],[9,12,10],[10,17,11],[11,22,12],[12,7,13],[13,12,14],[14,17,15],[15,22,16]],c=[[1,5,17],[6,9,18],[11,14,19],[0,20,20],[5,5,21],[10,9,22],[15,14,23],[4,20,24],[9,5,25],[14,9,26],[3,14,27],[8,20,28],[13,5,29],[2,9,30],[7,14,31],[12,20,32]],d=[[5,4,33],[8,11,34],[11,16,35],[14,23,36],[1,4,37],[4,11,38],[7,16,39],[10,23,40],[13,4,41],[0,11,42],[3,16,43],[6,23,44],[9,4,45],[12,11,46],[15,16,47],[2,23,48]],e=[[0,6,49],[7,10,50],[14,15,51],[5,21,52],[12,6,53],[3,10,54],[10,15,55],[1,21,56],[8,6,57],[15,10,58],[6,15,59],[13,21,60],[4,6,61],[11,10,62],[2,15,63],[9,21,64]],j=[[f,b],[g,c],[h,d],[i,e]];
return function(a){return p(a)}}()},Ext.namespace("gxp.menu"),gxp.menu.LayerMenu=Ext.extend(Ext.menu.Menu,{layerText:"Layer",layers:null,initComponent:function(){gxp.menu.LayerMenu.superclass.initComponent.apply(this,arguments),this.layers.on("add",this.onLayerAdd,this),this.onLayerAdd()},onRender:function(a,b){gxp.menu.LayerMenu.superclass.onRender.apply(this,arguments)},beforeDestroy:function(){this.layers&&this.layers.on&&this.layers.un("add",this.onLayerAdd,this),delete this.layers,gxp.menu.LayerMenu.superclass.beforeDestroy.apply(this,arguments)},onLayerAdd:function(){this.removeAll(),this.add({iconCls:"gxp-layer-visibility",text:this.layerText,canActivate:!1},"-"),this.layers.each(function(a){var b=a.getLayer();if(b.displayInLayerSwitcher){var c=new Ext.menu.CheckItem({text:a.get("title"),checked:a.getLayer().getVisibility(),group:a.get("group"),listeners:{checkchange:function(b,c){a.getLayer().setVisibility(c)}}});this.items.getCount()>2?this.insert(2,c):this.add(c)}},this)}}),Ext.reg("gxp_layermenu",gxp.menu.LayerMenu),Ext.namespace("gxp"),gxp.CrumbPanel=Ext.extend(Ext.TabPanel,{widths:null,enableTabScroll:!0,initComponent:function(){gxp.CrumbPanel.superclass.initComponent.apply(this,arguments),this.widths={}},onBeforeAdd:function(a){gxp.CrumbPanel.superclass.onBeforeAdd.apply(this,arguments),a.shortTitle&&(a.title=a.shortTitle)},onAdd:function(a){gxp.CrumbPanel.superclass.onAdd.apply(this,arguments),this.setActiveTab(this.items.getCount()-1),a.on("hide",this.onCmpHide,this),a.getEl().dom.style.display=""},onRemove:function(a){gxp.CrumbPanel.superclass.onRemove.apply(this,arguments),a.un("hide",this.onCmpHide,this);var b=this.widths[this.get(this.items.getCount()-1).id];b&&b<this.getWidth()&&(this.setWidth(b),this.ownerCt&&this.ownerCt.syncSize()),a.getEl().dom.style.display="none",this.activeTab.doLayout()},onRender:function(a){this.initialConfig.itemTpl||(this.itemTpl=new Ext.Template('<li class="{cls} gxp-crumb" id="{id}"><div class="gxp-crumb-separator">»</div>','<a class="x-tab-right" href="#"><em class="x-tab-left">','<span class="x-tab-strip-inner"><span class="x-tab-strip-text {iconCls}">{text}</span></span>',"</em></a></li>")),gxp.CrumbPanel.superclass.onRender.apply(this,arguments),this.getEl().down("div").addClass("gxp-crumbpanel-header")},onCmpHide:function(a){var b=this.items.getCount()-1;this.items.indexOf(a)===b&&this.setActiveTab(this.get(--b))},setActiveTab:function(a){var b;if(Ext.isNumber(a)?(b=a,a=this.get(b)):b=this.items.indexOf(a),~b){var c,d;for(d=this.items.getCount()-1;d>b;--d)c=this.get(d),this.remove(c,"hide"!==c.closeAction)}var e=a.initialConfig.minWidth||a.initialConfig.width,f=this.getWidth();e>f&&(this.widths[this.get(b-1).id]=f,this.setWidth(e),this.ownerCt&&this.ownerCt.syncSize()),gxp.CrumbPanel.superclass.setActiveTab.apply(this,arguments)}}),Ext.reg("gxp_crumbpanel",gxp.CrumbPanel),Ext.namespace("gxp"),gxp.LayerUploadPanel=Ext.extend(Ext.FormPanel,{titleLabel:"Title",titleEmptyText:"Layer title",abstractLabel:"Description",abstractEmptyText:"Layer description",fileLabel:"Data",fieldEmptyText:"Browse for data archive...",uploadText:"Upload",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",waitMsgText:"Uploading your data...",invalidFileExtensionText:"File extension must be one of: ",optionsText:"Options",workspaceLabel:"Workspace",workspaceEmptyText:"Default workspace",dataStoreLabel:"Store",dataStoreEmptyText:"Choose a store",dataStoreNewText:"Create new store",crsLabel:"CRS",crsEmptyText:"Coordinate Reference System ID",invalidCrsText:"CRS identifier should be an EPSG code (e.g. EPSG:4326)",fileUpload:!0,validFileExtensions:[".zip",".tif",".tiff",".gz",".tar.bz2",".tar",".tgz",".tbz2"],defaultDataStore:null,constructor:function(a){a.errorReader={read:a.handleUploadResponse||this.handleUploadResponse.createDelegate(this)},gxp.LayerUploadPanel.superclass.constructor.call(this,a)},selectedWorkspace:null,initComponent:function(){this.items=[{xtype:"textfield",name:"title",fieldLabel:this.titleLabel,emptyText:this.titleEmptyText,allowBlank:!0},{xtype:"textarea",name:"abstract",fieldLabel:this.abstractLabel,emptyText:this.abstractEmptyText,allowBlank:!0},{xtype:"fileuploadfield",id:"file",anchor:"90%",emptyText:this.fieldEmptyText,fieldLabel:this.fileLabel,name:"file",buttonText:"",buttonCfg:{iconCls:"gxp-icon-filebrowse"},listeners:{fileselected:function(a,b){a.setValue(b.split(/[\/\\]/).pop())}},validator:this.fileNameValidator.createDelegate(this)},{xtype:"fieldset",ref:"optionsFieldset",title:this.optionsText,checkboxToggle:!0,collapsed:!0,hidden:void 0!=this.workspace&&void 0!=this.store&&void 0!=this.crs,hideMode:"offsets",defaults:{anchor:"97%"},items:[this.createWorkspacesCombo(),this.createDataStoresCombo(),{xtype:"textfield",name:"nativeCRS",fieldLabel:this.crsLabel,emptyText:this.crsEmptyText,allowBlank:!0,regex:/^epsg:\d+$/i,regexText:this.invalidCrsText}],listeners:{collapse:function(a){a.items.each(function(a){a.reset()})}}}],this.buttons=[{text:this.uploadText,handler:function(){var a=this.getForm();if(a.isValid()){var b=a.getFieldValues(),c={import:{}};b.workspace&&(c.import.targetWorkspace={workspace:{name:b.workspace}}),Ext.isEmpty(b.store)&&this.defaultDataStore?c.import.targetStore={dataStore:{name:this.defaultDataStore}}:Ext.isEmpty(b.store)||b.store===this.dataStoreNewText||(c.import.targetStore={dataStore:{name:b.store}}),Ext.Ajax.request({url:this.getUploadUrl(),method:"POST",jsonData:c,success:function(b){this._import=b.getResponseHeader("Location"),this.optionsFieldset.expand(),a.submit({url:this._import+"/tasks?expand=all",waitMsg:this.waitMsgText,waitMsgTarget:!0,reset:!0,scope:this})},scope:this})}},scope:this}],this.addEvents("workspaceselected","datastoreselected","uploadcomplete"),this.getDefaultDataStore("default"),gxp.LayerUploadPanel.superclass.initComponent.call(this)},fileNameValidator:function(a){for(var c,b=!1,e=(a.length,0),f=this.validFileExtensions.length;e<f;++e)if(c=this.validFileExtensions[e],a.slice(-c.length).toLowerCase()===c){b=!0;break}return b||this.invalidFileExtensionText+"<br/>"+this.validFileExtensions.join(", ")},createWorkspacesCombo:function(){return{xtype:"combo",name:"workspace",ref:"../workspace",fieldLabel:this.workspaceLabel,store:new Ext.data.JsonStore({url:this.getWorkspacesUrl(),autoLoad:!0,root:"workspaces.workspace",fields:["name","href"]}),displayField:"name",valueField:"name",mode:"local",allowBlank:!0,triggerAction:"all",forceSelection:!0,listeners:{select:function(a,b,c){this.getDefaultDataStore(b.get("name")),this.fireEvent("workspaceselected",this,b)},scope:this}}},createDataStoresCombo:function(){var a=new Ext.data.JsonStore({autoLoad:!1,root:"dataStores.dataStore",fields:["name","href"]});this.on({workspaceselected:function(d,e){c.reset();var f=e.get("href");a.removeAll(),a.proxy=new Ext.data.HttpProxy({url:f.split(".json").shift()+"/datastores.json"}),a.proxy.on("loadexception",b,this),a.load()},scope:this});var b=function(){var c={name:this.dataStoreNewText},d=new a.recordType(c);a.insert(0,d),a.proxy&&a.proxy.un("loadexception",b,this)};a.on("load",b,this);var c=new Ext.form.ComboBox({name:"store",ref:"../dataStore",emptyText:this.dataStoreEmptyText,fieldLabel:this.dataStoreLabel,store:a,displayField:"name",valueField:"name",mode:"local",allowBlank:!0,triggerAction:"all",forceSelection:!0,listeners:{select:function(a,b,c){this.fireEvent("datastoreselected",this,b)},scope:this}});return c},getDefaultDataStore:function(a){Ext.Ajax.request({url:this.url+"/workspaces/"+a+"/datastores/default.json",callback:function(b,c,d){if(this.defaultDataStore=null,200===d.status){var e=Ext.decode(d.responseText);if("default"===a&&e.dataStore&&e.dataStore.workspace){this.workspace.setValue(e.dataStore.workspace.name);var f=this.workspace.store,g={name:e.dataStore.workspace.name,href:e.dataStore.workspace.href},h=new f.recordType(g);this.fireEvent("workspaceselected",this,h)}e.dataStore&&e.dataStore.enabled===!0&&!/file/i.test(e.dataStore.type)&&(this.defaultDataStore=e.dataStore.name,this.dataStore.setValue(this.defaultDataStore))}},scope:this})},getUploadUrl:function(){return this.url+"/imports"},getWorkspacesUrl:function(){return this.url+"/workspaces.json"},handleUploadResponse:function(a){var c,d,e,f,g,b=this.parseResponseText(a.responseText),h=this.getForm().getFieldValues(),i=!!b;if(b)if("string"==typeof b)i=!1,f=b;else if(d=b.tasks||[b.task],0===d.length)i=!1,f="Upload contains no suitable files.";else for(g=d.length-1;g>=0;--g)e=d[g],e?"NO_FORMAT"===e.state?(i=!1,f="Upload contains no suitable files."):"NO_CRS"!==e.state||h.nativeCRS||(i=!1,f="Coordinate Reference System (CRS) of source file "+e.data.file+" could not be determined. Please specify manually."):(i=!1,f="Unknown upload error");if(i){var j=!!(h.title||h.abstract||h.nativeCRS);if(j&&d[0].target.dataStore){this.waitMsg=new Ext.LoadMask((this.ownerCt||this).getEl(),{msg:this.processingUploadText}),this.waitMsg.show();var k={title:h.title||void 0,abstract:h.abstract||void 0,srs:h.nativeCRS||void 0};Ext.Ajax.request({method:"PUT",url:d[0].layer.href,jsonData:k,success:this.finishUpload,failure:function(a){this.waitMsg&&this.waitMsg.hide();var b=[];try{var c=Ext.decode(a.responseText);if(c.errors)for(var d=0,e=c.errors.length;d<e;++d)b.push({id:~c.errors[d].indexOf("SRS")?"nativeCRS":"file",msg:c.errors[d]})}catch(c){b.push({id:"file",msg:a.responseText})}this.getForm().markInvalid(b)},scope:this})}else this.finishUpload()}else c=[{data:{id:"file",msg:f||this.uploadFailedText}}];return{success:!1,records:c}},finishUpload:function(){Ext.Ajax.request({method:"POST",url:this._import,failure:this.handleFailure,success:this.handleUploadSuccess,scope:this})},parseResponseText:function(a){var b;try{b=Ext.decode(a)}catch(d){var c=a.match(/^\s*<pre[^>]*>(.*)<\/pre>\s*/);if(c)try{b=Ext.decode(c[1])}catch(a){b=c[1]}}return b},handleUploadSuccess:function(a){Ext.Ajax.request({method:"GET",url:this._import+"?expand=all",failure:this.handleFailure,success:function(a){this.waitMsg&&this.waitMsg.hide(),this.getForm().reset();var b=Ext.decode(a.responseText);this.fireEvent("uploadcomplete",this,b),delete this._import},scope:this})},handleFailure:function(a){a&&1223===a.status?this.handleUploadSuccess(a):(this.waitMsg&&this.waitMsg.hide(),this.getForm().markInvalid([{file:this.uploadFailedText}]))}}),Ext.reg("gxp_layeruploadpanel",gxp.LayerUploadPanel),OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(a){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){var b,c,d;a=a.replace(/[\n\r]/g," ");var e=this.regExes.typeStr.exec(a);if(e&&(c=e[1].toLowerCase(),d=e[2],this.parse[c]&&(b=this.parse[c].apply(this,[d])),this.internalProjection&&this.externalProjection))if(b&&"OpenLayers.Feature.Vector"==b.CLASS_NAME)b.geometry.transform(this.externalProjection,this.internalProjection);else if(b&&"geometrycollection"!=c&&"object"==typeof b)for(var f=0,g=b.length;f<g;f++){var h=b[f];h.geometry.transform(this.externalProjection,this.internalProjection)}return b},write:function(a){var b,c,d;a.constructor==Array?(b=a,d=!0):(b=[a],d=!1);var e=[];d&&e.push("GEOMETRYCOLLECTION(");for(var f=0,g=b.length;f<g;++f)d&&f>0&&e.push(","),c=b[f].geometry,e.push(this.extractGeometry(c));return d&&e.push(")"),e.join("")},extractGeometry:function(a){var b=a.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[b])return null;this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var c="collection"==b?"GEOMETRYCOLLECTION":b.toUpperCase(),d=c+"("+this.extract[b].apply(this,[a])+")";return d},extract:{point:function(a){return a.x+" "+a.y},multipoint:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push("("+this.extract.point.apply(this,[a.components[c]])+")");return b.join(",")},linestring:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b.join(",")},multilinestring:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")");return b.join(",")},polygon:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")");return b.join(",")},multipolygon:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push("("+this.extract.polygon.apply(this,[a.components[c]])+")");return b.join(",")},collection:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extractGeometry.apply(this,[a.components[c]]));return b.join(",")}},parse:{point:function(a){var b=OpenLayers.String.trim(a).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b[0],b[1]))},multipoint:function(a){for(var b,c=OpenLayers.String.trim(a).split(","),d=[],e=0,f=c.length;e<f;++e)b=c[e].replace(this.regExes.trimParens,"$1"),d.push(this.parse.point.apply(this,[b]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(d))},linestring:function(a){for(var b=OpenLayers.String.trim(a).split(","),c=[],d=0,e=b.length;d<e;++d)c.push(this.parse.point.apply(this,[b[d]]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(c))},multilinestring:function(a){for(var b,c=OpenLayers.String.trim(a).split(this.regExes.parenComma),d=[],e=0,f=c.length;e<f;++e)b=c[e].replace(this.regExes.trimParens,"$1"),d.push(this.parse.linestring.apply(this,[b]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(d))},polygon:function(a){for(var b,c,d,e=OpenLayers.String.trim(a).split(this.regExes.parenComma),f=[],g=0,h=e.length;g<h;++g)b=e[g].replace(this.regExes.trimParens,"$1"),c=this.parse.linestring.apply(this,[b]).geometry,d=new OpenLayers.Geometry.LinearRing(c.components),f.push(d);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(f))},multipolygon:function(a){for(var b,c=OpenLayers.String.trim(a).split(this.regExes.doubleParenComma),d=[],e=0,f=c.length;e<f;++e)b=c[e].replace(this.regExes.trimParens,"$1"),d.push(this.parse.polygon.apply(this,[b]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(d))},geometrycollection:function(a){a=a.replace(/,\s*([A-Za-z])/g,"|$1");for(var b=OpenLayers.String.trim(a).split("|"),c=[],d=0,e=b.length;d<e;++d)c.push(OpenLayers.Format.WKT.prototype.read.apply(this,[b[d]]));return c}},CLASS_NAME:"OpenLayers.Format.WKT"}),OpenLayers.Format.CQL=function(){function j(a,b){return b instanceof RegExp?b.exec(a):b(a)}function k(a,c){var d,e,f=c.length;for(d=0;d<f;d++){e=c[d];var g=b[e],h=j(a,g);if(h){var i=h[0],k=a.substr(i.length).replace(/^\s*/,"");return{type:e,text:i,remainder:k}}}var l="ERROR: In parsing: ["+a+"], expected one of: ";for(d=0;d<f;d++)e=c[d],l+="\n    "+e+": "+b[e];throw new Error(l)}function l(a){var d,b=[],e=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{if(d=k(a,e),a=d.remainder,e=c[d.type],"END"!=d.type&&!e)throw new Error("No follows list for "+d.type);b.push(d)}while("END"!=d.type);return b}function m(a){function i(){var a=c.pop();switch(a.type){case"LOGICAL":var b=i(),e=i();return new OpenLayers.Filter.Logical({filters:[e,b],type:f[a.text.toUpperCase()]});case"NOT":var g=i();return new OpenLayers.Filter.Logical({filters:[g],type:OpenLayers.Filter.Logical.NOT});case"BETWEEN":var h,j,k;return c.pop(),j=i(),h=i(),k=i(),new OpenLayers.Filter.Comparison({property:k,lowerBoundary:h,upperBoundary:j,type:OpenLayers.Filter.Comparison.BETWEEN});case"COMPARISON":var l=i(),k=i();return new OpenLayers.Filter.Comparison({property:k,value:l,type:d[a.text.toUpperCase()]});case"IS_NULL":var k=i();return new OpenLayers.Filter.Comparison({property:k,type:d[a.text.toUpperCase()]});case"VALUE":var m=a.text.match(/^'(.*)'$/);return m?m[1].replace(/''/g,"'"):Number(a.text);case"SPATIAL":switch(a.text.toUpperCase()){case"BBOX":var n=i(),o=i(),p=i(),q=i(),r=i();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:r,value:OpenLayers.Bounds.fromArray([q,p,o,n])});case"INTERSECTS":var l=i(),k=i();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:k,value:l});case"WITHIN":var l=i(),k=i();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:k,value:l});case"CONTAINS":var l=i(),k=i();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:k,value:l});case"DWITHIN":var s=i(),l=i(),k=i();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:l,property:k,distance:Number(s)})}case"GEOMETRY":return OpenLayers.Geometry.fromWKT(a.text);default:return a.text}}for(var b=[],c=[];a.length;){var e=a.shift();switch(e.type){case"PROPERTY":case"GEOMETRY":case"VALUE":c.push(e);break;case"COMPARISON":case"BETWEEN":case"IS_NULL":case"LOGICAL":for(var g=h[e.type];b.length>0&&h[b[b.length-1].type]<=g;)c.push(b.pop());b.push(e);break;case"SPATIAL":case"NOT":case"LPAREN":b.push(e);break;case"RPAREN":for(;b.length>0&&"LPAREN"!=b[b.length-1].type;)c.push(b.pop());b.pop(),b.length>0&&"SPATIAL"==b[b.length-1].type&&c.push(b.pop());case"COMMA":case"END":break;default:throw new Error("Unknown token type "+e.type)}}for(;b.length>0;)c.push(b.pop());var j=i();if(c.length>0){for(var k="Remaining tokens after building AST: \n",l=c.length-1;l>=0;l--)k+=c[l].type+": "+c[l].text+"\n";throw new Error(k)}return j}var i,b={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,IS_NULL:/^IS NULL/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('([^']|'')*'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(a){var b=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(a);if(b){var c=a.length,d=a.indexOf("(",b[0].length);if(d>-1)for(var e=1;d<c&&e>0;)switch(d++,a.charAt(d)){case"(":e++;break;case")":e--}return[a.substr(0,d+1)]}},END:/^$/},c={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA","IS_NULL"],BETWEEN:["VALUE"],IS_NULL:["END"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},d={"=":OpenLayers.Filter.Comparison.EQUAL_TO,"<>":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<":OpenLayers.Filter.Comparison.LESS_THAN,"<=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":OpenLayers.Filter.Comparison.GREATER_THAN,">=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN,"IS NULL":OpenLayers.Filter.Comparison.IS_NULL},e={},f={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},g={},h={RPAREN:3,LOGICAL:2,COMPARISON:1};for(i in d)d.hasOwnProperty(i)&&(e[d[i]]=i);for(i in f)f.hasOwnProperty(i)&&(g[f[i]]=i);return OpenLayers.Class(OpenLayers.Format,{read:function(a){var b=m(l(a));return this.keepData&&(this.data=b),b},write:function(a){if(a instanceof OpenLayers.Geometry)return a.toString();switch(a.CLASS_NAME){case"OpenLayers.Filter.Spatial":switch(a.type){case OpenLayers.Filter.Spatial.BBOX:return"BBOX("+a.property+","+a.value.toBBOX()+")";case OpenLayers.Filter.Spatial.DWITHIN:return"DWITHIN("+a.property+", "+this.write(a.value)+", "+a.distance+")";case OpenLayers.Filter.Spatial.WITHIN:return"WITHIN("+a.property+", "+this.write(a.value)+")";case OpenLayers.Filter.Spatial.INTERSECTS:return"INTERSECTS("+a.property+", "+this.write(a.value)+")";case OpenLayers.Filter.Spatial.CONTAINS:return"CONTAINS("+a.property+", "+this.write(a.value)+")";default:throw new Error("Unknown spatial filter type: "+a.type)}case"OpenLayers.Filter.Logical":if(a.type==OpenLayers.Filter.Logical.NOT)return"NOT ("+this.write(a.filters[0])+")";for(var b="(",c=!0,d=0;d<a.filters.length;d++)c?c=!1:b+=") "+g[a.type]+" (",b+=this.write(a.filters[d]);return b+")";case"OpenLayers.Filter.Comparison":return a.type==OpenLayers.Filter.Comparison.BETWEEN?a.property+" BETWEEN "+this.write(a.lowerBoundary)+" AND "+this.write(a.upperBoundary):null!==a.value?a.property+" "+e[a.type]+" "+this.write(a.value):a.property+" "+e[a.type];case void 0:if("string"==typeof a)return"'"+a.replace(/'/g,"''")+"'";if("number"==typeof a)return String(a);default:throw new Error("Can't encode: "+a.CLASS_NAME+" "+a)}},CLASS_NAME:"OpenLayers.Format.CQL"})}(),Ext.namespace("gxp"),gxp.FilterBuilder=Ext.extend(Ext.Container,{builderTypeNames:["any","all","none","not all"],allowedBuilderTypes:null,allowBlank:!1,caseInsensitiveMatch:!1,preComboText:"Match",postComboText:"of the following:",cls:"gxp-filterbuilder",builderType:null,childFilterContainer:null,customizeFilterOnInit:!0,addConditionText:"add condition",addGroupText:"add group",removeConditionText:"remove condition",allowGroups:!0,initComponent:function(){var a={defaultBuilderType:gxp.FilterBuilder.ANY_OF};Ext.applyIf(this,a),this.customizeFilterOnInit&&(this.filter=this.customizeFilter(this.filter)),this.builderType=this.getBuilderType(),this.items=[{xtype:"container",layout:"form",ref:"form",defaults:{anchor:"100%"},hideLabels:!0,items:[{xtype:"compositefield",style:"padding-left: 2px",items:[{xtype:"label",style:"padding-top: 0.3em",text:this.preComboText},this.createBuilderTypeCombo(),{xtype:"label",style:"padding-top: 0.3em",text:this.postComboText}]},this.createChildFiltersPanel(),{xtype:"toolbar",items:this.createToolBar()}]}],this.addEvents("change"),gxp.FilterBuilder.superclass.initComponent.call(this)},createToolBar:function(){var a=[{text:this.addConditionText,iconCls:"add",handler:function(){this.addCondition()},scope:this}];return this.allowGroups&&a.push({text:this.addGroupText,iconCls:"add",handler:function(){this.addCondition(!0)},scope:this}),a},getFilter:function(){var a;return this.filter&&(a=this.filter.clone(),a instanceof OpenLayers.Filter.Logical&&(a=this.cleanFilter(a))),a},cleanFilter:function(a){if(a instanceof OpenLayers.Filter.Logical){if(a.type!==OpenLayers.Filter.Logical.NOT&&1===a.filters.length)a=this.cleanFilter(a.filters[0]);else for(var b,c=0,d=a.filters.length;c<d;++c)if(b=a.filters[c],b instanceof OpenLayers.Filter.Logical){if(b=this.cleanFilter(b),!b){a=b;break}a.filters[c]=b}else if(!b||null===b.type||null===b.property||null===b[a.type===OpenLayers.Filter.Comparison.BETWEEN?"lowerBoundary":"value"]){a=!1;break}}else a&&null!==a.type&&null!==a.property&&null!==a[a.type===OpenLayers.Filter.Comparison.BETWEEN?"lowerBoundary":"value"]||(a=!1);return a},customizeFilter:function(a){if(a){a=this.cleanFilter(a);var b,c,d;switch(a.type){case OpenLayers.Filter.Logical.AND:case OpenLayers.Filter.Logical.OR:if(a.filters&&0!==a.filters.length)for(c=0,d=a.filters.length;c<d;++c)b=a.filters[c],b instanceof OpenLayers.Filter.Logical&&(a.filters[c]=this.customizeFilter(b));else a.filters=[this.createDefaultFilter()];a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[a]});break;case OpenLayers.Filter.Logical.NOT:if(a.filters&&0!==a.filters.length)if(b=a.filters[0],b instanceof OpenLayers.Filter.Logical)if(b.type!==OpenLayers.Filter.Logical.NOT){var e;for(c=0,d=b.filters.length;c<d;++c)e=b.filters[c],e instanceof OpenLayers.Filter.Logical&&(b.filters[c]=this.customizeFilter(e))}else a=b.filters&&b.filters.length>0?this.customizeFilter(b.filters[0]):this.wrapFilter(this.createDefaultFilter());else{var f;f=this.defaultBuilderType===gxp.FilterBuilder.NOT_ALL_OF?OpenLayers.Filter.Logical.AND:OpenLayers.Filter.Logical.OR,a.filters=[new OpenLayers.Filter.Logical({type:f,filters:[b]})]}else a.filters=[new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[this.createDefaultFilter()]})];break;default:a=this.wrapFilter(a)}}else a=this.wrapFilter(this.createDefaultFilter());return a},createDefaultFilter:function(){return new OpenLayers.Filter.Comparison({matchCase:!this.caseInsensitiveMatch})},wrapFilter:function(a){var b;return b=this.defaultBuilderType===gxp.FilterBuilder.ALL_OF?OpenLayers.Filter.Logical.AND:OpenLayers.Filter.Logical.OR,new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[new OpenLayers.Filter.Logical({type:b,filters:[a]})]})},addCondition:function(a){var b,c;a?(c="gxp_filterbuilder",b=this.wrapFilter(this.createDefaultFilter())):(c="gxp_filterfield",b=this.createDefaultFilter());var d=this.newRow({xtype:c,filter:b,columnWidth:1,attributes:this.attributes,allowBlank:a?void 0:this.allowBlank,customizeFilterOnInit:a&&!1,caseInsensitiveMatch:this.caseInsensitiveMatch,listeners:{change:function(){this.fireEvent("change",this)},scope:this}});this.childFilterContainer.add(d),this.filter.filters[0].filters.push(b),this.childFilterContainer.doLayout()},removeCondition:function(a,b){var c=this.filter.filters[0].filters;c.length>0&&(c.remove(b),this.childFilterContainer.remove(a,!0)),0===c.length&&this.addCondition(),this.fireEvent("change",this)},createBuilderTypeCombo:function(){for(var d,a=this.allowedBuilderTypes||[gxp.FilterBuilder.ANY_OF,gxp.FilterBuilder.ALL_OF,gxp.FilterBuilder.NONE_OF],b=a.length,c=new Array(b),e=0;e<b;++e)d=a[e],c[e]=[d,this.builderTypeNames[d]];return{xtype:"combo",store:new Ext.data.SimpleStore({data:c,fields:["value","name"]}),value:this.builderType,ref:"../../builderTypeCombo",displayField:"name",valueField:"value",triggerAction:"all",mode:"local",listeners:{select:function(a,b){this.changeBuilderType(b.get("value")),this.fireEvent("change",this)},scope:this},width:60}},changeBuilderType:function(a){if(a!==this.builderType){this.builderType=a;var b=this.filter.filters[0];switch(a){case gxp.FilterBuilder.ANY_OF:this.filter.type=OpenLayers.Filter.Logical.OR,b.type=OpenLayers.Filter.Logical.OR;break;case gxp.FilterBuilder.ALL_OF:this.filter.type=OpenLayers.Filter.Logical.OR,b.type=OpenLayers.Filter.Logical.AND;break;case gxp.FilterBuilder.NONE_OF:this.filter.type=OpenLayers.Filter.Logical.NOT,b.type=OpenLayers.Filter.Logical.OR;break;case gxp.FilterBuilder.NOT_ALL_OF:this.filter.type=OpenLayers.Filter.Logical.NOT,b.type=OpenLayers.Filter.Logical.AND}}},createChildFiltersPanel:function(){this.childFilterContainer=new Ext.Container;for(var b,a=this.filter.filters[0].filters,c=0,d=a.length;c<d;++c){b=a[c];var e={xtype:"gxp_filterfield",allowBlank:this.allowBlank,columnWidth:1,filter:b,attributes:this.attributes,listeners:{change:function(){this.fireEvent("change",this)},scope:this}},f=Ext.applyIf(b instanceof OpenLayers.Filter.Logical?{xtype:"gxp_filterbuilder"}:{xtype:"container",layout:"form",hideLabels:!0,items:e},e);this.childFilterContainer.add(this.newRow(f))}return this.childFilterContainer},newRow:function(a){var b=new Ext.Container({layout:"column",items:[{xtype:"container",width:28,height:26,style:"padding-left: 2px",items:{xtype:"button",tooltip:this.removeConditionText,iconCls:"delete",handler:function(c){this.removeCondition(b,a.filter)},scope:this}},a]});return b},getBuilderType:function(){var a=this.defaultBuilderType;if(this.filter){var b=this.filter.filters[0];if(this.filter.type===OpenLayers.Filter.Logical.NOT)switch(b.type){case OpenLayers.Filter.Logical.OR:a=gxp.FilterBuilder.NONE_OF;break;case OpenLayers.Filter.Logical.AND:a=gxp.FilterBuilder.NOT_ALL_OF}else switch(b.type){case OpenLayers.Filter.Logical.OR:a=gxp.FilterBuilder.ANY_OF;break;case OpenLayers.Filter.Logical.AND:a=gxp.FilterBuilder.ALL_OF}}return a},setFilter:function(a){this.filter=this.customizeFilter(a),this.changeBuilderType(this.getBuilderType()),this.builderTypeCombo.setValue(this.builderType),this.form.remove(this.childFilterContainer),this.form.insert(1,this.createChildFiltersPanel()),this.form.doLayout(),this.fireEvent("change",this)}}),gxp.FilterBuilder.ANY_OF=0,gxp.FilterBuilder.ALL_OF=1,gxp.FilterBuilder.NONE_OF=2,gxp.FilterBuilder.NOT_ALL_OF=3,Ext.reg("gxp_filterbuilder",gxp.FilterBuilder),Ext.namespace("gxp"),gxp.WMSLayerPanel=Ext.extend(Ext.TabPanel,{layerRecord:null,source:null,styling:!0,sameOriginStyling:!0,rasterStyling:!1,transparent:null,editableStyles:!1,activeTab:0,border:!1,imageFormats:/png|gif|jpe?g/i,aboutText:"About",titleText:"Title",attributionText:"Attribution",nameText:"Name",descriptionText:"Description",displayText:"Display",opacityText:"Opacity",formatText:"Tile format",infoFormatText:"Info format",infoFormatEmptyText:"Select a format",transparentText:"Transparent",cacheText:"Caching",cacheFieldText:"Use cached tiles",stylesText:"Available Styles",displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile",initComponent:function(){if(this.cqlFormat=new OpenLayers.Format.CQL,this.source&&this.source.getSchema(this.layerRecord,function(a){if(a!==!1){var b=this.layerRecord.getLayer().params.CQL_FILTER;this.filterBuilder=new gxp.FilterBuilder({filter:b&&this.cqlFormat.read(b),allowGroups:!1,listeners:{afterrender:function(){this.filterBuilder.cascade(function(a){"toolbar"===a.getXType()&&(a.addText(this.cqlPrefixText),a.addButton({text:this.cqlText,handler:this.switchToCQL,scope:this}))},this)},change:function(a){var b=a.getFilter(),c=null;b!==!1&&(c=this.cqlFormat.write(b)),this.layerRecord.getLayer().mergeNewParams({CQL_FILTER:c})},scope:this},attributes:a}),this.filterFieldset.add(this.filterBuilder),this.filterFieldset.doLayout()}},this),this.addEvents("change"),this.items=[this.createAboutPanel(),this.createDisplayPanel()],this.styling&&gxp.WMSStylesDialog&&this.layerRecord.get("styles")){var a=this.layerRecord.get("restUrl");a||(a=(this.source||this.layerRecord.get("layer")).url.split("?").shift().replace(/\/(wms|ows)\/?$/,"/rest")),this.sameOriginStyling?this.editableStyles="/"===a.charAt(0):this.editableStyles=!0,this.items.push(this.createStylesPanel(a))}gxp.WMSLayerPanel.superclass.initComponent.call(this)},switchToCQL:function(){var a=this.filterBuilder.getFilter(),b="";a!==!1&&(b=this.cqlFormat.write(a)),this.filterBuilder.hide(),this.cqlField.setValue(b),this.cqlField.show(),this.cqlToolbar.show()},switchToFilterBuilder:function(){var a=null;try{a=this.cqlFormat.read(this.cqlField.getValue())}catch(a){}this.cqlField.hide(),this.cqlToolbar.hide(),this.filterBuilder.show(),null!==a&&this.filterBuilder.setFilter(a)},createStylesPanel:function(a){var b=gxp.WMSStylesDialog.createGeoServerStylerConfig(this.layerRecord,a);this.rasterStyling===!0&&b.plugins.push({ptype:"gxp_wmsrasterstylesdialog"});var c=this.ownerCt;return c.ownerCt instanceof Ext.Window||(b.dialogCls=Ext.Panel,b.showDlg=function(a){a.layout="fit",a.autoHeight=!1,c.add(a)}),Ext.apply(b,{title:this.stylesText,style:"padding: 10px",editable:!1})},createAboutPanel:function(){return{title:this.aboutText,bodyStyle:{padding:"10px"},defaults:{border:!1},items:[{layout:"form",labelWidth:70,items:[{xtype:"textfield",fieldLabel:this.titleText,anchor:"99%",value:this.layerRecord.get("title"),listeners:{change:function(a){this.layerRecord.set("title",a.getValue()),this.layerRecord.commit(),this.fireEvent("change")},scope:this}},{xtype:"textfield",fieldLabel:this.nameText,anchor:"99%",value:this.layerRecord.get("name"),readOnly:!0},{xtype:"textfield",fieldLabel:this.attributionText,anchor:"99%",listeners:{change:function(a){var b=this.layerRecord.getLayer();b.attribution=a.getValue(),b.map.events.triggerEvent("changelayer",{layer:b,property:"attribution"}),this.fireEvent("change")},scope:this},value:this.layerRecord.getLayer().attribution}]},{layout:"form",
labelAlign:"top",items:[{xtype:"textarea",fieldLabel:this.descriptionText,grow:!0,growMax:150,anchor:"99%",value:this.layerRecord.get("abstract"),readOnly:!0}]}]}},onFormatChange:function(a){var b=this.layerRecord.getLayer(),c=a.getValue();b.mergeNewParams({format:c});var d=this.transparentCb;"image/jpeg"==c?(this.transparent=d.getValue(),d.setValue(!1)):null!==this.transparent&&(d.setValue(this.transparent),this.transparent=null),d.setDisabled("image/jpeg"==c),this.fireEvent("change")},addScaleOptions:function(a,b){a.alwaysInRange=null,a.addOptions(b),a.display(),a.redraw()},createDisplayPanel:function(){var a=this.layerRecord,b=a.getLayer(),c=b.opacity;null==c&&(c=1);var d=[],e=b.params.FORMAT.toLowerCase();Ext.each(a.get("formats"),function(a){this.imageFormats.test(a)&&d.push(a.toLowerCase())},this),d.indexOf(e)===-1&&d.push(e);var f=b.params.TRANSPARENT;return f="true"===f||f===!0,{title:this.displayText,layout:"form",bodyStyle:{padding:"10px"},defaults:{labelWidth:70},items:[{xtype:"fieldset",title:this.displayOptionsText,items:[{xtype:"gx_opacityslider",name:"opacity",anchor:"99%",isFormField:!0,fieldLabel:this.opacityText,listeners:{change:function(){this.fireEvent("change")},scope:this},layer:this.layerRecord},{xtype:"compositefield",fieldLabel:this.formatText,anchor:"99%",items:[{xtype:"combo",width:90,listWidth:150,store:d,value:e,mode:"local",triggerAction:"all",editable:!1,listeners:{select:this.onFormatChange,scope:this}},{xtype:"checkbox",ref:"../../../transparentCb",checked:f,listeners:{check:function(a,c){b.mergeNewParams({transparent:c?"true":"false"}),this.fireEvent("change")},scope:this}},{xtype:"label",cls:"gxp-layerproperties-label",text:this.transparentText}]},{xtype:"compositefield",fieldLabel:this.singleTileText,anchor:"99%",items:[{xtype:"checkbox",checked:this.layerRecord.get("layer").singleTile,listeners:{check:function(a,c){b.addOptions({singleTile:c}),this.fireEvent("change")},scope:this}},{xtype:"label",cls:"gxp-layerproperties-label",text:this.singleTileFieldText}]},{xtype:"compositefield",anchor:"99%",hidden:null==this.layerRecord.get("layer").params.TILED,fieldLabel:this.cacheText,items:[{xtype:"checkbox",checked:this.layerRecord.get("layer").params.TILED===!0,listeners:{check:function(a,b){var c=this.layerRecord.get("layer");c.mergeNewParams({TILED:b}),this.fireEvent("change")},scope:this}},{xtype:"label",cls:"gxp-layerproperties-label",text:this.cacheFieldText}]},{xtype:"combo",fieldLabel:this.infoFormatText,emptyText:this.infoFormatEmptyText,store:a.get("infoFormats"),value:a.get("infoFormat"),hidden:void 0===a.get("infoFormats"),mode:"local",listWidth:150,triggerAction:"all",editable:!1,anchor:"99%",listeners:{select:function(b){var c=b.getValue();a.set("infoFormat",c),this.fireEvent("change")}},scope:this}]},{xtype:"fieldset",title:this.queryText,hideLabels:!0,ref:"../filterFieldset",listeners:{expand:function(){this.layerRecord.getLayer().mergeNewParams({CQL_FILTER:this.cqlFilter})},collapse:function(){this.cqlFilter=this.layerRecord.getLayer().params.CQL_FILTER,this.layerRecord.getLayer().mergeNewParams({CQL_FILTER:null})},scope:this},hidden:null===this.source,checkboxToggle:!0,collapsed:!this.layerRecord.getLayer().params.CQL_FILTER,items:[{xtype:"textarea",value:this.layerRecord.getLayer().params.CQL_FILTER,grow:!0,anchor:"99%",width:"100%",growMax:100,ref:"../../cqlField",hidden:!0}],buttons:[{ref:"../../../cqlToolbar",hidden:!0,text:this.switchToFilterBuilderText,handler:this.switchToFilterBuilder,scope:this}]},{xtype:"fieldset",title:this.scaleText,listeners:{expand:function(){var a=this.layerRecord.getLayer();void 0===this.minScale&&void 0===this.maxScale||this.addScaleOptions(a,{minScale:this.maxScale,maxScale:this.minScale})},collapse:function(){var a=this.layerRecord.getLayer();this.minScale=a.options.maxScale,this.maxScale=a.options.minScale,this.addScaleOptions(a,{minScale:null,maxScale:null})},scope:this},checkboxToggle:!0,collapsed:null==this.layerRecord.getLayer().options.maxScale&&null==this.layerRecord.getLayer().options.minScale,items:[{xtype:"compositefield",fieldLabel:this.minScaleText,items:[{xtype:"label",text:"1:",cls:"gxp-layerproperties-label"},{xtype:"numberfield",anchor:"99%",width:"85%",listeners:{change:function(a){var b={maxScale:parseInt(a.getValue())},c=this.layerRecord.getLayer();this.addScaleOptions(c,b)},scope:this},value:this.layerRecord.getLayer().options.maxScale}]},{xtype:"compositefield",fieldLabel:this.maxScaleText,items:[{xtype:"label",text:"1:",cls:"gxp-layerproperties-label"},{xtype:"numberfield",anchor:"99%",width:"85%",listeners:{change:function(a){var b={minScale:parseInt(a.getValue())},c=this.layerRecord.getLayer();this.addScaleOptions(c,b)},scope:this},value:this.layerRecord.getLayer().options.minScale}]}]}]}}}),Ext.reg("gxp_wmslayerpanel",gxp.WMSLayerPanel),Ext.namespace("gxp.form"),gxp.form.FilterField=Ext.extend(Ext.form.CompositeField,{lowerBoundaryTip:"lower boundary",upperBoundaryTip:"upper boundary",caseInsensitiveMatch:!1,filter:null,attributes:null,attributesComboConfig:null,initComponent:function(){this.filter||(this.filter=this.createDefaultFilter());var a="remote",b=new GeoExt.data.AttributeStore;this.attributes&&(0!=this.attributes.getCount()?(a="local",this.attributes.each(function(a){var c=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/.exec(a.get("type"));c||b.add([a])})):b=this.attributes);var c={xtype:"combo",store:b,editable:"local"==a,typeAhead:!0,forceSelection:!0,mode:a,triggerAction:"all",ref:"property",allowBlank:this.allowBlank,displayField:"name",valueField:"name",value:this.filter.property,listeners:{select:function(a,b){this.items.get(1).enable(),this.filter.property=b.get("name"),this.fireEvent("change",this.filter,this)},blur:function(a){var b=a.store.findExact("name",a.getValue());b!=-1?a.fireEvent("select",a,a.store.getAt(b)):null!=a.startValue&&a.setValue(a.startValue)},scope:this},width:120};this.attributesComboConfig=this.attributesComboConfig||{},Ext.applyIf(this.attributesComboConfig,c),this.items=this.createFilterItems(),this.addEvents("change"),gxp.form.FilterField.superclass.initComponent.call(this)},validateValue:function(a,b){return this.filter.type===OpenLayers.Filter.Comparison.BETWEEN?null!==this.filter.property&&null!==this.filter.upperBoundary&&null!==this.filter.lowerBoundary:null!==this.filter.property&&null!==this.filter.value&&null!==this.filter.type},createDefaultFilter:function(){return new OpenLayers.Filter.Comparison({matchCase:!this.caseInsensitiveMatch})},createFilterItems:function(){var a=this.filter.type===OpenLayers.Filter.Comparison.BETWEEN;return[this.attributesComboConfig,Ext.applyIf({xtype:"gxp_comparisoncombo",ref:"type",disabled:null==this.filter.property,allowBlank:this.allowBlank,value:this.filter.type,listeners:{select:function(a,b){this.items.get(2).enable(),this.items.get(3).enable(),this.items.get(4).enable(),this.setFilterType(b.get("value")),this.fireEvent("change",this.filter,this)},scope:this}},this.comparisonComboConfig),{xtype:"textfield",disabled:null==this.filter.type,hidden:a,ref:"value",value:this.filter.value,width:50,grow:!0,growMin:50,anchor:"100%",allowBlank:this.allowBlank,listeners:{change:function(a,b){this.filter.value=b,this.fireEvent("change",this.filter,this)},scope:this}},{xtype:"textfield",disabled:null==this.filter.type,hidden:!a,value:this.filter.lowerBoundary,tooltip:this.lowerBoundaryTip,grow:!0,growMin:30,ref:"lowerBoundary",anchor:"100%",allowBlank:this.allowBlank,listeners:{change:function(a,b){this.filter.lowerBoundary=b,this.fireEvent("change",this.filter,this)},render:function(a){Ext.QuickTips.register({target:a.getEl(),text:this.lowerBoundaryTip})},autosize:function(a,b){a.setWidth(b),a.ownerCt.doLayout()},scope:this}},{xtype:"textfield",disabled:null==this.filter.type,hidden:!a,grow:!0,growMin:30,ref:"upperBoundary",value:this.filter.upperBoundary,allowBlank:this.allowBlank,listeners:{change:function(a,b){this.filter.upperBoundary=b,this.fireEvent("change",this.filter,this)},render:function(a){Ext.QuickTips.register({target:a.getEl(),text:this.upperBoundaryTip})},scope:this}}]},setFilterType:function(a){this.filter.type=a,a===OpenLayers.Filter.Comparison.BETWEEN?(this.items.get(2).hide(),this.items.get(3).show(),this.items.get(4).show()):(this.items.get(2).show(),this.items.get(3).hide(),this.items.get(4).hide()),this.doLayout()},setFilter:function(a){var b=this.filter.type;this.filter=a,b!==a.type&&this.setFilterType(a.type),this.property.setValue(a.property),this.type.setValue(a.type),a.type===OpenLayers.Filter.Comparison.BETWEEN?(this.lowerBoundary.setValue(a.lowerBoundary),this.upperBoundary.setValue(a.upperBoundary)):this.value.setValue(a.value),this.fireEvent("change",this.filter,this)}}),Ext.reg("gxp_filterfield",gxp.form.FilterField),Ext.namespace("gxp.form"),gxp.form.ComparisonComboBox=Ext.extend(Ext.form.ComboBox,{allowedTypes:[[OpenLayers.Filter.Comparison.EQUAL_TO,"="],[OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<>"],[OpenLayers.Filter.Comparison.LESS_THAN,"<"],[OpenLayers.Filter.Comparison.GREATER_THAN,">"],[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,"<="],[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,">="],[OpenLayers.Filter.Comparison.LIKE,"like"],[OpenLayers.Filter.Comparison.BETWEEN,"between"]],allowBlank:!1,mode:"local",typeAhead:!0,forceSelection:!0,triggerAction:"all",width:50,editable:!0,initComponent:function(){var a={displayField:"name",valueField:"value",store:new Ext.data.SimpleStore({data:this.allowedTypes,fields:["value","name"]}),value:void 0===this.value?this.allowedTypes[0][0]:this.value,listeners:{blur:function(){var a=this.store.findExact("value",this.getValue());a!=-1?this.fireEvent("select",this,this.store.getAt(a)):null!=this.startValue&&this.setValue(this.startValue)}}};Ext.applyIf(this,a),gxp.form.ComparisonComboBox.superclass.initComponent.call(this)}}),Ext.reg("gxp_comparisoncombo",gxp.form.ComparisonComboBox),Ext.namespace("GeoExt"),GeoExt.LayerOpacitySlider=Ext.extend(Ext.slider.SingleSlider,{layer:null,complementaryLayer:null,delay:5,changeVisibilityDelay:5,aggressive:!1,changeVisibility:!1,value:null,inverse:!1,constructor:function(a){a.layer&&(this.layer=this.getLayer(a.layer),this.bind(),this.complementaryLayer=this.getLayer(a.complementaryLayer),void 0!==a.inverse&&(this.inverse=a.inverse),a.value=void 0!==a.value?a.value:this.getOpacityValue(this.layer),delete a.layer,delete a.complementaryLayer),GeoExt.LayerOpacitySlider.superclass.constructor.call(this,a)},bind:function(){this.layer&&this.layer.map&&this.layer.map.events.on({changelayer:this.update,scope:this})},unbind:function(){this.layer&&this.layer.map&&this.layer.map.events&&this.layer.map.events.un({changelayer:this.update,scope:this})},update:function(a){"opacity"!==a.property||a.layer!=this.layer||this._settingOpacity||this.setValue(this.getOpacityValue(this.layer))},setLayer:function(a){this.unbind(),this.layer=this.getLayer(a),this.setValue(this.getOpacityValue(a)),this.bind()},getOpacityValue:function(a){var b;return b=a&&null!==a.opacity?parseInt(a.opacity*(this.maxValue-this.minValue)):this.maxValue,this.inverse===!0&&(b=this.maxValue-this.minValue-b),b},getLayer:function(a){return a instanceof OpenLayers.Layer?a:a instanceof GeoExt.data.LayerRecord?a.getLayer():void 0},initComponent:function(){GeoExt.LayerOpacitySlider.superclass.initComponent.call(this),this.changeVisibility&&this.layer&&(0==this.layer.opacity||this.inverse===!1&&this.value==this.minValue||this.inverse===!0&&this.value==this.maxValue)&&this.layer.setVisibility(!1),this.complementaryLayer&&(this.layer&&1==this.layer.opacity||this.inverse===!1&&this.value==this.maxValue||this.inverse===!0&&this.value==this.minValue)&&this.complementaryLayer.setVisibility(!1),this.aggressive===!0?this.on("change",this.changeLayerOpacity,this,{buffer:this.delay}):this.on("changecomplete",this.changeLayerOpacity,this),this.changeVisibility===!0&&this.on("change",this.changeLayerVisibility,this,{buffer:this.changeVisibilityDelay}),this.complementaryLayer&&this.on("change",this.changeComplementaryLayerVisibility,this,{buffer:this.changeVisibilityDelay}),this.on("beforedestroy",this.unbind,this)},changeLayerOpacity:function(a,b){this.layer&&(b/=this.maxValue-this.minValue,this.inverse===!0&&(b=1-b),this._settingOpacity=!0,this.layer.setOpacity(b),delete this._settingOpacity)},changeLayerVisibility:function(a,b){var c=this.layer.getVisibility();this.inverse===!1&&b==this.minValue||this.inverse===!0&&b==this.maxValue&&c===!0?this.layer.setVisibility(!1):(this.inverse===!1&&b>this.minValue||this.inverse===!0&&b<this.maxValue&&0==c)&&this.layer.setVisibility(!0)},changeComplementaryLayerVisibility:function(a,b){var c=this.complementaryLayer.getVisibility();this.inverse===!1&&b==this.maxValue||this.inverse===!0&&b==this.minValue&&c===!0?this.complementaryLayer.setVisibility(!1):(this.inverse===!1&&b<this.maxValue||this.inverse===!0&&b>this.minValue&&0==c)&&this.complementaryLayer.setVisibility(!0)},addToMapPanel:function(a){this.on({render:function(){var b=this.getEl();b.setStyle({position:"absolute",zIndex:a.map.Z_INDEX_BASE.Control}),b.on({mousedown:this.stopMouseEvents,click:this.stopMouseEvents})},scope:this})},removeFromMapPanel:function(a){var b=this.getEl();b.un({mousedown:this.stopMouseEvents,click:this.stopMouseEvents,scope:this}),this.unbind()},stopMouseEvents:function(a){a.stopEvent()}}),Ext.reg("gx_opacityslider",GeoExt.LayerOpacitySlider),Ext.namespace("GeoExt"),GeoExt.SliderTip=Ext.extend(Ext.slider.Tip,{hover:!0,minWidth:10,offsets:[0,-10],dragging:!1,init:function(a){GeoExt.SliderTip.superclass.init.apply(this,arguments),this.hover&&a.on("render",this.registerThumbListeners,this),this.slider=a},registerThumbListeners:function(){for(var a,b,c=0,d=this.slider.thumbs.length;c<d;++c)a=this.slider.thumbs[c],b=a.tracker.el,function(a,b){b.on({mouseover:function(b){this.onSlide(this.slider,b,a),this.dragging=!1},mouseout:function(){this.dragging||this.hide.apply(this,arguments)},scope:this})}.apply(this,[a,b])},onSlide:function(a,b,c){return this.dragging=!0,GeoExt.SliderTip.superclass.onSlide.apply(this,arguments)}}),Ext.namespace("GeoExt"),GeoExt.LayerOpacitySliderTip=Ext.extend(GeoExt.SliderTip,{template:"<div>{opacity}%</div>",compiledTemplate:null,init:function(a){this.compiledTemplate=new Ext.Template(this.template),GeoExt.LayerOpacitySliderTip.superclass.init.call(this,a)},getText:function(a){var b={opacity:a.value};return this.compiledTemplate.apply(b)}}),Ext.namespace("gxp"),gxp.GoogleEarthPanel=Ext.extend(Ext.Panel,{HORIZONTAL_FIELD_OF_VIEW:30*Math.PI/180,map:null,mapPanel:null,layers:null,earth:null,projection:null,layerCache:null,initComponent:function(){this.addEvents("beforeadd","pluginfailure","pluginready"),gxp.GoogleEarthPanel.superclass.initComponent.call(this);var a=this.mapPanel;if(!a||a instanceof GeoExt.MapPanel||(a=Ext.getCmp(a)),!a)throw new Error("Could not get map panel from config: "+this.mapPanel);this.map=a.map,this.layers=a.layers,this.projection=new OpenLayers.Projection("EPSG:4326"),this.on("render",this.onRenderEvent,this),this.on("show",this.onShowEvent,this),this.on("hide",function(){null!=this.earth&&this.updateMap(),this.body.dom.innerHTML="",this.earth=null},this)},onEarthReady:function(a){this.earth=a,void 0===this.flyToSpeed?this.earth.getOptions().setFlyToSpeed(this.earth.SPEED_TELEPORT):null!==this.flyToSpeed&&this.earth.getOptions().setFlyToSpeed(this.flyToSpeed),this.resetCamera(),this.setExtent(this.map.getExtent()),this.earth.getNavigationControl().setVisibility(this.earth.VISIBILITY_SHOW);var b=this.earth.getNavigationControl().getScreenXY();b.setXUnits(this.earth.UNITS_PIXELS),b.setYUnits(this.earth.UNITS_INSET_PIXELS),this.earth.getWindow().setVisibility(!0),this.layers.each(function(a){this.addLayer(a)},this),this.layers.on("remove",this.updateLayers,this),this.layers.on("update",this.updateLayers,this),this.layers.on("add",this.updateLayers,this),this.fireEvent("pluginready",this.earth)},onRenderEvent:function(){var a=this.ownerCt&&this.ownerCt.layout instanceof Ext.layout.CardLayout;this.hidden||a||this.onShowEvent()},onShowEvent:function(){this.rendered&&(this.layerCache={},google.earth.createInstance(this.body.dom,this.onEarthReady.createDelegate(this),function(a){this.fireEvent("pluginfailure",this,a)}.createDelegate(this)))},beforeDestroy:function(){this.layers.un("remove",this.updateLayers,this),this.layers.un("update",this.updateLayers,this),this.layers.un("add",this.updateLayers,this),gxp.GoogleEarthPanel.superclass.beforeDestroy.call(this)},updateLayers:function(){if(this.earth){for(var a=this.earth.getFeatures(),b=a.getFirstChild();null!=b;)a.removeChild(b),b=a.getFirstChild();this.layers.each(function(a){this.addLayer(a)},this)}},addLayer:function(a,b){var c=a.getLayer(),d=c&&c.url;if(this.earth&&c instanceof OpenLayers.Layer.WMS&&"string"==typeof d){var e=this.fireEvent("beforeadd",a);if(e!==!1){var g,f=c.id;if(this.layerCache[f])g=this.layerCache[f];else{var h=this.earth.createLink("kl_"+f);d=d.replace(/\?.*/,"");var i=c.params,j="/kml?mode=refresh&layers="+i.LAYERS+"&styles="+i.STYLES;h.setHref(d+j),g=this.earth.createNetworkLink("nl_"+f),g.setName(f),g.set(h,!1,!1),this.layerCache[f]=g}g.setVisibility(c.getVisibility()),void 0!==b&&b<this.earth.getFeatures().getChildNodes().getLength()?this.earth.getFeatures().insertBefore(this.earth.getFeatures().getChildNodes().item(b)):this.earth.getFeatures().appendChild(g)}}},setExtent:function(a){a=a.transform(this.map.getProjectionObject(),this.projection);var b=a.getCenterLonLat(),c=this.getExtentWidth(a),d=c/(2*Math.tan(this.HORIZONTAL_FIELD_OF_VIEW)),e=this.earth.getView().copyAsLookAt(this.earth.ALTITUDE_RELATIVE_TO_GROUND);e.setLatitude(b.lat),e.setLongitude(b.lon),e.setRange(d),this.earth.getView().setAbstractView(e)},resetCamera:function(){var a=this.earth.getView().copyAsCamera(this.earth.ALTITUDE_RELATIVE_TO_GROUND);a.setRoll(0),a.setHeading(0),a.setTilt(0),this.earth.getView().setAbstractView(a)},getExtent:function(){var a=this.earth.getView().getViewportGlobeBounds(),b=new OpenLayers.Bounds(a.getWest(),a.getSouth(),a.getEast(),a.getNorth());return b},updateMap:function(){var a=this.earth.getView().copyAsLookAt(this.earth.ALTITUDE_RELATIVE_TO_GROUND),b=this.reprojectToMap(new OpenLayers.LonLat(a.getLongitude(),a.getLatitude())),c=this.reprojectToMap(this.getExtent());this.map.zoomToExtent(c,!0),this.map.setCenter(b);var d=a.getRange(),e=2*d*Math.tan(this.HORIZONTAL_FIELD_OF_VIEW),f=this.map.getResolutionForZoom(this.map.getZoom()+1),g=this.map.getExtent(),h=new OpenLayers.Bounds(b.lon-this.map.getSize().w/2*f,b.lat+this.map.getSize().h/2*f,b.lon+this.map.getSize().w/2*f,b.lat-this.map.getSize().h/2*f),i=Math.abs(this.getExtentWidth(g)-e),j=Math.abs(this.getExtentWidth(h)-e);j<i&&this.map.zoomTo(this.map.getZoom()+1)},getExtentWidth:function(a){var b=a.getCenterLonLat(),c=new OpenLayers.LonLat(a.left,b.lat),d=new OpenLayers.LonLat(a.right,b.lat);return 1e3*OpenLayers.Util.distVincenty(c,d)},reprojectToGE:function(a){return a.clone().transform(this.map.getProjectionObject(),this.projection)},reprojectToMap:function(a){return a.clone().transform(this.projection,this.map.getProjectionObject())}}),Ext.reg("gxp_googleearthpanel",gxp.GoogleEarthPanel),OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this}),this.updateAttribution(),this.div},updateAttribution:function(){var a=[];if(this.map&&this.map.layers){for(var b=0,c=this.map.layers.length;b<c;b++){var d=this.map.layers[b];d.attribution&&d.getVisibility()&&OpenLayers.Util.indexOf(a,d.attribution)===-1&&a.push(d.attribution)}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:a.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"}),OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(a){this.target=a;for(var b=this.events.length-1;b>=0;--b)this.target.register(this.events[b],this,this.buttonClick,{extension:!0})},destroy:function(){for(var a=this.events.length-1;a>=0;--a)this.target.unregister(this.events[a],this,this.buttonClick);delete this.target},getPressedButton:function(a){var c,b=3;do{if(OpenLayers.Element.hasClass(a,"olButton")){c=a;break}a=a.parentNode}while(--b>0&&a);return c},ignore:function(a){var b=3,c=!1;do{if("a"===a.nodeName.toLowerCase()){c=!0;break}a=a.parentNode}while(--b>0&&a);return c},buttonClick:function(a){var b=!0,c=OpenLayers.Event.element(a);if(c&&(OpenLayers.Event.isLeftClick(a)||!~a.type.indexOf("mouse"))){var d=this.getPressedButton(c);if(d){if("keydown"===a.type)switch(a.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:d}),OpenLayers.Event.stop(a),b=!1}else if(this.startEvt){if(this.completeRegEx.test(a.type)){var e=OpenLayers.Util.pagePosition(d),f=OpenLayers.Util.getViewportElement(),g=window.pageYOffset||f.scrollTop,h=window.pageXOffset||f.scrollLeft;e[0]=e[0]-h,e[1]=e[1]-g,this.target.triggerEvent("buttonclick",{buttonElement:d,buttonXY:{x:this.startEvt.clientX-e[0],y:this.startEvt.clientY-e[1]}})}this.cancelRegEx.test(a.type)&&delete this.startEvt,OpenLayers.Event.stop(a),b=!1}this.startRegEx.test(a.type)&&(this.startEvt=a,OpenLayers.Event.stop(a),b=!1)}else b=!this.ignore(OpenLayers.Event.element(a)),delete this.startEvt}return b}}),OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.controls=[],this.activeState={}},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var a,b=this.controls.length-1;b>=0;b--)a=this.controls[b],a.events&&a.events.un({activate:this.iconOn,deactivate:this.iconOff}),a.panel_div=null;this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var a,b=0,c=this.controls.length;b<c;b++)a=this.controls[b],(a===this.defaultControl||this.saveState&&this.activeState[a.id])&&a.activate();return this.saveState===!0&&(this.defaultControl=null),this.redraw(),!0}return!1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var a,b=0,c=this.controls.length;b<c;b++)a=this.controls[b],this.activeState[a.id]=a.deactivate();return this.redraw(),!0}return!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick),this.addControlsToMap(this.controls),this.div},redraw:function(){for(var a=this.div.childNodes.length,b=a-1;b>=0;b--)this.div.removeChild(this.div.childNodes[b]);if(this.div.innerHTML="",this.active)for(var b=0,c=this.controls.length;b<c;b++)this.div.appendChild(this.controls[b].panel_div)},activateControl:function(a){if(!this.active)return!1;if(a.type==OpenLayers.Control.TYPE_BUTTON)return void a.trigger();if(a.type==OpenLayers.Control.TYPE_TOGGLE)return void(a.active?a.deactivate():a.activate());if(this.allowDepress&&a.active)a.deactivate();else{for(var b,c=0,d=this.controls.length;c<d;c++)b=this.controls[c],b==a||b.type!==OpenLayers.Control.TYPE_TOOL&&null!=b.type||b.deactivate();a.activate()}},addControls:function(a){OpenLayers.Util.isArray(a)||(a=[a]),this.controls=this.controls.concat(a);for(var b=0,c=a.length;b<c;b++){var d=a[b],e=this.createControlMarkup(d);OpenLayers.Element.addClass(e,d.displayClass+"ItemInactive"),OpenLayers.Element.addClass(e,"olButton"),""==d.title||e.title||(e.title=d.title),d.panel_div=e}this.map&&(this.addControlsToMap(a),this.redraw())},createControlMarkup:function(a){return document.createElement("div")},addControlsToMap:function(a){for(var b,c=0,d=a.length;c<d;c++)b=a[c],b.autoActivate===!0?(b.autoActivate=!1,this.map.addControl(b),b.autoActivate=!0):(this.map.addControl(b),b.deactivate()),b.events.on({activate:this.iconOn,deactivate:this.iconOff})},iconOn:function(){var a=this.panel_div,b=new RegExp("\\b("+this.displayClass+"Item)Inactive\\b");a.className=a.className.replace(b,"$1Active")},iconOff:function(){var a=this.panel_div,b=new RegExp("\\b("+this.displayClass+"Item)Active\\b");a.className=a.className.replace(b,"$1Inactive")},onButtonClick:function(a){for(var b=this.controls,c=a.buttonElement,d=b.length-1;d>=0;--d)if(b[d].panel_div===c){this.activateControl(b[d]);break}},getControlsBy:function(a,b){var c="function"==typeof b.test,d=OpenLayers.Array.filter(this.controls,function(d){return d[a]==b||c&&b.test(d[a])});return d},getControlsByName:function(a){return this.getControlsBy("name",a)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},CLASS_NAME:"OpenLayers.Control.Panel"}),OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"}),OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"}),OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"}),OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomToMaxExtent()},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"}),OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]),this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"}),OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(a,b,c){OpenLayers.Util.extend(this,c),this.control=a,this.callbacks=b;var d=this.map||a.map;d&&this.setMap(d),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(a){this.map=a},checkModifiers:function(a){if(null==this.keyMask)return!0;var b=(a.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(a.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(a.altKey?OpenLayers.Handler.MOD_ALT:0)|(a.metaKey?OpenLayers.Handler.MOD_META:0);return b==this.keyMask},activate:function(){if(this.active)return!1;for(var a=OpenLayers.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;b<c;b++)this[a[b]]&&this.register(a[b],this[a[b]]);return this.active=!0,!0},deactivate:function(){if(!this.active)return!1;for(var a=OpenLayers.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;b<c;b++)this[a[b]]&&this.unregister(a[b],this[a[b]]);return this.touch=!1,this.active=!1,!0},startTouch:function(){if(!this.touch){this.touch=!0;for(var a=["mousedown","mouseup","mousemove","click","dblclick","mouseout"],b=0,c=a.length;b<c;b++)this[a[b]]&&this.unregister(a[b],this[a[b]])}},callback:function(a,b){a&&this.callbacks[a]&&this.callbacks[a].apply(this.control,b)},register:function(a,b){this.map.events.registerPriority(a,this,b),this.map.events.registerPriority(a,this,this.setEvent)},unregister:function(a,b){this.map.events.unregister(a,this,b),this.map.events.unregister(a,this,this.setEvent)},setEvent:function(a){return this.evt=a,!0},destroy:function(){this.deactivate(),this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"}),OpenLayers.Handler.MOD_NONE=0,OpenLayers.Handler.MOD_SHIFT=1,OpenLayers.Handler.MOD_CTRL=2,OpenLayers.Handler.MOD_ALT=4,OpenLayers.Handler.MOD_META=8,OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(a,b,c){if(OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.documentDrag===!0){var d=this;this._docMove=function(a){d.mousemove({xy:{x:a.clientX,y:a.clientY},element:document})},this._docUp=function(a){d.mouseup({xy:{x:a.clientX,y:a.clientY}})}}},dragstart:function(a){var b=!0;return this.dragging=!1,this.checkModifiers(a)&&(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))?(this.started=!0,this.start=a.xy,this.last=a.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(a),this.callback("down",[a.xy]),OpenLayers.Event.preventDefault(a),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,b=!this.stopDown):(this.started=!1,this.start=null,this.last=null),b},dragmove:function(a){return this.lastMoveEvt=a,!this.started||this.timeoutId||a.xy.x==this.last.x&&a.xy.y==this.last.y||(this.documentDrag===!0&&this.documentEvents&&(a.element===document?(this.adjustXY(a),this.setEvent(a)):this.removeDocumentEvents()),this.interval>0&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(a),this.callback("move",[a.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=a.xy),!0},dragend:function(a){if(this.started){this.documentDrag===!0&&this.documentEvents&&(this.adjustXY(a),this.removeDocumentEvents());var b=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.up(a),this.callback("up",[a.xy]),b&&this.callback("done",[a.xy]),document.onselectstart=this.oldOnselectstart}return!0},down:function(a){},move:function(a){},up:function(a){},out:function(a){},mousedown:function(a){return this.dragstart(a)},touchstart:function(a){return this.startTouch(),this.dragstart(a)},mousemove:function(a){return this.dragmove(a)},touchmove:function(a){return this.dragmove(a)},removeTimeout:function(){this.timeoutId=null,this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(a){return this.dragend(a)},touchend:function(a){return a.xy=this.last,this.dragend(a)},mouseout:function(a){if(this.started&&OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv))if(this.documentDrag===!0)this.addDocumentEvents();else{var b=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(a),this.callback("out",[]),b&&this.callback("done",[a.xy]),document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(a){return this.start==this.last},activate:function(){var a=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.dragging=!1,this.start=null,this.last=null,a=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")),a},adjustXY:function(a){var b=OpenLayers.Util.pagePosition(this.map.viewPortDiv);a.xy.x-=b[0],a.xy.y-=b[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown"),this.documentEvents=!0,
OpenLayers.Event.observe(document,"mousemove",this._docMove),OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown"),this.documentEvents=!1,OpenLayers.Event.stopObserving(document,"mousemove",this._docMove),OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"}),OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(a){OpenLayers.Handler.prototype.setMap.apply(this,arguments),this.dragHandler&&this.dragHandler.setMap(a)},startBox:function(a){this.callback("start",[]),this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999}),this.zoomBox.className=this.boxDivClassName,this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.viewPortDiv.appendChild(this.zoomBox),OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(a){var b=this.dragHandler.start.x,c=this.dragHandler.start.y,d=Math.abs(b-a.x),e=Math.abs(c-a.y),f=this.getBoxOffsets();this.zoomBox.style.width=d+f.width+1+"px",this.zoomBox.style.height=e+f.height+1+"px",this.zoomBox.style.left=(a.x<b?b-d-f.left:b-f.left)+"px",this.zoomBox.style.top=(a.y<c?c-e-f.top:c-f.top)+"px"},endBox:function(a){var b;if(Math.abs(this.dragHandler.start.x-a.x)>5||Math.abs(this.dragHandler.start.y-a.y)>5){var c=this.dragHandler.start,d=Math.min(c.y,a.y),e=Math.max(c.y,a.y),f=Math.min(c.x,a.x),g=Math.max(c.x,a.x);b=new OpenLayers.Bounds(f,e,g,d)}else b=this.dragHandler.start.clone();this.removeBox(),this.callback("done",[b])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox),this.zoomBox=null,this.boxOffsets=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return!!OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragHandler.activate(),!0)},deactivate:function(){return!!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0)},getBoxOffsets:function(){if(!this.boxOffsets){var a=document.createElement("div");a.style.position="absolute",a.style.border="1px solid black",a.style.width="3px",document.body.appendChild(a);var b=3==a.clientWidth;document.body.removeChild(a);var c=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),d=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),e=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),f=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:c,right:d,top:e,bottom:f,width:b===!1?c+d:0,height:b===!1?e+f:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"}),OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(a){if(a instanceof OpenLayers.Bounds){var b,c=a.getCenterPixel();if(this.out){var f=a.right-a.left,g=a.bottom-a.top,h=Math.min(this.map.size.h/g,this.map.size.w/f),i=this.map.getExtent(),j=this.map.getLonLatFromPixel(c),k=j.lon-i.getWidth()/2*h,l=j.lon+i.getWidth()/2*h,m=j.lat-i.getHeight()/2*h,n=j.lat+i.getHeight()/2*h;b=new OpenLayers.Bounds(k,m,l,n)}else{var d=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),e=this.map.getLonLatFromPixel({x:a.right,y:a.top});b=new OpenLayers.Bounds(d.lon,d.lat,e.lon,e.lat)}var o=this.map.getZoom(),p=this.map.getSize(),q={x:p.w/2,y:p.h/2},r=this.map.getZoomForExtent(b),s=this.map.getResolution(),t=this.map.getResolutionForZoom(r);if(s==t)this.map.setCenter(this.map.getLonLatFromPixel(c));else{var u={x:(s*c.x-t*q.x)/(s-t),y:(s*c.y-t*q.y)/(s-t)};this.map.zoomTo(r,u)}o==this.map.getZoom()&&1==this.alwaysZoom&&this.map.zoomTo(o+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,a):this.map.zoomTo(this.map.getZoom()+1,a))},CLASS_NAME:"OpenLayers.Control.ZoomBox"}),OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var a={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(a=OpenLayers.Util.extend(a,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(a)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(a){this.kinetic&&this.kinetic.update(a),this.panned=!0,this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:!0,animate:!1})},panMapDone:function(a){if(this.panned){var b=null;if(this.kinetic&&(b=this.kinetic.end(a)),this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:!!b,animate:!1}),b){var c=this;this.kinetic.move(b,function(a,b,d){c.map.pan(a,b,{dragging:!d,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"}),OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.wheelListener=null},onWheelEvent:function(a){if(this.map&&this.checkModifiers(a)){for(var b=!1,c=!1,d=!1,e=OpenLayers.Event.element(a);null!=e&&!d&&!b;){if(!b)try{var f;if(e.currentStyle)f=e.currentStyle.overflow;else{var g=document.defaultView.getComputedStyle(e,null);f=g.getPropertyValue("overflow")}b=f&&"auto"==f||"scroll"==f}catch(a){}if(!c&&(c=OpenLayers.Element.hasClass(e,"olScrollable"),!c))for(var h=0,i=this.map.layers.length;h<i;h++){var j=this.map.layers[h];if(e==j.div||e==j.pane){c=!0;break}}d=e==this.map.div,e=e.parentNode}if(!b&&d){if(c){var k=0;if(a.wheelDelta?(k=a.wheelDelta,k%160===0&&(k*=.75),k/=120):a.detail&&(k=-(a.detail/Math.abs(a.detail))),this.delta+=k,window.clearTimeout(this._timeoutId),this.interval&&Math.abs(this.delta)<this.maxDelta){var l=OpenLayers.Util.extend({},a);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(l)},this),this.interval)}else this.wheelZoom(a)}OpenLayers.Event.stop(a)}}},wheelZoom:function(a){var b=this.delta;this.delta=0,b&&(a.xy=this.map.events.getMousePosition(a),b<0?this.callback("down",[a,this.cumulative?Math.max(-this.maxDelta,b):-1]):this.callback("up",[a,this.cumulative?Math.min(this.maxDelta,b):1]))},activate:function(a){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b=this.wheelListener;return OpenLayers.Event.observe(window,"DOMMouseScroll",b),OpenLayers.Event.observe(window,"mousewheel",b),OpenLayers.Event.observe(document,"mousewheel",b),!0}return!1},deactivate:function(a){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var b=this.wheelListener;return OpenLayers.Event.stopObserving(window,"DOMMouseScroll",b),OpenLayers.Event.stopObserving(window,"mousewheel",b),OpenLayers.Event.stopObserving(document,"mousewheel",b),!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"}),OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,double:!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(a){return this.startTouch(),this.down=this.getEventInfo(a),this.last=this.getEventInfo(a),!0},touchmove:function(a){return this.last=this.getEventInfo(a),!0},touchend:function(a){return this.down&&(a.xy=this.last.xy,a.lastTouches=this.last.touches,this.handleSingle(a),this.down=null),!0},mousedown:function(a){return this.down=this.getEventInfo(a),this.last=this.getEventInfo(a),!0},mouseup:function(a){var b=!0;return this.checkModifiers(a)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(a)&&(b=this.rightclick(a)),b},rightclick:function(a){if(this.passesTolerance(a)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[a]),!this.stopDouble;var b=this.double?OpenLayers.Util.extend({},a):this.callback("rightclick",[a]),c=OpenLayers.Function.bind(this.delayedRightCall,this,b);this.rightclickTimerId=window.setTimeout(c,this.delay)}return!this.stopSingle},delayedRightCall:function(a){this.rightclickTimerId=null,a&&this.callback("rightclick",[a])},click:function(a){return this.last||(this.last=this.getEventInfo(a)),this.handleSingle(a),!this.stopSingle},dblclick:function(a){return this.handleDouble(a),!this.stopDouble},handleDouble:function(a){this.passesDblclickTolerance(a)&&(this.double&&this.callback("dblclick",[a]),this.clearTimer())},handleSingle:function(a){if(this.passesTolerance(a))if(null!=this.timerId)this.last.touches&&1===this.last.touches.length&&(this.double&&OpenLayers.Event.preventDefault(a),this.handleDouble(a)),this.last.touches&&2===this.last.touches.length||this.clearTimer();else{this.first=this.getEventInfo(a);var b=this.single?OpenLayers.Util.extend({},a):null;this.queuePotentialClick(b)}},queuePotentialClick:function(a){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)},passesTolerance:function(a){var b=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(b=this.pixelTolerance>=this.down.xy.distanceTo(a.xy),b&&this.touch&&this.down.touches.length===this.last.touches.length))for(var c=0,d=this.down.touches.length;c<d;++c)if(this.getTouchDistance(this.down.touches[c],this.last.touches[c])>this.pixelTolerance){b=!1;break}return b},getTouchDistance:function(a,b){return Math.sqrt(Math.pow(a.clientX-b.clientX,2)+Math.pow(a.clientY-b.clientY,2))},passesDblclickTolerance:function(a){var b=!0;return this.down&&this.first&&(b=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance),b},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(a){this.timerId=null,a&&this.callback("click",[a])},getEventInfo:function(a){var b;if(a.touches){var c=a.touches.length;b=new Array(c);for(var d,e=0;e<c;e++)d=a.touches[e],b[e]={clientX:d.olClientX,clientY:d.olClientY}}return{xy:a.xy,touches:b}},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.down=null,this.first=null,this.last=null,a=!0),a},CLASS_NAME:"OpenLayers.Handler.Click"}),OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(a){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.zoomBox&&this.zoomBox.destroy(),this.zoomBox=null,this.pinchZoom&&this.pinchZoom.destroy(),this.pinchZoom=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.dragPan.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.dragPan.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var a={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},b={double:!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,a,b),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask}),this.dragPan.draw(),this.zoomBox.draw();var c=this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6};this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(c,this.mouseWheelOptions)),OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(a){a.lastTouches&&2==a.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(a){this.map.zoomTo(this.map.zoom+1,a.xy)},defaultDblRightClick:function(a){this.map.zoomTo(this.map.zoom-1,a.xy)},wheelChange:function(a,b){this.map.fractionalZoom||(b=Math.round(b));var c=this.map.getZoom(),d=c+b;d=Math.max(d,0),d=Math.min(d,this.map.getNumZoomLevels()),d!==c&&this.map.zoomTo(d,a.xy)},wheelUp:function(a,b){this.wheelChange(a,b||1)},wheelDown:function(a,b){this.wheelChange(a,b||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1,this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0,this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1,this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0,this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"}),OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(a){OpenLayers.Util.extend(this,a)},begin:function(){OpenLayers.Animation.stop(this.timerId),this.timerId=void 0,this.points=[]},update:function(a){this.points.unshift({xy:a,tick:(new Date).getTime()}),this.points.length>this.nbPoints&&this.points.pop()},end:function(a){for(var b,f,c=(new Date).getTime(),d=0,e=this.points.length;d<e&&(f=this.points[d],!(c-f.tick>this.delay));d++)b=f;if(b){var g=(new Date).getTime()-b.tick,h=Math.sqrt(Math.pow(a.x-b.xy.x,2)+Math.pow(a.y-b.xy.y,2)),i=h/g;if(!(0==i||i<this.threshold)){var j=Math.asin((a.y-b.xy.y)/h);return b.xy.x<=a.x&&(j=Math.PI-j),{speed:i,theta:j}}}},move:function(a,b){var c=a.speed,d=Math.cos(a.theta),e=-Math.sin(a.theta),f=(new Date).getTime(),g=0,h=0,i=function(){if(null!=this.timerId){var a=(new Date).getTime()-f,i=-this.deceleration*Math.pow(a,2)/2+c*a,j=i*d,k=i*e,l={};l.end=!1;var m=-this.deceleration*a+c;m<=0&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,l.end=!0),l.x=j-g,l.y=k-h,g=j,h=k,b(l.x,l.y,l.end)}};this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(i,this))},CLASS_NAME:"OpenLayers.Kinetic"}),OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control.Button,{slideFactor:50,slideRatio:null,direction:null,initialize:function(a,b){this.direction=a,this.CLASS_NAME+=this.direction,OpenLayers.Control.prototype.initialize.apply(this,[b])},trigger:function(){if(this.map){var a=OpenLayers.Function.bind(function(a){return this.slideRatio?this.map.getSize()[a]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-a("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,a("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-a("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(a("w"),0)}}},CLASS_NAME:"OpenLayers.Control.Pan"}),OpenLayers.Control.Pan.NORTH="North",OpenLayers.Control.Pan.SOUTH="South",OpenLayers.Control.Pan.EAST="East",OpenLayers.Control.Pan.WEST="West",OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);var a={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,a)])},CLASS_NAME:"OpenLayers.Control.PanPanel"}),Ext.namespace("GeoExt"),GeoExt.ZoomSlider=Ext.extend(Ext.slider.SingleSlider,{map:null,baseCls:"gx-zoomslider",aggressive:!1,updating:!1,initComponent:function(){GeoExt.ZoomSlider.superclass.initComponent.call(this),this.map&&(this.map instanceof GeoExt.MapPanel&&(this.map=this.map.map),this.bind(this.map)),this.aggressive===!0?this.on("change",this.changeHandler,this):this.on("changecomplete",this.changeHandler,this),this.on("beforedestroy",this.unbind,this)},onRender:function(){GeoExt.ZoomSlider.superclass.onRender.apply(this,arguments),this.el.addClass(this.baseCls)},afterRender:function(){Ext.slider.SingleSlider.superclass.afterRender.apply(this,arguments),this.update()},addToMapPanel:function(a){this.on({render:function(){var b=this.getEl();b.setStyle({position:"absolute",zIndex:a.map.Z_INDEX_BASE.Control}),b.on({mousedown:this.stopMouseEvents,click:this.stopMouseEvents})},afterrender:function(){this.bind(a.map)},scope:this})},stopMouseEvents:function(a){a.stopEvent()},removeFromMapPanel:function(a){var b=this.getEl();b.un("mousedown",this.stopMouseEvents,this),b.un("click",this.stopMouseEvents,this),this.unbind()},bind:function(a){this.map=a,this.map.events.on({zoomend:this.onZoomEnd,updatesize:this.initZoomValues,changebaselayer:this.initZoomValues,scope:this}),this.initZoomValues()},onZoomEnd:function(){this.update()},unbind:function(){this.map&&this.map.events&&this.map.events.un({zoomend:this.onZoomEnd,updatesize:this.initZoomValues,changebaselayer:this.initZoomValues,scope:this})},initZoomValues:function(){var a=this.map.baseLayer;if(a){if(void 0===this.initialConfig.minValue){var b=this.map.getMinZoom?this.map.getMinZoom():0;this.minValue=Math.max(b,a.minZoomLevel||0)}void 0===this.initialConfig.maxValue&&(this.maxValue=null==a.minZoomLevel?a.numZoomLevels-1:a.maxZoomLevel),this.update(!0)}},getZoom:function(){return this.getValue()},getScale:function(){return OpenLayers.Util.getScaleFromResolution(this.map.getResolutionForZoom(this.getValue()),this.map.getUnits())},getResolution:function(){return this.map.getResolutionForZoom(this.getValue())},changeHandler:function(){this.map&&!this.updating&&this.map.zoomTo(this.getValue())},update:function(a){this.rendered&&this.map&&(this.updating=!0,a&&(this.thumbs[0].value=null),this.setValue(this.map.getZoom()),this.updating=!1)}}),Ext.reg("gx_zoomslider",GeoExt.ZoomSlider),Ext.namespace("GeoExt");GeoExt.ZoomSliderTip=Ext.extend(GeoExt.SliderTip,{template:"<div>Zoom Level: {zoom}</div><div>Resolution: {resolution}</div><div>Scale: 1 : {scale}</div>",compiledTemplate:null,init:function(a){this.compiledTemplate=new Ext.Template(this.template),GeoExt.ZoomSliderTip.superclass.init.call(this,a)},getText:function(a){var b={zoom:a.value,resolution:this.slider.getResolution(),scale:Math.round(this.slider.getScale())};return this.compiledTemplate.apply(b)}});Ext.namespace("gxp"),gxp.Viewer=Ext.extend(Ext.util.Observable,{defaultToolType:"gxp_tool",tools:null,selectedLayer:null,authenticate:null,saveErrorText:"Trouble saving: ",constructor:function(a){this.addEvents("ready","beforecreateportal","portalready","beforelayerselectionchange","layerselectionchange","featureedit","authorizationchange","beforesave","save","beforehashchange"),Ext.apply(this,{layerSources:{},portalItems:[]}),this.createLayerRecordQueue=[],(a.loadConfig||this.loadConfig).call(this,a,this.applyConfig),gxp.Viewer.superclass.constructor.apply(this,arguments)},selectLayer:function(a){a=a||null;var b=!1,c=this.fireEvent("beforelayerselectionchange",a);return c!==!1&&(b=!0,this.selectedLayer&&this.selectedLayer.set("selected",!1),this.selectedLayer=a,this.selectedLayer&&this.selectedLayer.set("selected",!0),this.fireEvent("layerselectionchange",a)),b},loadConfig:function(a){this.applyConfig(a)},applyConfig:function(a){this.initialConfig=Ext.apply({},a),Ext.apply(this,this.initialConfig),this.load()},load:function(){this.proxy&&(OpenLayers.ProxyHost=this.proxy),this.initMapPanel(),this.initTools();var b=[];for(var c in this.sources)b.push(this.createSourceLoader(c));b.push(function(a){Ext.onReady(function(){this.initPortal(),a()},this)}),gxp.util.dispatch(b,this.activate,this)},createSourceLoader:function(a){return function(b){var c=this.sources[a];c.projection=this.initialConfig.map.projection,this.addLayerSource({id:a,config:c,callback:b,fallback:function(a,c,d){b()},scope:this})}},addLayerSource:function(a){var c,b=a.id||Ext.id(null,"gxp-source-"),d=a.config;d.id=b;try{c=Ext.ComponentMgr.createPlugin(d,this.defaultSourceType)}catch(b){throw new Error("Could not create new source plugin with ptype: "+a.config.ptype)}return c.on({ready:{fn:function(){var c=a.callback||Ext.emptyFn;c.call(a.scope||this,b)},scope:this,single:!0},failure:{fn:function(){var c=a.fallback||Ext.emptyFn;delete this.layerSources[b],c.apply(a.scope||this,arguments)},scope:this,single:!0}}),this.layerSources[b]=c,c.init(this),c},initMapPanel:function(){var a=Ext.apply({},this.initialConfig.map),b={},c={wrapDateLine:void 0===a.wrapDateLine||a.wrapDateLine,maxResolution:a.maxResolution,numZoomLevels:a.numZoomLevels,displayInLayerSwitcher:!1};if(this.initialConfig.map)for(var e,d="theme,controls,resolutions,projection,units,maxExtent,restrictedExtent,maxResolution,numZoomLevels,panMethod".split(","),f=d.length-1;f>=0;--f)e=d[f],e in a&&(b[e]=a[e],delete a[e]);this.mapPanel=Ext.ComponentMgr.create(Ext.applyIf({xtype:a.xtype||"gx_mappanel",map:Ext.applyIf({theme:b.theme||null,controls:b.controls||[new OpenLayers.Control.Navigation({zoomWheelOptions:{interval:250},dragPanOptions:{enableKinetic:!0}}),new OpenLayers.Control.PanPanel,new OpenLayers.Control.ZoomPanel,new OpenLayers.Control.Attribution],maxExtent:b.maxExtent&&OpenLayers.Bounds.fromArray(b.maxExtent),restrictedExtent:b.restrictedExtent&&OpenLayers.Bounds.fromArray(b.restrictedExtent),numZoomLevels:b.numZoomLevels||20},b),center:a.center&&new OpenLayers.LonLat(a.center[0],a.center[1]),resolutions:a.resolutions,forceInitialExtent:!0,layers:[new OpenLayers.Layer(null,c)],items:this.mapItems,plugins:this.mapPlugins,tbar:a.tbar||new Ext.Toolbar({hidden:!0})},a)),this.mapPanel.getTopToolbar().on({afterlayout:this.mapPanel.map.updateSize,show:this.mapPanel.map.updateSize,hide:this.mapPanel.map.updateSize,scope:this.mapPanel.map}),this.mapPanel.layers.on({add:function(a,b){for(var c,d=b.length-1;d>=0;d--)c=b[d],c.get("selected")===!0&&this.selectLayer(c)},remove:function(a,b){b.get("selected")===!0&&this.selectLayer()},scope:this})},initTools:function(){if(this.tools={},this.initialConfig.tools&&this.initialConfig.tools.length>0)for(var a,b=0,c=this.initialConfig.tools.length;b<c;b++){try{a=Ext.ComponentMgr.createPlugin(this.initialConfig.tools[b],this.defaultToolType)}catch(a){throw new Error("Could not create tool plugin with ptype: "+this.initialConfig.tools[b].ptype)}a.init(this)}},initPortal:function(){var a=Ext.apply({},this.portalConfig);0===this.portalItems.length&&(this.mapPanel.region="center",this.portalItems.push(this.mapPanel)),this.fireEvent("beforecreateportal"),this.portal=Ext.ComponentMgr.create(Ext.applyIf(a,{layout:"fit",hideBorders:!0,items:{layout:"border",deferredRender:!1,items:this.portalItems}}),a.renderTo?"panel":"viewport"),this.fireEvent("portalready")},activate:function(){Ext.QuickTips.init(),this.addLayers(),this.checkLayerRecordQueue(),this.fireEvent("ready")},addLayers:function(){var a=this.initialConfig.map;if(a&&a.layers){for(var b,c,d,e=[],f=[],g=0;g<a.layers.length;++g)b=a.layers[g],c=this.layerSources[b.source],c?(d=c.createLayerRecord(b),d&&("background"===d.get("group")?e.push(d):f.push(d))):window.console&&console.warn("Non-existing source '"+b.source+"' referenced in layer config.");var h=this.mapPanel,j=(h.map,e.concat(f));j.length&&h.layers.add(j)}},getLayerRecordFromMap:function(a){var b=null;return this.mapPanel&&this.mapPanel.layers.each(function(c){if(c.get("source")==a.source&&c.get("name")==a.name)return b=c,!1}),b},createLayerRecord:function(a,b,c){this.createLayerRecordQueue.push({config:a,callback:b,scope:c}),this.checkLayerRecordQueue()},checkLayerRecordQueue:function(){for(var a,b,c,d,e,f=[],g=0,h=this.createLayerRecordQueue.length;g<h;++g)e=!1,a=this.createLayerRecordQueue[g],c=a.config.source,c in this.layerSources&&(b=this.layerSources[c],d=b.createLayerRecord(a.config),d?(!function(a,b){window.setTimeout(function(){a.callback.call(a.scope,b)},0)}(a,d),e=!0):b.lazy&&b.store.load({callback:this.checkLayerRecordQueue,scope:this})),e||f.push(a);this.createLayerRecordQueue=f},getSource:function(a){return a&&this.layerSources[a.get("source")]},getState:function(){var a=Ext.apply({},this.initialConfig),b=this.mapPanel.map.getCenter();Ext.apply(a.map,{center:[b.lon,b.lat],zoom:this.mapPanel.map.zoom,layers:[]});var c={};return this.mapPanel.layers.each(function(b){var d=b.getLayer();if(d.displayInLayerSwitcher){var e=b.get("source"),f=this.layerSources[e];if(!f)throw new Error("Could not find source for record '"+b.get("name")+" and layer "+d.name+"'");a.map.layers.push(f.getConfigForRecord(b)),c[e]||(c[e]=f.getState())}},this),Ext.apply(this.sources,c),a.tools=[],Ext.iterate(this.tools,function(b,c,d){c.getState!=gxp.plugins.Tool.prototype.getState&&a.tools.push(c.getState())}),a},isAuthorized:function(a){var b=!0;if(this.authorizedRoles){b=!1,a||(a="ROLE_ADMINISTRATOR"),Ext.isArray(a)||(a=[a]);for(var c=a.length-1;c>=0;--c)if(~this.authorizedRoles.indexOf(a[c])){b=!0;break}}return b},setAuthorizedRoles:function(a){this.authorizedRoles=a,this.fireEvent("authorizationchange")},cancelAuthentication:function(){this._authFn&&this.un("authorizationchange",this._authFn,this),this.fireEvent("authorizationchange")},isAuthenticated:function(a){return!this.authorizedRoles||this.authorizedRoles.length>0},doAuthorized:function(a,b,c){this.isAuthorized(a)||!this.authenticate?window.setTimeout(function(){b.call(c)},0):(this.authenticate(),this._authFn=function(){delete this._authFn,this.doAuthorized(a,b,c,!0)},this.on("authorizationchange",this._authFn,this,{single:!0}))},save:function(a,b){var d,e,c=Ext.util.JSON.encode(this.getState());this.id?(d="PUT",e="../maps/"+this.id):(d="POST",e="../maps/");var f={method:d,url:e,data:c};this.fireEvent("beforesave",f,a)!==!1&&OpenLayers.Request.issue(Ext.apply(f,{callback:function(c){this.handleSave(c),a&&a.call(b||this,c)},scope:this}))},handleSave:function(a){if(200==a.status){var b=Ext.util.JSON.decode(a.responseText),c=b.id;if(c){this.id=c;var d="#maps/"+c;this.fireEvent("beforehashchange",d)!==!1&&(window.location.hash=d),this.fireEvent("save",this.id)}}else window.console&&console.warn(this.saveErrorText+a.responseText)},destroy:function(){this.mapPanel.destroy(),this.portal&&this.portal.destroy()}}),function(){OpenLayers.DOTS_PER_INCH=25.4/.28}(),Ext.namespace("gxp"),gxp.EmbedMapDialog=Ext.extend(Ext.Container,{url:null,url:null,publishMessage:"Your map is ready to be published to the web! Simply copy the following HTML to embed the map in your website:",heightLabel:"Height",widthLabel:"Width",mapSizeLabel:"Map Size",miniSizeLabel:"Mini",smallSizeLabel:"Small",premiumSizeLabel:"Premium",largeSizeLabel:"Large",snippetArea:null,heightField:null,widthField:null,initComponent:function(){Ext.apply(this,this.getConfig()),gxp.EmbedMapDialog.superclass.initComponent.call(this)},getIframeHTML:function(){return this.snippetArea.getValue()},updateSnippet:function(){this.snippetArea.setValue('<iframe style="border: none;" height="'+this.heightField.getValue()+'" width="'+this.widthField.getValue()+'" src="'+gxp.util.getAbsoluteUrl(this.url)+'"></iframe>'),this.snippetArea.isVisible()===!0&&this.snippetArea.focus(!0,100)},getConfig:function(){this.snippetArea=new Ext.form.TextArea({height:70,selectOnFocus:!0,readOnly:!0});var a={change:this.updateSnippet,specialkey:function(a,b){b.getKey()==b.ENTER&&this.updateSnippet()},scope:this};this.heightField=new Ext.form.NumberField({width:50,value:400,listeners:a}),this.widthField=new Ext.form.NumberField({width:50,value:600,listeners:a});var b=new Ext.Container({layout:"column",defaults:{border:!1,xtype:"box"},items:[{autoEl:{cls:"gxp-field-label",html:this.mapSizeLabel}},new Ext.form.ComboBox({editable:!1,width:75,store:new Ext.data.SimpleStore({fields:["name","height","width"],data:[[this.miniSizeLabel,100,100],[this.smallSizeLabel,200,300],[this.largeSizeLabel,400,600],[this.premiumSizeLabel,600,800]]}),triggerAction:"all",displayField:"name",value:this.largeSizeLabel,mode:"local",listeners:{select:function(a,b,c){this.widthField.setValue(b.get("width")),this.heightField.setValue(b.get("height")),this.updateSnippet()},scope:this}}),{autoEl:{cls:"gxp-field-label",html:this.heightLabel}},this.heightField,{autoEl:{cls:"gxp-field-label",html:this.widthLabel}},this.widthField]});return{border:!1,defaults:{border:!1,cls:"gxp-export-section",xtype:"container",layout:"fit"},items:[{items:[b]},{xtype:"box",autoEl:{tag:"p",html:this.publishMessage}},{items:[this.snippetArea]}],listeners:{afterrender:this.updateSnippet,scope:this}}}}),Ext.reg("gxp_embedmapdialog",gxp.EmbedMapDialog),Ext.namespace("gxp"),gxp.RulePanel=Ext.extend(Ext.TabPanel,{fonts:void 0,symbolType:"Point",rule:null,attributes:null,nestedFilters:!0,minScaleDenominatorLimit:40075016.68*Math.pow(.5,19)*39.3701*OpenLayers.DOTS_PER_INCH/256,maxScaleDenominatorLimit:1577757414.193268*OpenLayers.DOTS_PER_INCH/256,scaleLevels:20,scaleSliderTemplate:"{scaleType} Scale 1:{scale}",modifyScaleTipContext:Ext.emptyFn,labelFeaturesText:"Label Features",labelsText:"Labels",basicText:"Basic",advancedText:"Advanced",limitByScaleText:"Limit by scale",limitByConditionText:"Limit by condition",symbolText:"Symbol",nameText:"Name",initComponent:function(){var a={plain:!0,border:!1};Ext.applyIf(this,a),this.rule?this.initialConfig.symbolType||(this.symbolType=this.getSymbolTypeFromRule(this.rule)||this.symbolType):this.rule=new OpenLayers.Rule({name:this.uniqueRuleName()}),this.activeTab=0,this.textSymbolizer=new gxp.TextSymbolizer({symbolizer:this.getTextSymbolizer(),attributes:this.attributes,fonts:this.fonts,listeners:{change:function(a){this.fireEvent("change",this,this.rule)},scope:this}}),this.scaleLimitPanel=new gxp.ScaleLimitPanel({maxScaleDenominator:this.rule.maxScaleDenominator||void 0,limitMaxScaleDenominator:!!this.rule.maxScaleDenominator,maxScaleDenominatorLimit:this.maxScaleDenominatorLimit,minScaleDenominator:this.rule.minScaleDenominator||void 0,limitMinScaleDenominator:!!this.rule.minScaleDenominator,minScaleDenominatorLimit:this.minScaleDenominatorLimit,scaleLevels:this.scaleLevels,scaleSliderTemplate:this.scaleSliderTemplate,modifyScaleTipContext:this.modifyScaleTipContext,listeners:{change:function(a,b,c){this.rule.minScaleDenominator=b,this.rule.maxScaleDenominator=c,this.fireEvent("change",this,this.rule)},scope:this}}),this.filterBuilder=new gxp.FilterBuilder({allowGroups:this.nestedFilters,filter:this.rule&&this.rule.filter&&this.rule.filter.clone(),attributes:this.attributes,listeners:{change:function(a){var b=a.getFilter();this.rule.filter=b,this.fireEvent("change",this,this.rule);
},scope:this}}),this.items=[{title:this.labelsText,autoScroll:!0,bodyStyle:{padding:"10px"},items:[{xtype:"fieldset",title:this.labelFeaturesText,autoHeight:!0,checkboxToggle:!0,collapsed:!this.hasTextSymbolizer(),items:[this.textSymbolizer],listeners:{collapse:function(){OpenLayers.Util.removeItem(this.rule.symbolizers,this.getTextSymbolizer()),this.fireEvent("change",this,this.rule)},expand:function(){this.setTextSymbolizer(this.textSymbolizer.symbolizer),this.fireEvent("change",this,this.rule)},scope:this}}]}],(this.getSymbolTypeFromRule(this.rule)||this.symbolType)&&(this.items=[{title:this.basicText,autoScroll:!0,items:[this.createHeaderPanel(),this.createSymbolizerPanel()]},this.items[0],{title:this.advancedText,defaults:{style:{margin:"7px"}},autoScroll:!0,items:[{xtype:"fieldset",title:this.limitByScaleText,checkboxToggle:!0,collapsed:!(this.rule&&(this.rule.minScaleDenominator||this.rule.maxScaleDenominator)),autoHeight:!0,items:[this.scaleLimitPanel],listeners:{collapse:function(){delete this.rule.minScaleDenominator,delete this.rule.maxScaleDenominator,this.fireEvent("change",this,this.rule)},expand:function(){var a=this.getActiveTab();this.activeTab=null,this.setActiveTab(a);var b=!1;this.scaleLimitPanel.limitMinScaleDenominator&&(this.rule.minScaleDenominator=this.scaleLimitPanel.minScaleDenominator,b=!0),this.scaleLimitPanel.limitMaxScaleDenominator&&(this.rule.maxScaleDenominator=this.scaleLimitPanel.maxScaleDenominator,b=!0),b&&this.fireEvent("change",this,this.rule)},scope:this}},{xtype:"fieldset",title:this.limitByConditionText,checkboxToggle:!0,collapsed:!(this.rule&&this.rule.filter),autoHeight:!0,items:[this.filterBuilder],listeners:{collapse:function(){delete this.rule.filter,this.fireEvent("change",this,this.rule)},expand:function(){this.rule.filter=this.filterBuilder.getFilter(),this.fireEvent("change",this,this.rule)},scope:this}}]}]),this.items[0].autoHeight=!0,this.addEvents("change"),this.on({tabchange:function(a,b){b.doLayout()},scope:this}),gxp.RulePanel.superclass.initComponent.call(this)},hasTextSymbolizer:function(){for(var a,b,c=0,d=this.rule.symbolizers.length;c<d;++c)if(a=this.rule.symbolizers[c],a instanceof OpenLayers.Symbolizer.Text){b=a;break}return b},getTextSymbolizer:function(){var a=this.hasTextSymbolizer();return a||(a=new OpenLayers.Symbolizer.Text({graphic:!1})),a},setTextSymbolizer:function(a){for(var b,c=0,d=this.rule.symbolizers.length;c<d;++c)if(candidate=this.rule.symbolizers[c],this.rule.symbolizers[c]instanceof OpenLayers.Symbolizer.Text){this.rule.symbolizers[c]=a,b=!0;break}b||this.rule.symbolizers.push(a)},uniqueRuleName:function(){return OpenLayers.Util.createUniqueID("rule_")},createHeaderPanel:function(){return this.symbolizerSwatch=new GeoExt.FeatureRenderer({symbolType:this.symbolType,isFormField:!0,fieldLabel:this.symbolText}),{xtype:"form",border:!1,labelAlign:"top",defaults:{border:!1},style:{padding:"0.3em 0 0 1em"},items:[{layout:"column",defaults:{border:!1,style:{"padding-right":"1em"}},items:[{layout:"form",width:150,items:[{xtype:"textfield",fieldLabel:this.nameText,anchor:"95%",value:this.rule&&(this.rule.title||this.rule.name||""),listeners:{change:function(a,b){this.rule.title=b,this.fireEvent("change",this,this.rule)},scope:this}}]},{layout:"form",width:70,items:[this.symbolizerSwatch]}]}]}},createSymbolizerPanel:function(){var a,b,c=OpenLayers.Symbolizer[this.symbolType],d=!1;if(!c)throw new Error("Appropriate symbolizer type not included in build: "+this.symbolType);for(var e=0,f=this.rule.symbolizers.length;e<f;++e)if(a=this.rule.symbolizers[e],a instanceof c){d=!0,b=a;break}b||(b=new c({fill:!1,stroke:!1})),this.symbolizerSwatch.setSymbolizers([b],{draw:this.symbolizerSwatch.rendered});var g={xtype:"gxp_"+this.symbolType.toLowerCase()+"symbolizer",symbolizer:b,bodyStyle:{padding:"10px"},border:!1,labelWidth:70,defaults:{labelWidth:70},listeners:{change:function(a){this.symbolizerSwatch.setSymbolizers([a],{draw:this.symbolizerSwatch.rendered}),d||(this.rule.symbolizers.push(a),d=!0),this.fireEvent("change",this,this.rule)},scope:this}};return"Point"===this.symbolType&&this.pointGraphics&&(g.pointGraphics=this.pointGraphics),g},getSymbolTypeFromRule:function(a){for(var b,c,d=0,e=a.symbolizers.length;d<e;++d)if(b=a.symbolizers[d],!(b instanceof OpenLayers.Symbolizer.Text)){c=b.CLASS_NAME.split(".").pop();break}return c}}),Ext.reg("gxp_rulepanel",gxp.RulePanel),Ext.namespace("gxp"),gxp.StylePropertiesDialog=Ext.extend(Ext.Container,{titleText:"General",nameFieldText:"Name",titleFieldText:"Title",abstractFieldText:"Abstract",userStyle:null,initComponent:function(){var a={change:function(a,b){this.userStyle[a.name]=b,this.fireEvent("change",this,this.userStyle)},scope:this},b={layout:"form",items:[{xtype:"fieldset",title:this.titleText,labelWidth:75,defaults:{xtype:"textfield",anchor:"100%",listeners:a},items:[{xtype:this.initialConfig.nameEditable?"textfield":"displayfield",fieldLabel:this.nameFieldText,name:"name",value:this.userStyle.name,maskRe:/[A-Za-z0-9_]/},{fieldLabel:this.titleFieldText,name:"title",value:this.userStyle.title},{xtype:"textarea",fieldLabel:this.abstractFieldText,name:"description",value:this.userStyle.description}]}]};Ext.applyIf(this,b),this.addEvents("change"),gxp.StylePropertiesDialog.superclass.initComponent.apply(this,arguments)}}),Ext.reg("gxp_stylepropertiesdialog",gxp.StylePropertiesDialog),OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(a){this.compare=a?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(a){this.exists(a)&&this.remove(a);var b=a.id;this.determineZIndex(a);for(var e,c=-1,d=this.order.length;d-c>1;){e=parseInt((c+d)/2);var f=this.compare(this,a,OpenLayers.Util.getElement(this.order[e]));f>0?c=e:d=e}return this.order.splice(d,0,b),this.indices[b]=this.getZIndex(a),this.getNextElement(d)},remove:function(a){var b=a.id,c=OpenLayers.Util.indexOf(this.order,b);if(c>=0)if(this.order.splice(c,1),delete this.indices[b],this.order.length>0){var d=this.order[this.order.length-1];this.maxZIndex=this.indices[d]}else this.maxZIndex=0},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(a){return null!=this.indices[a.id]},getZIndex:function(a){return a._style.graphicZIndex},determineZIndex:function(a){var b=a._style.graphicZIndex;null==b?(b=this.maxZIndex,a._style.graphicZIndex=b):b>this.maxZIndex&&(this.maxZIndex=b)},getNextElement:function(a){var b=a+1;if(b<this.order.length){var c=OpenLayers.Util.getElement(this.order[b]);return void 0==c&&(c=this.getNextElement(b)),c}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(a,b,c){var d=a.getZIndex(b),e=0;if(c){var f=a.getZIndex(c);e=d-f}return e},Z_ORDER_DRAWING_ORDER:function(a,b,c){var d=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);return c&&0==d&&(d=1),d},Z_ORDER_Y_ORDER:function(a,b,c){var d=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);if(c&&0===d){var e=c._boundsBottom-b._boundsBottom;d=0===e?1:e}return d}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.createRoot("_troot"),this.root.appendChild(this.vectorRoot),this.root.appendChild(this.textRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),b&&(b.zIndexing||b.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(b.yOrdering))},destroy:function(){this.clear(),this.rendererRoot=null,this.root=null,this.xmlns=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var a,b=this.vectorRoot;if(b)for(;a=b.firstChild;)b.removeChild(a);if(b=this.textRoot)for(;a=b.firstChild;)b.removeChild(a);this.indexer&&this.indexer.clear()},setExtent:function(a,b){var c=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),d=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var e,f=a.getWidth()/this.map.getExtent().getWidth(),a=a.scale(1/f),g=this.map.getMaxExtent();g.right>a.left&&g.right<a.right?e=!0:g.left>a.left&&g.left<a.right&&(e=!1),(e!==this.rightOfDateLine||b)&&(c=!1,this.xOffset=e===!0?g.getWidth()/d:0),this.rightOfDateLine=e}return c},getNodeType:function(a,b){},drawGeometry:function(a,b,c){var d=a.CLASS_NAME,e=!0;if("OpenLayers.Geometry.Collection"==d||"OpenLayers.Geometry.MultiPoint"==d||"OpenLayers.Geometry.MultiLineString"==d||"OpenLayers.Geometry.MultiPolygon"==d){for(var f=0,g=a.components.length;f<g;f++)e=this.drawGeometry(a.components[f],b,c)&&e;return e}e=!1;var h=!1;if("none"!=b.display&&(b.backgroundGraphic?this.redrawBackgroundNode(a.id,a,b,c):h=!0,e=this.redrawNode(a.id,a,b,c)),0==e){var i=document.getElementById(a.id);i&&(i._style.backgroundGraphic&&(h=!0),i.parentNode.removeChild(i))}if(h){var i=document.getElementById(a.id+this.BACKGROUND_ID_SUFFIX);i&&i.parentNode.removeChild(i)}return e},redrawNode:function(a,b,c,d){c=this.applyDefaultSymbolizer(c);var e=this.nodeFactory(a,this.getNodeType(b,c));e._featureId=d,e._boundsBottom=b.getBounds().bottom,e._geometryClass=b.CLASS_NAME,e._style=c;var f=this.drawGeometryNode(e,b,c);if(f===!1)return!1;if(e=f.node,this.indexer){var g=this.indexer.insert(e);g?this.vectorRoot.insertBefore(e,g):this.vectorRoot.appendChild(e)}else e.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(e);return this.postDraw(e),f.complete},redrawBackgroundNode:function(a,b,c,d){var e=OpenLayers.Util.extend({},c);return e.externalGraphic=e.backgroundGraphic,e.graphicXOffset=e.backgroundXOffset,e.graphicYOffset=e.backgroundYOffset,e.graphicZIndex=e.backgroundGraphicZIndex,e.graphicWidth=e.backgroundWidth||e.graphicWidth,e.graphicHeight=e.backgroundHeight||e.graphicHeight,e.backgroundGraphic=null,e.backgroundXOffset=null,e.backgroundYOffset=null,e.backgroundGraphicZIndex=null,this.redrawNode(a+this.BACKGROUND_ID_SUFFIX,b,e,null)},drawGeometryNode:function(a,b,c){c=c||a._style;var e,d={isFilled:void 0===c.fill||c.fill,isStroked:void 0===c.stroke?!!c.strokeWidth:c.stroke};switch(b.CLASS_NAME){case"OpenLayers.Geometry.Point":c.graphic===!1&&(d.isFilled=!1,d.isStroked=!1),e=this.drawPoint(a,b);break;case"OpenLayers.Geometry.LineString":d.isFilled=!1,e=this.drawLineString(a,b);break;case"OpenLayers.Geometry.LinearRing":e=this.drawLinearRing(a,b);break;case"OpenLayers.Geometry.Polygon":e=this.drawPolygon(a,b);break;case"OpenLayers.Geometry.Rectangle":e=this.drawRectangle(a,b)}return a._options=d,0!=e&&{node:this.setStyle(a,c,d,b),complete:e}},postDraw:function(a){},drawPoint:function(a,b){},drawLineString:function(a,b){},drawLinearRing:function(a,b){},drawPolygon:function(a,b){},drawRectangle:function(a,b){},drawCircle:function(a,b){},removeText:function(a){var b=document.getElementById(a+this.LABEL_ID_SUFFIX);b&&this.textRoot.removeChild(b);var c=document.getElementById(a+this.LABEL_OUTLINE_SUFFIX);c&&this.textRoot.removeChild(c)},getFeatureIdFromEvent:function(a){var b=a.target,c=b&&b.correspondingUseElement,d=c?c:b||a.srcElement;return d._featureId},eraseGeometry:function(a,b){if("OpenLayers.Geometry.MultiPoint"==a.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==a.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==a.CLASS_NAME||"OpenLayers.Geometry.Collection"==a.CLASS_NAME)for(var c=0,d=a.components.length;c<d;c++)this.eraseGeometry(a.components[c],b);else{var e=OpenLayers.Util.getElement(a.id);if(e&&e.parentNode&&(e.geometry&&(e.geometry.destroy(),e.geometry=null),e.parentNode.removeChild(e),this.indexer&&this.indexer.remove(e),e._style.backgroundGraphic)){var f=a.id+this.BACKGROUND_ID_SUFFIX,g=OpenLayers.Util.getElement(f);g&&g.parentNode&&g.parentNode.removeChild(g)}}},nodeFactory:function(a,b){var c=OpenLayers.Util.getElement(a);return c?this.nodeTypeCompare(c,b)||(c.parentNode.removeChild(c),c=this.nodeFactory(a,b)):c=this.createNode(b,a),c},nodeTypeCompare:function(a,b){},createNode:function(a,b){},moveRoot:function(a){var b=this.root;a.root.parentNode==this.rendererRoot&&(b=a.root),b.parentNode.removeChild(b),a.rendererRoot.appendChild(b)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(a){return"circle"!=a&&!!a},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(a){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){var a="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(a+"SVG","1.1")||document.implementation.hasFeature(a+"BasicStructure","1.1"))},inValidRange:function(a,b,c){var d=a+(c?0:this.translationParameters.x),e=b+(c?0:this.translationParameters.y);return d>=-this.MAX_PIXEL&&d<=this.MAX_PIXEL&&e>=-this.MAX_PIXEL&&e<=this.MAX_PIXEL},setExtent:function(a,b){var c=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),d=this.getResolution(),e=-a.left/d,f=a.top/d;if(b){this.left=e,this.top=f;var g="0 0 "+this.size.w+" "+this.size.h;return this.rendererRoot.setAttributeNS(null,"viewBox",g),this.translate(this.xOffset,0),!0}var h=this.translate(e-this.left+this.xOffset,f-this.top);return h||this.setExtent(a,!0),c&&h},translate:function(a,b){if(this.inValidRange(a,b,!0)){var c="";return(a||b)&&(c="translate("+a+","+b+")"),this.root.setAttributeNS(null,"transform",c),this.translationParameters={x:a,y:b},!0}return!1},setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":c=b.externalGraphic?"image":this.isComplexSymbol(b.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":c="rect";break;case"OpenLayers.Geometry.LineString":c="polyline";break;case"OpenLayers.Geometry.LinearRing":c="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":c="path"}return c},setStyle:function(a,b,c){b=b||a._style,c=c||a._options;var d=b.title||b.graphicTitle;if(d){a.setAttributeNS(null,"title",d);var e=a.getElementsByTagName("title");if(e.length>0)e[0].firstChild.textContent=d;else{var f=this.nodeFactory(null,"title");f.textContent=d,a.appendChild(f)}}var i,g=parseFloat(a.getAttributeNS(null,"r")),h=1;if("OpenLayers.Geometry.Point"==a._geometryClass&&g){if(a.style.visibility="",b.graphic===!1)a.style.visibility="hidden";else if(b.externalGraphic){i=this.getPosition(a),b.graphicWidth&&b.graphicHeight&&a.setAttributeNS(null,"preserveAspectRatio","none");var j=b.graphicWidth||b.graphicHeight,k=b.graphicHeight||b.graphicWidth;j=j?j:2*b.pointRadius,k=k?k:2*b.pointRadius;var l=void 0!=b.graphicXOffset?b.graphicXOffset:-(.5*j),m=void 0!=b.graphicYOffset?b.graphicYOffset:-(.5*k),n=b.graphicOpacity||b.fillOpacity;a.setAttributeNS(null,"x",(i.x+l).toFixed()),a.setAttributeNS(null,"y",(i.y+m).toFixed()),a.setAttributeNS(null,"width",j),a.setAttributeNS(null,"height",k),a.setAttributeNS(this.xlinkns,"xlink:href",b.externalGraphic),a.setAttributeNS(null,"style","opacity: "+n),a.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(b.graphicName)){var o=3*b.pointRadius,p=2*o,q=this.importSymbol(b.graphicName);i=this.getPosition(a),h=3*this.symbolMetrics[q.id][0]/p;var r=a.parentNode,s=a.nextSibling;r&&r.removeChild(a),a.firstChild&&a.removeChild(a.firstChild),a.appendChild(q.firstChild.cloneNode(!0)),a.setAttributeNS(null,"viewBox",q.getAttributeNS(null,"viewBox")),a.setAttributeNS(null,"width",p),a.setAttributeNS(null,"height",p),a.setAttributeNS(null,"x",i.x-o),a.setAttributeNS(null,"y",i.y-o),s?r.insertBefore(a,s):r&&r.appendChild(a)}else a.setAttributeNS(null,"r",b.pointRadius);var t=b.rotation;if((void 0!==t||void 0!==a._rotation)&&i)if(a._rotation=t,t|=0,"svg"!==a.nodeName)a.setAttributeNS(null,"transform","rotate("+t+" "+i.x+" "+i.y+")");else{var u=this.symbolMetrics[q.id];a.firstChild.setAttributeNS(null,"transform","rotate("+t+" "+u[1]+" "+u[2]+")")}}return c.isFilled?(a.setAttributeNS(null,"fill",b.fillColor),a.setAttributeNS(null,"fill-opacity",b.fillOpacity)):a.setAttributeNS(null,"fill","none"),c.isStroked?(a.setAttributeNS(null,"stroke",b.strokeColor),a.setAttributeNS(null,"stroke-opacity",b.strokeOpacity),a.setAttributeNS(null,"stroke-width",b.strokeWidth*h),a.setAttributeNS(null,"stroke-linecap",b.strokeLinecap||"round"),a.setAttributeNS(null,"stroke-linejoin","round"),b.strokeDashstyle&&a.setAttributeNS(null,"stroke-dasharray",this.dashStyle(b,h))):a.setAttributeNS(null,"stroke","none"),b.pointerEvents&&a.setAttributeNS(null,"pointer-events",b.pointerEvents),null!=b.cursor&&a.setAttributeNS(null,"cursor",b.cursor),a},dashStyle:function(a,b){var c=a.strokeWidth*b,d=a.strokeDashstyle;switch(d){case"solid":return"none";case"dot":return[1,4*c].join();case"dash":return[4*c,4*c].join();case"dashdot":return[4*c,4*c,1,4*c].join();case"longdash":return[8*c,4*c].join();case"longdashdot":return[8*c,4*c,1,4*c].join();default:return OpenLayers.String.trim(d).replace(/\s+/g,",")}},createNode:function(a,b){var c=document.createElementNS(this.xmlns,a);return b&&c.setAttributeNS(null,"id",b),c},nodeTypeCompare:function(a,b){return b==a.nodeName},createRenderRoot:function(){var a=this.nodeFactory(this.container.id+"_svgRoot","svg");return a.style.display="block",a},createRoot:function(a){return this.nodeFactory(this.container.id+a,"g")},createDefs:function(){var a=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(a),a},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(a,b,c){var d=this.getResolution(),e=(b.x-this.featureDx)/d+this.left,f=this.top-b.y/d;return!!this.inValidRange(e,f)&&(a.setAttributeNS(null,"cx",e),a.setAttributeNS(null,"cy",f),a.setAttributeNS(null,"r",c),a)},drawLineString:function(a,b){var c=this.getComponentsString(b.components);return!!c.path&&(a.setAttributeNS(null,"points",c.path),c.complete?a:null)},drawLinearRing:function(a,b){var c=this.getComponentsString(b.components);return!!c.path&&(a.setAttributeNS(null,"points",c.path),c.complete?a:null)},drawPolygon:function(a,b){for(var f,g,c="",d=!0,e=!0,h=0,i=b.components.length;h<i;h++)c+=" M",f=this.getComponentsString(b.components[h].components," "),g=f.path,g?(c+=" "+g,e=f.complete&&e):d=!1;return c+=" z",!!d&&(a.setAttributeNS(null,"d",c),a.setAttributeNS(null,"fill-rule","evenodd"),e?a:null)},drawRectangle:function(a,b){var c=this.getResolution(),d=(b.x-this.featureDx)/c+this.left,e=this.top-b.y/c;return!!this.inValidRange(d,e)&&(a.setAttributeNS(null,"x",d),a.setAttributeNS(null,"y",e),a.setAttributeNS(null,"width",b.width/c),a.setAttributeNS(null,"height",b.height/c),a)},drawText:function(a,b,c){var d=!!b.labelOutlineWidth;if(d){var e=OpenLayers.Util.extend({},b);e.fontColor=e.labelOutlineColor,e.fontStrokeColor=e.labelOutlineColor,e.fontStrokeWidth=b.labelOutlineWidth,b.labelOutlineOpacity&&(e.fontOpacity=b.labelOutlineOpacity),delete e.labelOutlineWidth,this.drawText(a,e,c)}var f=this.getResolution(),g=(c.x-this.featureDx)/f+this.left,h=c.y/f-this.top,i=d?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,j=this.nodeFactory(a+i,"text");j.setAttributeNS(null,"x",g),j.setAttributeNS(null,"y",-h),b.fontColor&&j.setAttributeNS(null,"fill",b.fontColor),b.fontStrokeColor&&j.setAttributeNS(null,"stroke",b.fontStrokeColor),b.fontStrokeWidth&&j.setAttributeNS(null,"stroke-width",b.fontStrokeWidth),b.fontOpacity&&j.setAttributeNS(null,"opacity",b.fontOpacity),b.fontFamily&&j.setAttributeNS(null,"font-family",b.fontFamily),b.fontSize&&j.setAttributeNS(null,"font-size",b.fontSize),b.fontWeight&&j.setAttributeNS(null,"font-weight",b.fontWeight),b.fontStyle&&j.setAttributeNS(null,"font-style",b.fontStyle),b.labelSelect===!0?(j.setAttributeNS(null,"pointer-events","visible"),j._featureId=a):j.setAttributeNS(null,"pointer-events","none");var k=b.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;j.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[k[0]]||"middle"),OpenLayers.IS_GECKO===!0&&j.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[k[1]]||"central");for(var l=b.label.split("\n"),m=l.length;j.childNodes.length>m;)j.removeChild(j.lastChild);for(var n=0;n<m;n++){var o=this.nodeFactory(a+i+"_tspan_"+n,"tspan");if(b.labelSelect===!0&&(o._featureId=a,o._geometry=c,o._geometryClass=c.CLASS_NAME),OpenLayers.IS_GECKO===!1&&o.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[k[1]]||"-35%"),o.setAttribute("x",g),0==n){var p=OpenLayers.Renderer.SVG.LABEL_VFACTOR[k[1]];null==p&&(p=-.5),o.setAttribute("dy",p*(m-1)+"em")}else o.setAttribute("dy","1em");o.textContent=""===l[n]?" ":l[n],o.parentNode||j.appendChild(o)}j.parentNode||this.textRoot.appendChild(j)},getComponentsString:function(a,b){for(var g,h,c=[],d=!0,e=a.length,f=[],i=0;i<e;i++)h=a[i],c.push(h),g=this.getShortString(h),g?f.push(g):(i>0&&this.getShortString(a[i-1])&&f.push(this.clipLine(a[i],a[i-1])),i<e-1&&this.getShortString(a[i+1])&&f.push(this.clipLine(a[i],a[i+1])),d=!1);return{path:f.join(b||","),complete:d}},clipLine:function(a,b){if(b.equals(a))return"";var j,c=this.getResolution(),d=this.MAX_PIXEL-this.translationParameters.x,e=this.MAX_PIXEL-this.translationParameters.y,f=(b.x-this.featureDx)/c+this.left,g=this.top-b.y/c,h=(a.x-this.featureDx)/c+this.left,i=this.top-a.y/c;return(h<-d||h>d)&&(j=(i-g)/(h-f),h=h<0?-d:d,i=g+(h-f)*j),(i<-e||i>e)&&(j=(h-f)/(i-g),i=i<0?-e:e,h=f+(i-g)*j),h+","+i},getShortString:function(a){var b=this.getResolution(),c=(a.x-this.featureDx)/b+this.left,d=this.top-a.y/b;return!!this.inValidRange(c,d)&&c+","+d},getPosition:function(a){return{x:parseFloat(a.getAttributeNS(null,"cx")),y:parseFloat(a.getAttributeNS(null,"cy"))}},importSymbol:function(a){this.defs||(this.defs=this.createDefs());var b=this.container.id+"-"+a,c=document.getElementById(b);if(null!=c)return c;var d=OpenLayers.Renderer.symbol[a];if(!d)throw new Error(a+" is not a valid symbol name");var e=this.nodeFactory(b,"symbol"),f=this.nodeFactory(null,"polygon");e.appendChild(f);for(var i,j,g=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),h=[],k=0;k<d.length;k+=2)i=d[k],j=d[k+1],g.left=Math.min(g.left,i),g.bottom=Math.min(g.bottom,j),g.right=Math.max(g.right,i),g.top=Math.max(g.top,j),h.push(i,",",j);f.setAttributeNS(null,"points",h.join(" "));var l=g.getWidth(),m=g.getHeight(),n=[g.left-l,g.bottom-m,3*l,3*m];return e.setAttributeNS(null,"viewBox",n.join(" ")),this.symbolMetrics[b]=[Math.max(l,m),g.getCenterLonLat().lon,g.getCenterLonLat().lat],this.defs.appendChild(e),e},getFeatureIdFromEvent:function(a){var b=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!b){var c=a.target;b=c.parentNode&&c!=this.rendererRoot?c.parentNode._featureId:void 0}return b},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG.preventDefault=function(a){OpenLayers.Event.preventDefault(a)},OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(a){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var b=document.createStyleSheet(),c=["shape","rect","oval","fill","stroke","imagedata","group","textbox"],d=0,e=c.length;d<e;d++)b.addRule("olv\\:"+c[d],"behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return!!document.namespaces},setExtent:function(a,b){var c=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),d=this.getResolution(),e=a.left/d|0,f=a.top/d-this.size.h|0;b||!this.offset?(this.offset={x:e,y:f},e=0,f=0):(e-=this.offset.x,f-=this.offset.y);var g=e-this.xOffset+" "+f;this.root.coordorigin=g;for(var i,h=[this.root,this.vectorRoot,this.textRoot],j=0,k=h.length;j<k;++j){i=h[j];var l=this.size.w+" "+this.size.h;i.coordsize=l}return this.root.style.flip="y",c},setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var e,b=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],c=this.size.w+"px",d=this.size.h+"px",f=0,g=b.length;f<g;++f)e=b[f],e.style.width=c,e.style.height=d},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":c=b.externalGraphic?"olv:rect":this.isComplexSymbol(b.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":c="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":c="olv:shape"}return c},setStyle:function(a,b,c,d){b=b||a._style,c=c||a._options;var e=b.fillColor,f=b.title||b.graphicTitle;if(f&&(a.title=f),"OpenLayers.Geometry.Point"===a._geometryClass)if(b.externalGraphic){c.isFilled=!0;var g=b.graphicWidth||b.graphicHeight,h=b.graphicHeight||b.graphicWidth;g=g?g:2*b.pointRadius,h=h?h:2*b.pointRadius;var i=this.getResolution(),j=void 0!=b.graphicXOffset?b.graphicXOffset:-(.5*g),k=void 0!=b.graphicYOffset?b.graphicYOffset:-(.5*h);a.style.left=((d.x-this.featureDx)/i-this.offset.x+j|0)+"px",a.style.top=(d.y/i-this.offset.y-(k+h)|0)+"px",a.style.width=g+"px",a.style.height=h+"px",a.style.flip="y",e="none",c.isStroked=!1}else if(this.isComplexSymbol(b.graphicName)){var l=this.importSymbol(b.graphicName);a.path=l.path,a.coordorigin=l.left+","+l.bottom;var m=l.size;a.coordsize=m+","+m,this.drawCircle(a,d,b.pointRadius),a.style.flip="y"}else this.drawCircle(a,d,b.pointRadius);c.isFilled?a.fillcolor=e:a.filled="false";var n=a.getElementsByTagName("fill"),o=0==n.length?null:n[0];c.isFilled?(o||(o=this.createNode("olv:fill",a.id+"_fill")),o.opacity=b.fillOpacity,"OpenLayers.Geometry.Point"===a._geometryClass&&b.externalGraphic&&(b.graphicOpacity&&(o.opacity=b.graphicOpacity),o.src=b.externalGraphic,o.type="frame",b.graphicWidth&&b.graphicHeight||(o.aspect="atmost")),o.parentNode!=a&&a.appendChild(o)):o&&a.removeChild(o);var p=b.rotation;void 0===p&&void 0===a._rotation||(a._rotation=p,b.externalGraphic?(this.graphicRotate(a,j,k,b),o.opacity=0):"OpenLayers.Geometry.Point"===a._geometryClass&&(a.style.rotation=p||0));var q=a.getElementsByTagName("stroke"),r=0==q.length?null:q[0];return c.isStroked?(r||(r=this.createNode("olv:stroke",a.id+"_stroke"),a.appendChild(r)),r.on=!0,r.color=b.strokeColor,r.weight=b.strokeWidth+"px",r.opacity=b.strokeOpacity,r.endcap="butt"==b.strokeLinecap?"flat":b.strokeLinecap||"round",b.strokeDashstyle&&(r.dashstyle=this.dashStyle(b))):(a.stroked=!1,r&&(r.on=!1)),"inherit"!=b.cursor&&null!=b.cursor&&(a.style.cursor=b.cursor),a},graphicRotate:function(a,b,c,d){var f,g,d=d||a._style,e=d.rotation||0;if(!d.graphicWidth||!d.graphicHeight){var h=new Image;return h.onreadystatechange=OpenLayers.Function.bind(function(){"complete"!=h.readyState&&"interactive"!=h.readyState||(f=h.width/h.height,g=Math.max(2*d.pointRadius,d.graphicWidth||0,d.graphicHeight||0),b*=f,d.graphicWidth=g*f,d.graphicHeight=g,this.graphicRotate(a,b,c,d))},this),void(h.src=d.externalGraphic)}g=Math.max(d.graphicWidth,d.graphicHeight),f=d.graphicWidth/d.graphicHeight;var i=Math.round(d.graphicWidth||g*f),j=Math.round(d.graphicHeight||g);a.style.width=i+"px",a.style.height=j+"px";var k=document.getElementById(a.id+"_image");k||(k=this.createNode("olv:imagedata",a.id+"_image"),a.appendChild(k)),k.style.width=i+"px",k.style.height=j+"px",k.src=d.externalGraphic,k.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var l=e*Math.PI/180,m=Math.sin(l),n=Math.cos(l),o="progid:DXImageTransform.Microsoft.Matrix(M11="+n+",M12="+-m+",M21="+m+",M22="+n+",SizingMethod='auto expand')\n",p=d.graphicOpacity||d.fillOpacity;p&&1!=p&&(o+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+p+")\n"),a.style.filter=o;var q=new OpenLayers.Geometry.Point(-b,-c),r=new OpenLayers.Bounds(0,0,i,j).toGeometry();r.rotate(d.rotation,q);var s=r.getBounds();a.style.left=Math.round(parseInt(a.style.left)+s.left)+"px",a.style.top=Math.round(parseInt(a.style.top)-s.bottom)+"px"},postDraw:function(a){a.style.visibility="visible";var b=a._style.fillColor,c=a._style.strokeColor;"none"==b&&a.fillcolor!=b&&(a.fillcolor=b),"none"==c&&a.strokecolor!=c&&(a.strokecolor=c)},setNodeDimension:function(a,b){var c=b.getBounds();if(c){var d=this.getResolution(),e=new OpenLayers.Bounds((c.left-this.featureDx)/d-this.offset.x|0,c.bottom/d-this.offset.y|0,(c.right-this.featureDx)/d-this.offset.x|0,c.top/d-this.offset.y|0);a.style.left=e.left+"px",a.style.top=e.top+"px",a.style.width=e.getWidth()+"px",a.style.height=e.getHeight()+"px",a.coordorigin=e.left+" "+e.top,a.coordsize=e.getWidth()+" "+e.getHeight()}},dashStyle:function(a){var b=a.strokeDashstyle;switch(b){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return b;default:var c=b.split(/[ ,]/);return 2==c.length?1*c[0]>=2*c[1]?"longdash":1==c[0]||1==c[1]?"dot":"dash":4==c.length?1*c[0]>=2*c[1]?"longdashdot":"dashdot":"solid"}},createNode:function(a,b){var c=document.createElement(a);return b&&(c.id=b),c.unselectable="on",c.onselectstart=OpenLayers.Function.False,c},nodeTypeCompare:function(a,b){var c=b,d=c.indexOf(":");d!=-1&&(c=c.substr(d+1));var e=a.nodeName;return d=e.indexOf(":"),d!=-1&&(e=e.substr(d+1)),c==e},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"olv:group")},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(a,b,c){if(!isNaN(b.x)&&!isNaN(b.y)){var d=this.getResolution();a.style.left=((b.x-this.featureDx)/d-this.offset.x|0)-c+"px",a.style.top=(b.y/d-this.offset.y|0)-c+"px";var e=2*c;return a.style.width=e+"px",a.style.height=e+"px",a}return!1},drawLineString:function(a,b){return this.drawLine(a,b,!1)},drawLinearRing:function(a,b){return this.drawLine(a,b,!0)},drawLine:function(a,b,c){this.setNodeDimension(a,b);for(var g,h,i,d=this.getResolution(),e=b.components.length,f=new Array(e),j=0;j<e;j++)g=b.components[j],h=(g.x-this.featureDx)/d-this.offset.x|0,i=g.y/d-this.offset.y|0,f[j]=" "+h+","+i+" l ";var k=c?" x e":" e";return a.path="m"+f.join("")+k,a},drawPolygon:function(a,b){this.setNodeDimension(a,b);var e,f,g,h,i,j,k,l,m,n,o,p,c=this.getResolution(),d=[];for(e=0,f=b.components.length;e<f;e++){for(d.push("m"),g=b.components[e].components,h=0===e,i=null,j=null,k=0,l=g.length;k<l;k++)m=g[k],o=(m.x-this.featureDx)/c-this.offset.x|0,p=m.y/c-this.offset.y|0,n=" "+o+","+p,d.push(n),0==k&&d.push(" l"),h||(i?i!=n&&(j?j!=n&&(h=!0):j=n):i=n);d.push(h?" x ":" ")}return d.push("e"),a.path=d.join(""),a},drawRectangle:function(a,b){var c=this.getResolution();return a.style.left=((b.x-this.featureDx)/c-this.offset.x|0)+"px",a.style.top=(b.y/c-this.offset.y|0)+"px",a.style.width=(b.width/c|0)+"px",a.style.height=(b.height/c|0)+"px",a},drawText:function(a,b,c){var d=this.nodeFactory(a+this.LABEL_ID_SUFFIX,"olv:rect"),e=this.nodeFactory(a+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),f=this.getResolution();
d.style.left=((c.x-this.featureDx)/f-this.offset.x|0)+"px",d.style.top=(c.y/f-this.offset.y|0)+"px",d.style.flip="y",e.innerText=b.label,"inherit"!=b.cursor&&null!=b.cursor&&(e.style.cursor=b.cursor),b.fontColor&&(e.style.color=b.fontColor),b.fontOpacity&&(e.style.filter="alpha(opacity="+100*b.fontOpacity+")"),b.fontFamily&&(e.style.fontFamily=b.fontFamily),b.fontSize&&(e.style.fontSize=b.fontSize),b.fontWeight&&(e.style.fontWeight=b.fontWeight),b.fontStyle&&(e.style.fontStyle=b.fontStyle),b.labelSelect===!0&&(d._featureId=a,e._featureId=a,e._geometry=c,e._geometryClass=c.CLASS_NAME),e.style.whiteSpace="nowrap",e.inset="1px,0px,0px,0px",d.parentNode||(d.appendChild(e),this.textRoot.appendChild(d));var g=b.labelAlign||"cm";1==g.length&&(g+="m");var h=e.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(0,1)],i=e.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(1,1)];d.style.left=parseInt(d.style.left)-h-1+"px",d.style.top=parseInt(d.style.top)+i+"px"},moveRoot:function(a){var b=this.map.getLayer(a.container.id);b instanceof OpenLayers.Layer.Vector.RootContainer&&(b=this.map.getLayer(this.container.id)),b&&b.renderer.clear(),OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments),b&&b.redraw()},importSymbol:function(a){var b=this.container.id+"-"+a,c=this.symbolCache[b];if(c)return c;var d=OpenLayers.Renderer.symbol[a];if(!d)throw new Error(a+" is not a valid symbol name");for(var e=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),f=["m"],g=0;g<d.length;g+=2){var h=d[g],i=d[g+1];e.left=Math.min(e.left,h),e.bottom=Math.min(e.bottom,i),e.right=Math.max(e.right,h),e.top=Math.max(e.top,i),f.push(h),f.push(i),0==g&&f.push("l")}f.push("x e");var j=f.join(" "),k=(e.getWidth()-e.getHeight())/2;return k>0?(e.bottom=e.bottom-k,e.top=e.top+k):(e.left=e.left+k,e.right=e.right-k),c={path:j,size:e.getWidth(),left:e.left,bottom:e.bottom},this.symbolCache[b]=c,c},CLASS_NAME:"OpenLayers.Renderer.VML"}),OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1},OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.root=document.createElement("canvas"),this.container.appendChild(this.root),this.canvas=this.root.getContext("2d"),this.features={},this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){return OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),!1},eraseGeometry:function(a,b){this.eraseFeatures(this.features[b][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(a){this.size=a.clone();var b=this.root;if(b.style.width=a.w+"px",b.style.height=a.h+"px",b.width=a.w,b.height=a.h,this.resolution=null,this.hitDetection){var c=this.hitCanvas;c.style.width=a.w+"px",c.style.height=a.h+"px",c.width=a.w,c.height=a.h}},drawFeature:function(a,b){var c;if(a.geometry){b=this.applyDefaultSymbolizer(b||a.style);var e,d=a.geometry.getBounds();this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(e=this.map.getMaxExtent());var f=d&&d.intersectsBounds(this.extent,{worldBounds:e});c="none"!==b.display&&!!d&&f,c?this.features[a.id]=[a,b]:delete this.features[a.id],this.pendingRedraw=!0}return this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),c},drawGeometry:function(a,b,c){var d=a.CLASS_NAME;if("OpenLayers.Geometry.Collection"!=d&&"OpenLayers.Geometry.MultiPoint"!=d&&"OpenLayers.Geometry.MultiLineString"!=d&&"OpenLayers.Geometry.MultiPolygon"!=d)switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(a,b,c);break;case"OpenLayers.Geometry.LineString":this.drawLineString(a,b,c);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(a,b,c);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(a,b,c)}else for(var e=0;e<a.components.length;e++)this.drawGeometry(a.components[e],b,c)},drawExternalGraphic:function(a,b,c){var d=new Image,e=b.title||b.graphicTitle;e&&(d.title=e);var f=b.graphicWidth||b.graphicHeight,g=b.graphicHeight||b.graphicWidth;f=f?f:2*b.pointRadius,g=g?g:2*b.pointRadius;var h=void 0!=b.graphicXOffset?b.graphicXOffset:-(.5*f),i=void 0!=b.graphicYOffset?b.graphicYOffset:-(.5*g),j=b.graphicOpacity||b.fillOpacity,k=function(){if(this.features[c]){var b=this.getLocalXY(a),e=b[0],k=b[1];if(!isNaN(e)&&!isNaN(k)){var l=e+h|0,m=k+i|0,n=this.canvas;n.globalAlpha=j;var o=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);n.drawImage(d,l*o,m*o,f*o,g*o),this.hitDetection&&(this.setHitContextStyle("fill",c),this.hitContext.fillRect(l,m,f,g))}}};d.onload=OpenLayers.Function.bind(k,this),d.src=b.externalGraphic},drawNamedSymbol:function(a,b,c){var d,e,f,g,h,i,j,k,l,m=Math.PI/180,n=OpenLayers.Renderer.symbol[b.graphicName];if(!n)throw new Error(b.graphicName+" is not a valid symbol name");if(n.length&&!(n.length<2)){var o=this.getLocalXY(a),p=o[0],q=o[1];if(!isNaN(p)&&!isNaN(q)){if(this.canvas.lineCap="round",this.canvas.lineJoin="round",this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round"),b.graphicName in this.cachedSymbolBounds)i=this.cachedSymbolBounds[b.graphicName];else{for(i=new OpenLayers.Bounds,h=0;h<n.length;h+=2)i.extend(new OpenLayers.LonLat(n[h],n[h+1]));this.cachedSymbolBounds[b.graphicName]=i}if(this.canvas.save(),this.hitDetection&&this.hitContext.save(),this.canvas.translate(p,q),this.hitDetection&&this.hitContext.translate(p,q),k=m*b.rotation,isNaN(k)||(this.canvas.rotate(k),this.hitDetection&&this.hitContext.rotate(k)),j=2*b.pointRadius/Math.max(i.getWidth(),i.getHeight()),this.canvas.scale(j,j),this.hitDetection&&this.hitContext.scale(j,j),f=i.getCenterLonLat().lon,g=i.getCenterLonLat().lat,this.canvas.translate(-f,-g),this.hitDetection&&this.hitContext.translate(-f,-g),l=b.strokeWidth,b.strokeWidth=l/j,b.fill!==!1){for(this.setCanvasStyle("fill",b),this.canvas.beginPath(),h=0;h<n.length;h+=2)d=n[h],e=n[h+1],0==h&&this.canvas.moveTo(d,e),this.canvas.lineTo(d,e);if(this.canvas.closePath(),this.canvas.fill(),this.hitDetection){for(this.setHitContextStyle("fill",c,b),this.hitContext.beginPath(),h=0;h<n.length;h+=2)d=n[h],e=n[h+1],0==h&&this.canvas.moveTo(d,e),this.hitContext.lineTo(d,e);this.hitContext.closePath(),this.hitContext.fill()}}if(b.stroke!==!1){for(this.setCanvasStyle("stroke",b),this.canvas.beginPath(),h=0;h<n.length;h+=2)d=n[h],e=n[h+1],0==h&&this.canvas.moveTo(d,e),this.canvas.lineTo(d,e);if(this.canvas.closePath(),this.canvas.stroke(),this.hitDetection){for(this.setHitContextStyle("stroke",c,b,j),this.hitContext.beginPath(),h=0;h<n.length;h+=2)d=n[h],e=n[h+1],0==h&&this.hitContext.moveTo(d,e),this.hitContext.lineTo(d,e);this.hitContext.closePath(),this.hitContext.stroke()}}b.strokeWidth=l,this.canvas.restore(),this.hitDetection&&this.hitContext.restore(),this.setCanvasStyle("reset")}}},setCanvasStyle:function(a,b){"fill"===a?(this.canvas.globalAlpha=b.fillOpacity,this.canvas.fillStyle=b.fillColor):"stroke"===a?(this.canvas.globalAlpha=b.strokeOpacity,this.canvas.strokeStyle=b.strokeColor,this.canvas.lineWidth=b.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(a){var b=Number(a.split("_").pop())+1;b>=16777216&&(this.hitOverflow=b-16777215,b=b%16777216+1);var c="000000"+b.toString(16),d=c.length;return c="#"+c.substring(d-6,d)},setHitContextStyle:function(a,b,c,d){var e=this.featureIdToHex(b);"fill"==a?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=e):"stroke"==a?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=e,"undefined"==typeof d?this.hitContext.lineWidth=c.strokeWidth+2:isNaN(d)||(this.hitContext.lineWidth=c.strokeWidth+2/d)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(a,b,c){if(b.graphic!==!1)if(b.externalGraphic)this.drawExternalGraphic(a,b,c);else if(b.graphicName&&"circle"!=b.graphicName)this.drawNamedSymbol(a,b,c);else{var d=this.getLocalXY(a),e=d[0],f=d[1];if(!isNaN(e)&&!isNaN(f)){var g=2*Math.PI,h=b.pointRadius;b.fill!==!1&&(this.setCanvasStyle("fill",b),this.canvas.beginPath(),this.canvas.arc(e,f,h,0,g,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",c,b),this.hitContext.beginPath(),this.hitContext.arc(e,f,h,0,g,!0),this.hitContext.fill())),b.stroke!==!1&&(this.setCanvasStyle("stroke",b),this.canvas.beginPath(),this.canvas.arc(e,f,h,0,g,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",c,b),this.hitContext.beginPath(),this.hitContext.arc(e,f,h,0,g,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(a,b,c){b=OpenLayers.Util.applyDefaults({fill:!1},b),this.drawLinearRing(a,b,c)},drawLinearRing:function(a,b,c){b.fill!==!1&&(this.setCanvasStyle("fill",b),this.renderPath(this.canvas,a,b,c,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",c,b),this.renderPath(this.hitContext,a,b,c,"fill"))),b.stroke!==!1&&(this.setCanvasStyle("stroke",b),this.renderPath(this.canvas,a,b,c,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",c,b),this.renderPath(this.hitContext,a,b,c,"stroke"))),this.setCanvasStyle("reset")},renderPath:function(a,b,c,d,e){var f=b.components,g=f.length;a.beginPath();var h=this.getLocalXY(f[0]),i=h[0],j=h[1];if(!isNaN(i)&&!isNaN(j)){a.moveTo(h[0],h[1]);for(var k=1;k<g;++k){var l=this.getLocalXY(f[k]);a.lineTo(l[0],l[1])}"fill"===e?a.fill():a.stroke()}},drawPolygon:function(a,b,c){var d=a.components,e=d.length;this.drawLinearRing(d[0],b,c);for(var f=1;f<e;++f)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(d[f],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},b),c),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(d[f],OpenLayers.Util.applyDefaults({fill:!1},b),c)},drawText:function(a,b){var c=this.getLocalXY(a);this.setCanvasStyle("reset"),this.canvas.fillStyle=b.fontColor,this.canvas.globalAlpha=b.fontOpacity||1;var d=[b.fontStyle?b.fontStyle:"normal","normal",b.fontWeight?b.fontWeight:"normal",b.fontSize?b.fontSize:"1em",b.fontFamily?b.fontFamily:"sans-serif"].join(" "),e=b.label.split("\n"),f=e.length;if(this.canvas.fillText){this.canvas.font=d,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[1]]||"middle";var g=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];null==g&&(g=-.5);var h=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;c[1]+=h*g*(f-1);for(var i=0;i<f;i++)b.labelOutlineWidth&&(this.canvas.save(),this.canvas.globalAlpha=b.labelOutlineOpacity||b.fontOpacity||1,this.canvas.strokeStyle=b.labelOutlineColor,this.canvas.lineWidth=b.labelOutlineWidth,this.canvas.strokeText(e[i],c[0],c[1]+h*i+1),this.canvas.restore()),this.canvas.fillText(e[i],c[0],c[1]+h*i)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=d;var j=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[0]];null==j&&(j=-.5);var g=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];null==g&&(g=-.5);var h=this.canvas.mozMeasureText("xx");c[1]+=h*(1+g*f);for(var i=0;i<f;i++){var k=c[0]+j*this.canvas.mozMeasureText(e[i]),l=c[1]+i*h;this.canvas.translate(k,l),this.canvas.mozDrawText(e[i]),this.canvas.translate(-k,-l)}}this.setCanvasStyle("reset")},getLocalXY:function(a){var b=this.getResolution(),c=this.extent,d=(a.x-this.featureDx)/b+-c.left/b,e=c.top/b-a.y/b;return[d,e]},clear:function(){var a=this.root.height,b=this.root.width;this.canvas.clearRect(0,0,b,a),this.features={},this.hitDetection&&this.hitContext.clearRect(0,0,b,a)},getFeatureIdFromEvent:function(a){var b,c;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging){var d=a.xy,e=0|d.x,f=0|d.y,g=this.hitContext.getImageData(e,f,1,1).data;if(255===g[3]){var h=g[2]+256*(g[1]+256*g[0]);if(h){b="OpenLayers_Feature_Vector_"+(h-1+this.hitOverflow);try{c=this.features[b][0]}catch(a){}}}}return c},eraseFeatures:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0;b<a.length;++b)delete this.features[a[b].id];this.redraw()},redraw:function(){if(!this.locked){var a=this.root.height,b=this.root.width;this.canvas.clearRect(0,0,b,a),this.hitDetection&&this.hitContext.clearRect(0,0,b,a);var d,e,f,c=[],g=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(var h in this.features)this.features.hasOwnProperty(h)&&(d=this.features[h][0],e=d.geometry,this.calculateFeatureDx(e.getBounds(),g),f=this.features[h][1],this.drawGeometry(e,f,d.id),f.label&&c.push([d,f]));for(var i,j=0,k=c.length;j<k;++j)i=c[j],this.drawText(i[0].geometry.getCentroid(),i[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"}),OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},OpenLayers.Renderer.Canvas.drawImageScaleFactor=null,OpenLayers.Format.SLD.v1_0_0_GeoServer=OpenLayers.Class(OpenLayers.Format.SLD.v1_0_0,{version:"1.0.0",profile:"GeoServer",readers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.priority=c)},VendorOption:function(a,b){b.vendorOptions||(b.vendorOptions={}),b.vendorOptions[a.getAttribute("name")]=this.getChildValue(a)},TextSymbolizer:function(a,b){OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld.TextSymbolizer.apply(this,arguments);var c=this.multipleSymbolizers?b.symbolizers[b.symbolizers.length-1]:b.symbolizer.Text;void 0===c.graphic&&(c.graphic=!1)}},OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.readers),writers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(a){return this.writers.sld._OGCExpression.call(this,"sld:Priority",a)},VendorOption:function(a){return this.createElementNSPlus("sld:VendorOption",{attributes:{name:a.name},value:a.value})},TextSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers,c=b.sld.TextSymbolizer.apply(this,arguments);return a.graphic!==!1&&(a.externalGraphic||a.graphicName)&&this.writeNode("Graphic",a,c),"priority"in a&&this.writeNode("Priority",a.priority,c),this.addVendorOptions(c,a)},PointSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers,c=b.sld.PointSymbolizer.apply(this,arguments);return this.addVendorOptions(c,a)},LineSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers,c=b.sld.LineSymbolizer.apply(this,arguments);return this.addVendorOptions(c,a)},PolygonSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers,c=b.sld.PolygonSymbolizer.apply(this,arguments);return this.addVendorOptions(c,a)}},OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(a,b){var c=b.vendorOptions;if(c)for(var d in b.vendorOptions)this.writeNode("VendorOption",{name:d,value:b.vendorOptions[d]},a);return a},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0_GeoServer"}),Ext.namespace("gxp"),gxp.WMSStylesDialog=Ext.extend(Ext.Container,{addStyleText:"Add",addStyleTip:"Add a new style",chooseStyleText:"Choose style",deleteStyleText:"Remove",deleteStyleTip:"Delete the selected style",editStyleText:"Edit",editStyleTip:"Edit the selected style",duplicateStyleText:"Duplicate",duplicateStyleTip:"Duplicate the selected style",addRuleText:"Add",addRuleTip:"Add a new rule",newRuleText:"New Rule",deleteRuleText:"Remove",deleteRuleTip:"Delete the selected rule",editRuleText:"Edit",editRuleTip:"Edit the selected rule",duplicateRuleText:"Duplicate",duplicateRuleTip:"Duplicate the selected rule",cancelText:"Cancel",saveText:"Save",styleWindowTitle:"User Style: {0}",ruleWindowTitle:"Style Rule: {0}",stylesFieldsetTitle:"Styles",rulesFieldsetTitle:"Rules",errorTitle:"Error saving style",errorMsg:"There was an error saving the style back to the server.",layerRecord:null,layerDescription:null,symbolType:null,stylesStore:null,selectedStyle:null,selectedRule:null,editable:!0,modified:!1,dialogCls:Ext.Window,initComponent:function(){this.addEvents("ready","modified","styleselected","beforesaved","saved");var a={layout:"form",disabled:!0,items:[{xtype:"fieldset",title:this.stylesFieldsetTitle,labelWidth:85,style:"margin-bottom: 0;"},{xtype:"toolbar",style:"border-width: 0 1px 1px 1px; margin-bottom: 10px;",items:[{xtype:"button",iconCls:"add",text:this.addStyleText,tooltip:this.addStyleTip,handler:this.addStyle,scope:this},{xtype:"button",iconCls:"delete",text:this.deleteStyleText,tooltip:this.deleteStyleTip,handler:function(){this.stylesStore.remove(this.selectedStyle)},scope:this},{xtype:"button",iconCls:"edit",text:this.editStyleText,tooltip:this.editStyleTip,handler:function(){this.editStyle()},scope:this},{xtype:"button",iconCls:"duplicate",text:this.duplicateStyleText,tooltip:this.duplicateStyleTip,handler:function(){var a=this.selectedStyle,b=a.get("userStyle").clone();b.isDefault=!1,b.name=this.newStyleName();var c=this.stylesStore;c.add(new c.recordType({name:b.name,title:b.title,abstract:b.description,userStyle:b})),this.editStyle(a)},scope:this}]}]};Ext.applyIf(this,a),this.createStylesStore(),this.on({beforesaved:function(){this._saving=!0},saved:function(){delete this._saving},savefailed:function(){Ext.Msg.show({title:this.errorTitle,msg:this.errorMsg,icon:Ext.MessageBox.ERROR,buttons:{ok:!0}}),delete this._saving},render:function(){gxp.util.dispatch([this.getStyles],function(){this.enable()},this)},scope:this}),gxp.WMSStylesDialog.superclass.initComponent.apply(this,arguments)},addStyle:function(){if(!this._ready)return void this.on("ready",this.addStyle,this);var a=this.selectedStyle,b=this.stylesStore,c=new OpenLayers.Style(null,{name:this.newStyleName(),rules:[this.createRule()]});b.add(new b.recordType({name:c.name,userStyle:c})),this.editStyle(a)},editStyle:function(a){var b=this.selectedStyle.get("userStyle"),c={bbar:["->",{text:this.cancelText,iconCls:"cancel",handler:function(){d.propertiesDialog.userStyle=b,d.destroy(),a&&(this._cancelling=!0,this.stylesStore.remove(this.selectedStyle),this.changeStyle(a,{updateCombo:!0,markModified:!0}),delete this._cancelling)},scope:this},{text:this.saveText,iconCls:"save",handler:function(){d.destroy()}}]},d=new this.dialogCls(Ext.apply(c,{title:String.format(this.styleWindowTitle,b.title||b.name),shortTitle:b.title||b.name,bodyBorder:!1,autoHeight:!0,width:300,modal:!0,items:{border:!1,items:{xtype:"gxp_stylepropertiesdialog",ref:"../propertiesDialog",userStyle:b.clone(),nameEditable:!1,style:"padding: 10px;"}},listeners:{beforedestroy:function(){this.selectedStyle.set("userStyle",d.propertiesDialog.userStyle)},scope:this}}));this.showDlg(d)},createSLD:function(a){a=a||{};var b={version:"1.0.0",namedLayers:{}},c=this.layerRecord.get("name");return b.namedLayers[c]={name:c,userStyles:[]},this.stylesStore.each(function(d){a.userStyles&&a.userStyles.indexOf(d.get("name"))===-1||b.namedLayers[c].userStyles.push(d.get("userStyle"))}),new OpenLayers.Format.SLD({multipleSymbolizers:!0,profile:"GeoServer"}).write(b)},saveStyles:function(a){this.modified===!0&&this.fireEvent("beforesaved",this,a)},updateStyleRemoveButton:function(){var a=this.selectedStyle&&this.selectedStyle.get("userStyle");this.items.get(1).items.get(1).setDisabled(!a||this.stylesStore.getCount()<=1||a.isDefault===!0)},updateRuleRemoveButton:function(){this.items.get(3).items.get(1).setDisabled(!this.selectedRule||this.items.get(2).items.get(0).rules.length<2)},createRule:function(){return new OpenLayers.Rule({symbolizers:[new OpenLayers.Symbolizer[this.symbolType]]})},addRulesFieldSet:function(){var a=new Ext.form.FieldSet({itemId:"rulesfieldset",title:this.rulesFieldsetTitle,autoScroll:!0,style:"margin-bottom: 0;",hideMode:"offsets",hidden:!0}),b=new Ext.Toolbar({style:"border-width: 0 1px 1px 1px;",hidden:!0,items:[{xtype:"button",iconCls:"add",text:this.addRuleText,tooltip:this.addRuleTip,handler:this.addRule,scope:this},{xtype:"button",iconCls:"delete",text:this.deleteRuleText,tooltip:this.deleteRuleTip,handler:this.removeRule,scope:this,disabled:!0},{xtype:"button",iconCls:"edit",text:this.editRuleText,toolitp:this.editRuleTip,handler:function(){this.layerDescription?this.editRule():this.describeLayer(this.editRule)},scope:this,disabled:!0},{xtype:"button",iconCls:"duplicate",text:this.duplicateRuleText,tip:this.duplicateRuleTip,handler:this.duplicateRule,scope:this,disabled:!0}]});return this.add(a,b),this.doLayout(),a},addRule:function(){var a=this.items.get(2).items.get(0);this.selectedStyle.get("userStyle").rules.push(this.createRule()),a.update(),this.selectedStyle.store.afterEdit(this.selectedStyle),this.updateRuleRemoveButton()},removeRule:function(){var a=this.selectedRule;this.items.get(2).items.get(0).unselect(),this.selectedStyle.get("userStyle").rules.remove(a),this.afterRuleChange()},duplicateRule:function(){var a=this.items.get(2).items.get(0),b=this.selectedRule.clone();this.selectedStyle.get("userStyle").rules.push(b),a.update(),this.selectedStyle.store.afterEdit(this.selectedStyle),this.updateRuleRemoveButton()},editRule:function(){var a=this.selectedRule,b=a.clone(),c=new this.dialogCls({title:String.format(this.ruleWindowTitle,a.title||a.name||this.newRuleText),shortTitle:a.title||a.name||this.newRuleText,layout:"fit",width:320,height:450,modal:!0,items:[{xtype:"gxp_rulepanel",ref:"rulePanel",symbolType:this.symbolType,rule:a,attributes:new GeoExt.data.AttributeStore({url:this.layerDescription.owsURL,baseParams:{SERVICE:this.layerDescription.owsType,REQUEST:"DescribeFeatureType",TYPENAME:this.layerDescription.typeName},method:"GET",disableCaching:!1}),autoScroll:!0,border:!1,defaults:{autoHeight:!0,hideMode:"offsets"},listeners:{change:this.saveRule,tabchange:function(){c instanceof Ext.Window&&c.syncShadow()},scope:this}}],bbar:["->",{text:this.cancelText,iconCls:"cancel",handler:function(){this.saveRule(c.rulePanel,b),c.destroy()},scope:this},{text:this.saveText,iconCls:"save",handler:function(){c.destroy()}}]});this.showDlg(c)},saveRule:function(a,b){var c=this.selectedStyle,e=(this.items.get(2).items.get(0),c.get("userStyle")),f=e.rules.indexOf(this.selectedRule);e.rules[f]=b,this.afterRuleChange(b)},afterRuleChange:function(a){this.items.get(2).items.get(0);this.selectedRule=a,this.selectedStyle.store.afterEdit(this.selectedStyle)},setRulesFieldSetVisible:function(a){this.items.get(3).setVisible(a&&this.editable),this.items.get(2).setVisible(a),this.doLayout()},parseSLD:function(a,b){var c=a.responseXML;c&&c.documentElement||(c=(new OpenLayers.Format.XML).read(a.responseText));var d=this.layerRecord.getLayer().params,e=this.initialConfig.styleName||d.STYLES;e&&(this.selectedStyle=this.stylesStore.getAt(this.stylesStore.findExact("name",e)));var f=new OpenLayers.Format.SLD({profile:"GeoServer",multipleSymbolizers:!0});try{var i,g=f.read(c),h=g.namedLayers[d.LAYERS].userStyles;if(d.SLD_BODY){var j=f.read(d.SLD_BODY);i=j.namedLayers[d.LAYERS].userStyles,Array.prototype.push.apply(h,i)}this.stylesStore.removeAll(),this.selectedStyle=null;for(var k,l,m,n,o=0,p=h.length;o<p;++o)k=h[o],m=this.stylesStore.findExact("name",k.name),m!==-1&&this.stylesStore.removeAt(m),l=new this.stylesStore.recordType({name:k.name,title:k.title,abstract:k.description,userStyle:k}),l.phantom=!1,this.stylesStore.add(l),this.selectedStyle||e!==k.name&&(e||k.isDefault!==!0)||(this.selectedStyle=l),k.isDefault===!0&&(n=l);this.selectedStyle||(this.selectedStyle=n),this.addRulesFieldSet(),this.createLegend(this.selectedStyle.get("userStyle").rules),this.stylesStoreReady(),d.SLD_BODY&&this.markModified()}catch(a){window.console&&console.warn(a.message),this.setupNonEditable()}},createLegend:function(a){var b=OpenLayers.Symbolizer.Raster;if(b&&a[0]&&a[0].symbolizers[0]instanceof b)throw new Error("Raster symbolizers are not supported.");this.addVectorLegend(a)},setupNonEditable:function(){this.editable=!1,this.items.get(1).hide();var a=this.getComponent("rulesfieldset")||this.addRulesFieldSet();a.add(this.createLegendImage()),this.doLayout(),this.items.get(3).hide(),this.stylesStoreReady()},stylesStoreReady:function(){this.stylesStore.commitChanges(),this.stylesStore.on({load:function(){this.addStylesCombo(),this.updateStyleRemoveButton()},add:function(a,b,c){this.updateStyleRemoveButton();var d=this.items.get(0).items.get(0);this.markModified(),d.fireEvent("select",d,a.getAt(c),c),d.setValue(this.selectedStyle.get("name"))},remove:function(a,b,c){if(!this._cancelling){this._removing=!0;var d=Math.min(c,a.getCount()-1);this.updateStyleRemoveButton();var e=this.items.get(0).items.get(0);this.markModified(),e.fireEvent("select",e,a.getAt(d),d),e.setValue(this.selectedStyle.get("name")),delete this._removing}},update:function(a,b){var c=b.get("userStyle"),d={name:c.name,title:c.title||c.name,abstract:c.description};Ext.apply(b.data,d),this.changeStyle(b,{updateCombo:!0,markModified:!0})},scope:this}),this.stylesStore.fireEvent("load",this.stylesStore,this.stylesStore.getRange()),this._ready=!0,this.fireEvent("ready")},markModified:function(){this.modified===!1&&(this.modified=!0),this._saving||this.fireEvent("modified",this,this.selectedStyle.get("name"))},createStylesStore:function(a){var b=this.layerRecord.get("styles")||[];this.stylesStore=new Ext.data.JsonStore({data:{styles:b},idProperty:"name",root:"styles",fields:["name","title","abstract","legend","userStyle"],listeners:{add:function(a,b){for(var c,d=b.length-1;d>=0;--d)c=b[d],a.suspendEvents(),c.get("title")||c.set("title",c.get("name")),a.resumeEvents()}}})},getStyles:function(a){var b=this.layerRecord.getLayer();if(this.editable===!0){var c=b.params.VERSION;parseFloat(c)>1.1&&(c="1.1.1"),Ext.Ajax.request({url:b.url,params:{SERVICE:"WMS",VERSION:c,REQUEST:"GetStyles",LAYERS:[b.params.LAYERS].join(",")},method:"GET",disableCaching:!1,success:this.parseSLD,failure:this.setupNonEditable,callback:a,scope:this})}else this.setupNonEditable()},describeLayer:function(a){if(this.layerDescription)window.setTimeout(function(){a.call(this)},0);else{var b=this.layerRecord.getLayer(),c=b.params.VERSION;parseFloat(c)>1.1&&(c="1.1.1"),Ext.Ajax.request({url:b.url,params:{SERVICE:"WMS",VERSION:c,REQUEST:"DescribeLayer",LAYERS:[b.params.LAYERS].join(",")},method:"GET",disableCaching:!1,success:function(a){var b=(new OpenLayers.Format.WMSDescribeLayer).read(a.responseXML&&a.responseXML.documentElement?a.responseXML:a.responseText);this.layerDescription=b[0]},callback:a,scope:this})}},addStylesCombo:function(){var a=this.stylesStore,b=new Ext.form.ComboBox(Ext.apply({fieldLabel:this.chooseStyleText,store:a,editable:!1,displayField:"title",valueField:"name",value:this.selectedStyle?this.selectedStyle.get("title"):this.layerRecord.getLayer().params.STYLES||"default",disabled:!a.getCount(),mode:"local",typeAhead:!0,triggerAction:"all",forceSelection:!0,anchor:"100%",listeners:{select:function(a,b){this.changeStyle(b),b.phantom||this._removing||this.fireEvent("styleselected",this,b.get("name"))},scope:this}},this.initialConfig.stylesComboOptions));this.items.get(0).add(b),this.doLayout()},createLegendImage:function(){var a=new GeoExt.WMSLegend({showTitle:!1,layerRecord:this.layerRecord,autoScroll:!0,defaults:{listeners:{render:function(b){b.getEl().on({load:function(c,d){d.getAttribute("src")!=b.defaultImgSrc&&(this.setRulesFieldSetVisible(!0),b.getEl().getHeight()>250&&a.setHeight(250))},error:function(){this.setRulesFieldSetVisible(!1)},scope:this})},scope:this}}});return a},changeStyle:function(a,b){b=b||{};var c=this.items.get(2).items.get(0);this.selectedStyle=a,this.updateStyleRemoveButton();var d=a.get("name");if(this.editable===!0){var e=a.get("userStyle");e.isDefault===!0&&(d="");var f=c.rules.indexOf(this.selectedRule);c.ownerCt.remove(c),this.createLegend(e.rules,{selectedRuleIndex:f})}b.updateCombo===!0&&(this.items.get(0).items.get(0).setValue(e.name),b.markModified===!0&&this.markModified())},addVectorLegend:function(a,b){if(b=Ext.applyIf(b||{},{enableDD:!0}),this.symbolType=b.symbolType,!this.symbolType){var c=["Point","Line","Polygon"];highest=0;for(var e,d=a[0].symbolizers,f=d.length-1;f>=0;f--)e=d[f].CLASS_NAME.split(".").pop(),highest=Math.max(highest,c.indexOf(e));this.symbolType=c[highest]}var g=this.items.get(2).add({xtype:"gx_vectorlegend",showTitle:!1,height:a.length>10?250:void 0,autoScroll:a.length>10,rules:a,symbolType:this.symbolType,selectOnClick:!0,enableDD:b.enableDD,listeners:{ruleselected:function(a,b){this.selectedRule=b;var c=this.items.get(3).items;this.updateRuleRemoveButton(),c.get(2).enable(),c.get(3).enable()},ruleunselected:function(a,b){this.selectedRule=null;var c=this.items.get(3).items;c.get(1).disable(),c.get(2).disable(),c.get(3).disable()},rulemoved:function(){this.markModified()},afterlayout:function(){null!==this.selectedRule&&null===g.selectedRule&&g.rules.indexOf(this.selectedRule)!==-1&&g.selectRuleEntry(this.selectedRule)},scope:this}});return this.setRulesFieldSetVisible(!0),g},newStyleName:function(){var a=this.layerRecord.get("name");return a.split(":").pop()+"_"+gxp.util.md5(a+new Date+Math.random()).substr(0,8)},showDlg:function(a){a.show()}}),gxp.WMSStylesDialog.createGeoServerStylerConfig=function(a,b){var c=a.getLayer();return b||(b=a.get("restUrl")),b||(b=c.url.split("?").shift().replace(/\/(wms|ows)\/?$/,"/rest")),{xtype:"gxp_wmsstylesdialog",layerRecord:a,plugins:[{ptype:"gxp_geoserverstylewriter",baseUrl:b}],listeners:{styleselected:function(a,b){c.mergeNewParams({styles:b})},modified:function(a,b){a.saveStyles()},saved:function(a,b){c.mergeNewParams({_olSalt:Math.random(),styles:b})},scope:this}}},OpenLayers.Renderer.defaultSymbolizer={fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square",fontColor:"#000000",fontSize:10,haloColor:"#FFFFFF",haloOpacity:1,haloRadius:1,labelAlign:"cm"},Ext.reg("gxp_wmsstylesdialog",gxp.WMSStylesDialog),Ext.namespace("gxp"),gxp.ScaleLimitPanel=Ext.extend(Ext.Panel,{maxScaleDenominatorLimit:1577757414.193268*OpenLayers.DOTS_PER_INCH/256,limitMaxScaleDenominator:!0,maxScaleDenominator:void 0,minScaleDenominatorLimit:40075016.68*Math.pow(.5,19)*39.3701*OpenLayers.DOTS_PER_INCH/256,limitMinScaleDenominator:!0,minScaleDenominator:void 0,scaleLevels:20,scaleSliderTemplate:"{scaleType} Scale 1:{scale}",modifyScaleTipContext:Ext.emptyFn,scaleFactor:null,changing:!1,border:!1,maxScaleLimitText:"Max scale limit",minScaleLimitText:"Min scale limit",initComponent:function(){this.layout="column",this.defaults={border:!1,bodyStyle:"margin: 0 5px;"},this.bodyStyle={padding:"5px"},this.scaleSliderTemplate=new Ext.Template(this.scaleSliderTemplate),Ext.applyIf(this,{minScaleDenominator:this.minScaleDenominatorLimit,maxScaleDenominator:this.maxScaleDenominatorLimit}),this.scaleFactor=Math.pow(this.maxScaleDenominatorLimit/this.minScaleDenominatorLimit,1/(this.scaleLevels-1)),this.scaleSlider=new Ext.Slider({vertical:!0,height:100,values:[0,100],listeners:{changecomplete:function(a,b){this.updateScaleValues(a)},render:function(a){a.thumbs[0].el.setVisible(this.limitMaxScaleDenominator),a.thumbs[1].el.setVisible(this.limitMinScaleDenominator),a.setDisabled(!this.limitMinScaleDenominator&&!this.limitMaxScaleDenominator)},scope:this},plugins:[new gxp.slider.Tip({getText:function(a){var b=a.slider.thumbs.indexOf(a),d=(a.value,this.sliderValuesToScale([a.value])),e={scale:String(d[0]),zoom:(a.value*(this.scaleLevels/100)).toFixed(1),type:0===b?"Max":"Min",scaleType:0===b?"Min":"Max"};return this.modifyScaleTipContext(this,e),this.scaleSliderTemplate.apply(e)}.createDelegate(this)})]
}),this.maxScaleDenominatorInput=new Ext.form.NumberField({allowNegative:!1,width:100,fieldLabel:"1",value:Math.round(this.maxScaleDenominator),disabled:!this.limitMaxScaleDenominator,validator:function(a){return!this.limitMinScaleDenominator||a>this.minScaleDenominator}.createDelegate(this),listeners:{valid:function(a){var b=Number(a.getValue()),c=Math.round(this.maxScaleDenominatorLimit);b<c&&b>this.minScaleDenominator&&(this.maxScaleDenominator=b,this.updateSliderValues())},change:function(a){var b=Number(a.getValue()),c=Math.round(this.maxScaleDenominatorLimit);b>c?a.setValue(c):b<this.minScaleDenominator?a.setValue(this.minScaleDenominator):(this.maxScaleDenominator=b,this.updateSliderValues())},scope:this}}),this.minScaleDenominatorInput=new Ext.form.NumberField({allowNegative:!1,width:100,fieldLabel:"1",value:Math.round(this.minScaleDenominator),disabled:!this.limitMinScaleDenominator,validator:function(a){return!this.limitMaxScaleDenominator||a<this.maxScaleDenominator}.createDelegate(this),listeners:{valid:function(a){var b=Number(a.getValue()),c=Math.round(this.minScaleDenominatorLimit);b>c&&b<this.maxScaleDenominator&&(this.minScaleDenominator=b,this.updateSliderValues())},change:function(a){var b=Number(a.getValue()),c=Math.round(this.minScaleDenominatorLimit);b<c?a.setValue(c):b>this.maxScaleDenominator?a.setValue(this.maxScaleDenominator):(this.minScaleDenominator=b,this.updateSliderValues())},scope:this}}),this.items=[this.scaleSlider,{xtype:"panel",layout:"form",defaults:{border:!1},items:[{labelWidth:90,layout:"form",width:150,items:[{xtype:"checkbox",checked:!!this.limitMinScaleDenominator,fieldLabel:this.maxScaleLimitText,listeners:{check:function(a,b){this.limitMinScaleDenominator=b;var c=this.scaleSlider;c.setValue(1,100),c.thumbs[1].el.setVisible(b),this.minScaleDenominatorInput.setDisabled(!b),this.updateScaleValues(c),c.setDisabled(!this.limitMinScaleDenominator&&!this.limitMaxScaleDenominator)},scope:this}}]},{labelWidth:10,layout:"form",items:[this.minScaleDenominatorInput]},{labelWidth:90,layout:"form",items:[{xtype:"checkbox",checked:!!this.limitMaxScaleDenominator,fieldLabel:this.minScaleLimitText,listeners:{check:function(a,b){this.limitMaxScaleDenominator=b;var c=this.scaleSlider;c.setValue(0,0),c.thumbs[0].el.setVisible(b),this.maxScaleDenominatorInput.setDisabled(!b),this.updateScaleValues(c),c.setDisabled(!this.limitMinScaleDenominator&&!this.limitMaxScaleDenominator)},scope:this}}]},{labelWidth:10,layout:"form",items:[this.maxScaleDenominatorInput]}]}],this.addEvents("change"),gxp.ScaleLimitPanel.superclass.initComponent.call(this)},updateScaleValues:function(a){if(!this.changing){var b=a.getValues(),c=!1;if(this.limitMaxScaleDenominator||b[0]>0&&(b[0]=0,c=!0),this.limitMinScaleDenominator||b[1]<100&&(b[1]=100,c=!0),c)a.setValue(0,b[0]),a.setValue(1,b[1]);else{var d=this.sliderValuesToScale(b),e=d[0],f=d[1];this.changing=!0,this.minScaleDenominatorInput.setValue(f),this.maxScaleDenominatorInput.setValue(e),this.changing=!1,this.fireEvent("change",this,this.limitMinScaleDenominator?f:void 0,this.limitMaxScaleDenominator?e:void 0)}}},updateSliderValues:function(){if(!this.changing){var a=this.minScaleDenominator,b=this.maxScaleDenominator,c=this.scaleToSliderValues([b,a]);this.changing=!0,this.scaleSlider.setValue(0,c[0]),this.scaleSlider.setValue(1,c[1]),this.changing=!1,this.fireEvent("change",this,this.limitMinScaleDenominator?a:void 0,this.limitMaxScaleDenominator?b:void 0)}},sliderValuesToScale:function(a){var b=100/(this.scaleLevels-1);return[Math.round(Math.pow(this.scaleFactor,(100-a[0])/b)*this.minScaleDenominatorLimit),Math.round(Math.pow(this.scaleFactor,(100-a[1])/b)*this.minScaleDenominatorLimit)]},scaleToSliderValues:function(a){var b=100/(this.scaleLevels-1);return[100-b*Math.log(a[0]/this.minScaleDenominatorLimit)/Math.log(this.scaleFactor),100-b*Math.log(a[1]/this.minScaleDenominatorLimit)/Math.log(this.scaleFactor)]}}),Ext.reg("gxp_scalelimitpanel",gxp.ScaleLimitPanel),Ext.namespace("gxp.slider"),gxp.slider.Tip=Ext.extend(Ext.slider.Tip,{hover:!0,dragging:!1,init:function(a){this.hover&&a.on("render",this.registerThumbListeners,this),this.slider=a,gxp.slider.Tip.superclass.init.apply(this,arguments)},registerThumbListeners:function(){for(var a=0,b=this.slider.thumbs.length;a<b;++a)this.slider.thumbs[a].el.on({mouseover:this.createHoverListener(a),mouseout:function(){this.dragging||this.hide.apply(this,arguments)},scope:this})},createHoverListener:function(a){return function(){this.onSlide(this.slider,{},this.slider.thumbs[a]),this.dragging=!1}.createDelegate(this)},onSlide:function(a,b,c){this.dragging=!0,gxp.slider.Tip.superclass.onSlide.apply(this,arguments)}}),Ext.namespace("gxp.plugins"),gxp.plugins.FormFieldHelp=Ext.extend(Object,{ptype:"gxp_formfieldhelp",helpText:null,dismissDelay:5e3,constructor:function(a){Ext.apply(this,a)},init:function(a){this.target=a,a.on("render",this.showHelp,this)},showHelp:function(){var a;a=this.target.label?this.target.label:this.target.getEl(),Ext.QuickTips.register({target:a,dismissDelay:this.dismissDelay,text:this.helpText})}}),Ext.preg(gxp.plugins.FormFieldHelp.prototype.ptype,gxp.plugins.FormFieldHelp),Ext.namespace("gxp"),gxp.TextSymbolizer=Ext.extend(Ext.Panel,{fonts:void 0,symbolizer:null,defaultSymbolizer:null,attributes:null,colorManager:null,haloCache:null,border:!1,layout:"form",labelValuesText:"Label values",haloText:"Halo",sizeText:"Size",priorityText:"Priority",labelOptionsText:"Label options",autoWrapText:"Auto wrap",followLineText:"Follow line",maxDisplacementText:"Maximum displacement",repeatText:"Repeat",forceLeftToRightText:"Force left to right",groupText:"Grouping",spaceAroundText:"Space around",labelAllGroupText:"Label all segments in line group",maxAngleDeltaText:"Maximum angle delta",conflictResolutionText:"Conflict resolution",goodnessOfFitText:"Goodness of fit",polygonAlignText:"Polygon alignment",graphicResizeText:"Graphic resize",graphicMarginText:"Graphic margin",graphicTitle:"Graphic",fontColorTitle:"Font color and opacity",positioningText:"Label positioning",anchorPointText:"Anchor point",displacementXText:"Displacement (X-direction)",displacementYText:"Displacement (Y-direction)",perpendicularOffsetText:"Perpendicular offset",priorityHelp:"The higher the value of the specified field, the sooner the label will be drawn (which makes it win in the conflict resolution game)",autoWrapHelp:"Wrap labels that exceed a certain length in pixels",followLineHelp:"Should the label follow the geometry of the line?",maxDisplacementHelp:"Maximum displacement in pixels if label position is busy",repeatHelp:"Repeat labels after a certain number of pixels",forceLeftToRightHelp:"Labels are usually flipped to make them readable. If the character happens to be a directional arrow then this is not desirable",groupHelp:"Grouping works by collecting all features with the same label text, then choosing a representative geometry for the group. Road data is a classic example to show why grouping is useful. It is usually desirable to display only a single label for all of 'Main Street', not a label for every block of 'Main Street.'",spaceAroundHelp:"Overlapping and Separating Labels. By default GeoServer will not render labels 'on top of each other'. By using the spaceAround option you can either allow labels to overlap, or add extra space around labels. The value supplied for the option is a positive or negative size in pixels. Using the default value of 0, the bounding box of a label cannot overlap the bounding box of another label.",labelAllGroupHelp:"The labelAllGroup option makes sure that all of the segments in a line group are labeled instead of just the longest one.",conflictResolutionHelp:"By default labels are subjected to conflict resolution, meaning the renderer will not allow any label to overlap with a label that has been drawn already. Setting this parameter to false pull the label out of the conflict resolution game, meaning the label will be drawn even if it overlaps with other labels, and other labels drawn after it won’t mind overlapping with it.",goodnessOfFitHelp:"Geoserver will remove labels if they are a particularly bad fit for the geometry they are labeling. For Polygons: the label is sampled approximately at every letter. The distance from these points to the polygon is determined and each sample votes based on how close it is to the polygon. The default value is 0.5.",graphic_resizeHelp:"Specifies a mode for resizing label graphics (such as highway shields) to fit the text of the label. The default mode, ‘none’, never modifies the label graphic. In stretch mode, GeoServer will resize the graphic to exactly surround the label text, possibly modifying the image’s aspect ratio. In proportional mode, GeoServer will expand the image to be large enough to surround the text while preserving its original aspect ratio.",maxAngleDeltaHelp:"Designed to use used in conjuection with followLine, the maxAngleDelta option sets the maximum angle, in degrees, between two subsequent characters in a curved label. Large angles create either visually disconnected words or overlapping characters. It is advised not to use angles larger than 30.",polygonAlignHelp:"GeoServer normally tries to place horizontal labels within a polygon, and give up in case the label position is busy or if the label does not fit enough in the polygon. This options allows GeoServer to try alternate rotations for the labels. Possible options: the default value, only the rotation manually specified in the <Rotation> tag will be used (manual), If the label does not fit horizontally and the polygon is taller than wider the vertical alignement will also be tried (ortho), If the label does not fit horizontally the minimum bounding rectangle will be computed and a label aligned to it will be tried out as well (mbr).",graphic_marginHelp:"Similar to the margin shorthand property in CSS for HTML, its interpretation varies depending on how many margin values are provided: 1 = use that margin length on all sides of the label 2 = use the first for top & bottom margins and the second for left & right margins. 3 = use the first for the top margin, second for left & right margins, third for the bottom margin. 4 = use the first for the top margin, second for the right margin, third for the bottom margin, and fourth for the left margin.",initComponent:function(){this.symbolizer||(this.symbolizer={}),Ext.applyIf(this.symbolizer,this.defaultSymbolizer),this.symbolizer.vendorOptions||(this.symbolizer.vendorOptions={}),this.haloCache={},this.attributes.on("load",this.showHideGeometryOptions,this),this.attributes.load();var a={xtype:"combo",fieldLabel:this.labelValuesText,store:this.attributes,mode:"local",lastQuery:"",editable:!1,triggerAction:"all",allowBlank:!1,displayField:"name",valueField:"name",value:this.symbolizer.label&&this.symbolizer.label.replace(/^\${(.*)}$/,"$1"),listeners:{select:function(a,b){this.symbolizer.label="${"+b.get("name")+"}",this.fireEvent("change",this.symbolizer)},scope:this},width:120};this.attributesComboConfig=this.attributesComboConfig||{},Ext.applyIf(this.attributesComboConfig,a),this.labelWidth=80,this.items=[this.attributesComboConfig,{cls:"x-html-editor-tb",style:"background: transparent; border: none; padding: 0 0em 0.5em;",xtype:"toolbar",items:[{xtype:"gxp_fontcombo",fonts:this.fonts||void 0,width:110,value:this.symbolizer.fontFamily,listeners:{select:function(a,b){this.symbolizer.fontFamily=b.get("field1"),this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"tbtext",text:this.sizeText+": "},{xtype:"numberfield",allowNegative:!1,emptyText:OpenLayers.Renderer.defaultSymbolizer.fontSize,value:this.symbolizer.fontSize,width:30,listeners:{change:function(a,b){b=parseFloat(b),isNaN(b)?delete this.symbolizer.fontSize:this.symbolizer.fontSize=b,this.fireEvent("change",this.symbolizer)},scope:this}},{enableToggle:!0,cls:"x-btn-icon",iconCls:"x-edit-bold",pressed:"bold"===this.symbolizer.fontWeight,listeners:{toggle:function(a,b){this.symbolizer.fontWeight=b?"bold":"normal",this.fireEvent("change",this.symbolizer)},scope:this}},{enableToggle:!0,cls:"x-btn-icon",iconCls:"x-edit-italic",pressed:"italic"===this.symbolizer.fontStyle,listeners:{toggle:function(a,b){this.symbolizer.fontStyle=b?"italic":"normal",this.fireEvent("change",this.symbolizer)},scope:this}}]},{xtype:"gxp_fillsymbolizer",fillText:this.fontColorTitle,symbolizer:this.symbolizer,colorProperty:"fontColor",opacityProperty:"fontOpacity",checkboxToggle:!1,autoHeight:!0,width:213,labelWidth:70,plugins:this.colorManager&&[new this.colorManager],listeners:{change:function(a){this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"fieldset",title:this.graphicTitle,checkboxToggle:!0,hideMode:"offsets",collapsed:!(this.symbolizer.fillColor||this.symbolizer.fillOpacity||this.symbolizer.vendorOptions["graphic-resize"]||this.symbolizer.vendorOptions["graphic-margin"]),labelWidth:70,items:[{xtype:"gxp_pointsymbolizer",symbolizer:this.symbolizer,listeners:{change:function(a){a.graphic=!!a.graphicName||!!a.externalGraphic,this.fireEvent("change",this.symbolizer)},scope:this},border:!1,labelWidth:70},this.createVendorSpecificField({name:"graphic-resize",xtype:"combo",store:["none","stretch","proportional"],mode:"local",listeners:{select:function(a,b){"none"===a.getValue()?this.graphicMargin.hide():(Ext.isEmpty(this.graphicMargin.getValue())&&(this.graphicMargin.setValue(0),this.symbolizer.vendorOptions["graphic-margin"]=0),this.graphicMargin.show())},scope:this},width:100,triggerAction:"all",fieldLabel:this.graphicResizeText}),this.createVendorSpecificField({name:"graphic-margin",ref:"../graphicMargin",hidden:"stretch"!==this.symbolizer.vendorOptions["graphic-resize"]&&"proportional"!==this.symbolizer.vendorOptions["graphic-resize"],width:100,fieldLabel:this.graphicMarginText,xtype:"textfield"})],listeners:{collapse:function(){this.graphicCache={externalGraphic:this.symbolizer.externalGraphic,fillColor:this.symbolizer.fillColor,fillOpacity:this.symbolizer.fillOpacity,graphicName:this.symbolizer.graphicName,pointRadius:this.symbolizer.pointRadius,rotation:this.symbolizer.rotation,strokeColor:this.symbolizer.strokeColor,strokeWidth:this.symbolizer.strokeWidth,strokeDashStyle:this.symbolizer.strokeDashStyle},delete this.symbolizer.externalGraphic,delete this.symbolizer.fillColor,delete this.symbolizer.fillOpacity,delete this.symbolizer.graphicName,delete this.symbolizer.pointRadius,delete this.symbolizer.rotation,delete this.symbolizer.strokeColor,delete this.symbolizer.strokeWidth,delete this.symbolizer.strokeDashStyle,this.fireEvent("change",this.symbolizer)},expand:function(){Ext.apply(this.symbolizer,this.graphicCache),this.doLayout(),this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"fieldset",title:this.haloText,checkboxToggle:!0,collapsed:!(this.symbolizer.haloRadius||this.symbolizer.haloColor||this.symbolizer.haloOpacity),autoHeight:!0,labelWidth:50,items:[{xtype:"numberfield",fieldLabel:this.sizeText,anchor:"89%",allowNegative:!1,emptyText:OpenLayers.Renderer.defaultSymbolizer.haloRadius,value:this.symbolizer.haloRadius,listeners:{change:function(a,b){b=parseFloat(b),isNaN(b)?delete this.symbolizer.haloRadius:this.symbolizer.haloRadius=b,this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"gxp_fillsymbolizer",symbolizer:{fillColor:"haloColor"in this.symbolizer?this.symbolizer.haloColor:OpenLayers.Renderer.defaultSymbolizer.haloColor,fillOpacity:"haloOpacity"in this.symbolizer?this.symbolizer.haloOpacity:100*OpenLayers.Renderer.defaultSymbolizer.haloOpacity},defaultColor:OpenLayers.Renderer.defaultSymbolizer.haloColor,checkboxToggle:!1,width:190,labelWidth:60,plugins:this.colorManager&&[new this.colorManager],listeners:{change:function(a){this.symbolizer.haloColor=a.fillColor,this.symbolizer.haloOpacity=a.fillOpacity,this.fireEvent("change",this.symbolizer)},scope:this}}],listeners:{collapse:function(){this.haloCache={haloRadius:this.symbolizer.haloRadius,haloColor:this.symbolizer.haloColor,haloOpacity:this.symbolizer.haloOpacity},delete this.symbolizer.haloRadius,delete this.symbolizer.haloColor,delete this.symbolizer.haloOpacity,this.fireEvent("change",this.symbolizer)},expand:function(){Ext.apply(this.symbolizer,this.haloCache),this.doLayout(),this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"fieldset",collapsed:!(this.symbolizer.labelAlign||this.symbolizer.vendorOptions.polygonAlign||this.symbolizer.labelXOffset||this.symbolizer.labelYOffset||this.symbolizer.labelPerpendicularOffset),title:this.positioningText,checkboxToggle:!0,autoHeight:!0,labelWidth:75,defaults:{width:100},items:[this.createField(Ext.applyIf({fieldLabel:this.anchorPointText,geometryTypes:["POINT"],value:this.symbolizer.labelAlign||"lb",store:[["lt","Left-top"],["ct","Center-top"],["rt","Right-top"],["lm","Left-center"],["cm","Center"],["rm","Right-center"],["lb","Left-bottom"],["cb","Center-bottom"],["rb","Right-bottom"]],listeners:{select:function(a,b){this.symbolizer.labelAlign=a.getValue(),delete this.symbolizer.labelAnchorPointX,delete this.symbolizer.labelAnchorPointY,this.fireEvent("change",this.symbolizer)},scope:this}},this.attributesComboConfig)),this.createField({xtype:"numberfield",geometryTypes:["POINT"],fieldLabel:this.displacementXText,value:this.symbolizer.labelXOffset,listeners:{change:function(a,b){this.symbolizer.labelXOffset=b,this.fireEvent("change",this.symbolizer)},scope:this}}),this.createField({xtype:"numberfield",geometryTypes:["POINT"],fieldLabel:this.displacementYText,value:this.symbolizer.labelYOffset,listeners:{change:function(a,b){this.symbolizer.labelYOffset=b,this.fireEvent("change",this.symbolizer)},scope:this}}),this.createField({xtype:"numberfield",geometryTypes:["LINE"],fieldLabel:this.perpendicularOffsetText,value:this.symbolizer.labelPerpendicularOffset,listeners:{change:function(a,b){Ext.isEmpty(b)?delete this.symbolizer.labelPerpendicularOffset:this.symbolizer.labelPerpendicularOffset=b,this.fireEvent("change",this.symbolizer)},scope:this}}),this.createVendorSpecificField({name:"polygonAlign",geometryTypes:["POLYGON"],xtype:"combo",mode:"local",value:this.symbolizer.vendorOptions.polygonAlign||"manual",triggerAction:"all",store:["manual","ortho","mbr"],fieldLabel:this.polygonAlignText})]},{xtype:"fieldset",title:this.priorityText,checkboxToggle:!0,collapsed:!this.symbolizer.priority,autoHeight:!0,labelWidth:50,items:[Ext.applyIf({fieldLabel:this.priorityText,value:this.symbolizer.priority&&this.symbolizer.priority.replace(/^\${(.*)}$/,"$1"),allowBlank:!0,name:"priority",plugins:[{ptype:"gxp_formfieldhelp",dismissDelay:2e4,helpText:this.priorityHelp}],listeners:{select:function(a,b){this.symbolizer[a.name]="${"+b.get("name")+"}",this.fireEvent("change",this.symbolizer)},scope:this}},this.attributesComboConfig)]},{xtype:"fieldset",title:this.labelOptionsText,checkboxToggle:!0,collapsed:!(this.symbolizer.vendorOptions.autoWrap||this.symbolizer.vendorOptions.followLine||this.symbolizer.vendorOptions.maxAngleDelta||this.symbolizer.vendorOptions.maxDisplacement||this.symbolizer.vendorOptions.repeat||this.symbolizer.vendorOptions.forceLeftToRight||this.symbolizer.vendorOptions.group||this.symbolizer.vendorOptions.spaceAround||this.symbolizer.vendorOptions.labelAllGroup||this.symbolizer.vendorOptions.conflictResolution||this.symbolizer.vendorOptions.goodnessOfFit||this.symbolizer.vendorOptions.polygonAlign),autoHeight:!0,labelWidth:80,defaults:{width:100},items:[this.createVendorSpecificField({name:"autoWrap",allowBlank:!1,fieldLabel:this.autoWrapText}),this.createVendorSpecificField({name:"followLine",geometryTypes:["LINE"],xtype:"checkbox",listeners:{check:function(a,b){b?this.maxAngleDelta.show():this.maxAngleDelta.hide()},scope:this},fieldLabel:this.followLineText}),this.createVendorSpecificField({name:"maxAngleDelta",ref:"../maxAngleDelta",hidden:null==this.symbolizer.vendorOptions.followLine,geometryTypes:["LINE"],fieldLabel:this.maxAngleDeltaText}),this.createVendorSpecificField({name:"maxDisplacement",fieldLabel:this.maxDisplacementText}),this.createVendorSpecificField({name:"repeat",geometryTypes:["LINE"],fieldLabel:this.repeatText}),this.createVendorSpecificField({name:"forceLeftToRight",xtype:"checkbox",geometryTypes:["LINE"],fieldLabel:this.forceLeftToRightText}),this.createVendorSpecificField({name:"group",listeners:{check:function(a,b){"LINE"===this.geometryType&&(b===!1?this.labelAllGroup.hide():this.labelAllGroup.show())},scope:this},xtype:"checkbox",yesno:!0,fieldLabel:this.groupText}),this.createVendorSpecificField({name:"labelAllGroup",ref:"../labelAllGroup",geometryTypes:["LINE"],hidden:"yes"!==this.symbolizer.vendorOptions.group,xtype:"checkbox",fieldLabel:this.labelAllGroupText}),this.createVendorSpecificField({name:"conflictResolution",xtype:"checkbox",listeners:{check:function(a,b){b?this.spaceAround.show():this.spaceAround.hide()},scope:this},fieldLabel:this.conflictResolutionText}),this.createVendorSpecificField({name:"spaceAround",hidden:this.symbolizer.vendorOptions.conflictResolution!==!0,allowNegative:!0,ref:"../spaceAround",fieldLabel:this.spaceAroundText}),this.createVendorSpecificField({name:"goodnessOfFit",geometryTypes:["POLYGON"],fieldLabel:this.goodnessOfFitText})]}],this.addEvents("change"),gxp.TextSymbolizer.superclass.initComponent.call(this)},createField:function(a){var b=Ext.ComponentMgr.create(a);return a.geometryTypes&&this.on("geometrytype",function(c){a.geometryTypes.indexOf(c)===-1&&b.hide()}),b},createVendorSpecificField:function(a){var b=function(b,c){Ext.isEmpty(c)?delete this.symbolizer.vendorOptions[a.name]:a.yesno===!0?this.symbolizer.vendorOptions[a.name]=1==c?"yes":"no":this.symbolizer.vendorOptions[a.name]=c,this.fireEvent("change",this.symbolizer)},c=Ext.ComponentMgr.create(Ext.applyIf(a,{xtype:"numberfield",allowNegative:!1,value:a.value||this.symbolizer.vendorOptions[a.name],checked:a.yesno===!0?"yes"===this.symbolizer.vendorOptions[a.name]:this.symbolizer.vendorOptions[a.name],plugins:[{ptype:"gxp_formfieldhelp",dismissDelay:2e4,helpText:this[a.name.replace(/-/g,"_")+"Help"]}]}));return c.on("change",b,this),c.on("check",b,this),a.geometryTypes&&this.on("geometrytype",function(b){a.geometryTypes.indexOf(b)===-1&&c.hide()}),c},showHideGeometryOptions:function(){var a=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/,b=/gml:((Multi)?(Polygon|Surface)).*/,c=/gml:((Multi)?(Point)).*/,d=/gml:((Multi)?(Line|Curve|Surface)).*/,e=null;this.attributes.each(function(f){var g=f.get("type"),h=a.exec(g);h&&(b.exec(g)?e="POLYGON":c.exec(g)?e="POINT":d.exec(g)&&(e="LINE"))},this),null!==e&&(this.geometryType=e,this.fireEvent("geometrytype",e))}}),Ext.reg("gxp_textsymbolizer",gxp.TextSymbolizer),Ext.namespace("gxp"),gxp.FillSymbolizer=Ext.extend(Ext.FormPanel,{symbolizer:null,colorProperty:"fillColor",opacityProperty:"fillOpacity",colorManager:null,checkboxToggle:!0,defaultColor:null,border:!1,fillText:"Fill",colorText:"Color",opacityText:"Opacity",initComponent:function(){this.symbolizer||(this.symbolizer={});var a;this.colorManager&&(a=[new this.colorManager]);var b=100;this.opacityProperty in this.symbolizer?b=100*this.symbolizer[this.opacityProperty]:OpenLayers.Renderer.defaultSymbolizer[this.opacityProperty]&&(b=100*OpenLayers.Renderer.defaultSymbolizer[this.opacityProperty]),this.items=[{xtype:"fieldset",title:this.fillText,autoHeight:!0,checkboxToggle:this.checkboxToggle,collapsed:this.checkboxToggle===!0&&this.symbolizer.fill===!1,hideMode:"offsets",defaults:{width:100},items:[{xtype:"gxp_colorfield",fieldLabel:this.colorText,name:"color",emptyText:OpenLayers.Renderer.defaultSymbolizer[this.colorProperty],value:this.symbolizer[this.colorProperty],defaultBackground:this.defaultColor||OpenLayers.Renderer.defaultSymbolizer[this.colorProperty],plugins:a,listeners:{valid:function(a){var b=a.getValue(),c=this.symbolizer[this.colorProperty]!=b;this.symbolizer[this.colorProperty]=b,c&&this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"slider",fieldLabel:this.opacityText,name:"opacity",values:[b],isFormField:!0,listeners:{changecomplete:function(a,b){this.symbolizer[this.opacityProperty]=b/100,this.fireEvent("change",this.symbolizer)},scope:this},plugins:[new GeoExt.SliderTip({getText:function(a){return a.value+"%"}})]}],listeners:{collapse:function(){this.symbolizer.fill!==!1&&(this.symbolizer.fill=!1,this.fireEvent("change",this.symbolizer))},expand:function(){this.symbolizer.fill=!0,this.fireEvent("change",this.symbolizer)},scope:this}}],this.addEvents("change"),gxp.FillSymbolizer.superclass.initComponent.call(this)}}),Ext.reg("gxp_fillsymbolizer",gxp.FillSymbolizer),Ext.namespace("gxp.form"),gxp.form.ColorField=Ext.extend(Ext.form.TextField,{cssColors:{aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},defaultBackground:"#ffffff",initComponent:function(){this.value&&(this.value=this.hexToColor(this.value)),gxp.form.ColorField.superclass.initComponent.call(this),this.on({render:this.colorField,valid:this.colorField,scope:this})},isDark:function(a){var b=!1;if(a){var c=parseInt(a.substring(1,3),16)/255,d=parseInt(a.substring(3,5),16)/255,e=parseInt(a.substring(5,7),16)/255,f=.299*c+.587*d+.144*e;b=f<.5}return b},colorField:function(){var a=this.colorToHex(this.getValue())||this.defaultBackground;this.getEl().setStyle({background:a,color:this.isDark(a)?"#ffffff":"#000000"})},getHexValue:function(){return this.colorToHex(gxp.form.ColorField.superclass.getValue.apply(this,arguments))},getValue:function(){var a=this.getHexValue(),b=this.initialConfig.value;return a===this.hexToColor(b)&&(a=b),a},setValue:function(a){gxp.form.ColorField.superclass.setValue.apply(this,[this.hexToColor(a)])},colorToHex:function(a){if(!a)return a;var b;return b=a.match(/^#[0-9a-f]{6}$/i)?a:this.cssColors[a.toLowerCase()]||null},hexToColor:function(a){if(!a)return a;var b=a;for(var c in this.cssColors)if(this.cssColors[c]==b.toUpperCase()){b=c;break}return b}}),Ext.reg("gxp_colorfield",gxp.form.ColorField),Ext.namespace("gxp.form"),gxp.form.FontComboBox=Ext.extend(Ext.form.ComboBox,{fonts:["Serif","SansSerif","Arial","Courier New","Tahoma","Times New Roman","Verdana"],defaultFont:"Serif",allowBlank:!1,mode:"local",triggerAction:"all",editable:!1,initComponent:function(){var a=this.fonts||gxp.form.FontComboBox.prototype.fonts,b=this.defaultFont;a.indexOf(this.defaultFont)===-1&&(b=a[0]);var c={displayField:"field1",valueField:"field1",store:a,value:b,tpl:new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item"><span style="font-family: {field1};">{field1}</span></div></tpl>')};Ext.applyIf(this,c),gxp.form.FontComboBox.superclass.initComponent.call(this)}}),Ext.reg("gxp_fontcombo",gxp.form.FontComboBox),Ext.namespace("gxp"),gxp.PolygonSymbolizer=Ext.extend(Ext.Panel,{symbolizer:null,initComponent:function(){this.items=[{xtype:"gxp_fillsymbolizer",symbolizer:this.symbolizer,listeners:{change:function(a){this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"gxp_strokesymbolizer",symbolizer:this.symbolizer,listeners:{change:function(a){this.fireEvent("change",this.symbolizer)},scope:this}}],this.addEvents("change"),gxp.PolygonSymbolizer.superclass.initComponent.call(this)}}),Ext.reg("gxp_polygonsymbolizer",gxp.PolygonSymbolizer),Ext.namespace("gxp"),gxp.StrokeSymbolizer=Ext.extend(Ext.FormPanel,{solidStrokeName:"solid",dashStrokeName:"dash",dotStrokeName:"dot",titleText:"Stroke",styleText:"Style",colorText:"Color",widthText:"Width",opacityText:"Opacity",symbolizer:null,colorManager:null,checkboxToggle:!0,defaultColor:null,dashStyles:null,border:!1,initComponent:function(){this.dashStyles=this.dashStyles||[["solid",this.solidStrokeName],["4 4",this.dashStrokeName],["2 4",this.dotStrokeName]],this.symbolizer||(this.symbolizer={});var a;this.colorManager&&(a=[new this.colorManager]),this.items=[{xtype:"fieldset",title:this.titleText,autoHeight:!0,checkboxToggle:this.checkboxToggle,collapsed:this.checkboxToggle===!0&&this.symbolizer.stroke===!1,hideMode:"offsets",defaults:{width:100},items:[{xtype:"combo",name:"style",fieldLabel:this.styleText,store:new Ext.data.SimpleStore({data:this.dashStyles,fields:["value","display"]}),displayField:"display",valueField:"value",value:this.getDashArray(this.symbolizer.strokeDashstyle)||OpenLayers.Renderer.defaultSymbolizer.strokeDashstyle,mode:"local",allowBlank:!0,triggerAction:"all",editable:!1,listeners:{select:function(a,b){this.symbolizer.strokeDashstyle=b.get("value"),this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"gxp_colorfield",name:"color",fieldLabel:this.colorText,emptyText:OpenLayers.Renderer.defaultSymbolizer.strokeColor,value:this.symbolizer.strokeColor,defaultBackground:this.defaultColor||OpenLayers.Renderer.defaultSymbolizer.strokeColor,plugins:a,listeners:{valid:function(a){var b=a.getValue(),c=this.symbolizer.strokeColor!=b;this.symbolizer.strokeColor=b,c&&this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"numberfield",name:"width",fieldLabel:this.widthText,allowNegative:!1,emptyText:OpenLayers.Renderer.defaultSymbolizer.strokeWidth,value:this.symbolizer.strokeWidth,listeners:{change:function(a,b){b=parseFloat(b),isNaN(b)?delete this.symbolizer.strokeWidth:this.symbolizer.strokeWidth=b,this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"slider",name:"opacity",fieldLabel:this.opacityText,values:[100*("strokeOpacity"in this.symbolizer?this.symbolizer.strokeOpacity:OpenLayers.Renderer.defaultSymbolizer.strokeOpacity)],isFormField:!0,listeners:{changecomplete:function(a,b){this.symbolizer.strokeOpacity=b/100,this.fireEvent("change",this.symbolizer)},scope:this},plugins:[new GeoExt.SliderTip({getText:function(a){return a.value+"%"}})]}],listeners:{collapse:function(){this.symbolizer.stroke!==!1&&(this.symbolizer.stroke=!1,this.fireEvent("change",this.symbolizer))},expand:function(){this.symbolizer.stroke=!0,this.fireEvent("change",this.symbolizer)},scope:this}}],this.addEvents("change"),gxp.StrokeSymbolizer.superclass.initComponent.call(this)},getDashArray:function(a){var b;if(a){var c=a.split(/\s+/),d=c[0]/c[1];isNaN(d)||(b=d>=1?"4 4":"2 4")}return b}}),Ext.reg("gxp_strokesymbolizer",gxp.StrokeSymbolizer),Ext.namespace("gxp"),gxp.LineSymbolizer=Ext.extend(Ext.Panel,{symbolizer:null,initComponent:function(){this.items=[{xtype:"gxp_strokesymbolizer",symbolizer:this.symbolizer,listeners:{change:function(a){this.fireEvent("change",this.symbolizer)},scope:this}}],this.addEvents("change"),gxp.LineSymbolizer.superclass.initComponent.call(this)}}),Ext.reg("gxp_linesymbolizer",gxp.LineSymbolizer),Ext.namespace("gxp"),gxp.PointSymbolizer=Ext.extend(Ext.Panel,{symbolizer:null,graphicCircleText:"circle",graphicSquareText:"square",graphicTriangleText:"triangle",graphicStarText:"star",graphicCrossText:"cross",graphicXText:"x",graphicExternalText:"external",urlText:"URL",opacityText:"opacity",symbolText:"Symbol",sizeText:"Size",rotationText:"Rotation",pointGraphics:null,colorManager:null,external:null,layout:"form",initComponent:function(){this.symbolizer||(this.symbolizer={}),this.pointGraphics||(this.pointGraphics=[{display:this.graphicCircleText,value:"circle",mark:!0},{display:this.graphicSquareText,value:"square",mark:!0},{display:this.graphicTriangleText,value:"triangle",mark:!0},{display:this.graphicStarText,value:"star",mark:!0},{display:this.graphicCrossText,value:"cross",mark:!0},{display:this.graphicXText,value:"x",mark:!0},{display:this.graphicExternalText}]),this.external=!!this.symbolizer.externalGraphic,this.markPanel=new Ext.Panel({border:!1,collapsed:this.external,layout:"form",items:[{xtype:"gxp_fillsymbolizer",symbolizer:this.symbolizer,labelWidth:this.labelWidth,labelAlign:this.labelAlign,colorManager:this.colorManager,listeners:{change:function(a){this.fireEvent("change",this.symbolizer);
},scope:this}},{xtype:"gxp_strokesymbolizer",symbolizer:this.symbolizer,labelWidth:this.labelWidth,labelAlign:this.labelAlign,colorManager:this.colorManager,listeners:{change:function(a){this.fireEvent("change",this.symbolizer)},scope:this}}]}),this.urlField=new Ext.form.TextField({name:"url",fieldLabel:this.urlText,value:this.symbolizer.externalGraphic,hidden:!this.external,listeners:{change:function(a,b){this.symbolizer.externalGraphic=b,this.fireEvent("change",this.symbolizer)},scope:this},width:100}),this.graphicPanel=new Ext.Panel({border:!1,collapsed:!this.external,layout:"form",items:[this.urlField,{xtype:"slider",name:"opacity",fieldLabel:this.opacityText,value:[null==this.symbolizer.graphicOpacity?100:100*this.symbolizer.graphicOpacity],isFormField:!0,listeners:{changecomplete:function(a,b){this.symbolizer.graphicOpacity=b/100,this.fireEvent("change",this.symbolizer)},scope:this},plugins:[new GeoExt.SliderTip({getText:function(a){return a.value+"%"}})],width:100}]}),this.items=[{xtype:"combo",name:"mark",fieldLabel:this.symbolText,store:new Ext.data.JsonStore({data:{root:this.pointGraphics},root:"root",fields:["value","display","preview",{name:"mark",type:"boolean"}]}),value:this.external?0:this.symbolizer.graphicName,displayField:"display",valueField:"value",tpl:new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item gx-pointsymbolizer-mark-item"><tpl if="preview"><img src="{preview}" alt="{display}"/></tpl><span>{display}</span></div></tpl>'),mode:"local",allowBlank:!1,triggerAction:"all",editable:!1,listeners:{select:function(a,b){var c=b.get("mark"),d=b.get("value");if(c)this.external&&(this.external=!1,delete this.symbolizer.externalGraphic,this.updateGraphicDisplay()),this.symbolizer.graphicName=d;else if(d?(this.urlField.hide(),this.symbolizer.externalGraphic=d):this.urlField.show(),!this.external){this.external=!0;var e=this.urlField.getValue();Ext.isEmpty(e)||(this.symbolizer.externalGraphic=e),delete this.symbolizer.graphicName,this.updateGraphicDisplay()}this.fireEvent("change",this.symbolizer)},scope:this},width:100},{xtype:"textfield",name:"size",fieldLabel:this.sizeText,value:this.symbolizer.pointRadius&&2*this.symbolizer.pointRadius,listeners:{change:function(a,b){this.symbolizer.pointRadius=b/2,this.fireEvent("change",this.symbolizer)},scope:this},width:100},{xtype:"textfield",name:"rotation",fieldLabel:this.rotationText,value:this.symbolizer.rotation,listeners:{change:function(a,b){this.symbolizer.rotation=b,this.fireEvent("change",this.symbolizer)},scope:this},width:100},this.markPanel,this.graphicPanel],this.addEvents("change"),gxp.PointSymbolizer.superclass.initComponent.call(this)},updateGraphicDisplay:function(){this.external?(this.markPanel.collapse(),this.graphicPanel.expand()):(this.graphicPanel.collapse(),this.markPanel.expand())}}),Ext.reg("gxp_pointsymbolizer",gxp.PointSymbolizer),OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!this.eTop){this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top";this.topInUnits.length;this.div.appendChild(this.eTop),""==this.topOutUnits||""==this.topInUnits?this.eTop.style.visibility="hidden":this.eTop.style.visibility="visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),""==this.bottomOutUnits||""==this.bottomInUnits?this.eBottom.style.visibility="hidden":this.eBottom.style.visibility="visible"}return this.map.events.register("moveend",this,this.update),this.update(),this.div},getBarLen:function(a){var e,b=parseInt(Math.log(a)/Math.log(10)),c=Math.pow(10,b),d=parseInt(a/c);return e=d>5?5:d>2?2:1,e*c},update:function(){var a=this.map.getResolution();if(a){var b=this.map.getUnits(),c=OpenLayers.INCHES_PER_UNIT,d=this.maxWidth*a*c[b],e=1;if(this.geodesic===!0){var f=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth,g=d/c.km;e=f/g,d*=e}var h,i;d>1e5?(h=this.topOutUnits,i=this.bottomOutUnits):(h=this.topInUnits,i=this.bottomInUnits);var j=d/c[h],k=d/c[i],l=this.getBarLen(j),m=this.getBarLen(k);j=l/c[b]*c[h],k=m/c[b]*c[i];var n=j/a/e,o=k/a/e;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(o)+"px",this.eBottom.innerHTML=m+" "+i),"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(n)+"px",this.eTop.innerHTML=l+" "+h)}},CLASS_NAME:"OpenLayers.Control.ScaleLine"}),Ext.namespace("gxp"),gxp.ScaleOverlay=Ext.extend(Ext.Panel,{map:null,zoomLevelText:"Zoom level",initComponent:function(){gxp.ScaleOverlay.superclass.initComponent.call(this),this.cls="map-overlay",this.map&&(this.map instanceof GeoExt.MapPanel&&(this.map=this.map.map),this.bind(this.map)),this.on("beforedestroy",this.unbind,this)},addToMapPanel:function(a){this.on({afterrender:function(){this.bind(a.map)},scope:this})},stopMouseEvents:function(a){a.stopEvent()},removeFromMapPanel:function(a){var b=this.getEl();b.un("mousedown",this.stopMouseEvents,this),b.un("click",this.stopMouseEvents,this),this.unbind()},addScaleLine:function(){var a=new Ext.BoxComponent({autoEl:{tag:"div",cls:"olControlScaleLine overlay-element overlay-scaleline"}});this.on("afterlayout",function(){a.getEl().dom.style.position="relative",a.getEl().dom.style.display="inline",this.getEl().on("click",this.stopMouseEvents,this),this.getEl().on("mousedown",this.stopMouseEvents,this)},this),a.on("render",function(){var b=new OpenLayers.Control.ScaleLine({geodesic:!0,div:a.getEl().dom});this.map.addControl(b),b.activate()},this),this.add(a)},handleZoomEnd:function(){var a=this.zoomStore.queryBy(function(a){return this.map.getZoom()==a.data.level},this);if(a.length>0)a=a.items[0],this.zoomSelector.setValue("1 : "+parseInt(a.data.scale,10));else{if(!this.zoomSelector.rendered)return;this.zoomSelector.clearValue()}},addScaleCombo:function(){this.zoomStore=new GeoExt.data.ScaleStore({map:this.map}),this.zoomSelector=new Ext.form.ComboBox({emptyText:this.zoomLevelText,tpl:'<tpl for="."><div class="x-combo-list-item">1 : {[parseInt(values.scale)]}</div></tpl>',editable:!1,triggerAction:"all",mode:"local",store:this.zoomStore,width:110}),this.zoomSelector.on({click:this.stopMouseEvents,mousedown:this.stopMouseEvents,select:function(a,b,c){this.map.zoomTo(b.data.level)},scope:this}),this.map.events.register("zoomend",this,this.handleZoomEnd);var a=new Ext.Panel({items:[this.zoomSelector],cls:"overlay-element overlay-scalechooser",border:!1});this.add(a)},bind:function(a){this.map=a,this.addScaleLine(),this.addScaleCombo(),this.doLayout()},unbind:function(){this.map&&this.map.events&&this.map.events.unregister("zoomend",this,this.handleZoomEnd),this.zoomStore=null,this.zoomSelector=null}}),Ext.reg("gxp_scaleoverlay",gxp.ScaleOverlay),Ext.namespace("gxp.plugins"),gxp.plugins.Tool=Ext.extend(Ext.util.Observable,{ptype:"gxp_tool",autoActivate:!0,actionTarget:"map.tbar",showButtonText:!1,output:null,constructor:function(a){this.initialConfig=a||{},this.active=!1,Ext.apply(this,a),this.id||(this.id=Ext.id()),this.output=[],this.addEvents("activate","deactivate"),gxp.plugins.Tool.superclass.constructor.apply(this,arguments)},init:function(a){a.tools[this.id]=this,this.target=a,this.autoActivate&&this.activate(),this.target.on("portalready",this.addActions,this)},activate:function(){if(this.active===!1)return this.active=!0,this.fireEvent("activate",this),!0},deactivate:function(){if(this.active===!0)return this.active=!1,this.fireEvent("deactivate",this),!0},getContainer:function(a){var b,c,d,e=a.split("."),f=e[0];if(f){if("map"==f)b=this.target.mapPanel;else if(b=Ext.getCmp(f)||this.target.portal[f],!b)throw new Error("Can't find component with id: "+f)}else b=this.target.portal;return c=e.length>1&&e[1],c&&(d={tbar:"getTopToolbar",bbar:"getBottomToolbar",fbar:"getFooterToolbar"}[c],b=d?b[d]():b[c]),b},addActions:function(a){if(a=a||this.actions,!a||null===this.actionTarget)return this.removeOutput(),void this.addOutput(this.outputConfig);var d,e,f,g,h,i,j,b=this.actionTarget instanceof Array?this.actionTarget:[this.actionTarget],c=a instanceof Array?a:[a],k=null;for(g=b.length-1;g>=0;--g){for(e=b[g],e&&(e instanceof Object&&(k=e.index,e=e.target),j=this.getContainer(e)),h=0,i=c.length;h<i;++h)if(c[h]instanceof Ext.Action||c[h]instanceof Ext.Component||(f=Ext.getCmp(c[h]),f&&(c[h]=f),"string"!=typeof c[h]&&(h==this.defaultAction&&(c[h].pressed=!0),c[h]=new Ext.Action(c[h]))),d=c[h],h==this.defaultAction&&d instanceof GeoExt.Action&&(d.isDisabled()?d.activateOnEnable=!0:d.control.activate()),j){this.showButtonText&&d.setText(d.initialConfig.buttonText),j instanceof Ext.menu.Menu?d=Ext.apply(new Ext.menu.CheckItem(d),{text:d.initialConfig.menuText,group:d.initialConfig.toggleGroup,groupClass:null}):j instanceof Ext.Toolbar||(d=new Ext.Button(d));var l=null===k?j.add(d):j.insert(k,d);if(d=d instanceof Ext.Button?d:l,null!==k&&(k+=1),null!=this.outputAction&&h==this.outputAction){var f;d.on("click",function(){f?this.outputTarget?f.show():f.ownerCt.ownerCt.show():f=this.addOutput()},this)}}j&&(j.isVisible()?j.doLayout():j instanceof Ext.menu.Menu||j.show())}return this.actions=c,this.actions},addOutput:function(a){if(a||this.outputConfig){a=a||{};var c,b=this.outputTarget;if(b)c=this.getContainer(b),a instanceof Ext.Component||Ext.apply(a,this.outputConfig);else{var d=this.outputConfig||{};c=new Ext.Window(Ext.apply({hideBorders:!0,shadow:!1,closeAction:"hide",autoHeight:!d.height,layout:d.height?"fit":void 0,items:[{defaults:Ext.applyIf({autoHeight:!(d.height||d.defaults&&d.defaults.height)},d.defaults)}]},d)).show().items.get(0)}if(c){var e=c.add(a);return e.on("removed",function(a){this.output.remove(a)},this,{single:!0}),e instanceof Ext.Window?e.show():c.doLayout(),this.output.push(e),e}var f=this.ptype;window.console&&console.error("Failed to create output for plugin with ptype: "+f)}},removeOutput:function(){for(var a,b=this.output.length-1;b>=0;--b)a=this.output[b],this.outputTarget?a.ownerCt?(a.ownerCt.remove(a),a.ownerCt instanceof Ext.Window&&a.ownerCt[a.ownerCt.closeAction]()):a.remove():a.findParentBy(function(a){return a instanceof Ext.Window}).close();this.output=[]},getState:function(){return Ext.apply({},this.initialConfig)}}),Ext.preg(gxp.plugins.Tool.prototype.ptype,gxp.plugins.Tool),Ext.namespace("gxp.data"),gxp.data.WFSProtocolProxy=Ext.extend(GeoExt.data.ProtocolProxy,{setFilter:function(a){this.protocol.filter=a,this.protocol.options.filter=a},constructor:function(a){Ext.applyIf(a,{version:"1.1.0"}),this.protocol&&this.protocol instanceof OpenLayers.Protocol||(a.protocol=new OpenLayers.Protocol.WFS(Ext.apply({version:a.version,srsName:a.srsName,url:a.url,featureType:a.featureType,featureNS:a.featureNS,geometryName:a.geometryName,schema:a.schema,filter:a.filter,maxFeatures:a.maxFeatures,multi:a.multi},a.protocol))),gxp.data.WFSProtocolProxy.superclass.constructor.apply(this,arguments)},doRequest:function(a,b,c,d,e,f,g){if(delete c.xaction,a===Ext.data.Api.actions.read)this.load(c,d,e,f,g);else{b instanceof Array||(b=[b]);var i,h=new Array(b.length);Ext.each(b,function(a,b){h[b]=a.getFeature(),i=h[b],i.modified=Ext.apply(i.modified||{},{attributes:Ext.apply(i.modified&&i.modified.attributes||{},a.modified)})},this);var j={action:a,records:b,callback:e,scope:f},k={callback:function(a){this.onProtocolCommit(a,j)},scope:this};Ext.applyIf(k,c),this.protocol.commit(h,k)}},onProtocolCommit:function(a,b){if(a.success()){var d,e,h,i,c=a.reqFeatures,f=[],g=a.insertIds||[],j=0;for(h=0,i=c.length;h<i;++h)e=c[h],d=e.state,d&&(d==OpenLayers.State.DELETE?f.push(e):d==OpenLayers.State.INSERT?(e.fid=g[j],++j):e.modified&&(e.modified={}),e.state=null);for(h=0,i=f.length;h<i;++h)e=f[h],e.layer&&e.layer.destroyFeatures([e]);i=c.length;var l,k=new Array(i);for(h=0;h<i;++h){l=c[h],k[h]={id:l.id,feature:l,state:null};var m=b.records[h].fields;for(var n in l.attributes)m.containsKey(n)&&(k[h][n]=l.attributes[n])}b.callback.call(b.scope,k,a.priv,!0)}else{var o=a.priv;o.status>=200&&o.status<300?this.fireEvent("exception",this,"remote",b.action,b,a.error,b.records):this.fireEvent("exception",this,"response",b.action,b,o),b.callback.call(b.scope,[],o,!1)}}}),Ext.namespace("gxp.data"),gxp.data.WFSFeatureStore=Ext.extend(GeoExt.data.FeatureStore,{setOgcFilter:function(a){this.proxy.setFilter(a)},constructor:function(a){a.proxy&&a.proxy instanceof GeoExt.data.ProtocolProxy||(a.proxy=new gxp.data.WFSProtocolProxy(Ext.apply({srsName:a.srsName,url:a.url,featureType:a.featureType,featureNS:a.featureNS,geometryName:a.geometryName,schema:a.schema,filter:a.ogcFilter,maxFeatures:a.maxFeatures,multi:a.multi},a.proxy))),a.writer||(a.writer=new Ext.data.DataWriter({write:Ext.emptyFn})),gxp.data.WFSFeatureStore.superclass.constructor.apply(this,arguments),this.reader.extractValues=function(a,b,c){var d=this.readRecords([a.feature]);return d.records[0].data}.createDelegate(this.reader),this.reader.meta.idProperty="id",this.reader.getId=function(a){return a.id}}}),Ext.namespace("gxp.plugins"),gxp.plugins.FeatureManager=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_featuremanager",maxFeatures:100,paging:!0,pagingType:null,autoZoomPage:!1,autoSetLayer:!0,autoLoadFeatures:!1,layerRecord:null,featureStore:null,hitCountProtocol:null,featureLayer:null,schema:null,geometryType:null,toolsShowingLayer:null,selectStyle:null,style:null,pages:null,page:null,numberOfFeatures:null,numPages:null,pageIndex:null,constructor:function(a){this.addEvents("beforequery","query","beforelayerchange","layerchange","beforesetpage","setpage","beforeclearfeatures","clearfeatures","beforesave","exception"),a&&!a.pagingType&&(this.pagingType=gxp.plugins.FeatureManager.QUADTREE_PAGING),a&&a.layer&&(this.autoSetLayer=!1),gxp.plugins.FeatureManager.superclass.constructor.apply(this,arguments)},init:function(a){gxp.plugins.FeatureManager.superclass.init.apply(this,arguments),this.toolsShowingLayer={},this.style={all:new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:this.initialConfig.symbolizer||{Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:4,strokeOpacity:1,strokeColor:"#ff9933"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#ff6633",fillColor:"white",fillOpacity:.3}}})]}),selected:new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{display:"none"}})]})},this.featureLayer=new OpenLayers.Layer.Vector(this.id,{displayInLayerSwitcher:!1,visibility:!1,styleMap:new OpenLayers.StyleMap({select:Ext.applyIf(Ext.apply({display:""},this.selectStyle),OpenLayers.Feature.Vector.style.select),vertex:this.style.all},{extendDefault:!1})}),this.target.on({ready:function(){this.target.mapPanel.map.addLayer(this.featureLayer)},scope:this}),this.on({beforedestroy:function(){this.target.mapPanel.map.removeLayer(this.featureLayer)},scope:this})},activate:function(){if(gxp.plugins.FeatureManager.superclass.activate.apply(this,arguments)){if(this.autoSetLayer&&this.target.on("beforelayerselectionchange",this.setLayer,this),this.layer){var a=Ext.apply({},this.layer);this.target.createLayerRecord(a,this.setLayer,this)}return this.on("layerchange",this.setSchema,this),!0}},deactivate:function(){if(gxp.plugins.FeatureManager.superclass.deactivate.apply(this,arguments))return this.autoSetLayer&&this.target.un("beforelayerselectionchange",this.setLayer,this),this.un("layerchange",this.setSchema,this),this.setLayer(),!0},getPageExtent:function(){return this.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING?this.page.extent:this.featureStore.layer.getDataExtent()},setLayer:function(a){var b=this.fireEvent("beforelayerchange",this,a);return b!==!1&&(a&&(this.featureLayer.projection=a.getLayer().projection),a!==this.layerRecord&&(this.clearFeatureStore(),this.layerRecord=a,a?this.autoLoadFeatures===!0?this.loadFeatures():this.setFeatureStore():this.fireEvent("layerchange",this,null))),b},setSchema:function(a,b,c){this.schema=c},showLayer:function(a,b){this.toolsShowingLayer[a]=b||"all",this.setLayerDisplay()},hideLayer:function(a){delete this.toolsShowingLayer[a],this.setLayerDisplay()},setLayerDisplay:function(){var a=this.visible(),b=this.target.mapPanel.map;if(a){var c=this.style[a];c!==this.featureLayer.styleMap.styles.default&&(this.featureLayer.styleMap.styles.default=c,this.featureLayer.redraw()),this.featureLayer.setVisibility(!0),b.events.on({addlayer:this.raiseLayer,scope:this})}else this.featureLayer.map&&(this.featureLayer.setVisibility(!1),b.events.un({addlayer:this.raiseLayer,scope:this}))},visible:function(){var a=!1;for(var b in this.toolsShowingLayer)"all"!=a&&(a=this.toolsShowingLayer[b]);return a},raiseLayer:function(){var a=this.featureLayer&&this.featureLayer.map;a&&a.setLayerIndex(this.featureLayer,a.layers.length)},loadFeatures:function(a,b,c){if(this.fireEvent("beforequery",this,a,b,c)!==!1){if(this.filter=a,this.pages=null,b){var d=this;d._activeQuery&&d.un("query",d._activeQuery),this.on("query",d._activeQuery=function(a,e){delete d._activeQuery,this.un("query",arguments.callee,this);e.getCount();0==e.getCount()?b.call(c,[]):this.featureLayer.events.register("featuresadded",this,function(a){this.featureLayer.events.unregister("featuresadded",this,arguments.callee),b.call(c,a.features)})},this,{single:!0})}this.featureStore?(this.featureStore.setOgcFilter(a),this.paging?this.setPage():this.featureStore.load()):(this.paging&&this.on("layerchange",function(a,b,c){c&&(this.un("layerchange",arguments.callee,this),this.setPage())},this),this.setFeatureStore(a,!this.paging))}},clearFeatures:function(){var a=this.featureStore;if(a&&this.fireEvent("beforeclearfeatures",this)!==!1){a.removeAll(),this.fireEvent("clearfeatures",this);var b=a.proxy;b.abortRequest(),b.protocol.response&&b.protocol.response.abort()}},getProjection:function(a){var b=this.target.mapPanel.map.getProjectionObject(),c=a.getLayer().projection;return c&&c.equals(b)&&(b=c),b},setFeatureStore:function(a,b){var c=this.layerRecord,d=this.target.getSource(c);d&&d instanceof gxp.plugins.WMSSource?d.getSchema(c,function(d){if(d===!1)this.clearFeatureStore();else{var f,e=[],g=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/,h={"xsd:boolean":"boolean","xsd:int":"int","xsd:integer":"int","xsd:short":"int","xsd:long":"int","xsd:date":"date","xsd:string":"string","xsd:float":"float","xsd:double":"float"};d.each(function(a){var b=g.exec(a.get("type"));if(b)f=a.get("name"),this.geometryType=b[1];else{var c=h[a.get("type")],d={name:a.get("name"),type:h[c]};"date"==c&&(d.dateFormat="Y-m-d\\Z"),e.push(d)}},this);var i={srsName:this.getProjection(c).getCode(),url:d.url,featureType:d.reader.raw.featureTypes[0].typeName,featureNS:d.reader.raw.targetNamespace,geometryName:f};this.hitCountProtocol=new OpenLayers.Protocol.WFS(Ext.apply({version:"1.1.0",readOptions:{output:"object"},resultType:"hits",filter:a},i)),this.featureStore=new gxp.data.WFSFeatureStore(Ext.apply({fields:e,proxy:{protocol:{outputFormat:this.format,multi:this.multi}},maxFeatures:this.maxFeatures,layer:this.featureLayer,ogcFilter:a,autoLoad:b,autoSave:!1,listeners:{beforewrite:function(a,b,c,d){this.fireEvent("beforesave",this,a,d.params)},write:function(a,b,d,e,f){this.redrawMatchingLayers(c)},load:function(a,b,c){this.fireEvent("query",this,a,this.filter)},scope:this}},i))}this.fireEvent("layerchange",this,c,d)},this):(this.clearFeatureStore(),this.fireEvent("layerchange",this,c,!1))},redrawMatchingLayers:function(a){var b=a.get("name"),c=a.get("source");this.target.mapPanel.layers.each(function(a){a.get("source")===c&&a.get("name")===b&&a.getLayer().redraw(!0)})},clearFeatureStore:function(){this.featureStore&&(this.featureStore.removeAll(),this.featureStore.unbind(),this.featureStore.destroy(),this.numberOfFeatures=null,this.featureStore=null,this.geometryType=null)},processPage:function(a,b,c,d){b=b||{};var e=b.lonLat?null:b.index,f=b.next,g=this.pages,h=this.pages.indexOf(a);this.setPageFilter(a);var i=!f||h==(g.indexOf(f)||g.length)-1,j=!b.lonLat||a.extent.containsLonLat(b.lonLat);j&&a.numFeatures&&a.numFeatures<=this.maxFeatures?c.call(this,a):j&&(h==e||i)&&this.hitCountProtocol.read({callback:function(h){var i=e,j=b.lonLat;f&&(i=(g.indexOf(f)||g.length)-1),!i&&j&&a.extent.containsLonLat(j)&&(i=g.indexOf(a)),a.numFeatures=h.numberOfFeatures,this.page||(a.numFeatures>this.maxFeatures?this.createLeaf(a,Ext.applyIf({index:i,next:f},b),c,d):0==a.numFeatures&&g.length>1?(g.remove(a),b.allowEmpty===!1&&this.setPage({index:e%this.pages.length,allowEmpty:!1})):this.pages.indexOf(a)==i&&c.call(this,a))},scope:this})},createLeaf:function(a,b,c,d){b=b||{};var f=(this.layerRecord.getLayer(),this.pages.indexOf(a));this.pages.remove(a);var m,n,g=a.extent,h=g.getCenterLonLat(),i=[g.left,h.lon,g.left,h.lon],j=[h.lat,h.lat,g.bottom,g.bottom],k=[h.lon,g.right,h.lon,g.right],l=[g.top,g.top,h.lat,h.lat];for(m=3;m>=0;--m)n={extent:new OpenLayers.Bounds(i[m],j[m],k[m],l[m])},this.pages.splice(f,0,n),this.processPage(n,b,c,d)},getPagingExtent:function(a){var b=this.layerRecord.getLayer(),c=this.getSpatialFilter(),d=c?c.value:this.target.mapPanel.map[a]();return d&&b.maxExtent&&d.containsBounds(b.maxExtent)&&(d=b.maxExtent),d},getSpatialFilter:function(){var a;if(this.filter instanceof OpenLayers.Filter.Spatial&&this.filter.type===OpenLayers.Filter.Spatial.BBOX)a=this.filter;else if(this.filter instanceof OpenLayers.Filter.Logical&&this.filter.type===OpenLayers.Filter.Logical.AND)for(var b,c=this.filter.filters.length-1;c>=0;--c)if(b=this.filter.filters[c],b instanceof OpenLayers.Filter.Spatial&&b.type===OpenLayers.Filter.Spatial.BBOX){a=b;break}return a},setPageFilter:function(a){var b;if(a.extent){var c=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:this.featureStore.geometryName,value:a.extent});b=this.filter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.filter,c]}):c}else b=this.filter;return this.featureStore.setOgcFilter(b),this.hitCountProtocol.filter=b,this.hitCountProtocol.options.filter=b,b},nextPage:function(a,b){var c;if(this.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING){var d=this.page;this.page=null,c=(this.pages.indexOf(d)+1)%this.pages.length}else c=this.pageIndex+1%this.numPages;this.setPage({index:c,allowEmpty:!1},a,b)},previousPage:function(a,b){var c;this.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING?(c=this.pages.indexOf(this.page)-1,c<0&&(c=this.pages.length-1)):(c=this.pageIndex-1,c<0&&(c=this.numPages-1)),this.setPage({index:c,allowEmpty:!1,next:this.page},a)},setPage:function(a,b,c){if(this.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING){if(this.filter instanceof OpenLayers.Filter.FeatureId)return void this.featureStore.load({callback:function(){b&&b.call(c)}});if(this.fireEvent("beforesetpage",this,a,b,c)!==!1){if(!a){var d=this.getPagingExtent("getExtent"),e=new OpenLayers.LonLat(d.left,d.top),f=this.target.mapPanel.map.getMaxExtent();f.containsLonLat(e,!0)||(e=new OpenLayers.LonLat(f.left,f.top)),a={lonLat:e,allowEmpty:!1}}if(a.index=a.index||0,"last"==a.index&&(a.index=this.pages.length-1,a.next=this.pages[0]),this.page=null,this.pages){if(a.lonLat)for(var i=this.pages.length-1;i>=0;--i)if(this.pages[i].extent.containsLonLat(a.lonLat)){a.index=i;break}}else{var h=(this.layerRecord.getLayer(),this.getPagingExtent("getMaxExtent"));this.pages=[{extent:h}],a.index=0}this.processPage(this.pages[a.index],a,function(d){var e=this.target.mapPanel.map;this.page=d,this.setPageFilter(d),this.autoZoomPage&&!e.getExtent().containsLonLat(d.extent.getCenterLonLat())&&e.zoomToExtent(d.extent);var f=this.pages.indexOf(this.page);this.fireEvent("setpage",this,a,b,c,f,this.pages.length),this.featureStore.load({callback:function(){b&&b.call(c,d)}})},this)}}else if(this.fireEvent("beforesetpage",this,a,b,c)!==!1)if(a){if(null!=a.index){"last"===a.index?this.pageIndex=this.numPages-1:"first"===a.index?this.pageIndex=0:this.pageIndex=a.index;var j=this.pageIndex*this.maxFeatures;this.fireEvent("setpage",this,a,b,c,this.pageIndex,this.numPages),this.featureStore.load({startIndex:j,callback:function(){b&&b.call(c)}})}}else this.hitCountProtocol.read({filter:this.filter,callback:function(d){this.numberOfFeatures=d.numberOfFeatures,this.numPages=Math.ceil(this.numberOfFeatures/this.maxFeatures),this.pageIndex=0,this.fireEvent("setpage",this,a,b,c,this.pageIndex,this.numPages),this.featureStore.load({output:"object",callback:function(){b&&b.call(c)}})},scope:this})}}),gxp.plugins.FeatureManager.QUADTREE_PAGING=0,gxp.plugins.FeatureManager.WFS_PAGING=1,Ext.preg(gxp.plugins.FeatureManager.prototype.ptype,gxp.plugins.FeatureManager),OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{in:"click",out:"clickout"},mousemove:{in:"over",out:"out"},dblclick:{in:"dblclick",out:null},mousedown:{in:null,out:null},mouseup:{in:null,out:null},touchstart:{in:"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(a,b,c,d){OpenLayers.Handler.prototype.initialize.apply(this,[a,c,d]),this.layer=b},touchstart:function(a){return this.startTouch(),!!OpenLayers.Event.isMultiTouch(a)||this.mousedown(a)},touchmove:function(a){OpenLayers.Event.preventDefault(a)},mousedown:function(a){return(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))&&(this.down=a.xy),!this.handle(a)||!this.stopDown},mouseup:function(a){return this.up=a.xy,!this.handle(a)||!this.stopUp},click:function(a){return!this.handle(a)||!this.stopClick},mousemove:function(a){return!this.callbacks.over&&!this.callbacks.out||(this.handle(a),!0)},dblclick:function(a){return!this.handle(a)},geometryTypeMatches:function(a){return null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)>-1},handle:function(a){this.feature&&!this.feature.layer&&(this.feature=null);var b=a.type,c=!1,d=!!this.feature,e="click"==b||"dblclick"==b||"touchstart"==b;if(this.feature=this.layer.getFeatureFromEvent(a),this.feature&&!this.feature.layer&&(this.feature=null),this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null),this.feature){"touchstart"===b&&OpenLayers.Event.preventDefault(a);var f=this.feature!=this.lastFeature;this.geometryTypeMatches(this.feature)?(d&&f?(this.lastFeature&&this.triggerCallback(b,"out",[this.lastFeature]),this.triggerCallback(b,"in",[this.feature])):d&&!e||this.triggerCallback(b,"in",[this.feature]),this.lastFeature=this.feature,c=!0):(this.lastFeature&&(d&&f||e)&&this.triggerCallback(b,"out",[this.lastFeature]),this.feature=null)}else this.lastFeature&&(d||e)&&this.triggerCallback(b,"out",[this.lastFeature]);return c},triggerCallback:function(a,b,c){var d=this.EVENTMAP[a][b];if(d)if("click"==a&&this.up&&this.down){var e=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));e<=this.clickTolerance&&this.callback(d,c),this.up=this.down=null}else this.callback(d,c)},activate:function(){var a=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.feature=null,this.lastFeature=null,this.down=null,this.up=null,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),a=!0),a},handleMapEvents:function(a){"removelayer"!=a.type&&"order"!=a.property||this.moveLayerToTop()},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;a>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(a):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"}),OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(a){for(var c,b=this.layers,d=0;d<b.length;d++)if(c=b[d].getFeatureFromEvent(a))return c},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),this.collectRoots(),a.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(a){a.events.unregister("changelayer",this,this.handleChangeLayer),this.resetRoots(),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var a,b=0;b<this.map.layers.length;++b)a=this.map.layers[b],OpenLayers.Util.indexOf(this.layers,a)!=-1&&a.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var a,b=0;b<this.layers.length;++b)a=this.layers[b],this.renderer&&a.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(a.renderer)},handleChangeLayer:function(a){var b=a.layer;"order"==a.property&&OpenLayers.Util.indexOf(this.layers,b)!=-1&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"}),OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),null===this.scope&&(this.scope=this),this.initLayer(a);var c={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(c.over=this.overFeature,c.out=this.outFeature),this.callbacks=OpenLayers.Util.extend(c,this.callbacks),this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(a){OpenLayers.Util.isArray(a)?(this.layers=a,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:a})):this.layer=a},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(a){var c,d,e,f,b=this.layers||[this.layer];for(e=0;e<b.length;++e)if(c=b[e],f=0,null!=c.selectedFeatures)for(;c.selectedFeatures.length>f;)d=c.selectedFeatures[f],a&&a.except==d?++f:this.unselect(d)},clickFeature:function(a){if(!this.hover){var b=OpenLayers.Util.indexOf(a.layer.selectedFeatures,a)>-1;b?this.toggleSelect()?this.unselect(a):this.multipleSelect()||this.unselectAll({except:a}):(this.multipleSelect()||this.unselectAll({except:a}),this.select(a))}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(a){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(a){var b=a.layer;this.hover&&(this.highlightOnly?this.highlight(a):OpenLayers.Util.indexOf(b.selectedFeatures,a)==-1&&this.select(a))},outFeature:function(a){if(this.hover)if(this.highlightOnly){
if(a._lastHighlighter==this.id)if(a._prevHighlighter&&a._prevHighlighter!=this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);b&&b.highlight(a)}else this.unhighlight(a)}else this.unselect(a)},highlight:function(a){var b=a.layer,c=this.events.triggerEvent("beforefeaturehighlighted",{feature:a});if(c!==!1){a._prevHighlighter=a._lastHighlighter,a._lastHighlighter=this.id;var d=this.selectStyle||this.renderIntent;b.drawFeature(a,d),this.events.triggerEvent("featurehighlighted",{feature:a})}},unhighlight:function(a){var b=a.layer;void 0==a._prevHighlighter?delete a._lastHighlighter:a._prevHighlighter==this.id?delete a._prevHighlighter:(a._lastHighlighter=a._prevHighlighter,delete a._prevHighlighter),b.drawFeature(a,a.style||a.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:a})},select:function(a){var b=this.onBeforeSelect.call(this.scope,a),c=a.layer;b!==!1&&(b=c.events.triggerEvent("beforefeatureselected",{feature:a}),b!==!1&&(c.selectedFeatures.push(a),this.highlight(a),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=c.selectedFeatures[0]),c.events.triggerEvent("featureselected",{feature:a}),this.onSelect.call(this.scope,a)))},unselect:function(a){var b=a.layer;this.unhighlight(a),OpenLayers.Util.removeItem(b.selectedFeatures,a),b.events.triggerEvent("featureunselected",{feature:a}),this.onUnselect.call(this.scope,a)},selectBox:function(a){if(a instanceof OpenLayers.Bounds){var b=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),c=this.map.getLonLatFromPixel({x:a.right,y:a.top}),d=new OpenLayers.Bounds(b.lon,b.lat,c.lon,c.lat);this.multipleSelect()||this.unselectAll();var e=this.multiple;this.multiple=!0;var f=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:f});for(var g,h=0;h<f.length;++h){g=f[h];for(var i=0,j=g.features.length;i<j;++i){var k=g.features[i];k.getVisibility()&&(null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,k.geometry.CLASS_NAME)>-1)&&d.toGeometry().intersects(k.geometry)&&OpenLayers.Util.indexOf(g.selectedFeatures,k)==-1&&this.select(k)}}this.multiple=e,this.events.triggerEvent("boxselectionend",{layers:f})}},setMap:function(a){this.handlers.feature.setMap(a),this.box&&this.handlers.box.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(a){var b=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(a),this.handlers.feature.layer=this.layer,b&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"}),OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(a){var b;"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var c=a.documentElement;if(c){var e=this["read_"+c.nodeName];b=e?e.call(this,c):new OpenLayers.Format.GML(this.options?this.options:{}).read(a)}else b=a;return b},read_msGMLOutput:function(a){var b=[],c=this.getSiblingNodesByTagCriteria(a,this.layerIdentifier);if(c)for(var d=0,e=c.length;d<e;++d){var f=c[d],g=f.nodeName;f.prefix&&(g=g.split(":")[1]);var g=g.replace(this.layerIdentifier,""),h=this.getSiblingNodesByTagCriteria(f,this.featureIdentifier);if(h)for(var i=0;i<h.length;i++){var j=h[i],k=this.parseGeometry(j),l=this.parseAttributes(j),m=new OpenLayers.Feature.Vector(k.geometry,l,null);m.bounds=k.bounds,m.type=g,b.push(m)}}return b},read_FeatureInfoResponse:function(a){for(var b=[],c=this.getElementsByTagNameNS(a,"*","FIELDS"),d=0,e=c.length;d<e;d++){var i,f=c[d],g=null,h={},j=f.attributes.length;if(j>0)for(i=0;i<j;i++){var k=f.attributes[i];h[k.nodeName]=k.nodeValue}else{var l=f.childNodes;for(i=0,j=l.length;i<j;++i){var m=l[i];3!=m.nodeType&&(h[m.getAttribute("name")]=m.getAttribute("value"))}}b.push(new OpenLayers.Feature.Vector(g,h,null))}return b},getSiblingNodesByTagCriteria:function(a,b){var d,e,f,g,h,c=[];if(a&&a.hasChildNodes()){d=a.childNodes,f=d.length;for(var i=0;i<f;i++){for(h=d[i];h&&1!=h.nodeType;)h=h.nextSibling,i++;e=h?h.nodeName:"",e.length>0&&e.indexOf(b)>-1?c.push(h):(g=this.getSiblingNodesByTagCriteria(h,b),g.length>0&&(0==c.length?c=g:c.push(g)))}}return c},parseAttributes:function(a){var b={};if(1==a.nodeType)for(var c=a.childNodes,d=c.length,e=0;e<d;++e){var f=c[e];if(1==f.nodeType){var g=f.childNodes,h=f.prefix?f.nodeName.split(":")[1]:f.nodeName;if(0==g.length)b[h]=null;else if(1==g.length){var i=g[0];if(3==i.nodeType||4==i.nodeType){var j=i.nodeValue.replace(this.regExes.trimSpace,"");b[h]=j}}}}return b},parseGeometry:function(a){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var c,b=this.gmlFormat.parseFeature(a),d=null;return b&&(c=b.geometry&&b.geometry.clone(),d=b.bounds&&b.bounds.clone(),b.destroy()),{geometry:c,bounds:d}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"}),Ext.namespace("gxp.plugins"),gxp.plugins.ClickableFeatures=Ext.extend(gxp.plugins.Tool,{featureManager:null,autoLoadFeature:!1,autoLoadedFeature:null,toleranceParameters:["BUFFER","RADIUS"],constructor:function(a){a&&"autoLoadFeatures"in a&&(a.autoLoadFeature=a.autoLoadFeatures,delete a.autoLoadFeatures,window.console&&console.warn("Deprecated config option 'autoLoadFeatures' for ptype: '"+a.ptype+"'. Use 'autoLoadFeature' instead.")),gxp.plugins.ClickableFeatures.superclass.constructor.apply(this,[a])},noFeatureClick:function(a){this.selectControl||(this.selectControl=new OpenLayers.Control.SelectFeature(this.target.tools[this.featureManager].featureLayer,this.initialConfig.controlOptions));var b=this.target.mapPanel.map.getLonLatFromPixel(a.xy),c=this.target.tools[this.featureManager],d=c.page;if(!("all"==c.visible()&&c.paging&&d&&d.extent.containsLonLat(b))){var e=c.layerRecord&&c.layerRecord.getLayer();if(e){var f=this.target.mapPanel.map,g=f.getSize(),h=Ext.applyIf({REQUEST:"GetFeatureInfo",BBOX:f.getExtent().toBBOX(),WIDTH:g.w,HEIGHT:g.h,X:parseInt(a.xy.x),Y:parseInt(a.xy.y),QUERY_LAYERS:e.params.LAYERS,INFO_FORMAT:"application/vnd.ogc.gml",EXCEPTIONS:"application/vnd.ogc.se_xml",FEATURE_COUNT:1},e.params);if("number"==typeof this.tolerance)for(var i=0,j=this.toleranceParameters.length;i<j;++i)h[this.toleranceParameters[i]]=this.tolerance;var k=f.getProjectionObject(),l=e.projection;l&&l.equals(k)&&(k=l),parseFloat(e.params.VERSION)>=1.3?h.CRS=k.getCode():h.SRS=k.getCode();new GeoExt.data.FeatureStore({fields:{},proxy:new GeoExt.data.ProtocolProxy({protocol:new OpenLayers.Protocol.HTTP({url:"string"==typeof e.url?e.url:e.url[0],params:h,format:new OpenLayers.Format.WMSGetFeatureInfo})}),autoLoad:!0,listeners:{load:function(b,d){if(d.length>0){var e=d[0].get("fid"),f=new OpenLayers.Filter.FeatureId({fids:[e]}),g=function(){c.loadFeatures(f,function(a){a.length&&(this.autoLoadedFeature=a[0],this.select(a[0]))},this)}.createDelegate(this),h=c.featureLayer.getFeatureByFid(e);if(h)this.select(h);else if(c.paging&&c.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING){var i=this.target.mapPanel.map.getLonLatFromPixel(a.xy);c.setPage({lonLat:i},function(){var a=c.featureLayer.getFeatureByFid(e);a?this.select(a):this.autoLoadFeature===!0&&g()},this)}else g()}},scope:this}})}}},select:function(a){this.selectControl.unselectAll(),this.selectControl.select(a)}}),Ext.namespace("gxp.plugins"),gxp.plugins.SchemaAnnotations={getAnnotationsFromSchema:function(a){var b=null,c=a.get("annotation");if(void 0!==c){b={};var e,f,d=GeoExt.Lang.locale.split("-").shift();for(e=0,f=c.appinfo.length;e<f;++e){var g=Ext.decode(c.appinfo[e]);if(g.title&&g.title[d]){b.label=g.title[d];break}}for(e=0,f=c.documentation.length;e<f;++e)if(c.documentation[e].lang===d){b.helpText=c.documentation[e].textContent;break}}return b}},Ext.namespace("gxp.plugins"),gxp.plugins.FeatureEditorGrid=Ext.extend(Ext.grid.PropertyGrid,{ptype:"gxp_editorgrid",xtype:"gxp_editorgrid",feature:null,schema:null,fields:null,excludeFields:null,propertyNames:null,readOnly:null,border:!1,initComponent:function(){this.dateFormat||(this.dateFormat=Ext.form.DateField.prototype.format),this.timeFormat||(this.timeFormat=Ext.form.TimeField.prototype.format),this.customRenderers=this.customRenderers||{},this.customEditors=this.customEditors||{};var b,a=this.feature;if(this.fields){b={};for(var c=0,d=this.fields.length;c<d;++c)b[this.fields[c]]=a.attributes[this.fields[c]]}else b=a.attributes;if(this.excludeFields||(this.excludeFields=[]),this.schema){var e=this.fields?this.fields.join(",").toUpperCase().split(","):[];this.schema.each(function(c){var d=c.get("type");if(!d.match(/^[^:]*:?((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry))/)){var f=c.get("name");this.fields&&e.indexOf(f.toUpperCase())==-1&&this.excludeFields.push(f);var g=a.attributes[f],h=GeoExt.form.recordToField(c),i=this.getAnnotationsFromSchema(c);i&&i.label&&(this.propertyNames=this.propertyNames||{},this.propertyNames[f]=i.label);var j;if("string"==typeof g){var k;switch(d.split(":").pop()){case"date":k=this.dateFormat,h.editable=!1;break;case"dateTime":k||(k=this.dateFormat+" "+this.timeFormat,h.editable=!0),h.format=k,j={startedit:function(a,b){if(!(b instanceof Date)){var c=Date.parseDate(b.replace(/Z$/,""),"c");c&&this.setValue(c)}}},this.customRenderers[f]=function(){return function(a){var b=a;return"string"==typeof a&&(b=Date.parseDate(a.replace(/Z$/,""),"c")),b?b.format(k):a}}();break;case"boolean":j={startedit:function(a,b){this.setValue(Boolean(b))}}}}this.customEditors[f]=new Ext.grid.GridEditor({field:Ext.create(h),listeners:j}),b[f]=g}},this),a.attributes=b}this.source=b;var f=this.excludeFields.length?this.excludeFields.join(",").toUpperCase().split(","):[];this.viewConfig={forceFit:!0,getRowClass:function(a){if(f.indexOf(a.get("name").toUpperCase())!==-1)return"x-hide-nosize"}},this.listeners={beforeedit:function(){return this.featureEditor&&this.featureEditor.editing},propertychange:function(){this.featureEditor&&this.featureEditor.setFeatureState(this.featureEditor.getDirtyState())},scope:this};var g=Ext.data.Store.prototype.sort;Ext.data.Store.prototype.sort=function(){},gxp.plugins.FeatureEditorGrid.superclass.initComponent.apply(this,arguments),Ext.data.Store.prototype.sort=g,this.propStore.isEditableValue=function(){return!0}},init:function(a){this.featureEditor=a,this.featureEditor.on("canceledit",this.onCancelEdit,this),this.featureEditor.add(this),this.featureEditor.doLayout()},destroy:function(){this.featureEditor&&(this.featureEditor.un("canceledit",this.onCancelEdit,this),this.featureEditor=null),gxp.plugins.FeatureEditorGrid.superclass.destroy.call(this)},onCancelEdit:function(a,b){b&&this.setSource(b.attributes)}}),Ext.override(gxp.plugins.FeatureEditorGrid,gxp.plugins.SchemaAnnotations),Ext.preg(gxp.plugins.FeatureEditorGrid.prototype.ptype,gxp.plugins.FeatureEditorGrid),Ext.reg(gxp.plugins.FeatureEditorGrid.prototype.xtype,gxp.plugins.FeatureEditorGrid),OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate(),this.eventListener=null,OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var a=0,b=this.KEY_EVENTS.length;a<b;a++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[a],this.eventListener);return!0}return!1},deactivate:function(){var a=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var b=0,c=this.KEY_EVENTS.length;b<c;b++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[b],this.eventListener);a=!0}return a},handleKeyEvent:function(a){this.checkModifiers(a)&&this.callback(a.type,[a])},CLASS_NAME:"OpenLayers.Handler.Keyboard"}),OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{documentDrag:!1,geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertex:null,vertices:null,virtualVertices:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(a,b){b=b||{},this.layer=a,this.vertices=[],this.virtualVertices=[],this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,b.vertexRenderIntent)),this.virtualStyle.fillOpacity=.3,this.virtualStyle.strokeOpacity=.3,this.deleteCodes=[46,68],this.mode=OpenLayers.Control.ModifyFeature.RESHAPE,OpenLayers.Control.prototype.initialize.apply(this,[b]),OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var c={down:function(a){this.vertex=null;var b=this.layer.getFeatureFromEvent(this.handlers.drag.evt);b?this.dragStart(b):this.clickout&&(this._unselect=this.feature)},move:function(a){delete this._unselect,this.vertex&&this.dragVertex(this.vertex,a)},up:function(){this.handlers.drag.stopDown=!1,this._unselect&&(this.unselectFeature(this._unselect),delete this._unselect)},done:function(a){this.vertex&&this.dragComplete(this.vertex)}},d={documentDrag:this.documentDrag,stopDown:!1},e={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,e),drag:new OpenLayers.Handler.Drag(this,c,d)}},destroy:function(){this.map&&this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.handlers.keyboard.activate()&&this.handlers.drag.activate())},deactivate:function(){var a=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.moveLayerBack(),this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.handlers.drag.deactivate(),this.handlers.keyboard.deactivate();var b=this.feature;b&&b.geometry&&b.layer&&this.unselectFeature(b),a=!0}return a},beforeSelectFeature:function(a){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:a})},selectFeature:function(a){if(!(this.feature===a||this.geometryTypes&&OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)==-1)){this.beforeSelectFeature(a)!==!1&&(this.feature&&this.unselectFeature(this.feature),this.feature=a,this.layer.selectedFeatures.push(a),this.layer.drawFeature(a,"select"),this.modified=!1,this.resetVertices(),this.onModificationStart(this.feature));var b=a.modified;!a.geometry||b&&b.geometry||(this._originalGeometry=a.geometry.clone())}},unselectFeature:function(a){this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[],this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle),this.layer.drawFeature(this.feature,"default"),this.feature=null,OpenLayers.Util.removeItem(this.layer.selectedFeatures,a),this.onModificationEnd(a),this.layer.events.triggerEvent("afterfeaturemodified",{feature:a,modified:this.modified}),this.modified=!1},dragStart:function(a){var b="OpenLayers.Geometry.Point"==a.geometry.CLASS_NAME;this.standalone||(a._sketch||!b)&&a._sketch||(this.toggle&&this.feature===a&&(this._unselect=a),this.selectFeature(a)),(a._sketch||b)&&(this.vertex=a,this.handlers.drag.stopDown=!0)},dragVertex:function(a,b){var c=this.map.getLonLatFromViewPortPx(b),d=a.geometry;d.move(c.lon-d.x,c.lat-d.y),this.modified=!0,"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?this.layer.events.triggerEvent("vertexmodified",{vertex:a.geometry,feature:this.feature,pixel:b}):(a._index?(a.geometry.parent.addComponent(a.geometry,a._index),delete a._index,OpenLayers.Util.removeItem(this.virtualVertices,a),this.vertices.push(a)):a==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):a!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:a.geometry,feature:this.feature,pixel:b}),this.virtualVertices.length>0&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:"select")),this.layer.drawFeature(a)},dragComplete:function(a){this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var a=this.feature;a.modified=OpenLayers.Util.extend(a.modified,{geometry:this._originalGeometry}),delete this._originalGeometry}},resetVertices:function(){this.vertices.length>0&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]),this.virtualVertices.length>0&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null),this.feature&&"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(a){var b=a.keyCode;if(this.feature&&OpenLayers.Util.indexOf(this.deleteCodes,b)!=-1){var c=this.layer.getFeatureFromEvent(this.handlers.drag.evt);c&&OpenLayers.Util.indexOf(this.vertices,c)!=-1&&!this.handlers.drag.dragging&&c.geometry.parent&&(c.geometry.parent.removeComponent(c.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:c.geometry,feature:this.feature,pixel:a.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:"select"),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature}))}},collectVertices:function(){function b(c){var d,e,f,g;if("OpenLayers.Geometry.Point"==c.CLASS_NAME)e=new OpenLayers.Feature.Vector(c),e._sketch=!0,e.renderIntent=a.vertexRenderIntent,a.vertices.push(e);else{var h=c.components.length;for("OpenLayers.Geometry.LinearRing"==c.CLASS_NAME&&(h-=1),d=0;d<h;++d)f=c.components[d],"OpenLayers.Geometry.Point"==f.CLASS_NAME?(e=new OpenLayers.Feature.Vector(f),e._sketch=!0,e.renderIntent=a.vertexRenderIntent,a.vertices.push(e)):b(f);if(a.createVertices&&"OpenLayers.Geometry.MultiPoint"!=c.CLASS_NAME)for(d=0,g=c.components.length;d<g-1;++d){var i=c.components[d],j=c.components[d+1];if("OpenLayers.Geometry.Point"==i.CLASS_NAME&&"OpenLayers.Geometry.Point"==j.CLASS_NAME){var k=(i.x+j.x)/2,l=(i.y+j.y)/2,m=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(k,l),null,a.virtualStyle);m.geometry.parent=c,m._index=d+1,m._sketch=!0,a.virtualVertices.push(m)}}}}this.vertices=[],this.virtualVertices=[];var a=this;b.call(this,this.feature.geometry),this.layer.addFeatures(this.virtualVertices,{silent:!0}),this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var a=this.feature.geometry,b=a.getBounds().getCenterLonLat(),c=new OpenLayers.Geometry.Point(b.lon,b.lat),d=new OpenLayers.Feature.Vector(c);c.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,b,c),a.move(b,c)},d._sketch=!0,this.dragHandle=d,this.dragHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var a=this.feature.geometry,b=a.getBounds(),c=b.getCenterLonLat(),d=new OpenLayers.Geometry.Point(c.lon,c.lat),e=new OpenLayers.Geometry.Point(b.right,b.bottom),f=new OpenLayers.Feature.Vector(e),g=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,h=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,i=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;e.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,b,c);var e=this.x-d.x,f=this.y-d.y,j=e-b,k=f-c;if(i){var l=Math.atan2(k,j),m=Math.atan2(f,e),n=m-l;n*=180/Math.PI,a.rotate(n,d)}if(g){var o,p;if(h)o=f/k,p=e/j/o;else{var q=Math.sqrt(j*j+k*k),r=Math.sqrt(e*e+f*f);o=r/q}a.resize(o,d,p)}},f._sketch=!0,this.radiusHandle=f,this.radiusHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(a){this.handlers.drag.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},handleMapEvents:function(a){"removelayer"!=a.type&&"order"!=a.property||this.moveLayerToTop()},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;a>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(a):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Control.ModifyFeature"}),OpenLayers.Control.ModifyFeature.RESHAPE=1,OpenLayers.Control.ModifyFeature.RESIZE=2,OpenLayers.Control.ModifyFeature.ROTATE=4,OpenLayers.Control.ModifyFeature.DRAG=8,Ext.namespace("gxp"),gxp.FeatureEditPopup=Ext.extend(GeoExt.Popup,{closeMsgTitle:"Save Changes?",closeMsg:"This feature has unsaved changes. Would you like to save your changes?",deleteMsgTitle:"Delete Feature?",deleteMsg:"Are you sure you want to delete this feature?",editButtonText:"Edit",editButtonTooltip:"Make this feature editable",deleteButtonText:"Delete",deleteButtonTooltip:"Delete this feature",cancelButtonText:"Cancel",cancelButtonTooltip:"Stop editing, discard changes",saveButtonText:"Save",saveButtonTooltip:"Save changes",layout:"fit",feature:null,schema:null,readOnly:!1,allowDelete:!1,editing:!1,editorPluginConfig:{ptype:"gxp_editorgrid"},modifyControl:null,geometry:null,attributes:null,cancelButton:null,saveButton:null,editButton:null,deleteButton:null,initComponent:function(){this.addEvents("startedit","stopedit","beforefeaturemodified","featuremodified","canceledit","cancelclose");var a=this.feature;a instanceof GeoExt.data.FeatureRecord&&(a=this.feature=a.getFeature()),this.location||(this.location=a),this.anchored=!this.editing,!this.title&&a.fid&&(this.title=a.fid),this.editButton=new Ext.Button({text:this.editButtonText,tooltip:this.editButtonTooltip,iconCls:"edit",handler:this.startEditing,scope:this}),this.deleteButton=new Ext.Button({text:this.deleteButtonText,tooltip:this.deleteButtonTooltip,iconCls:"delete",hidden:!this.allowDelete,handler:this.deleteFeature,scope:this}),this.cancelButton=new Ext.Button({text:this.cancelButtonText,tooltip:this.cancelButtonTooltip,iconCls:"cancel",hidden:!0,handler:function(){this.stopEditing(!1)},scope:this}),this.saveButton=new Ext.Button({text:this.saveButtonText,tooltip:this.saveButtonTooltip,iconCls:"save",hidden:!0,handler:function(){this.stopEditing(!0)},scope:this}),this.plugins=[Ext.apply({feature:a,schema:this.schema,fields:this.fields,excludeFields:this.excludeFields,propertyNames:this.propertyNames,readOnly:this.readOnly},this.editorPluginConfig)],this.bbar=new Ext.Toolbar({hidden:this.readOnly,items:[this.editButton,this.deleteButton,this.saveButton,this.cancelButton]}),gxp.FeatureEditPopup.superclass.initComponent.call(this),this.on({show:function(){this.editing&&(this.editing=null,this.startEditing())},beforeclose:function(){if(this.editing)return this.feature.state===this.getDirtyState()?(Ext.Msg.show({title:this.closeMsgTitle,msg:this.closeMsg,buttons:Ext.Msg.YESNOCANCEL,fn:function(a){a&&"cancel"!==a?(this.stopEditing("yes"===a),this.close()):this.fireEvent("cancelclose",this)},scope:this,icon:Ext.MessageBox.QUESTION,animEl:this.getEl()}),!1):void this.stopEditing(!1)},scope:this})},getDirtyState:function(){return this.feature.state===OpenLayers.State.INSERT?this.feature.state:OpenLayers.State.UPDATE},startEditing:function(){this.editing||(this.fireEvent("startedit",this),this.editing=!0,this.anc&&this.unanchorPopup(),this.editButton.hide(),this.deleteButton.hide(),this.saveButton.show(),this.cancelButton.show(),this.geometry=this.feature.geometry&&this.feature.geometry.clone(),this.attributes=Ext.apply({},this.feature.attributes),this.modifyControl=new OpenLayers.Control.ModifyFeature(this.feature.layer,{standalone:!0,vertexRenderIntent:this.vertexRenderIntent}),this.feature.layer.map.addControl(this.modifyControl),this.modifyControl.activate(),this.feature.geometry&&this.modifyControl.selectFeature(this.feature))},stopEditing:function(a){if(this.editing){this.fireEvent("stopedit",this),this.modifyControl.deactivate(),this.modifyControl.destroy();var b=this.feature;if(b.state===this.getDirtyState())if(a===!0){if(this.fireEvent("beforefeaturemodified",this,b),this.schema){var c,d;for(var e in b.attributes)if(d=this.schema.getAt(this.schema.findExact("name",e)),c=b.attributes[e],c instanceof Date){var f=d.get("type").split(":").pop();b.attributes[e]=c.format("date"==f?"Y-m-d":"c")}}this.fireEvent("featuremodified",this,b)}else if(b.state===OpenLayers.State.INSERT)this.editing=!1,b.layer&&b.layer.destroyFeatures([b]),this.fireEvent("canceledit",this,null),this.close();else{var g=b.layer;g.drawFeature(b,{display:"none"}),b.geometry=this.geometry,b.attributes=this.attributes,this.setFeatureState(null),g.drawFeature(b),this.fireEvent("canceledit",this,b)}this.isDestroyed||(this.cancelButton.hide(),this.saveButton.hide(),this.editButton.show(),this.allowDelete&&this.deleteButton.show()),this.editing=!1}},deleteFeature:function(){Ext.Msg.show({title:this.deleteMsgTitle,msg:this.deleteMsg,buttons:Ext.Msg.YESNO,fn:function(a){"yes"===a&&(this.setFeatureState(OpenLayers.State.DELETE),this.fireEvent("featuremodified",this,this.feature),this.close())},scope:this,icon:Ext.MessageBox.QUESTION,animEl:this.getEl()})},setFeatureState:function(a){this.feature.state=a;var b=this.feature.layer;b&&b.events.triggerEvent("featuremodified",{feature:this.feature})}}),Ext.reg("gxp_featureeditpopup",gxp.FeatureEditPopup),OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},initialize:function(a,b,c){OpenLayers.Control.prototype.initialize.apply(this,[c]),this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(a,b){this.layer.events.triggerEvent("sketchmodified",{vertex:a,feature:b})},create:function(a,b){this.layer.events.triggerEvent("sketchstarted",{vertex:a,feature:b})}},this.callbacks),this.layer=a,this.handlerOptions=this.handlerOptions||{},this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:a.renderers,rendererOptions:a.rendererOptions}),"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi);var d=this.layer.styleMap&&this.layer.styleMap.styles.temporary;d&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({default:d})})),this.handler=new b(this,this.callbacks,this.handlerOptions)},drawFeature:function(a){var b=new OpenLayers.Feature.Vector(a),c=this.layer.events.triggerEvent("sketchcomplete",{feature:b});c!==!1&&(b.state=OpenLayers.State.INSERT,this.layer.addFeatures([b]),this.featureAdded(b),this.events.triggerEvent("featureadded",{feature:b}))},insertXY:function(a,b){this.handler&&this.handler.line&&this.handler.insertXY(a,b)},insertDeltaXY:function(a,b){this.handler&&this.handler.line&&this.handler.insertDeltaXY(a,b)},insertDirectionLength:function(a,b){this.handler&&this.handler.line&&this.handler.insertDirectionLength(a,b)},insertDeflectionLength:function(a,b){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(a,b)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"}),OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(a,b,c){c&&c.layerOptions&&c.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style.default,{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var a=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a),this.map.addLayer(this.layer),!0},createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a),c=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(c),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return!!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.cancel(),null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,!0)},destroyFeature:function(a){!this.layer||!a&&this.persist||this.layer.destroyFeatures(),this.point=null},destroyPersistedFeature:function(){var a=this.layer;a&&a.features.length>1&&this.layer.features[0].destroy()},finalize:function(a){var b=a?"cancel":"done";this.mouseDown=!1,this.lastDown=null,this.lastUp=null,this.lastTouchPx=null,this.callback(b,[this.geometryClone()]),this.destroyFeature(a)},cancel:function(){this.finalize(!0)},click:function(a){return OpenLayers.Event.stop(a),!1},dblclick:function(a){return OpenLayers.Event.stop(a),!1},modifyFeature:function(a){this.point||this.createFeature(a);var b=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=b.lon,this.point.geometry.y=b.lat,this.callback("modify",[this.point.geometry,this.point,!1]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var a=this.point&&this.point.geometry;return a&&this.multi&&(a=new OpenLayers.Geometry.MultiPoint([a])),a},geometryClone:function(){var a=this.getGeometry();return a&&a.clone()},mousedown:function(a){return this.down(a)},touchstart:function(a){return this.startTouch(),this.lastTouchPx=a.xy,this.down(a)},mousemove:function(a){return this.move(a)},touchmove:function(a){return this.lastTouchPx=a.xy,this.move(a)},mouseup:function(a){return this.up(a)},touchend:function(a){return a.xy=this.lastTouchPx,this.up(a)},down:function(a){return this.mouseDown=!0,this.lastDown=a.xy,this.touch||this.modifyFeature(a.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(a){return this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(a.xy),!0},up:function(a){return this.mouseDown=!1,
this.stoppedDown=this.stopDown,!this.checkModifiers(a)||(!(!this.lastUp||!this.lastUp.equals(a.xy))||(!this.lastDown||!this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)||(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.finalize(),!this.stopUp)))},mouseout:function(a){OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(a,b,c){var d=!0;if(null!=c&&a&&b){var e=a.distanceTo(b);e>c&&(d=!1)}return d},CLASS_NAME:"OpenLayers.Handler.Point"}),OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a),c=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(c),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(a){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,a),this.line=null},destroyPersistedFeature:function(){var a=this.layer;a&&a.features.length>2&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(a){this.layer.removeFeatures([this.point]);var b=this.layer.getLonLatFromViewPortPx(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat)),this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length),this.layer.addFeatures([this.point]),this.callback("point",[this.point.geometry,this.getGeometry()]),this.callback("modify",[this.point.geometry,this.getSketch()]),this.drawFeature(),delete this.redoStack},insertXY:function(a,b){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(a,b),this.getCurrentPointIndex()),this.drawFeature(),delete this.redoStack},insertDeltaXY:function(a,b){var c=this.getCurrentPointIndex()-1,d=this.line.geometry.components[c];!d||isNaN(d.x)||isNaN(d.y)||this.insertXY(d.x+a,d.y+b)},insertDirectionLength:function(a,b){a*=Math.PI/180;var c=b*Math.cos(a),d=b*Math.sin(a);this.insertDeltaXY(c,d)},insertDeflectionLength:function(a,b){var c=this.getCurrentPointIndex()-1;if(c>0){var d=this.line.geometry.components[c],e=this.line.geometry.components[c-1],f=Math.atan2(d.y-e.y,d.x-e.x);this.insertDirectionLength(180*f/Math.PI+a,b)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var a=this.line.geometry,b=a.components,c=this.getCurrentPointIndex()-1,d=b[c],e=a.removeComponent(d);if(e){if(this.touch&&c>0){b=a.components;var f=b[c-1],g=this.getCurrentPointIndex(),h=b[g];h.x=f.x,h.y=f.y}this.redoStack||(this.redoStack=[]),this.redoStack.push(d),this.drawFeature()}return e},redo:function(){var a=this.redoStack&&this.redoStack.pop();return a&&(this.line.geometry.addComponent(a,this.getCurrentPointIndex()),this.drawFeature()),!!a},freehandMode:function(a){return this.freehandToggle&&a[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(a,b){this.line||this.createFeature(a);var c=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=c.lon,this.point.geometry.y=c.lat,this.callback("modify",[this.point.geometry,this.getSketch(),b]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var a=this.line&&this.line.geometry;return a&&this.multi&&(a=new OpenLayers.Geometry.MultiLineString([a])),a},touchstart:function(a){return this.timerId&&this.passesTolerance(this.lastTouchPx,a.xy,this.doubleTouchTolerance)?(this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1):(this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300),OpenLayers.Handler.Point.prototype.touchstart.call(this,a))},down:function(a){var b=this.stopDown;return this.freehandMode(a)&&(b=!0,this.touch&&(this.modifyFeature(a.xy,!!this.lastUp),OpenLayers.Event.stop(a))),this.touch||this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)||this.modifyFeature(a.xy,!!this.lastUp),this.mouseDown=!0,this.lastDown=a.xy,this.stoppedDown=b,!b},move:function(a){return this.stoppedDown&&this.freehandMode(a)?(this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(a.xy),!1):(this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(a.xy,!!this.lastUp),!0)},up:function(a){return!this.mouseDown||this.lastUp&&this.lastUp.equals(a.xy)||(this.stoppedDown&&this.freehandMode(a)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(a.xy),this.lastUp=a.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())),this.stoppedDown=this.stopDown,this.mouseDown=!1,!this.stopUp},finishGeometry:function(){var a=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[a]),this.removePoint(),this.finalize()},dblclick:function(a){return this.freehandMode(a)||this.finishGeometry(),!1},CLASS_NAME:"OpenLayers.Handler.Path"}),OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a),c=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(c),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry])),this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(a){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var d,e,b=this.point.geometry,c=this.control.layer.features,f=c.length-1;f>=0;--f)if(d=c[f].geometry,(d instanceof OpenLayers.Geometry.Polygon||d instanceof OpenLayers.Geometry.MultiPolygon)&&d.intersects(b)){e=c[f],this.control.layer.removeFeatures([e],{silent:!0}),this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology),e.geometry.addComponent(this.line.geometry),this.polygon=e,this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(a){var b=a.vertex,c=this.line.geometry.components;if(!this.polygon.geometry.intersects(b)){var d=c[c.length-3];b.x=d.x,b.y=d.y}},finishGeometry:function(){var a=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[a]),this.removePoint(),this.finalize()},finalizeInteriorRing:function(){var a=this.line.geometry,b=0!==a.getArea();if(b){for(var c=this.polygon.geometry.components,d=c.length-2;d>=0;--d)if(a.intersects(c[d])){b=!1;break}if(b){a:for(var d=c.length-2;d>0;--d)for(var f=c[d].components,g=0,h=f.length;g<h;++g)if(a.containsPoint(f[g])){b=!1;break a}}}return b?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(a),this.restoreFeature(),!1},cancel:function(){return this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0)),OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(a){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology),this.layer.removeFeatures([this.polygon],{silent:!0}),this.control.layer.addFeatures([this.polygon],{silent:!0}),this.drawingHole=!1,a||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(a){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,a),this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var a=this.polygon&&this.polygon.geometry;return a&&this.multi&&(a=new OpenLayers.Geometry.MultiPolygon([a])),a},CLASS_NAME:"OpenLayers.Handler.Polygon"}),Ext.namespace("gxp.plugins"),gxp.plugins.FeatureEditor=Ext.extend(gxp.plugins.ClickableFeatures,{ptype:"gxp_featureeditor",commitMessage:!1,splitButton:null,iconClsAdd:"gxp-icon-addfeature",closeOnSave:!1,supportAbstractGeometry:!1,supportNoGeometry:!1,iconClsEdit:"gxp-icon-editfeature",exceptionTitle:"Save Failed",exceptionText:"Trouble saving features",pointText:"Point",lineText:"Line",polygonText:"Polygon",noGeometryText:"Event",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:",createFeatureActionTip:"Create a new feature",createFeatureActionText:"Create",editFeatureActionTip:"Edit existing feature",editFeatureActionText:"Modify",splitButtonText:"Edit",splitButtonTooltip:"Edit features on selected WMS layer",outputTarget:"map",snappingAgent:null,readOnly:!1,modifyOnly:!1,showSelectedOnly:!0,roles:["ROLE_ADMINISTRATOR"],createAction:null,editAction:null,activeIndex:0,drawControl:null,popup:null,schema:null,constructor:function(a){this.addEvents("layereditable","featureeditable"),gxp.plugins.FeatureEditor.superclass.constructor.apply(this,arguments)},init:function(a){gxp.plugins.FeatureEditor.superclass.init.apply(this,arguments),this.target.on("authorizationchange",this.onAuthorizationChange,this)},destroy:function(){this.target.un("authorizationchange",this.onAuthorizationChange,this),gxp.plugins.FeatureEditor.superclass.destroy.apply(this,arguments)},onAuthorizationChange:function(){this.target.isAuthorized(this.roles)||(this.selectControl.deactivate(),this.drawControl.deactivate()),this.enableOrDisable()},addActions:function(){function e(c,e){function g(){d=!0,h.call(this),"setLayer"===e?this.target.selectLayer(f[0]):"clearFeatures"===e?window.setTimeout(function(){c[e].call(c)}):c[e].apply(c,f)}function h(){b.featureStore.un("write",g,this),a.un("canceledit",g,this),a.un("cancelclose",h,this)}var f=Array.prototype.slice.call(arguments);return f.splice(0,2),d||!a||a.isDestroyed?void(d=!1):(a.editing&&(b.featureStore.on("write",g,this),a.on({canceledit:g,cancelclose:h,scope:this}),a.close()),!a.editing)}var a,b=this.getFeatureManager(),c=b.featureLayer,d=!1;b.on({beforequery:e.createDelegate(this,"loadFeatures",1),beforelayerchange:e.createDelegate(this,"setLayer",1),beforesetpage:e.createDelegate(this,"setPage",1),beforeclearfeatures:e.createDelegate(this,"clearFeatures",1),scope:this}),this.drawControl=new OpenLayers.Control.DrawFeature(c,OpenLayers.Handler.Point,{eventListeners:{featureadded:function(a){this.autoLoadFeature===!0&&(this.autoLoadedFeature=a.feature)},activate:function(){this.target.doAuthorized(this.roles,function(){b.showLayer(this.id,this.showSelectedOnly&&"selected")},this)},deactivate:function(){b.hideLayer(this.id)},scope:this}}),this.selectControl=new OpenLayers.Control.SelectFeature(c,{clickout:!1,multipleKey:"fakeKey",eventListeners:{activate:function(){this.target.doAuthorized(this.roles,function(){(this.autoLoadFeature===!0||b.paging)&&this.target.mapPanel.map.events.register("click",this,this.noFeatureClick),b.showLayer(this.id,this.showSelectedOnly&&"selected"),this.selectControl.unselectAll(a&&a.editing&&{except:a.feature})},this)},deactivate:function(){(this.autoLoadFeature===!0||b.paging)&&this.target.mapPanel.map.events.unregister("click",this,this.noFeatureClick),a?(a.editing&&a.on("cancelclose",function(){this.selectControl.activate()},this,{single:!0}),a.on("close",function(){b.hideLayer(this.id)},this,{single:!0}),a.close()):b.hideLayer(this.id)},scope:this}}),c.events.on({beforefeatureremoved:function(a){this.popup&&a.feature===this.popup.feature&&this.selectControl.unselect(a.feature)},featureunselected:function(b){var c=b.feature;c&&this.fireEvent("featureeditable",this,c,!1),c&&c.geometry&&a&&!a.hidden&&a.close()},beforefeatureselected:function(b){if(a)return!a.editing},featureselected:function(c){var d=c.feature;d&&this.fireEvent("featureeditable",this,d,!0);var e=b.featureStore;(this._forcePopupForNoGeometry===!0||this.selectControl.active&&null!==d.geometry)&&(this.readOnly===!1&&(this.selectControl.deactivate(),b.showLayer(this.id,this.showSelectedOnly&&"selected")),a=this.addOutput({xtype:"gxp_featureeditpopup",collapsible:!0,feature:e.getByFeature(d),vertexRenderIntent:"vertex",readOnly:this.readOnly,fields:this.fields,excludeFields:this.excludeFields,editing:d.state===OpenLayers.State.INSERT,schema:this.schema,allowDelete:!0,width:200,height:250}),a.on({close:function(){this.readOnly===!1&&this.selectControl.activate(),d.layer&&d.layer.selectedFeatures.indexOf(d)!==-1&&this.selectControl.unselect(d),d===this.autoLoadedFeature&&(d.layer&&d.layer.removeFeatures([c.feature]),this.autoLoadedFeature=null)},featuremodified:function(a,c){e.on({beforewrite:{fn:function(a,b,c,d){this.commitMessage===!0&&(d.params.handle=this._commitMsg,delete this._commitMsg)},single:!0},beforesave:{fn:function(){if(a&&a.isVisible()&&a.disable(),this.commitMessage===!0&&!this._commitMsg){var b=arguments.callee;return Ext.Msg.show({prompt:!0,title:this.commitTitle,msg:this.commitText,buttons:Ext.Msg.OK,fn:function(a,c){"ok"===a&&(this._commitMsg=c,e.un("beforesave",b,this),e.save())},scope:this,multiline:!0}),!1}},single:this.commitMessage!==!0},write:{fn:function(){a&&(a.isVisible()&&a.enable(),this.closeOnSave&&a.close());var c=b.layerRecord;this.target.fireEvent("featureedit",b,{name:c.get("name"),source:c.get("source")})},single:!0},exception:{fn:function(c,d,f,g,h,i){var j=this.exceptionText;"remote"===d?h.exceptionReport&&(j=gxp.util.getOGCExceptionText(h.exceptionReport)):j="Status: "+h.status,b.fireEvent("exception",b,h.exceptionReport||{},j,i),b.hasListener("exception")===!1&&e.hasListener("exception")===!1&&Ext.Msg.show({title:this.exceptionTitle,msg:j,icon:Ext.MessageBox.ERROR,buttons:{ok:!0}}),a&&a.isVisible()&&(a.enable(),a.startEditing())},single:!0},scope:this}),c.state===OpenLayers.State.DELETE&&(e._removing=!0,e.remove(e.getRecordFromFeature(c)),delete e._removing),e.save()},canceledit:function(a,b){e.commitChanges()},scope:this}),this.popup=a)},sketchcomplete:function(a){b.featureLayer.events.register("featuresadded",this,function(a){b.featureLayer.events.unregister("featuresadded",this,arguments.callee),this.drawControl.deactivate(),this.selectControl.activate(),this.selectControl.select(a.features[0])})},scope:this});var f=this.toggleGroup||Ext.id(),g=[],h={tooltip:this.createFeatureActionTip,menuText:this.initialConfig.createFeatureActionText,text:this.initialConfig.createFeatureActionText,iconCls:this.iconClsAdd,disabled:!0,hidden:this.modifyOnly||this.readOnly,toggleGroup:f,group:f,groupClass:null,enableToggle:!0,allowDepress:!0,control:this.drawControl,deactivateOnDisable:!0,map:this.target.mapPanel.map,listeners:{checkchange:this.onItemCheckchange,scope:this}};if(this.supportAbstractGeometry===!0){var i=[];this.supportNoGeometry===!0&&i.push(new Ext.menu.CheckItem({text:this.noGeometryText,iconCls:"gxp-icon-event",groupClass:null,group:f,listeners:{checkchange:function(a,b){if(b===!0){var d=new OpenLayers.Feature.Vector(null);d.state=OpenLayers.State.INSERT,c.addFeatures([d]),this._forcePopupForNoGeometry=!0,c.events.triggerEvent("featureselected",{feature:d}),delete this._forcePopupForNoGeometry}this.createAction.items[0]instanceof Ext.menu.CheckItem?this.createAction.items[0].setChecked(!1):this.createAction.items[0].toggle(!1)},scope:this}}));var j=function(a,b,c){b===!0&&this.setHandler(c,!1),this.createAction.items[0]instanceof Ext.menu.CheckItem?this.createAction.items[0].setChecked(b):this.createAction.items[0].toggle(b)};i.push(new Ext.menu.CheckItem({groupClass:null,text:this.pointText,group:f,iconCls:"gxp-icon-point",listeners:{checkchange:j.createDelegate(this,[OpenLayers.Handler.Point],2)}}),new Ext.menu.CheckItem({groupClass:null,text:this.lineText,group:f,iconCls:"gxp-icon-line",listeners:{checkchange:j.createDelegate(this,[OpenLayers.Handler.Path],2)}}),new Ext.menu.CheckItem({groupClass:null,text:this.polygonText,group:f,iconCls:"gxp-icon-polygon",listeners:{checkchange:j.createDelegate(this,[OpenLayers.Handler.Polygon],2)}})),g.push(new GeoExt.Action(Ext.apply(h,{menu:new Ext.menu.Menu({items:i})})))}else g.push(new GeoExt.Action(h));g.push(new GeoExt.Action({tooltip:this.editFeatureActionTip,text:this.initialConfig.editFeatureActionText,menuText:this.initialConfig.editFeatureActionText,iconCls:this.iconClsEdit,disabled:!0,toggleGroup:f,group:f,groupClass:null,enableToggle:!0,allowDepress:!0,control:this.selectControl,deactivateOnDisable:!0,map:this.target.mapPanel.map,listeners:{checkchange:this.onItemCheckchange,scope:this}})),this.createAction=g[0],this.editAction=g[1],this.splitButton&&(this.splitButton=new Ext.SplitButton({menu:{items:[Ext.apply(new Ext.menu.CheckItem(g[0]),{text:this.createFeatureActionText}),Ext.apply(new Ext.menu.CheckItem(g[1]),{text:this.editFeatureActionText})]},disabled:!0,buttonText:this.splitButtonText,tooltip:this.splitButtonTooltip,iconCls:this.iconClsAdd,enableToggle:!0,toggleGroup:this.toggleGroup,allowDepress:!0,handler:function(a,b){a.pressed&&a.menu.items.itemAt(this.activeIndex).setChecked(!0)},scope:this,listeners:{toggle:function(a,b){b||a.menu.items.each(function(a){a.setChecked(!1)})},render:function(a){Ext.ButtonToggleMgr.register(a)}}}),g=[this.splitButton]),g=gxp.plugins.FeatureEditor.superclass.addActions.call(this,g),b.on("layerchange",this.onLayerChange,this);var k=this.getSnappingAgent();return k&&k.registerEditor(this),g},onItemCheckchange:function(a,b){this.splitButton&&(this.activeIndex=a.ownerCt.items.indexOf(a),this.splitButton.toggle(b),b&&this.splitButton.setIconClass(a.iconCls))},getFeatureManager:function(){var a=this.target.tools[this.featureManager];if(!a)throw new Error("Unable to access feature manager by id: "+this.featureManager);return a},getSnappingAgent:function(){var a,b=this.snappingAgent;if(b&&(a=this.target.tools[b],!a))throw new Error("Unable to locate snapping agent with id: "+b);return a},setHandler:function(a,b){var c=this.drawControl,d=c.active;d&&c.deactivate(),c.handler.destroy(),c.handler=new a(c,c.callbacks,Ext.apply(c.handlerOptions,{multi:b})),d&&c.activate()},enableOrDisable:function(){var a=!this.schema;return this.splitButton&&this.splitButton.setDisabled(a),this.createAction.setDisabled(a),this.editAction.setDisabled(a),a},onLayerChange:function(a,b,c){this.schema=c;var d=this.enableOrDisable();if(d)return void this.fireEvent("layereditable",this,b,!1);var f=(this.drawControl,this.createAction),g={Point:OpenLayers.Handler.Point,Line:OpenLayers.Handler.Path,Curve:OpenLayers.Handler.Path,Polygon:OpenLayers.Handler.Polygon,Surface:OpenLayers.Handler.Polygon},h=a.geometryType&&a.geometryType.replace("Multi",""),i=h&&g[h];if(i){var j=h!=a.geometryType;this.setHandler(i,j),f.enable()}else this.supportAbstractGeometry===!0&&a.geometryType&&"Geometry"===a.geometryType?f.enable():f.disable();this.fireEvent("layereditable",this,b,!0)},select:function(a){this.selectControl.unselectAll(this.popup&&this.popup.editing&&{except:this.popup.feature}),this.selectControl.select(a)}}),Ext.preg(gxp.plugins.FeatureEditor.prototype.ptype,gxp.plugins.FeatureEditor),Ext.namespace("GeoExt.grid"),GeoExt.grid.FeatureSelectionModelMixin=function(){return{autoActivateControl:!0,layerFromStore:!0,selectControl:null,bound:!1,superclass:null,selectedFeatures:[],autoPanMapOnSelection:!1,constructor:function(a){if(a=a||{},a.selectControl instanceof OpenLayers.Control.SelectFeature){if(!a.singleSelect){var b=a.selectControl;a.singleSelect=!(b.multiple||b.multipleKey)}}else a.layer instanceof OpenLayers.Layer.Vector&&(this.selectControl=this.createSelectControl(a.layer,a.selectControl),delete a.layer,delete a.selectControl);a.autoPanMapOnSelection&&(this.autoPanMapOnSelection=!0,delete a.autoPanMapOnSelection),this.superclass=arguments.callee.superclass,this.superclass.constructor.call(this,a)},initEvents:function(){if(this.superclass.initEvents.call(this),this.layerFromStore){var a=this.grid.getStore()&&this.grid.getStore().layer;!a||this.selectControl instanceof OpenLayers.Control.SelectFeature||(this.selectControl=this.createSelectControl(a,this.selectControl))}this.selectControl&&this.bind(this.selectControl)},createSelectControl:function(a,b){b=b||{};var c=void 0!==b.singleSelect?b.singleSelect:this.singleSelect;b=OpenLayers.Util.extend({toggle:!0,multipleKey:c?null:Ext.isMac?"metaKey":"ctrlKey"},b);var d=new OpenLayers.Control.SelectFeature(a,b);return a.map.addControl(d),d},bind:function(a,b){if(!this.bound){b=b||{},this.selectControl=a,a instanceof OpenLayers.Layer.Vector&&(this.selectControl=this.createSelectControl(a,b.controlConfig)),this.autoActivateControl&&this.selectControl.activate();for(var c=this.getLayers(),d=0,e=c.length;d<e;d++)c[d].events.on({featureselected:this.featureSelected,featureunselected:this.featureUnselected,scope:this});this.on("rowselect",this.rowSelected,this),this.on("rowdeselect",this.rowDeselected,this),this.bound=!0}return this.selectControl},unbind:function(){var a=this.selectControl;if(this.bound){for(var b=this.getLayers(),c=0,d=b.length;c<d;c++)b[c].events.un({featureselected:this.featureSelected,featureunselected:this.featureUnselected,scope:this});this.un("rowselect",this.rowSelected,this),this.un("rowdeselect",this.rowDeselected,this),this.autoActivateControl&&a.deactivate(),this.selectControl=null,this.bound=!1}return a},featureSelected:function(a){if(!this._selecting){var b=this.grid.store,c=b.findBy(function(b,c){return b.getFeature()==a.feature});c==-1||this.isSelected(c)||(this._selecting=!0,this.selectRow(c,!this.singleSelect),this._selecting=!1,this.grid.getView().focusRow(c))}},featureUnselected:function(a){if(!this._selecting){var b=this.grid.store,c=b.findBy(function(b,c){return b.getFeature()==a.feature});c!=-1&&this.isSelected(c)&&(this._selecting=!0,this.deselectRow(c),this._selecting=!1,this.grid.getView().focusRow(c))}},rowSelected:function(a,b,c){var d=c.getFeature();if(!this._selecting&&d){for(var e=this.getLayers(),f=0,g=e.length;f<g;f++)if(e[f].selectedFeatures.indexOf(d)==-1){this._selecting=!0,this.selectControl.select(d),this._selecting=!1,this.selectedFeatures.push(d);break}this.autoPanMapOnSelection&&this.recenterToSelectionExtent()}},rowDeselected:function(a,b,c){var d=c.getFeature();if(!this._selecting&&d){for(var e=this.getLayers(),f=0,g=e.length;f<g;f++)if(e[f].selectedFeatures.indexOf(d)!=-1){this._selecting=!0,this.selectControl.unselect(d),this._selecting=!1,OpenLayers.Util.removeItem(this.selectedFeatures,d);break}this.autoPanMapOnSelection&&this.selectedFeatures.length>0&&this.recenterToSelectionExtent()}},getLayers:function(){return this.selectControl.layers||[this.selectControl.layer]},recenterToSelectionExtent:function(){var a=this.selectControl.map,b=this.getSelectionExtent(),c=a.getZoomForExtent(b,!1);c>a.getZoom()?a.setCenter(b.getCenterLonLat()):a.zoomToExtent(b)},getSelectionExtent:function(){var a=null,b=this.selectedFeatures;if(b&&b.length>0)for(var c=null,d=0,e=b.length;d<e;d++)c=b[d].geometry,c&&(null===a&&(a=new OpenLayers.Bounds),a.extend(c.getBounds()));return a}}},GeoExt.grid.FeatureSelectionModel=Ext.extend(Ext.grid.RowSelectionModel,new GeoExt.grid.FeatureSelectionModelMixin),Ext.namespace("gxp.grid"),gxp.grid.FeatureGrid=Ext.extend(Ext.grid.GridPanel,{map:null,ignoreFields:null,includeFields:null,layer:null,columnsSortable:!0,columnMenuDisabled:!1,initComponent:function(){this.ignoreFields=["feature","state","fid"].concat(this.ignoreFields),this.store?(this.cm=this.createColumnModel(this.store),this.map&&(this.layer=new OpenLayers.Layer.Vector(this.id+"_layer"),this.map.addLayer(this.layer))):(this.store=new Ext.data.Store,this.cm=new Ext.grid.ColumnModel({columns:[]})),this.layer&&(this.sm=this.sm||new GeoExt.grid.FeatureSelectionModel({layerFromStore:!1,layer:this.layer}),this.store instanceof GeoExt.data.FeatureStore&&this.store.bind(this.layer)),this.dateFormat||(this.dateFormat=Ext.form.DateField.prototype.format),this.timeFormat||(this.timeFormat=Ext.form.TimeField.prototype.format),gxp.grid.FeatureGrid.superclass.initComponent.call(this)},onDestroy:function(){this.initialConfig&&this.initialConfig.map&&!this.initialConfig.layer&&(this.layer.destroy(),delete this.layer),gxp.grid.FeatureGrid.superclass.onDestroy.apply(this,arguments)},setStore:function(a,b){b&&(this.schema=b),a?(this.store instanceof GeoExt.data.FeatureStore&&this.store.unbind(),this.layer&&(this.layer.destroyFeatures(),a.bind(this.layer)),this.reconfigure(a,this.createColumnModel(a))):this.reconfigure(new Ext.data.Store,new Ext.grid.ColumnModel({columns:[]}))},getColumns:function(a){function b(a){return function(b){var c=b;return"string"==typeof b&&(c=Date.parseDate(b.replace(/Z$/,""),"c")),c?c.format(a):b}}var f,g,h,i,j,c=[],d=this.customEditors||{},e=this.customRenderers||{};return(this.schema||a.fields).each(function(a){if(this.schema)switch(f=a.get("name"),g=a.get("type").split(":").pop(),i=null,g){case"date":i=this.dateFormat;break;case"datetime":i=i?i:this.dateFormat+" "+this.timeFormat,h=void 0,j=b(i);break;case"boolean":h="booleancolumn";break;case"string":h="gridcolumn";break;default:h="numbercolumn"}else f=a.name;if(this.ignoreFields.indexOf(f)===-1&&(null===this.includeFields||this.includeFields.indexOf(f)>=0)){var k=this.columnConfig?this.columnConfig[f]:null;c.push(Ext.apply({dataIndex:f,hidden:!!this.fieldVisibility&&!this.fieldVisibility[f],header:this.propertyNames?this.propertyNames[f]||f:f,sortable:this.columnsSortable,menuDisabled:this.columnMenuDisabled,xtype:h,editor:d[f]||{xtype:"textfield"},format:i,renderer:e[f]||(h?void 0:j)},k))}},this),c},createColumnModel:function(a){var b=this.getColumns(a);return new Ext.grid.ColumnModel(b)}}),Ext.reg("gxp_featuregrid",gxp.grid.FeatureGrid),Ext.namespace("gxp.plugins"),gxp.plugins.FeatureGrid=Ext.extend(gxp.plugins.ClickableFeatures,{ptype:"gxp_featuregrid",schema:null,showTotalResults:!1,alwaysDisplayOnMap:!1,displayMode:"all",autoExpand:!1,autoCollapse:!1,selectOnMap:!1,displayFeatureText:"Display on map",firstPageTip:"First page",previousPageTip:"Previous page",zoomPageExtentTip:"Zoom to page extent",nextPageTip:"Next page",lastPageTip:"Last page",totalMsg:"Features {1} to {2} of {0}",displayTotalResults:function(){var a=this.target.tools[this.featureManager];this.showTotalResults===!0&&this.displayItem.setText(null!==a.numberOfFeatures?String.format(this.totalMsg,a.numberOfFeatures,a.pageIndex*a.maxFeatures+Math.min(a.numberOfFeatures,1),Math.min((a.pageIndex+1)*a.maxFeatures,a.numberOfFeatures)):"")},addOutput:function(a){function f(){var a=b.schema,c=["feature","state","fid"];a&&a.each(function(a){0==a.get("type").indexOf("gml:")&&c.push(a.get("name"))}),e.ignoreFields=c,e.setStore(b.featureStore,a),b.featureStore||(b.paging&&(e.lastPageButton.disable(),e.nextPageButton.disable(),e.firstPageButton.disable(),e.prevPageButton.disable(),e.zoomToPageButton.disable()),this.displayTotalResults())}var d,b=this.target.tools[this.featureManager],c=this.target.mapPanel.map;this.selectControl=new OpenLayers.Control.SelectFeature(b.featureLayer,this.initialConfig.controlOptions),this.selectOnMap?((this.autoLoadFeature||b.paging&&b.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING)&&this.selectControl.events.on({activate:function(){c.events.register("click",this,this.noFeatureClick)},deactivate:function(){c.events.unregister("click",this,this.noFeatureClick)},scope:this}),c.addControl(this.selectControl),d={selectControl:this.selectControl}):d={selectControl:this.selectControl,singleSelect:!1,autoActivateControl:!1,listeners:{beforerowselect:function(){if(window.event&&"contextmenu"==window.event.type||this.selectControl.active||b.featureStore.getModifiedRecords().length)return!1},scope:this}},this.displayItem=new Ext.Toolbar.TextItem({}),a=Ext.apply({xtype:"gxp_featuregrid",border:!1,sm:new GeoExt.grid.FeatureSelectionModel(d),autoScroll:!0,columnMenuDisabled:!!b.paging,bbar:(b.paging?[{iconCls:"x-tbar-page-first",ref:"../firstPageButton",tooltip:this.firstPageTip,disabled:!0,handler:function(){b.setPage({index:0})}},{iconCls:"x-tbar-page-prev",ref:"../prevPageButton",tooltip:this.previousPageTip,disabled:!0,handler:function(){b.previousPage()}},{iconCls:"gxp-icon-zoom-to",ref:"../zoomToPageButton",tooltip:this.zoomPageExtentTip,disabled:!0,hidden:b.pagingType!==gxp.plugins.FeatureManager.QUADTREE_PAGING||b.autoZoomPage,handler:function(){var a=b.getPageExtent();null!==a&&c.zoomToExtent(a)}},{iconCls:"x-tbar-page-next",ref:"../nextPageButton",tooltip:this.nextPageTip,disabled:!0,handler:function(){b.nextPage()}},{iconCls:"x-tbar-page-last",ref:"../lastPageButton",tooltip:this.lastPageTip,disabled:!0,handler:function(){b.setPage({index:"last"})}},{xtype:"tbspacer",width:10},this.displayItem]:[]).concat(["->"].concat(this.alwaysDisplayOnMap?[]:[{text:this.displayFeatureText,enableToggle:!0,toggleHandler:function(a,c){this.selectOnMap&&this.selectControl[c?"activate":"deactivate"](),b[c?"showLayer":"hideLayer"](this.id,this.displayMode)},scope:this}])),contextMenu:new Ext.menu.Menu({items:[]})},a||{});var e=gxp.plugins.FeatureGrid.superclass.addOutput.call(this,a);return e.on({added:function(a,c){function d(){this.displayTotalResults(),this.selectOnMap&&this.selectControl.deactivate(),this.autoCollapse&&"function"==typeof c.collapse&&c.collapse()}function e(){this.displayTotalResults(),this.selectOnMap&&this.selectControl.activate(),this.autoExpand&&"function"==typeof c.expand&&c.expand()}b.on({query:function(a,b){b&&b.getCount()?e.call(this):d.call(this)},layerchange:d,clearfeatures:d,scope:this})},contextmenu:function(a){if(e.contextMenu.items.getCount()>0){var b=e.getView().findRowIndex(a.getTarget());b!==!1&&(e.getSelectionModel().selectRow(b),e.contextMenu.showAt(a.getXY()),a.stopEvent())}},scope:this}),(this.alwaysDisplayOnMap||this.selectOnMap===!0&&"selected"===this.displayMode)&&b.showLayer(this.id,this.displayMode),b.paging&&b.on({beforesetpage:function(){e.zoomToPageButton.disable()},setpage:function(a,b,c,d,f,g){var h=g>0;e.zoomToPageButton.setDisabled(!h);var i=h&&0!==f;e.firstPageButton.setDisabled(!i),e.prevPageButton.setDisabled(!i);var j=h&&f!==g-1;e.lastPageButton.setDisabled(!j),e.nextPageButton.setDisabled(!j)},scope:this}),b.featureStore&&f.call(this),b.on("layerchange",f,this),e}}),Ext.preg(gxp.plugins.FeatureGrid.prototype.ptype,gxp.plugins.FeatureGrid),Ext.namespace("gxp.plugins"),gxp.plugins.StyleWriter=Ext.extend(Ext.util.Observable,{deletedStyles:null,constructor:function(a){this.initialConfig=a,Ext.apply(this,a),this.deletedStyles=[],gxp.plugins.StyleWriter.superclass.constructor.apply(this,arguments)},init:function(a){this.target=a,a.stylesStore.on({remove:function(a,b,c){var d=b.get("name");b.get("name")===d&&this.deletedStyles.push(d)},scope:this}),a.on({beforesaved:this.write,scope:this})},write:function(a,b){a.stylesStore.commitChanges(),a.fireEvent("saved",a,a.selectedStyle.get("name"))}}),Ext.namespace("gxp.plugins"),
gxp.plugins.GeoServerStyleWriter=Ext.extend(gxp.plugins.StyleWriter,{baseUrl:"/geoserver/rest",constructor:function(a){this.initialConfig=a,Ext.apply(this,a),gxp.plugins.GeoServerStyleWriter.superclass.constructor.apply(this,arguments)},write:function(a){delete this._failed,a=a||{};var b=[],c=this.target.stylesStore;c.each(function(a){(a.phantom||c.modified.indexOf(a)!==-1)&&this.writeStyle(a,b)},this);var d=function(){var b=this.target;if(this._failed!==!0){this.deleteStyles();for(var c=this.target.stylesStore.getModifiedRecords(),d=c.length-1;d>=0;--d)c[d].phantom=!1;b.stylesStore.commitChanges(),a.success&&a.success.call(a.scope),b.fireEvent("saved",b,b.selectedStyle.get("name"))}else b.fireEvent("savefailed",b,b.selectedStyle.get("name"))};b.length>0?gxp.util.dispatch(b,function(){this.assignStyles(a.defaultStyle,d)},this):this.assignStyles(a.defaultStyle,d)},writeStyle:function(a,b){var c=a.get("userStyle").name;b.push(function(b,d){Ext.Ajax.request({method:a.phantom===!0?"POST":"PUT",url:this.baseUrl+"/styles"+(a.phantom===!0?"":"/"+c+".xml"),headers:{"Content-Type":"application/vnd.ogc.sld+xml; charset=UTF-8"},xmlData:this.target.createSLD({userStyles:[c]}),failure:function(){this._failed=!0,b.call(this)},success:a.phantom===!0?function(){Ext.Ajax.request({method:"POST",url:this.baseUrl+"/layers/"+this.target.layerRecord.get("name")+"/styles.json",jsonData:{style:{name:c}},failure:function(){this._failed=!0,b.call(this)},success:b,scope:this})}:b,scope:this})})},assignStyles:function(a,b){var c=[];this.target.stylesStore.each(function(b){a||b.get("userStyle").isDefault!==!0||(a=b.get("name")),b.get("name")!==a&&this.deletedStyles.indexOf(b.id)===-1&&c.push({name:b.get("name")})},this),Ext.Ajax.request({method:"PUT",url:this.baseUrl+"/layers/"+this.target.layerRecord.get("name")+".json",jsonData:{layer:{defaultStyle:{name:a},styles:c.length>0?{style:c}:{},enabled:!0}},success:b,failure:function(){this._failed=!0,b.call(this)},scope:this})},deleteStyles:function(){for(var a=0,b=this.deletedStyles.length;a<b;++a)Ext.Ajax.request({method:"DELETE",url:this.baseUrl+"/styles/"+this.deletedStyles[a]+"?purge=true"});this.deletedStyles=[]}}),Ext.preg("gxp_geoserverstylewriter",gxp.plugins.GeoServerStyleWriter),Ext.namespace("gxp.plugins"),gxp.plugins.LayerSource=Ext.extend(Ext.util.Observable,{store:null,lazy:!1,hidden:!1,title:"",constructor:function(a){this.initialConfig=a,Ext.apply(this,a),this.addEvents("ready","failure"),gxp.plugins.LayerSource.superclass.constructor.apply(this,arguments)},init:function(a){this.target=a,this.createStore()},getMapProjection:function(){var a=this.target.mapPanel.map.projection;return this.target.mapPanel.map.getProjectionObject()||a&&new OpenLayers.Projection(a)||new OpenLayers.Projection("EPSG:4326")},getProjection:function(a){var b=a.getLayer(),c=this.getMapProjection(),d=b.projection?b.projection instanceof OpenLayers.Projection?b.projection:new OpenLayers.Projection(b.projection):c;return d.equals(c)?c:null},createStore:function(){this.fireEvent("ready",this)},createLayerRecord:function(a){},getConfigForRecord:function(a){var b=a.getLayer();return{source:a.get("source"),name:a.get("name"),title:a.get("title"),visibility:b.getVisibility(),opacity:b.opacity||void 0,group:a.get("group"),fixed:a.get("fixed"),selected:a.get("selected")}},getState:function(){return Ext.apply({},this.initialConfig)}}),OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(a,b,c){(c&&c.sphericalMercator||this.sphericalMercator)&&(c=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},c)),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a||this.name,b||this.url,{},c])},clone:function(a){return null==a&&(a=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var b=this.getXYZ(a),c=this.url;if(OpenLayers.Util.isArray(c)){var d=""+b.x+b.y+b.z;c=this.selectUrl(d,c)}return OpenLayers.String.format(c,b)},getXYZ:function(a){var b=this.getServerResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w)),d=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h)),e=this.getServerZoom();if(this.wrapDateLine){var f=Math.pow(2,e);c=(c%f+f)%f}return{x:c,y:d,z:e}},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"}),OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.29858214169740677,.14929107084870338,.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,protocolRegex:/^http:/i,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,protocol:~window.location.href.indexOf("http")?"":"http:",initialize:function(a){a=OpenLayers.Util.applyDefaults({sphericalMercator:!0},a);var b=a.name||"Bing "+(a.type||this.type),c=[b,null,a];OpenLayers.Layer.XYZ.prototype.initialize.apply(this,c),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions),this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_"),window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var a=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),b=this.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(a),c=document.createElement("script");c.type="text/javascript",c.src=b,c.id=this._callbackId,document.getElementsByTagName("head")[0].appendChild(c)},initLayer:function(){var a=this.metadata.resourceSets[0].resources[0],b=a.imageUrl.replace("{quadkey}","${quadkey}");b=b.replace("{culture}",this.culture),b=b.replace(this.protocolRegex,this.protocol),this.url=[];for(var c=0;c<a.imageUrlSubdomains.length;++c)this.url.push(b.replace("{subdomain}",a.imageUrlSubdomains[c]));this.addOptions({maxResolution:Math.min(this.serverResolutions[a.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(a.zoomMax+1-a.zoomMin,this.numZoomLevels)},!0),this.isBaseLayer||this.redraw(),this.updateAttribution()},getURL:function(a){if(this.url){for(var b=this.getXYZ(a),c=b.x,d=b.y,e=b.z,f=[],g=e;g>0;--g){var h="0",i=1<<g-1;0!=(c&i)&&h++,0!=(d&i)&&(h++,h++),f.push(h)}var j=f.join(""),k=this.selectUrl(""+c+d+e,this.url);return OpenLayers.String.format(k,{quadkey:j})}},updateAttribution:function(){var a=this.metadata;if(a.resourceSets&&this.map&&this.map.center){var g,h,i,j,k,l,m,b=a.resourceSets[0].resources[0],c=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),d=b.imageryProviders||[],e=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),f="";for(h=0,i=d.length;h<i;++h)for(g=d[h],j=0,k=g.coverageAreas.length;j<k;++j)m=g.coverageAreas[j],l=OpenLayers.Bounds.fromArray(m.bbox,!0),c.intersectsBounds(l)&&e<=m.zoomMax&&e>=m.zoomMin&&(f+=g.attribution+" ");var n=a.brandLogoUri.replace(this.protocolRegex,this.protocol);this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:n,copyrights:f}),this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments),this.map.events.register("moveend",this,this.updateAttribution)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Bing(this.options)),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution),OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"}),OpenLayers.Layer.Bing.processMetadata=function(a){this.metadata=a,this.initLayer();var b=document.getElementById(this._callbackId);b.parentNode.removeChild(b),window[this._callbackId]=void 0,delete this._callbackId},Ext.namespace("gxp.plugins"),gxp.plugins.BingSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_bingsource",title:"Bing Layers",roadTitle:"Bing Roads",aerialTitle:"Bing Aerial",labeledAerialTitle:"Bing Aerial With Labels",apiKey:"AqTGBsziZHIJYYxgivLBf0hVdrAk9mWO5cQcb8Yux8sW5M8c8opEC2lZqKR1ZZXf",createStore:function(){var a=[new OpenLayers.Layer.Bing({key:this.apiKey,name:this.roadTitle,type:"Road",buffer:1,transitionEffect:"resize"}),new OpenLayers.Layer.Bing({key:this.apiKey,name:this.aerialTitle,type:"Aerial",buffer:1,transitionEffect:"resize"}),new OpenLayers.Layer.Bing({key:this.apiKey,name:this.labeledAerialTitle,type:"AerialWithLabels",buffer:1,transitionEffect:"resize"})];this.store=new GeoExt.data.LayerStore({layers:a,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"type"},{name:"abstract",type:"string",mapping:"attribution"},{name:"group",type:"string",defaultValue:"background"},{name:"fixed",type:"boolean",defaultValue:!0},{name:"selected",type:"boolean"}]}),this.store.each(function(a){a.set("group","background")}),this.fireEvent("ready",this)},createLayerRecord:function(a){var b,c=this.store.findExact("name",a.name);if(c>-1){b=this.store.getAt(c).copy(Ext.data.Record.id({}));var d=b.getLayer().clone();a.title&&(d.setName(a.title),b.set("title",a.title)),"visibility"in a&&(d.visibility=a.visibility),b.set("selected",a.selected||!1),b.set("source",a.source),b.set("name",a.name),"group"in a&&b.set("group",a.group),b.data.layer=d,b.commit()}return b}}),Ext.preg(gxp.plugins.BingSource.prototype.ptype,gxp.plugins.BingSource),OpenLayers.Layer.SphericalMercator={getExtent:function(){var a=null;return a=this.sphericalMercator?this.map.calculateBounds():OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)},getLonLatFromViewPortPx:function(a){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(a){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];for(var a=156543.03390625,b=0;b<=this.MAX_ZOOM_LEVEL;++b)this.RESOLUTIONS[b]=a/Math.pow(2,b);this.units="m",this.projection=this.projection||"EPSG:900913"},forwardMercator:function(){var a=new OpenLayers.Projection("EPSG:4326"),b=new OpenLayers.Projection("EPSG:900913");return function(c,d){var e=OpenLayers.Projection.transform({x:c,y:d},a,b);return new OpenLayers.LonLat(e.x,e.y)}}(),inverseMercator:function(){var a=new OpenLayers.Projection("EPSG:4326"),b=new OpenLayers.Projection("EPSG:900913");return function(c,d){var e=OpenLayers.Projection.transform({x:c,y:d},b,a);return new OpenLayers.LonLat(e.x,e.y)}}()},OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:!0,isBaseLayer:!0,isFixed:!0,pane:null,mapObject:null,initialize:function(a,b){OpenLayers.Layer.prototype.initialize.apply(this,arguments),null==this.pane&&(this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane"))},destroy:function(){this.mapObject=null,this.pane=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1,this.pane.style.display=this.div.style.display,this.pane.style.width="100%",this.pane.style.height="100%","msie"==OpenLayers.BROWSER_NAME&&(this.pane.style.background="url("+OpenLayers.Util.getImageLocation("blank.gif")+")"),this.isFixed?this.map.viewPortDiv.appendChild(this.pane):this.map.layerContainerDiv.appendChild(this.pane),this.loadMapObject(),null==this.mapObject&&this.loadWarningMessage()},removeMap:function(a){this.pane&&this.pane.parentNode&&this.pane.parentNode.removeChild(this.pane),OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var a=this.map.getSize(),b=Math.min(a.w,300),c=Math.min(a.h,200),d=new OpenLayers.Size(b,c),e=new OpenLayers.Pixel(a.w/2,a.h/2),f=e.add(-d.w/2,-d.h/2),g=OpenLayers.Util.createDiv(this.name+"_warning",f,d,null,null,null,"auto");g.style.padding="7px",g.style.backgroundColor="yellow",g.innerHTML=this.getWarningHTML(),this.div.appendChild(g)},getWarningHTML:function(){return""},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments),this.pane.style.display=this.div.style.display},setZIndex:function(a){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments),this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(a,b){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments),this.dragPanMapObject?this.dragPanMapObject(a,-b):this.moveTo(this.map.getCachedCenter())},moveTo:function(a,b,c){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),null!=this.mapObject){var d=this.map.getCenter(),e=this.map.getZoom();if(null!=d){var f=this.getMapObjectCenter(),g=this.getOLLonLatFromMapObjectLonLat(f),h=this.getMapObjectZoom(),i=this.getOLZoomFromMapObjectZoom(h);if(!d.equals(g)||e!=i)if(!b&&g&&this.dragPanMapObject&&this.smoothDragPan){var j=this.map.getViewPortPxFromLonLat(g),k=this.map.getViewPortPxFromLonLat(d);this.dragPanMapObject(k.x-j.x,j.y-k.y)}else{var l=this.getMapObjectLonLatFromOLLonLat(d),m=this.getMapObjectZoomFromOLZoom(e);this.setMapObjectCenter(l,m,c)}}}},getLonLatFromViewPortPx:function(a){var b=null;if(null!=this.mapObject&&null!=this.getMapObjectCenter()){var c=this.getMapObjectPixelFromOLPixel(a),d=this.getMapObjectLonLatFromMapObjectPixel(c);b=this.getOLLonLatFromMapObjectLonLat(d)}return b},getViewPortPxFromLonLat:function(a){var b=null;if(null!=this.mapObject&&null!=this.getMapObjectCenter()){var c=this.getMapObjectLonLatFromOLLonLat(a),d=this.getMapObjectPixelFromMapObjectLonLat(c);b=this.getOLPixelFromMapObjectPixel(d)}return b},getOLLonLatFromMapObjectLonLat:function(a){var b=null;if(null!=a){var c=this.getLongitudeFromMapObjectLonLat(a),d=this.getLatitudeFromMapObjectLonLat(a);b=new OpenLayers.LonLat(c,d)}return b},getMapObjectLonLatFromOLLonLat:function(a){var b=null;return null!=a&&(b=this.getMapObjectLonLatFromLonLat(a.lon,a.lat)),b},getOLPixelFromMapObjectPixel:function(a){var b=null;if(null!=a){var c=this.getXFromMapObjectPixel(a),d=this.getYFromMapObjectPixel(a);b=new OpenLayers.Pixel(c,d)}return b},getMapObjectPixelFromOLPixel:function(a){var b=null;return null!=a&&(b=this.getMapObjectPixelFromXY(a.x,a.y)),b},CLASS_NAME:"OpenLayers.Layer.EventPane"}),OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){for(var a=["minZoomLevel","maxZoomLevel","numZoomLevels"],b=0,c=a.length;b<c;b++){var d=a[b];this[d]=null!=this.options[d]?this.options[d]:this.map[d]}(null==this.minZoomLevel||this.minZoomLevel<this.MIN_ZOOM_LEVEL)&&(this.minZoomLevel=this.MIN_ZOOM_LEVEL);var e,f=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;if(e=null==this.options.numZoomLevels&&null!=this.options.maxZoomLevel||null==this.numZoomLevels&&null!=this.maxZoomLevel?this.maxZoomLevel-this.minZoomLevel+1:this.numZoomLevels,null!=e?this.numZoomLevels=Math.min(e,f):this.numZoomLevels=f,this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1,null!=this.RESOLUTIONS){var g=0;this.resolutions=[];for(var b=this.minZoomLevel;b<=this.maxZoomLevel;b++)this.resolutions[g++]=this.RESOLUTIONS[b];this.maxResolution=this.resolutions[0],this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getResolution.apply(this,arguments);var a=null,b=this.map.getSize(),c=this.getExtent();return null!=b&&null!=c&&(a=Math.max(c.getWidth()/b.w,c.getHeight()/b.h)),a},getExtent:function(){var a=this.map.getSize(),b=this.getLonLatFromViewPortPx({x:0,y:0}),c=this.getLonLatFromViewPortPx({x:a.w,y:a.h});return null!=b&&null!=c?new OpenLayers.Bounds(b.lon,c.lat,c.lon,b.lat):null},getZoomForResolution:function(a){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments);var b=OpenLayers.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(b)},getOLZoomFromMapObjectZoom:function(a){var b=null;return null!=a&&(b=a-this.minZoomLevel,this.map.baseLayer!==this&&(b=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(b)))),b},getMapObjectZoomFromOLZoom:function(a){var b=null;return null!=a&&(b=a+this.minZoomLevel,this.map.baseLayer!==this&&(b=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(b)))),b},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"}),OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,2145767211914062e-20,1072883605957031e-20,536441802978515e-20,268220901489257e-20,1341104507446289e-21,6.705522537231445e-7],type:null,wrapDateLine:!0,sphericalMercator:!1,version:null,initialize:function(a,b){b=b||{},b.version||(b.version="function"==typeof GMap2?"2":"3");var c=OpenLayers.Layer.Google["v"+b.version.replace(/\./g,"_")];if(!c)throw"Unsupported Google Maps API version: "+b.version;OpenLayers.Util.applyDefaults(b,c),OpenLayers.Util.applyDefaults(b,c.DEFAULTS),b.maxExtent&&(b.maxExtent=b.maxExtent.clone()),OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[a,b]),OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,[a,b]),this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())},setVisibility:function(a){var b=null==this.opacity?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments),this.setOpacity(b)},display:function(a){this._dragging||this.setGMapVisibility(a),OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(a,b,c){this._dragging=c,OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments),delete this._dragging},setOpacity:function(a){if(a!==this.opacity&&(null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"}),this.opacity=a),this.getVisibility()){var b=this.getMapContainer();OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,a)}},destroy:function(){if(this.map){this.setGMapVisibility(!1);var a=OpenLayers.Layer.Google.cache[this.map.id];a&&a.count<=1&&this.removeGMapElements()}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var a=OpenLayers.Layer.Google.cache[this.map.id];if(a){var b=this.mapObject&&this.getMapContainer();b&&b.parentNode&&b.parentNode.removeChild(b);var c=a.termsOfUse;c&&c.parentNode&&c.parentNode.removeChild(c);var d=a.poweredBy;d&&d.parentNode&&d.parentNode.removeChild(d),this.mapObject&&window.google&&google.maps&&google.maps.event&&google.maps.event.clearListeners&&google.maps.event.clearListeners(this.mapObject,"tilesloaded")}},removeMap:function(a){this.visibility&&this.mapObject&&this.setGMapVisibility(!1);var b=OpenLayers.Layer.Google.cache[a.id];b&&(b.count<=1?(this.removeGMapElements(),delete OpenLayers.Layer.Google.cache[a.id]):--b.count),delete this.termsOfUse,delete this.poweredBy,delete this.mapObject,delete this.dragObject,OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(a){var b=null;if(null!=a){var c=a.getSouthWest(),d=a.getNorthEast();this.sphericalMercator?(c=this.forwardMercator(c.lng(),c.lat()),d=this.forwardMercator(d.lng(),d.lat())):(c=new OpenLayers.LonLat(c.lng(),c.lat()),d=new OpenLayers.LonLat(d.lng(),d.lat())),b=new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat)}return b},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lon:a.lng()},getLatitudeFromMapObjectLonLat:function(a){var b=this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lat:a.lat();return b},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},CLASS_NAME:"OpenLayers.Layer.Google"}),OpenLayers.Layer.Google.cache={},OpenLayers.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){this.type||(this.type=G_NORMAL_MAP);var a,b,c,d=OpenLayers.Layer.Google.cache[this.map.id];if(d)a=d.mapObject,b=d.termsOfUse,c=d.poweredBy,++d.count;else{var e=this.map.viewPortDiv,f=document.createElement("div");f.id=this.map.id+"_GMap2Container",f.style.position="absolute",f.style.width="100%",f.style.height="100%",e.appendChild(f);try{a=new GMap2(f),b=f.lastChild,e.appendChild(b),b.style.zIndex="1100",b.style.right="",b.style.bottom="",b.className="olLayerGoogleCopyright",c=f.lastChild,e.appendChild(c),c.style.zIndex="1100",c.style.right="",c.style.bottom="",c.className="olLayerGooglePoweredBy gmnoprint"}catch(a){throw a}OpenLayers.Layer.Google.cache[this.map.id]={mapObject:a,termsOfUse:b,poweredBy:c,count:1}}this.mapObject=a,this.termsOfUse=b,this.poweredBy=c,OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)===-1&&this.mapObject.addMapType(this.type),"function"==typeof a.getDragObject?this.dragObject=a.getDragObject():this.dragPanMapObject=null,this.isBaseLayer===!1&&this.setGMapVisibility("none"!==this.div.style.display)},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded())this.mapObject.checkResize();else{if(!this._resized)var a=this,b=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(b),delete a._resized,a.mapObject.checkResize(),a.moveTo(a.map.getCenter(),a.map.getZoom())});this._resized=!0}},setGMapVisibility:function(a){var b=OpenLayers.Layer.Google.cache[this.map.id];if(b){var c=this.mapObject.getContainer();a===!0?(this.mapObject.setMapType(this.type),c.style.display="",this.termsOfUse.style.left="",this.termsOfUse.style.display="",this.poweredBy.style.display="",b.displayed=this.id):(b.displayed===this.id&&delete b.displayed,b.displayed||(c.style.display="none",this.termsOfUse.style.display="none",this.termsOfUse.style.left="-9999px",this.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(a){var b=null;if(null!=a){var c=this.sphericalMercator?this.inverseMercator(a.bottom,a.left):new OpenLayers.LonLat(a.bottom,a.left),d=this.sphericalMercator?this.inverseMercator(a.top,a.right):new OpenLayers.LonLat(a.top,a.right);b=new GLatLngBounds(new GLatLng(c.lat,c.lon),new GLatLng(d.lat,d.lon))}return b},setMapObjectCenter:function(a,b){this.mapObject.setCenter(a,b)},dragPanMapObject:function(a,b){this.dragObject.moveBy(new GSize(-a,b))},getMapObjectLonLatFromMapObjectPixel:function(a){return this.mapObject.fromContainerPixelToLatLng(a)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.fromLatLngToContainerPixel(a)},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getMapObjectLonLatFromLonLat:function(a,b){var c;if(this.sphericalMercator){var d=this.inverseMercator(a,b);c=new GLatLng(d.lat,d.lon)}else c=new GLatLng(b,a);return c},getMapObjectPixelFromXY:function(a,b){return new GPoint(a,b)}},OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:!0,projection:"EPSG:900913"},animationEnabled:!0,loadMapObject:function(){this.type||(this.type=google.maps.MapTypeId.ROADMAP);var a,b=OpenLayers.Layer.Google.cache[this.map.id];if(b)a=b.mapObject,++b.count;else{var c=this.map.getCenter(),d=document.createElement("div");d.className="olForeignContainer",d.style.width="100%",d.style.height="100%",a=new google.maps.Map(d,{center:c?new google.maps.LatLng(c.lat,c.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1});var e=document.createElement("div");e.style.width="100%",e.style.height="100%",a.controls[google.maps.ControlPosition.TOP_LEFT].push(e),b={googleControl:e,mapObject:a,count:1},OpenLayers.Layer.Google.cache[this.map.id]=b}this.mapObject=a,this.setGMapVisibility(this.visibility)},onMapResize:function(){this.visibility&&google.maps.event.trigger(this.mapObject,"resize")},setGMapVisibility:function(a){var b=OpenLayers.Layer.Google.cache[this.map.id],c=this.map;if(b){for(var f,d=this.type,e=c.layers,g=e.length-1;g>=0;--g)if(f=e[g],f instanceof OpenLayers.Layer.Google&&f.visibility===!0&&f.inRange===!0){d=f.type,a=!0;break}var h=this.mapObject.getDiv();if(a===!0){if(h.parentNode!==c.div)if(b.rendered)c.div.appendChild(h),b.googleControl.appendChild(c.viewPortDiv),google.maps.event.trigger(this.mapObject,"resize");else{var i=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){b.rendered=!0,i.setGMapVisibility(i.getVisibility()),i.moveTo(i.map.getCenter())})}this.mapObject.setMapTypeId(d)}else b.googleControl.hasChildNodes()&&(c.div.appendChild(c.viewPortDiv),c.div.removeChild(h))}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(a){var b=null;if(null!=a){var c=this.sphericalMercator?this.inverseMercator(a.bottom,a.left):new OpenLayers.LonLat(a.bottom,a.left),d=this.sphericalMercator?this.inverseMercator(a.top,a.right):new OpenLayers.LonLat(a.top,a.right);b=new google.maps.LatLngBounds(new google.maps.LatLng(c.lat,c.lon),new google.maps.LatLng(d.lat,d.lon))}return b},getMapObjectLonLatFromMapObjectPixel:function(a){var b=this.map.getSize(),c=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),d=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),e=this.map.getResolution(),f=a.x-b.w/2,g=a.y-b.h/2,h=new OpenLayers.LonLat(c+f*e,d-g*e);return this.wrapDateLine&&(h=h.wrapDateLine(this.maxExtent)),this.getMapObjectLonLatFromLonLat(h.lon,h.lat)},getMapObjectPixelFromMapObjectLonLat:function(a){var b=this.getLongitudeFromMapObjectLonLat(a),c=this.getLatitudeFromMapObjectLonLat(a),d=this.map.getResolution(),e=this.map.getExtent();return this.getMapObjectPixelFromXY(1/d*(b-e.left),1/d*(e.top-c))},setMapObjectCenter:function(a,b){if(this.animationEnabled===!1&&b!=this.mapObject.zoom){var c=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){c.style.visibility=""}),c.style.visibility="hidden"}this.mapObject.setOptions({center:a,zoom:b})},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getMapObjectLonLatFromLonLat:function(a,b){var c;if(this.sphericalMercator){var d=this.inverseMercator(a,b);c=new google.maps.LatLng(d.lat,d.lon)}else c=new google.maps.LatLng(b,a);return c},getMapObjectPixelFromXY:function(a,b){return new google.maps.Point(a,b)}},Ext.namespace("gxp.plugins"),gxp.plugins.GoogleSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_googlesource",timeout:7e3,title:"Google Layers",roadmapAbstract:"Show street map",satelliteAbstract:"Show satellite imagery",hybridAbstract:"Show imagery with street names",terrainAbstract:"Show street map with terrain",otherParams:"sensor=false",constructor:function(a){this.config=a,gxp.plugins.GoogleSource.superclass.constructor.apply(this,arguments)},createStore:function(){gxp.plugins.GoogleSource.loader.onLoad({otherParams:this.otherParams,timeout:this.timeout,callback:this.syncCreateStore,errback:function(){delete this.store,this.fireEvent("failure",this,"The Google Maps script failed to load within the provided timeout ("+this.timeout/1e3+" s).")},scope:this})},syncCreateStore:function(){var c,d,a={ROADMAP:{abstract:this.roadmapAbstract,MAX_ZOOM_LEVEL:20},SATELLITE:{abstract:this.satelliteAbstract},HYBRID:{abstract:this.hybridAbstract},TERRAIN:{abstract:this.terrainAbstract,MAX_ZOOM_LEVEL:15}},b=[];for(c in a)d=google.maps.MapTypeId[c],b.push(new OpenLayers.Layer.Google("Google "+d.replace(/\w/,function(a){return a.toUpperCase()}),{type:d,typeName:c,MAX_ZOOM_LEVEL:a[c].MAX_ZOOM_LEVEL,maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),restrictedExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),projection:this.projection}));this.store=new GeoExt.data.LayerStore({layers:b,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"typeName"},{name:"abstract",type:"string"},{name:"group",type:"string",defaultValue:"background"},{name:"fixed",type:"boolean",defaultValue:!0},{name:"selected",type:"boolean"}]}),this.store.each(function(b){b.set("abstract",a[b.get("name")].abstract)}),this.fireEvent("ready",this)},createLayerRecord:function(a){var b,c=function(b){return b.get("name")===a.name};if(this.target.mapPanel.layers.findBy(c)==-1){b=this.store.getAt(this.store.findBy(c)).clone();var d=b.getLayer();a.title&&(d.setName(a.title),b.set("title",a.title)),"visibility"in a&&(d.visibility=a.visibility),b.set("selected",a.selected||!1),b.set("source",a.source),b.set("name",a.name),"group"in a&&b.set("group",a.group),b.commit()}return b}}),gxp.plugins.GoogleSource.loader=new(Ext.extend(Ext.util.Observable,{ready:!(!window.google||!google.maps),loading:!1,constructor:function(){return this.addEvents("ready","failure"),Ext.util.Observable.prototype.constructor.apply(this,arguments)},onScriptLoad:function(){var a=gxp.plugins.GoogleSource.loader;a.ready||(a.ready=!0,a.loading=!1,a.fireEvent("ready"))},onLoad:function(a){this.ready?window.setTimeout(function(){a.callback.call(a.scope)},0):this.loading?this.on({ready:a.callback,failure:a.errback||Ext.emptyFn,scope:a.scope}):this.loadScript(a)},loadScript:function(a){function f(){document.getElementsByTagName("head")[0].appendChild(c)}var b={autoload:Ext.encode({modules:[{name:"maps",version:3.3,nocss:"true",callback:"gxp.plugins.GoogleSource.loader.onScriptLoad",other_params:a.otherParams}]})},c=document.createElement("script");c.src="http://www.google.com/jsapi?"+Ext.urlEncode(b);var d=a.errback||Ext.emptyFn,e=a.timeout||gxp.plugins.GoogleSource.prototype.timeout;window.setTimeout(function(){gxp.plugins.GoogleSource.loader.ready||(this.loading=!1,this.ready=!1,document.getElementsByTagName("head")[0].removeChild(c),d.call(a.scope),this.fireEvent("failure"),this.purgeListeners())}.createDelegate(this),e),this.on({ready:a.callback,scope:a.scope}),this.loading=!0,document.body?f():Ext.onReady(f)}})),Ext.preg(gxp.plugins.GoogleSource.prototype.ptype,gxp.plugins.GoogleSource),Ext.namespace("gxp.plugins"),gxp.plugins.OLSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_olsource",createLayerRecord:function(a){for(var b,c=window,d=a.type.split("."),e=0,f=d.length;e<f&&(c=c[d[e]],c);++e);if(!(c&&c.prototype&&c.prototype.initialize))throw new Error("Cannot construct OpenLayers layer from given type: "+a.type);var g=function(){c.prototype.initialize.apply(this,a.args)};g.prototype=c.prototype;var h=new g;"visibility"in a&&(h.visibility=a.visibility);var i=GeoExt.data.LayerRecord.create([{name:"name",type:"string"},{name:"source",
type:"string"},{name:"group",type:"string"},{name:"fixed",type:"boolean"},{name:"selected",type:"boolean"},{name:"type",type:"string"},{name:"args"},{name:"queryable",type:"boolean"}]),j={layer:h,title:h.name,name:a.name||h.name,source:a.source,group:a.group,fixed:"fixed"in a&&a.fixed,selected:"selected"in a&&a.selected,queryable:"queryable"in a&&a.queryable,type:a.type,args:a.args,properties:"properties"in a?a.properties:void 0};return b=new i(j,h.id)},getConfigForRecord:function(a){var b=gxp.plugins.OLSource.superclass.getConfigForRecord.apply(this,arguments);a.getLayer();return Ext.apply(b,{type:a.get("type"),args:a.get("args")})}}),Ext.preg(gxp.plugins.OLSource.prototype.ptype,gxp.plugins.OLSource),OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(a,b,c){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},CLASS_NAME:"OpenLayers.Layer.OSM"}),Ext.namespace("gxp.plugins"),gxp.plugins.OSMSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_osmsource",title:"OpenStreetMap Layers",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Data CC-By-SA by <a href='http://openstreetmap.org/' target='_blank'>OpenStreetMap</a>",createStore:function(){var a={projection:"EPSG:900913",maxExtent:new OpenLayers.Bounds(-20037508.3392,-20037508.3392,20037508.3392,20037508.3392),maxResolution:156543.03390625,numZoomLevels:19,units:"m",buffer:1,transitionEffect:"resize"},b=[new OpenLayers.Layer.OSM("OpenStreetMap",["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],OpenLayers.Util.applyDefaults({attribution:this.mapnikAttribution,type:"mapnik"},a))];this.store=new GeoExt.data.LayerStore({layers:b,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"type"},{name:"abstract",type:"string",mapping:"attribution"},{name:"group",type:"string",defaultValue:"background"},{name:"fixed",type:"boolean",defaultValue:!0},{name:"selected",type:"boolean"}]}),this.store.each(function(a){a.set("group","background")}),this.fireEvent("ready",this)},createLayerRecord:function(a){var b,c=this.store.findExact("name",a.name);if(c>-1){b=this.store.getAt(c).copy(Ext.data.Record.id({}));var d=b.getLayer().clone();a.title&&(d.setName(a.title),b.set("title",a.title)),"visibility"in a&&(d.visibility=a.visibility),b.set("selected",a.selected||!1),b.set("source",a.source),b.set("name",a.name),"group"in a&&b.set("group",a.group),b.data.layer=d,b.commit()}return b}}),Ext.preg(gxp.plugins.OSMSource.prototype.ptype,gxp.plugins.OSMSource),OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(a,b,c){var d=[];d.push(a,b,{},c),OpenLayers.Layer.Grid.prototype.initialize.apply(this,d)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=this.getServerResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w)),d=Math.round((a.bottom-this.tileOrigin.lat)/(b*this.tileSize.h)),e=this.getServerZoom(),f=this.serviceVersion+"/"+this.layername+"/"+e+"/"+c+"/"+d+"."+this.type,g=this.url;return OpenLayers.Util.isArray(g)&&(g=this.selectUrl(f,g)),g+f},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"}),Ext.namespace("gxp.plugins"),gxp.plugins.MapBoxSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_mapboxsource",title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldGlassTitle:"World Glass",worldPrintTitle:"World Print",createStore:function(){for(var e,a={projection:"EPSG:900913",numZoomLevels:19,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135],buffer:1},b=[{name:"blue-marble-topo-bathy-jan",numZoomLevels:9},{name:"blue-marble-topo-bathy-jul",numZoomLevels:9},{name:"blue-marble-topo-jan",numZoomLevels:9},{name:"blue-marble-topo-jul",numZoomLevels:9},{name:"control-room",numZoomLevels:9},{name:"geography-class",numZoomLevels:9},{name:"natural-earth-hypso",numZoomLevels:7},{name:"natural-earth-hypso-bathy",numZoomLevels:7},{name:"natural-earth-1",numZoomLevels:7},{name:"natural-earth-2",numZoomLevels:7},{name:"world-dark",numZoomLevels:12},{name:"world-light",numZoomLevels:12},{name:"world-glass",numZoomLevels:11},{name:"world-print",numZoomLevels:10}],c=b.length,d=new Array(c),f=0;f<c;++f)e=b[f],d[f]=new OpenLayers.Layer.TMS(this[OpenLayers.String.camelize(e.name)+"Title"],["http://a.tiles.mapbox.com/mapbox/","http://b.tiles.mapbox.com/mapbox/","http://c.tiles.mapbox.com/mapbox/","http://d.tiles.mapbox.com/mapbox/"],OpenLayers.Util.applyDefaults({attribution:/^world/.test(name)?"<a href='http://mapbox.com'>MapBox</a> | Some Data &copy; OSM CC-BY-SA | <a href='http://mapbox.com/tos'>Terms of Service</a>":"<a href='http://mapbox.com'>MapBox</a> | <a href='http://mapbox.com/tos'>Terms of Service</a>",type:"png",tileOrigin:new OpenLayers.LonLat(-20037508.34,-20037508.34),layername:e.name,abstract:'<div class="thumb-mapbox thumb-mapbox-'+e.name+'"></div>',numZoomLevels:e.numZoomLevels},a));this.store=new GeoExt.data.LayerStore({layers:d,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"layername"},{name:"abstract",type:"string"},{name:"group",type:"string"},{name:"fixed",type:"boolean"},{name:"selected",type:"boolean"}]}),this.fireEvent("ready",this)},createLayerRecord:function(a){var b,c=this.store.findExact("name",a.name);if(c>-1){b=this.store.getAt(c).copy(Ext.data.Record.id({}));var d=b.getLayer().clone();a.title&&(d.setName(a.title),b.set("title",a.title)),"visibility"in a&&(d.visibility=a.visibility),b.set("selected",a.selected||!1),b.set("source",a.source),b.set("name",a.name),"group"in a&&b.set("group",a.group),b.data.layer=d,b.commit()}return b}}),Ext.preg(gxp.plugins.MapBoxSource.prototype.ptype,gxp.plugins.MapBoxSource),Ext.namespace("gxp.plugins"),gxp.plugins.MapQuestSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_mapquestsource",title:"MapQuest Layers",osmAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest Imagery",createStore:function(){var a={projection:"EPSG:900913",maxExtent:new OpenLayers.Bounds(-20037508.3392,-20037508.3392,20037508.3392,20037508.3392),maxResolution:156543.03390625,numZoomLevels:19,units:"m",buffer:1,transitionEffect:"resize",tileOptions:{crossOriginKeyword:null}},b=[new OpenLayers.Layer.OSM(this.osmTitle,["http://otile1.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile2.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile3.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile4.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png"],OpenLayers.Util.applyDefaults({attribution:this.osmAttribution,type:"osm"},a)),new OpenLayers.Layer.OSM(this.naipTitle,["http://otile1.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.png","http://otile2.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.png","http://otile3.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.png","http://otile4.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.png"],OpenLayers.Util.applyDefaults({attribution:this.naipAttribution,type:"naip"},a))];this.store=new GeoExt.data.LayerStore({layers:b,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"type"},{name:"abstract",type:"string",mapping:"attribution"},{name:"group",type:"string",defaultValue:"background"},{name:"fixed",type:"boolean",defaultValue:!0},{name:"selected",type:"boolean"}]}),this.store.each(function(a){a.set("group","background")}),this.fireEvent("ready",this)},createLayerRecord:function(a){var b,c=this.store.findExact("name",a.name);if(c>-1){b=this.store.getAt(c).copy(Ext.data.Record.id({}));var d=b.getLayer().clone();a.title&&(d.setName(a.title),b.set("title",a.title)),"visibility"in a&&(d.visibility=a.visibility),b.set("selected",a.selected||!1),b.set("source",a.source),b.set("name",a.name),"group"in a&&b.set("group",a.group),b.data.layer=d,b.commit()}return b}}),Ext.preg(gxp.plugins.MapQuestSource.prototype.ptype,gxp.plugins.MapQuestSource),OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"}),OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=a;a&&9==a.nodeType&&(a=a.documentElement);var c={};if(this.readNode(a,c),void 0===c.service){var d=new OpenLayers.Format.OGCExceptionReport;c.error=d.read(b)}return c},readers:{wms:{Service:function(a,b){b.service={},this.readChildNodes(a,b.service)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.abstract=this.getChildValue(a)},BoundingBox:function(a,b){var c={};c.bbox=[parseFloat(a.getAttribute("minx")),parseFloat(a.getAttribute("miny")),parseFloat(a.getAttribute("maxx")),parseFloat(a.getAttribute("maxy"))];var d={x:parseFloat(a.getAttribute("resx")),y:parseFloat(a.getAttribute("resy"))};return isNaN(d.x)&&isNaN(d.y)||(c.res=d),c},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},ContactInformation:function(a,b){b.contactInformation={},this.readChildNodes(a,b.contactInformation)},ContactPersonPrimary:function(a,b){b.personPrimary={},this.readChildNodes(a,b.personPrimary)},ContactPerson:function(a,b){b.person=this.getChildValue(a)},ContactOrganization:function(a,b){b.organization=this.getChildValue(a)},ContactPosition:function(a,b){b.position=this.getChildValue(a)},ContactAddress:function(a,b){b.contactAddress={},this.readChildNodes(a,b.contactAddress)},AddressType:function(a,b){b.type=this.getChildValue(a)},Address:function(a,b){b.address=this.getChildValue(a)},City:function(a,b){b.city=this.getChildValue(a)},StateOrProvince:function(a,b){b.stateOrProvince=this.getChildValue(a)},PostCode:function(a,b){b.postcode=this.getChildValue(a)},Country:function(a,b){b.country=this.getChildValue(a)},ContactVoiceTelephone:function(a,b){b.phone=this.getChildValue(a)},ContactFacsimileTelephone:function(a,b){b.fax=this.getChildValue(a)},ContactElectronicMailAddress:function(a,b){b.email=this.getChildValue(a)},Fees:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.fees=c)},AccessConstraints:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.accessConstraints=c)},Capability:function(a,b){b.capability={nestedLayers:[],layers:[]},this.readChildNodes(a,b.capability)},Request:function(a,b){b.request={},this.readChildNodes(a,b.request)},GetCapabilities:function(a,b){b.getcapabilities={formats:[]},this.readChildNodes(a,b.getcapabilities)},Format:function(a,b){OpenLayers.Util.isArray(b.formats)?b.formats.push(this.getChildValue(a)):b.format=this.getChildValue(a)},DCPType:function(a,b){this.readChildNodes(a,b)},HTTP:function(a,b){this.readChildNodes(a,b)},Get:function(a,b){b.get={},this.readChildNodes(a,b.get),b.href||(b.href=b.get.href)},Post:function(a,b){b.post={},this.readChildNodes(a,b.post),b.href||(b.href=b.get.href)},GetMap:function(a,b){b.getmap={formats:[]},this.readChildNodes(a,b.getmap)},GetFeatureInfo:function(a,b){b.getfeatureinfo={formats:[]},this.readChildNodes(a,b.getfeatureinfo)},Exception:function(a,b){b.exception={formats:[]},this.readChildNodes(a,b.exception)},Layer:function(a,b){var c,d;b.capability?(d=b.capability,c=b):d=b;var e=a.getAttributeNode("queryable"),f=e&&e.specified?a.getAttribute("queryable"):null;e=a.getAttributeNode("cascaded");var g=e&&e.specified?a.getAttribute("cascaded"):null;e=a.getAttributeNode("opaque");var h=e&&e.specified?a.getAttribute("opaque"):null,i=a.getAttribute("noSubsets"),j=a.getAttribute("fixedWidth"),k=a.getAttribute("fixedHeight"),l=c||{},m=OpenLayers.Util.extend,n={nestedLayers:[],styles:c?[].concat(c.styles):[],srs:c?m({},l.srs):{},metadataURLs:[],bbox:c?m({},l.bbox):{},llbbox:l.llbbox,dimensions:c?m({},l.dimensions):{},authorityURLs:c?m({},l.authorityURLs):{},identifiers:{},keywords:[],queryable:f&&""!==f?"1"===f||"true"===f:l.queryable||!1,cascaded:null!==g?parseInt(g):l.cascaded||0,opaque:h?"1"===h||"true"===h:l.opaque||!1,noSubsets:null!==i?"1"===i||"true"===i:l.noSubsets||!1,fixedWidth:null!=j?parseInt(j):l.fixedWidth||0,fixedHeight:null!=k?parseInt(k):l.fixedHeight||0,minScale:l.minScale,maxScale:l.maxScale,attribution:l.attribution};if(b.nestedLayers.push(n),n.capability=d,this.readChildNodes(a,n),delete n.capability,n.name){var o=n.name.split(":"),p=d.request,q=p.getfeatureinfo;o.length>0&&(n.prefix=o[0]),d.layers.push(n),void 0===n.formats&&(n.formats=p.getmap.formats),void 0===n.infoFormats&&q&&(n.infoFormats=q.formats)}},Attribution:function(a,b){b.attribution={},this.readChildNodes(a,b.attribution)},LogoURL:function(a,b){b.logo={width:a.getAttribute("width"),height:a.getAttribute("height")},this.readChildNodes(a,b.logo)},Style:function(a,b){var c={};b.styles.push(c),this.readChildNodes(a,c)},LegendURL:function(a,b){var c={width:a.getAttribute("width"),height:a.getAttribute("height")};b.legend=c,this.readChildNodes(a,c)},MetadataURL:function(a,b){var c={type:a.getAttribute("type")};b.metadataURLs.push(c),this.readChildNodes(a,c)},DataURL:function(a,b){b.dataURL={},this.readChildNodes(a,b.dataURL)},FeatureListURL:function(a,b){b.featureListURL={},this.readChildNodes(a,b.featureListURL)},AuthorityURL:function(a,b){var c=a.getAttribute("name"),d={};this.readChildNodes(a,d),b.authorityURLs[c]=d.href},Identifier:function(a,b){var c=a.getAttribute("authority");b.identifiers[c]=this.getChildValue(a)},KeywordList:function(a,b){this.readChildNodes(a,b)},SRS:function(a,b){b.srs[this.getChildValue(a)]=!0}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"}),OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(a,b){this.readChildNodes(a,b)},Keyword:function(a,b){b.keywords&&b.keywords.push(this.getChildValue(a))},DescribeLayer:function(a,b){b.describelayer={formats:[]},this.readChildNodes(a,b.describelayer)},GetLegendGraphic:function(a,b){b.getlegendgraphic={formats:[]},this.readChildNodes(a,b.getlegendgraphic)},GetStyles:function(a,b){b.getstyles={formats:[]},this.readChildNodes(a,b.getstyles)},PutStyles:function(a,b){b.putstyles={formats:[]},this.readChildNodes(a,b.putstyles)},UserDefinedSymbolization:function(a,b){var c={supportSLD:1==parseInt(a.getAttribute("SupportSLD")),userLayer:1==parseInt(a.getAttribute("UserLayer")),userStyle:1==parseInt(a.getAttribute("UserStyle")),remoteWFS:1==parseInt(a.getAttribute("RemoteWFS"))};b.userSymbols=c},LatLonBoundingBox:function(a,b){b.llbbox=[parseFloat(a.getAttribute("minx")),parseFloat(a.getAttribute("miny")),parseFloat(a.getAttribute("maxx")),parseFloat(a.getAttribute("maxy"))]},BoundingBox:function(a,b){var c=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);c.srs=a.getAttribute("SRS"),b.bbox[c.srs]=c},ScaleHint:function(a,b){var c=a.getAttribute("min"),d=a.getAttribute("max"),e=Math.pow(2,.5),f=OpenLayers.INCHES_PER_UNIT.m;0!=c&&(b.maxScale=parseFloat((c/e*f*OpenLayers.DOTS_PER_INCH).toPrecision(13))),d!=Number.POSITIVE_INFINITY&&(b.minScale=parseFloat((d/e*f*OpenLayers.DOTS_PER_INCH).toPrecision(13)))},Dimension:function(a,b){var c=a.getAttribute("name").toLowerCase(),d={name:c,units:a.getAttribute("units"),unitsymbol:a.getAttribute("unitSymbol")};b.dimensions[d.name]=d},Extent:function(a,b){var c=a.getAttribute("name").toLowerCase();if(c in b.dimensions){var d=b.dimensions[c];d.nearestVal="1"===a.getAttribute("nearestValue"),d.multipleVal="1"===a.getAttribute("multipleValues"),d.current="1"===a.getAttribute("current"),d.default=a.getAttribute("default")||"";var e=this.getChildValue(a);d.values=e.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"}),OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(a,b){for(var c=this.getChildValue(a),d=c.split(/ +/),e=0,f=d.length;e<f;e++)b.srs[d[e]]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"}),OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(a,b){b.srs[this.getChildValue(a)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"}),OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(a,b){this.readChildNodes(a,b)},LayerLimit:function(a,b){b.layerLimit=parseInt(this.getChildValue(a))},MaxWidth:function(a,b){b.maxWidth=parseInt(this.getChildValue(a))},MaxHeight:function(a,b){b.maxHeight=parseInt(this.getChildValue(a))},BoundingBox:function(a,b){var c=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);c.srs=a.getAttribute("CRS"),b.bbox[c.srs]=c},CRS:function(a,b){this.readers.wms.SRS.apply(this,[a,b])},EX_GeographicBoundingBox:function(a,b){b.llbbox=[],this.readChildNodes(a,b.llbbox)},westBoundLongitude:function(a,b){b[0]=this.getChildValue(a)},eastBoundLongitude:function(a,b){b[2]=this.getChildValue(a)},southBoundLatitude:function(a,b){b[1]=this.getChildValue(a)},northBoundLatitude:function(a,b){b[3]=this.getChildValue(a)},MinScaleDenominator:function(a,b){b.maxScale=parseFloat(this.getChildValue(a)).toPrecision(16)},MaxScaleDenominator:function(a,b){b.minScale=parseFloat(this.getChildValue(a)).toPrecision(16)},Dimension:function(a,b){var c=a.getAttribute("name").toLowerCase(),d={name:c,units:a.getAttribute("units"),unitsymbol:a.getAttribute("unitSymbol"),nearestVal:"1"===a.getAttribute("nearestValue"),multipleVal:"1"===a.getAttribute("multipleValues"),default:a.getAttribute("default")||"",current:"1"===a.getAttribute("current"),values:this.getChildValue(a).split(",")};b.dimensions[d.name]=d},Keyword:function(a,b){var c={value:this.getChildValue(a),vocabulary:a.getAttribute("vocabulary")};b.keywords&&b.keywords.push(c)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(a,b){this.readers.wms.UserDefinedSymbolization.apply(this,[a,b]),b.userSymbols.inlineFeature=1==parseInt(a.getAttribute("InlineFeature")),b.userSymbols.remoteWCS=1==parseInt(a.getAttribute("RemoteWCS"))},DescribeLayer:function(a,b){this.readers.wms.DescribeLayer.apply(this,[a,b])},GetLegendGraphic:function(a,b){this.readers.wms.GetLegendGraphic.apply(this,[a,b])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"}),OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"}),Ext.namespace("GeoExt.data"),GeoExt.data.WMSCapabilitiesReader=function(a,b){a=a||{},a.format||(a.format=new OpenLayers.Format.WMSCapabilities),"function"!=typeof b&&(b=GeoExt.data.LayerRecord.create(b||a.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"abstract",type:"string"},{name:"queryable",type:"boolean"},{name:"opaque",type:"boolean"},{name:"noSubsets",type:"boolean"},{name:"cascaded",type:"int"},{name:"fixedWidth",type:"int"},{name:"fixedHeight",type:"int"},{name:"minScale",type:"float"},{name:"maxScale",type:"float"},{name:"prefix",type:"string"},{name:"formats"},{name:"styles"},{name:"srs"},{name:"dimensions"},{name:"bbox"},{name:"llbbox"},{name:"attribution"},{name:"keywords"},{name:"identifiers"},{name:"authorityURLs"},{name:"metadataURLs"},{name:"infoFormats"}])),GeoExt.data.WMSCapabilitiesReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.WMSCapabilitiesReader,Ext.data.DataReader,{attributionCls:"gx-attribution",read:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),this.readRecords(b)},serviceExceptionFormat:function(a){return OpenLayers.Util.indexOf(a,"application/vnd.ogc.se_inimage")>-1?"application/vnd.ogc.se_inimage":OpenLayers.Util.indexOf(a,"application/vnd.ogc.se_xml")>-1?"application/vnd.ogc.se_xml":a[0]},imageFormat:function(a){var b=a.formats;return a.opaque&&OpenLayers.Util.indexOf(b,"image/jpeg")>-1?"image/jpeg":OpenLayers.Util.indexOf(b,"image/png")>-1?"image/png":OpenLayers.Util.indexOf(b,"image/png; mode=24bit")>-1?"image/png; mode=24bit":OpenLayers.Util.indexOf(b,"image/gif")>-1?"image/gif":b[0]},imageTransparent:function(a){return void 0==a.opaque||!a.opaque},readRecords:function(a){if(("string"==typeof a||a.nodeType)&&(a=this.meta.format.read(a)),a.error)throw new Ext.data.DataReader.Error("invalid-response",a.error);var b=a.version,c=a.capability||{},d=c.request&&c.request.getmap&&c.request.getmap.href,e=c.layers,f=c.exception?c.exception.formats:[],g=this.serviceExceptionFormat(f),h=[];if(d&&e)for(var j,k,l,m,n,o,i=this.recordType.prototype.fields,p=0,q=e.length;p<q;p++)if(j=e[p],j.name){k={};for(var r=0,s=i.length;r<s;r++)n=i.items[r],o=j[n.mapping||n.name]||n.defaultValue,o=n.convert(o),k[n.name]=o;l={attribution:j.attribution?this.attributionMarkup(j.attribution):void 0,minScale:j.minScale,maxScale:j.maxScale},this.meta.layerOptions&&Ext.apply(l,this.meta.layerOptions),m={layers:j.name,exceptions:g,format:this.imageFormat(j),transparent:this.imageTransparent(j),version:b},this.meta.layerParams&&Ext.apply(m,this.meta.layerParams),k.layer=new OpenLayers.Layer.WMS(j.title||j.name,d,m,l),h.push(new this.recordType(k,k.layer.id))}return{totalRecords:h.length,success:!0,records:h}},attributionMarkup:function(a){var b=[];if(a.logo&&b.push("<img class='"+this.attributionCls+"-image' src='"+a.logo.href+"' />"),a.title&&b.push("<span class='"+this.attributionCls+"-title'>"+a.title+"</span>"),a.href)for(var c=0;c<b.length;c++)b[c]="<a class='"+this.attributionCls+"-link' href="+a.href+">"+b[c]+"</a>";return b.join(" ")}}),Ext.namespace("GeoExt.data"),GeoExt.data.WMSCapabilitiesStore=function(a){a=a||{},GeoExt.data.WMSCapabilitiesStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(a.data?void 0:new Ext.data.HttpProxy({url:a.url,disableCaching:!1,method:"GET"})),reader:new GeoExt.data.WMSCapabilitiesReader(a,a.fields)}))},Ext.extend(GeoExt.data.WMSCapabilitiesStore,Ext.data.Store),Ext.namespace("GeoExt.data"),GeoExt.data.WMSDescribeLayerStore=function(a){a=a||{},GeoExt.data.WMSDescribeLayerStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(a.data?void 0:new Ext.data.HttpProxy({url:a.url,disableCaching:!1,method:"GET"})),reader:new GeoExt.data.WMSDescribeLayerReader(a,a.fields)}))},Ext.extend(GeoExt.data.WMSDescribeLayerStore,Ext.data.Store),function(){function a(a){var b=this.meta.format;if("string"==typeof a||a.nodeType){a=b.read(a);var c=b.read;b.read=function(){return b.read=c,a}}this.raw=a}Ext.intercept(GeoExt.data.WMSCapabilitiesReader.prototype,"readRecords",a),GeoExt.data.AttributeReader&&Ext.intercept(GeoExt.data.AttributeReader.prototype,"readRecords",a)}(),Ext.namespace("gxp.plugins"),gxp.plugins.WMSSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_wmssource",baseParams:null,format:null,describeLayerStore:null,describedLayers:null,schemaCache:null,ready:!1,requiredProperties:["title","bbox"],constructor:function(a){a&&a.forceLazy===!0&&(a.requiredProperties=[],delete a.forceLazy,window.console&&console.warn("Deprecated config option 'forceLazy: true' for layer source '"+a.id+"'. Use 'requiredProperties: []' instead.")),gxp.plugins.WMSSource.superclass.constructor.apply(this,arguments),this.format||(this.format=new OpenLayers.Format.WMSCapabilities({keepData:!0}))},init:function(a){gxp.plugins.WMSSource.superclass.init.apply(this,arguments),this.target.on("authorizationchange",this.onAuthorizationChange,this)},onAuthorizationChange:function(){if(this.disabled!==!0&&this.store&&"/"===this.url.charAt(0)){var a=this.store.lastOptions||{params:{}};Ext.apply(a.params,{_dc:Math.random()}),this.store.reload(a)}},destroy:function(){this.target.un("authorizationchange",this.onAuthorizationChange,this),gxp.plugins.WMSSource.superclass.destroy.apply(this,arguments)},isLazy:function(){var a=!0,b=this.target.initialConfig.map;if(b&&b.layers)for(var c,d=0,e=b.layers.length;d<e&&(c=b.layers[d],c.source!==this.id||(a=this.layerConfigComplete(c),a!==!1));++d);return a},layerConfigComplete:function(a){var b=!0;if(!Ext.isObject(a.capability))for(var c=this.requiredProperties,d=c.length-1;d>=0&&(b=!!a[c[d]],b!==!1);--d);return b},createStore:function(){var a=this.baseParams||{SERVICE:"WMS",REQUEST:"GetCapabilities"};this.version&&(a.VERSION=this.version);var b=this.isLazy();this.store=new GeoExt.data.WMSCapabilitiesStore({url:this.trimUrl(this.url,a),baseParams:a,format:this.format,autoLoad:!b,layerParams:{exceptions:null},listeners:{load:function(){this.store.reader.raw&&this.store.reader.raw.service?(this.title||(this.title=this.store.reader.raw.service.title),this.ready?this.lazy=!1:(this.ready=!0,this.fireEvent("ready",this))):this.fireEvent("failure",this,"Invalid capabilities document."),delete this.format.data},exception:function(a,b,c,d,e,f){delete this.store;var g,h="";if("response"===b)if("string"==typeof f)g=f;else{g="Invalid response from server.";var i=this.format&&this.format.data;i&&i.parseError&&(g+="  "+i.parseError.reason+" - line: "+i.parseError.line);var j=e.status;if(j>=200&&j<300){var k=f&&f.arg&&f.arg.exceptionReport;h=gxp.util.getOGCExceptionText(k)}else h="Status: "+j}else g="Trouble creating layer store from response.",h="Unable to handle response.";this.fireEvent("failure",this,g,h),delete this.format.data},scope:this}}),b&&(this.lazy=b,this.ready=!0,this.fireEvent("ready",this))},trimUrl:function(a,b,c){var d=OpenLayers.Util.getParameters(a);b=OpenLayers.Util.upperCaseObject(b);var e=0;for(var f in d)++e,f.toUpperCase()in b&&(--e,delete d[f]);return a.split("?").shift()+(e?"?"+OpenLayers.Util.getParameterString(d):"")},createLazyLayerRecord:function(a){a=Ext.apply({},a);var b=a.srs||this.target.map.projection;a.srs={},a.srs[b]=!0;var c=a.bbox||this.target.map.maxExtent||OpenLayers.Projection.defaults[b].maxExtent;a.bbox={},a.bbox[b]={bbox:c};var d;return d=this.store&&this.store instanceof GeoExt.data.WMSCapabilitiesStore?new this.store.recordType(a):new GeoExt.data.LayerRecord(a),d.setLayer(new OpenLayers.Layer.WMS(a.title||a.name,a.url||this.url,{layers:a.name,transparent:!("transparent"in a)||a.transparent,cql_filter:a.cql_filter,format:a.format},{projection:b,eventListeners:{tileloaded:this.countAlive,tileerror:this.countAlive,scope:this}})),d.json=a,d},countAlive:function(a){"_alive"in a.object.metadata||(a.object.metadata._alive=0,a.object.events.register("loadend",this,this.removeDeadLayer)),a.object.metadata._alive+="tileerror"==a.type?-1:1},removeDeadLayer:function(a){a.object.events.un({tileloaded:this.countAlive,tileerror:this.countAlive,loadend:this.removeDeadLayer,scope:this}),0===a.object.metadata._alive&&(this.target.mapPanel.map.removeLayer(a.object),window.console&&console.debug("Unavailable layer "+a.object.name+" removed.")),delete a.object.metadata._alive},createLayerRecord:function(a){var b,c,d=this.store.findExact("name",a.name);if(d>-1?c=this.store.getAt(d):Ext.isObject(a.capability)?c=this.store.reader.readRecords({capability:{request:{getmap:{href:this.trimUrl(this.url,this.baseParams)}},layers:[a.capability]}}).records[0]:this.layerConfigComplete(a)&&(c=this.createLazyLayerRecord(a)),c){var e=c.getLayer().clone(),f=this.getMapProjection(),g=this.getProjection(c);g&&e.addOptions({projection:g});var j,h=(g||f).getCode(),i=c.get("bbox");if(i&&i[h])j=OpenLayers.Bounds.fromArray(i[h].bbox,e.reverseAxisOrder());else{var k=c.get("llbbox");k&&(k[0]=Math.max(k[0],-180),k[1]=Math.max(k[1],-90),k[2]=Math.min(k[2],180),k[3]=Math.min(k[3],90),j=OpenLayers.Bounds.fromArray(k).transform("EPSG:4326",f))}e.mergeNewParams({STYLES:a.styles,FORMAT:a.format,TRANSPARENT:a.transparent,CQL_FILTER:a.cql_filter});var l=!1;"tiled"in a?l=!a.tiled:c.data.dimensions&&c.data.dimensions.time&&(l=!0),e.setName(a.title||e.name),e.addOptions({attribution:e.attribution||a.attribution,maxExtent:j,restrictedExtent:j,singleTile:l,ratio:a.ratio||1,visibility:!("visibility"in a)||a.visibility,opacity:"opacity"in a?a.opacity:1,buffer:"buffer"in a?a.buffer:1,dimensions:c.data.dimensions,transitionEffect:l?"resize":null,minScale:a.minscale,maxScale:a.maxscale});var m=Ext.applyIf({title:e.name,group:a.group,infoFormat:a.infoFormat,getFeatureInfo:a.getFeatureInfo,source:a.source,properties:"gxp_wmslayerpanel",fixed:a.fixed,selected:"selected"in a&&a.selected,restUrl:this.restUrl,layer:e},c.data),n=[{name:"source",type:"string"},{name:"group",type:"string"},{name:"properties",type:"string"},{name:"fixed",type:"boolean"},{name:"selected",type:"boolean"},{name:"restUrl",type:"string"},{name:"infoFormat",type:"string"},{name:"getFeatureInfo"}];c.fields.each(function(a){n.push(a)});var o=GeoExt.data.LayerRecord.create(n);b=new o(m,e.id),b.json=a}else window.console&&this.store.getCount()>0&&void 0!==a.name&&console.warn("Could not create layer record for layer '"+a.name+"'. Check if the layer is found in the WMS GetCapabilities response.");return b},getProjection:function(a){var b=this.getMapProjection(),c=b,d=a.get("srs");if(!d[b.getCode()]){c=null;var e,f;for(f in d)if((e=new OpenLayers.Projection(f)).equals(b)){c=e;break}}return c},initDescribeLayerStore:function(){var a=this.store.reader.raw;this.lazy&&(a={capability:{request:{describelayer:{href:this.url}}},version:this.version||"1.1.1"
});var b=a.capability.request.describelayer;if(b){var c=a.version;parseFloat(c)>1.1&&(c="1.1.1");var d={SERVICE:"WMS",VERSION:c,REQUEST:"DescribeLayer"};this.describeLayerStore=new GeoExt.data.WMSDescribeLayerStore({url:this.trimUrl(b.href,d),baseParams:d})}},describeLayer:function(a,b,c){function d(a){window.setTimeout(function(){b.call(c,a)},0)}if(this.describeLayerStore||this.initDescribeLayerStore(),!this.describeLayerStore)return void d(!1);this.describedLayers||(this.describedLayers={});var h,e=a.getLayer().params.LAYERS,f=function(){for(var d,f,a=Ext.isArray(arguments[1])?arguments[1]:arguments[0],h=a.length-1;h>=0;h--){if(d=a[h],f=d.get("layerName"),f==e)return this.describeLayerStore.un("load",arguments.callee,this),this.describedLayers[f]=!0,void b.call(c,d);if("function"==typeof this.describedLayers[f]){var i=this.describedLayers[f];this.describeLayerStore.un("load",i,this),i.apply(this,arguments)}}delete g[e],b.call(c,!1)},g=this.describedLayers;g[e]?(h=this.describeLayerStore.findExact("layerName",e))==-1?this.describeLayerStore.on("load",f,this):d(this.describeLayerStore.getAt(h)):(g[e]=f,this.describeLayerStore.load({params:{LAYERS:e},add:!0,callback:f,scope:this}))},fetchSchema:function(a,b,c,d){var e=this.schemaCache[b];e?0==e.getCount()?e.on("load",function(){c.call(d,e)},this,{single:!0}):c.call(d,e):(e=new GeoExt.data.AttributeStore({url:a,baseParams:{SERVICE:"WFS",VERSION:"1.1.0",REQUEST:"DescribeFeatureType",TYPENAME:b},autoLoad:!0,listeners:{load:function(){c.call(d,e)},scope:this}}),this.schemaCache[b]=e)},getSchema:function(a,b,c){this.schemaCache||(this.schemaCache={}),this.describeLayer(a,function(d){if(d&&"WFS"==d.get("owsType")){var e=d.get("typeName"),f=d.get("owsURL");this.fetchSchema(f,e,b,c)}else d?b.call(c,!1):this.fetchSchema(this.url,a.get("name"),b,c)},this)},getWFSProtocol:function(a,b,c){this.getSchema(a,function(d){var e=!1;if(d){var f,g=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/;d.each(function(a){var b=g.exec(a.get("type"));b&&(f=a.get("name"))},this),e=new OpenLayers.Protocol.WFS({version:"1.1.0",srsName:a.getLayer().projection.getCode(),url:d.url,featureType:d.reader.raw.featureTypes[0].typeName,featureNS:d.reader.raw.targetNamespace,geometryName:f})}b.call(c,e,d,a)},this)},getConfigForRecord:function(a){var b=Ext.applyIf(gxp.plugins.WMSSource.superclass.getConfigForRecord.apply(this,arguments),a.json),c=a.getLayer(),d=c.params,e=c.options,f=b.name,g=this.store.reader.raw;if(g)for(var h=g.capability.layers,i=h.length-1;i>=0;--i)if(h[i].name===f){b.capability=Ext.apply({},h[i]);var j={};j[c.projection.getCode()]=!0,b.capability.srs=j;break}return b.capability||(c.maxExtent&&(b.bbox=c.maxExtent.toArray()),b.srs=c.projection.getCode()),Ext.apply(b,{format:d.FORMAT,styles:d.STYLES,tiled:!e.singleTile,transparent:d.TRANSPARENT,cql_filter:d.CQL_FILTER,minscale:e.minScale,maxscale:e.maxScale,infoFormat:a.get("infoFormat"),attribution:c.attribution})},disable:function(){this.disabled=!0},getState:function(){var a=gxp.plugins.WMSSource.superclass.getState.apply(this,arguments);return Ext.applyIf(a,{title:this.title})}}),Ext.preg(gxp.plugins.WMSSource.prototype.ptype,gxp.plugins.WMSSource),Ext.namespace("gxp.plugins"),gxp.plugins.CatalogueSource=Ext.extend(gxp.plugins.WMSSource,{url:null,yx:null,title:null,lazy:!0,hidden:!0,proxyOptions:null,describeLayer:function(a,b,c){var d=Ext.data.Record.create([{name:"owsType",type:"string"},{name:"owsURL",type:"string"},{name:"typeName",type:"string"}]),e=new d({owsType:"WFS",owsURL:a.get("url"),typeName:a.get("name")});b.call(c,e)},destroy:function(){this.store&&this.store.destroy(),this.store=null,gxp.plugins.CatalogueSource.superclass.destroy.apply(this,arguments)}}),OpenLayers.Format.CSWGetRecords=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.CSWGetRecords.DEFAULTS);var b=OpenLayers.Format.CSWGetRecords["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSWGetRecords version: "+a.version;return new b(a)},OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"},OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",xmlns:"http://www.w3.org/2000/xmlns/"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{csw:{GetRecordsResponse:function(a,b){b.records=[],this.readChildNodes(a,b);var c=this.getAttributeNS(a,"","version");""!=c&&(b.version=c)},RequestId:function(a,b){b.RequestId=this.getChildValue(a)},SearchStatus:function(a,b){b.SearchStatus={};var c=this.getAttributeNS(a,"","timestamp");""!=c&&(b.SearchStatus.timestamp=c)},SearchResults:function(a,b){this.readChildNodes(a,b);for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)"numberOfRecordsMatched"==c[e].name||"numberOfRecordsReturned"==c[e].name||"nextRecord"==c[e].name?d[c[e].name]=parseInt(c[e].nodeValue):d[c[e].name]=c[e].nodeValue;b.SearchResults=d},SummaryRecord:function(a,b){var c={type:"SummaryRecord"};this.readChildNodes(a,c),b.records.push(c)},BriefRecord:function(a,b){var c={type:"BriefRecord"};this.readChildNodes(a,c),b.records.push(c)},DCMIRecord:function(a,b){var c={type:"DCMIRecord"};this.readChildNodes(a,c),b.records.push(c)},Record:function(a,b){var c={type:"Record"};this.readChildNodes(a,c),b.records.push(c)},"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();b[c]=this.getChildValue(a)}},geonet:{info:function(a,b){var c={};this.readChildNodes(a,c),b.gninfo=c}},dc:{"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();OpenLayers.Util.isArray(b[c])||(b[c]=[]);for(var d={},e=a.attributes,f=0,g=e.length;f<g;++f)d[e[f].name]=e[f].nodeValue;d.value=this.getChildValue(a),""!=d.value&&b[c].push(d)}},dct:{"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();OpenLayers.Util.isArray(b[c])||(b[c]=[]),b[c].push(this.getChildValue(a))}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(a,b){b.bounds&&(b.BoundingBox=[{crs:b.projection,value:[b.bounds.left,b.bounds.bottom,b.bounds.right,b.bounds.top]}],delete b.projection,delete b.bounds),OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(a){var b=this.writeNode("csw:GetRecords",a);return this.setAttributeNS(b,this.namespaces.xmlns,"xmlns:gmd",this.namespaces.gmd),OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{csw:{GetRecords:function(a){a||(a={});var b=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:a.requestId||this.requestId,resultType:a.resultType||this.resultType,outputFormat:a.outputFormat||this.outputFormat,outputSchema:a.outputSchema||this.outputSchema,startPosition:a.startPosition||this.startPosition,maxRecords:a.maxRecords||this.maxRecords}});(a.DistributedSearch||this.DistributedSearch)&&this.writeNode("csw:DistributedSearch",a.DistributedSearch||this.DistributedSearch,b);var c=a.ResponseHandler||this.ResponseHandler;if(OpenLayers.Util.isArray(c)&&c.length>0)for(var d=0,e=c.length;d<e;d++)this.writeNode("csw:ResponseHandler",c[d],b);return this.writeNode("Query",a.Query||this.Query,b),b},DistributedSearch:function(a){var b=this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:a.hopCount}});return b},ResponseHandler:function(a){var b=this.createElementNSPlus("csw:ResponseHandler",{value:a.value});return b},Query:function(a){a||(a={});var b=this.createElementNSPlus("csw:Query",{attributes:{typeNames:a.typeNames||"csw:Record"}}),c=a.ElementName;if(OpenLayers.Util.isArray(c)&&c.length>0)for(var d=0,e=c.length;d<e;d++)this.writeNode("csw:ElementName",c[d],b);else this.writeNode("csw:ElementSetName",a.ElementSetName||{value:"summary"},b);return a.Constraint&&this.writeNode("csw:Constraint",a.Constraint,b),a.SortBy&&this.writeNode("ogc:SortBy",a.SortBy,b),b},ElementName:function(a){var b=this.createElementNSPlus("csw:ElementName",{value:a.value});return b},ElementSetName:function(a){var b=this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:a.typeNames},value:a.value});return b},Constraint:function(a){var b=this.createElementNSPlus("csw:Constraint",{attributes:{version:a.version}});if(a.Filter){var c=new OpenLayers.Format.Filter({version:a.version});b.appendChild(c.write(a.Filter))}else if(a.CqlText){var d=this.createElementNSPlus("CqlText",{value:a.CqlText.value});b.appendChild(d)}return b}},ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"}),Ext.namespace("GeoExt.data"),GeoExt.data.CSWRecordsReader=function(a,b){a=a||{},a.format||(a.format=new OpenLayers.Format.CSWGetRecords),a.root||(a.root="records"),GeoExt.data.CSWRecordsReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.CSWRecordsReader,Ext.data.JsonReader,{read:function(a){var b=a.data;return b||(b=a.responseXML,b&&b.documentElement||(b=a.responseText)),this.readRecords(b)},readRecords:function(a){if(("string"==typeof a||a.nodeType)&&(a=this.meta.format.read(a)),a.success===!1)throw new Ext.data.DataReader.Error("invalid-response",a);var b=GeoExt.data.CSWRecordsReader.superclass.readRecords.call(this,a);return Ext.each(b.records,function(a){for(var b in a.data){var c=a.data[b];if(c instanceof Array)for(var d=0,e=c.length;d<e;++d)if(c[d]instanceof Object){var f=0;for(var g in c[d])c[d].hasOwnProperty(g)&&f++;1===f&&c[d].value&&(c[d]=c[d].value)}}}),a.SearchResults&&(b.totalRecords=a.SearchResults.numberOfRecordsMatched),b}}),OpenLayers.Protocol.CSW=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.CSW.DEFAULTS);var b=OpenLayers.Protocol.CSW["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSW version: "+a.version;return new b(a)},OpenLayers.Protocol.CSW.DEFAULTS={version:"2.0.2"},OpenLayers.Protocol.CSW.v2_0_2=OpenLayers.Class(OpenLayers.Protocol,{formatOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]),a.format||(this.format=new OpenLayers.Format.CSWGetRecords.v2_0_2(OpenLayers.Util.extend({},this.formatOptions)))},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){a=OpenLayers.Util.extend({},a),OpenLayers.Util.applyDefaults(a,this.options||{});var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=this.format.write(a.params||a);return b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers,data:c}),b},handleRead:function(a,b){if(b.callback){var c=a.priv;c.status>=200&&c.status<300?(a.data=this.parseData(c),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,b.callback.call(b.scope,a)}},parseData:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),!b||b.length<=0?null:this.format.read(b)},CLASS_NAME:"OpenLayers.Protocol.CSW.v2_0_2"}),Ext.namespace("gxp.plugins"),gxp.plugins.CSWCatalogueSource=Ext.extend(gxp.plugins.CatalogueSource,{ptype:"gxp_cataloguesource",createStore:function(){this.store=new Ext.data.Store({proxy:new GeoExt.data.ProtocolProxy(Ext.apply({setParamsAsOptions:!0,protocol:new OpenLayers.Protocol.CSW({url:this.url})},this.proxyOptions||{})),reader:new GeoExt.data.CSWRecordsReader({fields:["title","abstract","URI","bounds","projection","references"]})}),gxp.plugins.LayerSource.prototype.createStore.apply(this,arguments)},getPagingStart:function(){return 1},getPagingParamNames:function(){return{start:"startPosition",limit:"maxRecords"}},getFullFilter:function(a,b){var c=[];return void 0!==a&&c.push(a),c=c.concat(b),c.length<=1?c[0]:new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:c})},filter:function(a){var b=void 0;""!==a.queryString&&(b=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,matchCase:!1,property:"csw:AnyText",value:"*"+a.queryString+"*"}));var c={resultType:"results",maxRecords:a.limit,Query:{typeNames:"gmd:MD_Metadata",ElementSetName:{value:"full"}}},d=this.getFullFilter(b,a.filters);void 0!==d&&Ext.apply(c.Query,{Constraint:{version:"1.1.0",Filter:d}}),Ext.apply(this.store.baseParams,c),this.store.load()}}),Ext.preg(gxp.plugins.CSWCatalogueSource.prototype.ptype,gxp.plugins.CSWCatalogueSource),Ext.namespace("gxp.plugins"),gxp.plugins.QueryForm=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_queryform",featureManager:null,autoHide:!1,schema:null,queryActionText:"Query",cancelButtonText:"Cancel",queryMenuText:"Query layer",queryActionTip:"Query the selected layer",queryByLocationText:"Query by current map extent",queryByAttributesText:"Query by attributes",queryMsg:"Querying...",noFeaturesTitle:"No Match",noFeaturesMessage:"Your query did not return any results.",outputAction:0,autoExpand:null,addActions:function(a){this.initialConfig.actions||a||(a=[{text:this.queryActionText,menuText:this.queryMenuText,iconCls:"gxp-icon-find",tooltip:this.queryActionTip,disabled:!0,toggleGroup:this.toggleGroup,enableToggle:!0,allowDepress:!0,toggleHandler:function(a,b){if(this.autoExpand&&this.output.length>0){var c=Ext.getCmp(this.autoExpand);c[b?"expand":"collapse"](),b?(c.expand(),c.ownerCt&&c.ownerCt instanceof Ext.Panel&&c.ownerCt.expand()):this.target.tools[this.featureManager].loadFeatures()}},scope:this}]),this.actions=gxp.plugins.QueryForm.superclass.addActions.apply(this,a),null!==this.actionTarget&&this.actions&&this.target.tools[this.featureManager].on("layerchange",function(a,b,c){for(var d=this.actions.length-1;d>=0;--d)this.actions[d].setDisabled(!c)},this)},addOutput:function(a){function f(){e&&(d.un("expand",f),d.un("collapse",f),d=null),e=!0}var b=this.target.tools[this.featureManager];a=Ext.apply({border:!1,bodyStyle:"padding: 10px",layout:"form",width:320,autoScroll:!0,items:[{xtype:"fieldset",ref:"spatialFieldset",title:this.queryByLocationText,anchor:"97%",style:"margin-bottom:0; border-left-color:transparent; border-right-color:transparent; border-width:1px 1px 0 1px; padding-bottom:0",checkboxToggle:!0},{xtype:"fieldset",ref:"attributeFieldset",title:this.queryByAttributesText,anchor:"97%",style:"margin-bottom:0",checkboxToggle:!0}],bbar:["->",{text:this.cancelButtonText,iconCls:"cancel",handler:function(){var a=this.outputTarget?c.ownerCt:c.ownerCt.ownerCt;a&&a instanceof Ext.Window&&a.hide(),g(b,b.layerRecord,b.schema),b.loadFeatures()}},{text:this.queryActionText,iconCls:"gxp-icon-find",handler:function(){var a=[];if(c.spatialFieldset.collapsed!==!0&&a.push(new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:b.featureStore.geometryName,value:this.target.mapPanel.map.getExtent()})),c.attributeFieldset.collapsed!==!0){var d=c.filterBuilder.getFilter();d&&a.push(d)}b.loadFeatures(a.length>1?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:a}):a[0])},scope:this}]},a||{});var c=gxp.plugins.QueryForm.superclass.addOutput.call(this,a),d=null,e=!0;this.autoExpand&&(d=Ext.getCmp(this.autoExpand),d.on({expand:f,collapse:f}));var g=function(a,b,f){c.attributeFieldset.removeAll(),c.setDisabled(!f),d&&(e=!1,d[f?"expand":"collapse"](),f&&d&&d.ownerCt&&d.ownerCt instanceof Ext.Panel&&d.ownerCt.expand()),f?(c.attributeFieldset.add({xtype:"gxp_filterbuilder",ref:"../filterBuilder",attributes:f,allowBlank:!0,allowGroups:!1}),c.spatialFieldset.expand(),c.attributeFieldset.expand()):(c.attributeFieldset.rendered&&c.attributeFieldset.collapse(),c.spatialFieldset.rendered&&c.spatialFieldset.collapse()),c.attributeFieldset.doLayout()};return b.on("layerchange",g),g(b,b.layerRecord,b.schema),b.on({beforequery:function(){new Ext.LoadMask(c.getEl(),{store:b.featureStore,msg:this.queryMsg}).show()},query:function(a,b){if(b&&null!==this.target.tools[this.featureManager].featureStore&&(b.getCount()||Ext.Msg.show({title:this.noFeaturesTitle,msg:this.noFeaturesMessage,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO}),this.autoHide)){var d=this.outputTarget?c.ownerCt:c.ownerCt.ownerCt;d instanceof Ext.Window&&d.hide()}},scope:this}),c}}),Ext.preg(gxp.plugins.QueryForm.prototype.ptype,gxp.plugins.QueryForm),Ext.namespace("GeoExt.data"),GeoExt.data.WMSDescribeLayerReader=function(a,b){a=a||{},a.format||(a.format=new OpenLayers.Format.WMSDescribeLayer),"function"!=typeof b&&(b=Ext.data.Record.create(b||a.fields||[{name:"owsType",type:"string"},{name:"owsURL",type:"string"},{name:"typeName",type:"string"}])),GeoExt.data.WMSDescribeLayerReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.WMSDescribeLayerReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),this.readRecords(b)},readRecords:function(a){if(("string"==typeof a||a.nodeType)&&(a=this.meta.format.read(a)),a.error)throw new Ext.data.DataReader.Error("invalid-response",a.error);for(var c,b=[],d=0,e=a.length;d<e;d++)c=a[d],c&&b.push(new this.recordType(c));return{totalRecords:b.length,success:!0,records:b}}}),OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:OpenLayers.Util.applyDefaults({VendorSpecificCapabilities:function(a,b){b.vendorSpecific={tileSets:[]},this.readChildNodes(a,b.vendorSpecific)},TileSet:function(a,b){var c={srs:{},bbox:{},resolutions:[]};this.readChildNodes(a,c),b.tileSets.push(c)},Resolutions:function(a,b){for(var c=this.getChildValue(a).split(" "),d=0,e=c.length;d<e;d++)""!=c[d]&&b.resolutions.push(parseFloat(c[d]))},Width:function(a,b){b.width=parseInt(this.getChildValue(a))},Height:function(a,b){b.height=parseInt(this.getChildValue(a))},Layers:function(a,b){b.layers=this.getChildValue(a)},Styles:function(a,b){b.styles=this.getChildValue(a)}},OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"}),Ext.namespace("gxp.plugins"),gxp.plugins.WMSCSource=Ext.extend(gxp.plugins.WMSSource,{ptype:"gxp_wmscsource",version:"1.1.1",constructor:function(a){a.baseParams={SERVICE:"WMS",REQUEST:"GetCapabilities",TILED:!0},a.format||(this.format=new OpenLayers.Format.WMSCapabilities({keepData:!0,profile:"WMSC",allowFallback:!0})),gxp.plugins.WMSCSource.superclass.constructor.apply(this,arguments)},createLayerRecord:function(a){var b=gxp.plugins.WMSCSource.superclass.createLayerRecord.apply(this,arguments);if(b){var c,d;this.store.reader.raw&&(c=this.store.reader.raw.capability);var e=c&&c.vendorSpecific?c.vendorSpecific.tileSets:a.capability&&a.capability.tileSets,f=b.get("layer");if(e)for(var g=this.getProjection(b)||this.getMapProjection(),h=0,i=e.length;h<i;h++){var j=e[h];if(j.layers===f.params.LAYERS){var k;for(d in j.srs){k=new OpenLayers.Projection(d);break}if(g.equals(k)){var l=j.bbox[d].bbox;f.projection=k,f.addOptions({resolutions:j.resolutions,tileSize:new OpenLayers.Size(j.width,j.height),tileOrigin:new OpenLayers.LonLat(l[0],l[1])});break}}}else if(this.lazy){var m=a.tileSize,n=a.tileOrigin;if(f.addOptions({resolutions:a.resolutions,tileSize:m?new OpenLayers.Size(m[0],m[1]):void 0,tileOrigin:n?OpenLayers.LonLat.fromArray(n):void 0}),!n){var o;this.target.map.maxExtent?o=this.target.map.maxExtent:(d=a.srs||this.target.map.projection,o=OpenLayers.Projection.defaults[d].maxExtent),o&&(f.tileOrigin=OpenLayers.LonLat.fromArray(o))}}return f.params.TILED=a.tiled,b}},getConfigForRecord:function(a){var d,b=gxp.plugins.WMSCSource.superclass.getConfigForRecord.apply(this,arguments),c=b.name,e=a.getLayer();if(b.capability&&this.store.reader.raw){var f=this.store.reader.raw.capability,g=f.vendorSpecific&&f.vendorSpecific.tileSets;if(g)for(var h=g.length-1;h>=0;--h)if(d=g[h],d.layers===c&&d.srs[e.projection]){b.capability.tileSets=[d];break}}if(!b.capability||!b.capability.tileSets){var i=e.options.tileSize;i&&(b.tileSize=[i.w,i.h]),b.tileOrigin=e.options.tileOrigin,b.resolutions=e.options.resolutions}return Ext.applyIf(b,{cached:!!e.params.TILED})}}),Ext.preg(gxp.plugins.WMSCSource.prototype.ptype,gxp.plugins.WMSCSource);Ext.namespace("gxp.plugins");gxp.plugins.ZoomToExtent=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_zoomtoextent",menuText:"Zoom To Max Extent",tooltip:"Zoom To Max Extent",extent:null,closest:!0,iconCls:"gxp-icon-zoomtoextent",closest:!0,constructor:function(a){gxp.plugins.ZoomToExtent.superclass.constructor.apply(this,arguments),this.extent instanceof Array&&(this.extent=OpenLayers.Bounds.fromArray(this.extent))},addActions:function(){return gxp.plugins.ZoomToExtent.superclass.addActions.apply(this,[{text:this.buttonText,menuText:this.menuText,iconCls:this.iconCls,tooltip:this.tooltip,handler:function(){var a=this.target.mapPanel.map,b="function"==typeof this.extent?this.extent():this.extent;if(!b)for(var c,d,e=0,f=a.layers.length;e<f;++e)c=a.layers[e],c.getVisibility()&&(d=c.restrictedExtent||c.maxExtent,b?b.extend(d):d&&(b=d.clone()));if(b){var g=a.restrictedExtent||a.maxExtent;g&&(b=new OpenLayers.Bounds(Math.max(b.left,g.left),Math.max(b.bottom,g.bottom),Math.min(b.right,g.right),Math.min(b.top,g.top))),a.zoomToExtent(b,this.closest)}},scope:this}])}}),Ext.preg(gxp.plugins.ZoomToExtent.prototype.ptype,gxp.plugins.ZoomToExtent),OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var b={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(b,this.previousOptions),this.previous=new OpenLayers.Control.Button(b);var c={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(c,this.nextOptions),this.next=new OpenLayers.Control.Button(c),this.clear()},onPreviousChange:function(a,b){a&&!this.previous.active?this.previous.activate():!a&&this.previous.active&&this.previous.deactivate()},onNextChange:function(a,b){a&&!this.next.active?this.next.activate():!a&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this),this.previous.destroy(),this.next.destroy(),this.deactivate();for(var a in this)this[a]=null},setMap:function(a){this.map=a,this.next.setMap(a),this.previous.setMap(a)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments),this.next.draw(),this.previous.draw()},previousTrigger:function(){var a=this.previousStack.shift(),b=this.previousStack.shift();return void 0!=b?(this.nextStack.unshift(a),this.previousStack.unshift(b),this.restoring=!0,this.restore(b),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)):this.previousStack.unshift(a),b},nextTrigger:function(){var a=this.nextStack.shift();return void 0!=a&&(this.previousStack.unshift(a),this.restoring=!0,this.restore(a),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)),a},clear:function(){this.previousStack=[],this.previous.deactivate(),this.nextStack=[],this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(a){var b,c;if(this.map.getProjectionObject()==a.projection)c=this.map.getZoomForResolution(a.resolution),b=a.center;else{b=a.center.clone(),b.transform(a.projection,this.map.getProjectionObject());var d=a.units,e=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,f=d&&e?OpenLayers.INCHES_PER_UNIT[d]/OpenLayers.INCHES_PER_UNIT[e]:1;c=this.map.getZoomForResolution(f*a.resolution)}this.map.setCenter(b,c)},setListeners:function(){this.listeners={};for(var a in this.registry)this.listeners[a]=OpenLayers.Function.bind(function(){if(!this.restoring){var b=this.registry[a].apply(this,arguments);this.previousStack.unshift(b),this.previousStack.length>1&&this.onPreviousChange(this.previousStack[1],this.previousStack.length-1),this.previousStack.length>this.limit+1&&this.previousStack.pop(),this.nextStack.length>0&&(this.nextStack=[],this.onNextChange(null,0))}return!0},this)},activate:function(){var a=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var b in this.listeners)this.map.events.register(b,this,this.listeners[b]);a=!0,0==this.previousStack.length&&this.initStack()}return a},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var a=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var b in this.listeners)this.map.events.unregister(b,this,this.listeners[b]);this.clearOnDeactivate&&this.clear(),a=!0}return a},CLASS_NAME:"OpenLayers.Control.NavigationHistory"}),Ext.namespace("gxp.plugins"),gxp.plugins.NavigationHistory=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_navigationhistory",previousMenuText:"Zoom To Previous Extent",nextMenuText:"Zoom To Next Extent",previousTooltip:"Zoom To Previous Extent",nextTooltip:"Zoom To Next Extent",constructor:function(a){gxp.plugins.NavigationHistory.superclass.constructor.apply(this,arguments)},addActions:function(){var a=new OpenLayers.Control.NavigationHistory;this.target.mapPanel.map.addControl(a);var b=[new GeoExt.Action({menuText:this.previousMenuText,iconCls:"gxp-icon-zoom-previous",tooltip:this.previousTooltip,disabled:!0,control:a.previous}),new GeoExt.Action({menuText:this.nextMenuText,iconCls:"gxp-icon-zoom-next",tooltip:this.nextTooltip,disabled:!0,control:a.next})];return gxp.plugins.NavigationHistory.superclass.addActions.apply(this,[b])}}),Ext.preg(gxp.plugins.NavigationHistory.prototype.ptype,gxp.plugins.NavigationHistory),Ext.namespace("gxp.plugins"),gxp.plugins.Zoom=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_zoom",zoomMenuText:"Zoom Box",zoomInMenuText:"Zoom In",zoomOutMenuText:"Zoom Out",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"Zoom in",zoomOutTooltip:"Zoom out",constructor:function(a){gxp.plugins.Zoom.superclass.constructor.apply(this,arguments)},addActions:function(){var a=[{menuText:this.zoomInMenuText,iconCls:"gxp-icon-zoom-in",tooltip:this.zoomInTooltip,handler:function(){this.target.mapPanel.map.zoomIn()},scope:this},{menuText:this.zoomOutMenuText,iconCls:"gxp-icon-zoom-out",tooltip:this.zoomOutTooltip,handler:function(){this.target.mapPanel.map.zoomOut()},scope:this}];return this.showZoomBoxAction&&a.unshift(new GeoExt.Action({menuText:this.zoomText,iconCls:"gxp-icon-zoom",tooltip:this.zoomTooltip,control:new OpenLayers.Control.ZoomBox(this.controlOptions),map:this.target.mapPanel.map,enableToggle:!0,allowDepress:!1,toggleGroup:this.toggleGroup})),gxp.plugins.Zoom.superclass.addActions.apply(this,[a])}}),Ext.preg(gxp.plugins.Zoom.prototype.ptype,gxp.plugins.Zoom),OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);var c={done:this.measureComplete,point:this.measurePartial};this.immediate&&(c.modify=this.measureImmediate),this.callbacks=OpenLayers.Util.extend(c,this.callbacks),this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions),this.handler=new a(this,this.callbacks,this.handlerOptions)},deactivate:function(){return this.cancelDelay(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay(),this.handler.cancel()},setImmediate:function(a){this.immediate=a,this.immediate?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(a,b){var c=this.active;c&&this.deactivate(),this.handler=new a(this,this.callbacks,b),c&&this.activate()},measureComplete:function(a){this.cancelDelay(),this.measure(a,"measure")},measurePartial:function(a,b){this.cancelDelay(),b=b.clone(),this.handler.freehandMode(this.handler.evt)?this.measure(b,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null,this.measure(b,"measurepartial")},this),this.partialDelay)},measureImmediate:function(a,b,c){c&&!this.handler.freehandMode(this.handler.evt)&&(this.cancelDelay(),this.measure(b.geometry,"measurepartial"))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(a,b){var c,d;a.CLASS_NAME.indexOf("LineString")>-1?(c=this.getBestLength(a),d=1):(c=this.getBestArea(a),d=2),this.events.triggerEvent(b,{measure:c[0],units:c[1],order:d,geometry:a})},getBestArea:function(a){for(var c,d,b=this.displaySystemUnits[this.displaySystem],e=0,f=b.length;e<f&&(c=b[e],d=this.getArea(a,c),!(d>1));++e);return[d,c]},getArea:function(a,b){var c,d;this.geodesic?(c=a.getGeodesicArea(this.map.getProjectionObject()),d="m"):(c=a.getArea(),d=this.map.getUnits());var e=OpenLayers.INCHES_PER_UNIT[b];if(e){var f=OpenLayers.INCHES_PER_UNIT[d];c*=Math.pow(f/e,2)}return c},getBestLength:function(a){for(var c,d,b=this.displaySystemUnits[this.displaySystem],e=0,f=b.length;e<f&&(c=b[e],d=this.getLength(a,c),!(d>1));++e);return[d,c]},getLength:function(a,b){var c,d;this.geodesic?(c=a.getGeodesicLength(this.map.getProjectionObject()),d="m"):(c=a.getLength(),d=this.map.getUnits());var e=OpenLayers.INCHES_PER_UNIT[b];if(e){var f=OpenLayers.INCHES_PER_UNIT[d];c*=f/e}return c},CLASS_NAME:"OpenLayers.Control.Measure"}),Ext.namespace("gxp.plugins"),gxp.plugins.Measure=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_measure",outputTarget:"map",buttonText:"Measure",lengthMenuText:"Length",areaMenuText:"Area",lengthTooltip:"Measure length",areaTooltip:"Measure area",measureTooltip:"Measure",constructor:function(a){gxp.plugins.Measure.superclass.constructor.apply(this,arguments)},destroy:function(){this.button=null,gxp.plugins.Measure.superclass.destroy.apply(this,arguments)},createMeasureControl:function(a,b){var f,c=new OpenLayers.StyleMap({default:new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",fillColor:"white",fillOpacity:.3}}})]})}),d=function(){f&&f.destroy()},e=function(a){var b=a.measure,c=a.units;h.displaySystem="english";var d=a.geometry.CLASS_NAME.indexOf("LineString")>-1?h.getBestLength(a.geometry):h.getBestArea(a.geometry),e=d[0],f=d[1];
h.displaySystem="metric";var g=2==a.order?"<sup>2</sup>":"";return b.toFixed(2)+" "+c+g+"<br>"+e.toFixed(2)+" "+f+g},g=Ext.apply({},this.initialConfig.controlOptions);Ext.applyIf(g,{geodesic:!0,persist:!0,handlerOptions:{layerOptions:{styleMap:c}},eventListeners:{measurepartial:function(a){if(d(),f=this.addOutput({xtype:"tooltip",html:e(a),title:b,autoHide:!1,closable:!0,draggable:!1,mouseOffset:[0,0],showDelay:1,listeners:{hide:d}}),a.measure>0){var c=h.handler.lastUp,g=this.target.mapPanel.getPosition();f.targetXY=[g[0]+c.x,g[1]+c.y],f.show()}},deactivate:d,scope:this}});var h=new OpenLayers.Control.Measure(a,g);return h},addActions:function(){return this.activeIndex=0,this.button=new Ext.SplitButton({iconCls:"gxp-icon-measure-length",tooltip:this.measureTooltip,buttonText:this.buttonText,enableToggle:!0,toggleGroup:this.toggleGroup,allowDepress:!0,handler:function(a,b){a.pressed&&a.menu.items.itemAt(this.activeIndex).setChecked(!0)},scope:this,listeners:{toggle:function(a,b){b||a.menu.items.each(function(a){a.setChecked(!1)})},render:function(a){Ext.ButtonToggleMgr.register(a)}},menu:new Ext.menu.Menu({items:[new Ext.menu.CheckItem(new GeoExt.Action({text:this.lengthMenuText,iconCls:"gxp-icon-measure-length",toggleGroup:this.toggleGroup,group:this.toggleGroup,listeners:{checkchange:function(a,b){this.activeIndex=0,this.button.toggle(b),b&&this.button.setIconClass(a.iconCls)},scope:this},map:this.target.mapPanel.map,control:this.createMeasureControl(OpenLayers.Handler.Path,this.lengthTooltip)})),new Ext.menu.CheckItem(new GeoExt.Action({text:this.areaMenuText,iconCls:"gxp-icon-measure-area",toggleGroup:this.toggleGroup,group:this.toggleGroup,allowDepress:!1,listeners:{checkchange:function(a,b){this.activeIndex=1,this.button.toggle(b),b&&this.button.setIconClass(a.iconCls)},scope:this},map:this.target.mapPanel.map,control:this.createMeasureControl(OpenLayers.Handler.Polygon,this.areaTooltip)}))]})}),gxp.plugins.Measure.superclass.addActions.apply(this,[this.button])}}),Ext.preg(gxp.plugins.Measure.prototype.ptype,gxp.plugins.Measure),OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(a){return this.passesTolerance(a.xy)&&(this.clearTimer(),this.callback("move",[a]),this.px=a.xy,a=OpenLayers.Util.extend({},a),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)),!this.stopMove},mouseout:function(a){return OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv)&&(this.clearTimer(),this.callback("move",[a])),!0},passesTolerance:function(a){var b=!0;if(this.pixelTolerance&&this.px){var c=Math.sqrt(Math.pow(this.px.x-a.x,2)+Math.pow(this.px.y-a.y,2));c<this.pixelTolerance&&(b=!1)}return b},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(a){this.callback("pause",[a])},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),a=!0),a},CLASS_NAME:"OpenLayers.Handler.Hover"}),OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(a){if(a=a||{},a.handlerOptions=a.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[a]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions)),this.drillDown===!0&&(this.hover=!1),this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var b={};b[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{})}},getInfoForClick:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy}),OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait"),this.request(a.xy,{})},getInfoForHover:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy}),this.request(a.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var c,d,a=this.layers||this.map.layers,b=[],e=a.length-1;e>=0;--e)c=a[e],c instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||c.getVisibility())&&(d=OpenLayers.Util.isArray(c.url)?c.url[0]:c.url,this.drillDown!==!1||this.url||(this.url=d),(this.drillDown===!0||this.urlMatches(d))&&b.push(c));return b},urlMatches:function(a){var b=OpenLayers.Util.isEquivalentUrl(this.url,a);if(!b&&this.layerUrls)for(var c=0,d=this.layerUrls.length;c<d;++c)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[c],a)){b=!0;break}return b},buildWMSOptions:function(a,b,c,d){for(var e=[],f=[],g=0,h=b.length;g<h;g++)null!=b[g].params.LAYERS&&(e=e.concat(b[g].params.LAYERS),f=f.concat(this.getStyleNames(b[g])));var i=b[0],j=this.map.getProjection(),k=i.projection;k&&k.equals(this.map.getProjectionObject())&&(j=k.getCode());var l=OpenLayers.Util.extend({service:"WMS",version:i.params.VERSION,request:"GetFeatureInfo",exceptions:i.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,i.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:d,info_format:i.params.INFO_FORMAT||this.infoFormat},parseFloat(i.params.VERSION)>=1.3?{crs:j,i:parseInt(c.x),j:parseInt(c.y)}:{srs:j,x:parseInt(c.x),y:parseInt(c.y)});return 0!=e.length&&(l=OpenLayers.Util.extend({layers:e,query_layers:e,styles:f},l)),OpenLayers.Util.applyDefaults(l,this.vendorParams),{url:a,params:OpenLayers.Util.upperCaseObject(l),callback:function(b){this.handleResponse(c,b,a)},scope:this}},getStyleNames:function(a){var b;return b=a.params.STYLES?a.params.STYLES:OpenLayers.Util.isArray(a.params.LAYERS)?new Array(a.params.LAYERS.length):a.params.LAYERS.replace(/[^,]/g,"")},request:function(a,b){var c=this.findLayers();if(0==c.length)return this.events.triggerEvent("nogetfeatureinfo"),void OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");if(b=b||{},this.drillDown===!1){var d=this.buildWMSOptions(this.url,c,a,c[0].params.FORMAT),e=OpenLayers.Request.GET(d);b.hover===!0&&(this.hoverRequest=e)}else{this._requestCount=0,this._numRequests=0,this.features=[];for(var g,f={},h=0,i=c.length;h<i;h++){var j=c[h];g=OpenLayers.Util.isArray(j.url)?j.url[0]:j.url,g in f?f[g].push(j):(this._numRequests++,f[g]=[j])}var c;for(var g in f){c=f[g];var d=this.buildWMSOptions(g,c,a,c[0].params.FORMAT);OpenLayers.Request.GET(d)}}},triggerGetFeatureInfo:function(a,b,c){this.events.triggerEvent("getfeatureinfo",{text:a.responseText,features:c,request:a,xy:b}),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(a,b,c){var d=b.responseXML;d&&d.documentElement||(d=b.responseText);var e=this.format.read(d);this.drillDown===!1?this.triggerGetFeatureInfo(b,a,e):(this._requestCount++,"object"===this.output?this._features=(this._features||[]).concat({url:c,features:e}):this._features=(this._features||[]).concat(e),this._requestCount===this._numRequests&&(this.triggerGetFeatureInfo(b,a,this._features.concat()),delete this._features,delete this._requestCount,delete this._numRequests))},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"}),Ext.namespace("gxp.plugins"),gxp.plugins.WMSGetFeatureInfo=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_wmsgetfeatureinfo",outputTarget:"map",popupCache:null,infoActionTip:"Get Feature Info",popupTitle:"Feature Info",buttonText:"Identify",format:"html",addActions:function(){this.popupCache={};var a=gxp.plugins.WMSGetFeatureInfo.superclass.addActions.call(this,[{tooltip:this.infoActionTip,iconCls:"gxp-icon-getfeatureinfo",buttonText:this.buttonText,toggleGroup:this.toggleGroup,enableToggle:!0,allowDepress:!0,toggleHandler:function(a,b){for(var d=0,e=c.controls.length;d<e;d++)b?c.controls[d].activate():c.controls[d].deactivate()}}]),b=this.actions[0].items[0],c={controls:[]},d=function(){for(var e,a=this.target.mapPanel.layers.queryBy(function(a){return a.get("queryable")}),d=this.target.mapPanel.map,f=0,g=c.controls.length;f<g;f++)e=c.controls[f],e.deactivate(),e.destroy();c.controls=[],a.each(function(a){var g,e=a.getLayer(),f=Ext.apply({},this.vendorParams);if(this.layerParams)for(var h=this.layerParams.length-1;h>=0;--h)g=this.layerParams[h].toUpperCase(),f[g]=e.params[g];var i=a.get("infoFormat");void 0===i&&(i="html"==this.format?"text/html":"application/vnd.ogc.gml");var j=new OpenLayers.Control.WMSGetFeatureInfo(Ext.applyIf({url:e.url,queryVisible:!0,layers:[e],infoFormat:i,vendorParams:f,eventListeners:{getfeatureinfo:function(b){var c=a.get("title")||a.get("name");if("text/html"==i){var d=b.text.match(/<body[^>]*>([\s\S]*)<\/body>/);d&&!d[1].match(/^\s*$/)&&this.displayPopup(b,c,d[1])}else"text/plain"==i?this.displayPopup(b,c,"<pre>"+b.text+"</pre>"):b.features&&b.features.length>0&&this.displayPopup(b,c,null,a.get("getFeatureInfo"))},scope:this}},this.controlOptions));d.addControl(j),c.controls.push(j),b.pressed&&j.activate()},this)};return this.target.mapPanel.layers.on("update",d,this),this.target.mapPanel.layers.on("add",d,this),this.target.mapPanel.layers.on("remove",d,this),a},displayPopup:function(a,b,c,d){var e,f=a.xy.x+"."+a.xy.y;d=d||{},f in this.popupCache?e=this.popupCache[f]:(e=this.addOutput({xtype:"gx_popup",title:this.popupTitle,layout:"accordion",fill:!1,autoScroll:!0,location:a.xy,map:this.target.mapPanel,width:250,height:300,defaults:{layout:"fit",autoScroll:!0,autoHeight:!0,autoWidth:!0,collapsible:!0}}),e.on({close:function(a){return function(b){delete this.popupCache[a]}}(f),scope:this}),this.popupCache[f]=e);var g=a.features,h=[];if(!c&&g)for(var i,j=0,k=g.length;j<k;++j)i=g[j],h.push(Ext.apply({xtype:"gxp_editorgrid",readOnly:!0,listeners:{beforeedit:function(a){return!1}},title:i.fid?i.fid:b,feature:i,fields:d.fields,propertyNames:d.propertyNames},this.itemConfig));else c&&h.push(Ext.apply({title:b,html:c},this.itemConfig));e.add(h),e.doLayout()}}),Ext.preg(gxp.plugins.WMSGetFeatureInfo.prototype.ptype,gxp.plugins.WMSGetFeatureInfo),Ext.namespace("gxp.plugins"),gxp.plugins.Navigation=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_navigation",menuText:"Pan Map",tooltip:"Pan Map",constructor:function(a){gxp.plugins.Navigation.superclass.constructor.apply(this,arguments)},addActions:function(){var a;this.controlOptions?(this.controlOptions=this.controlOptions||{},Ext.applyIf(this.controlOptions,{dragPanOptions:{enableKinetic:!0}}),a=new OpenLayers.Control.Navigation(this.controlOptions)):(candidates=this.target.mapPanel.map.getControlsByClass("OpenLayers.Control.Navigation"),candidates.length&&(a=candidates[0]));var b=[new GeoExt.Action({tooltip:this.tooltip,menuText:this.menuText,iconCls:"gxp-icon-pan",enableToggle:!0,pressed:!0,allowDepress:!1,control:a,map:a.map?null:this.target.mapPanel.map,toggleGroup:this.toggleGroup})];return gxp.plugins.Navigation.superclass.addActions.apply(this,[b])}}),Ext.preg(gxp.plugins.Navigation.prototype.ptype,gxp.plugins.Navigation),Ext.namespace("gxp.plugins"),gxp.plugins.LayerTree=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_layertree",shortTitle:"Layers",rootNodeText:"Layers",overlayNodeText:"Overlays",baseNodeText:"Base Layers",groups:null,defaultGroup:"default",treeNodeUI:null,constructor:function(a){gxp.plugins.LayerTree.superclass.constructor.apply(this,arguments),this.groups||(this.groups={default:this.overlayNodeText,background:{title:this.baseNodeText,exclusive:!0}}),this.treeNodeUI||(this.treeNodeUI=Ext.extend(GeoExt.tree.LayerNodeUI,new GeoExt.tree.TreeNodeUIEventMixin))},addOutput:function(a){a=Ext.apply(this.createOutputConfig(),a||{});var b=gxp.plugins.LayerTree.superclass.addOutput.call(this,a);return b.on({contextmenu:this.handleTreeContextMenu,beforemovenode:this.handleBeforeMoveNode,scope:this}),b},createOutputConfig:function(){var b,a=new Ext.tree.TreeNode({text:this.rootNodeText,expanded:!0,isTarget:!1,allowDrop:!1});this.initialConfig.loader&&this.initialConfig.loader.baseAttrs&&(b=this.initialConfig.loader.baseAttrs);var e,f,c=this.defaultGroup,d=this;for(var g in this.groups)e="string"==typeof this.groups[g]?{title:this.groups[g]}:this.groups[g],f=e.exclusive,a.appendChild(new GeoExt.tree.LayerContainer(Ext.apply({text:e.title,iconCls:"gxp-folder",expanded:!0,group:g==this.defaultGroup?void 0:g,loader:new GeoExt.tree.LayerLoader({baseAttrs:f?Ext.apply({checkedGroup:Ext.isString(f)?f:g},b):b,store:this.target.mapPanel.layers,filter:function(a){return function(b){return(b.get("group")||c)==a&&1==b.getLayer().displayInLayerSwitcher}}(g),createNode:function(a){return d.configureLayerNode(this,a),GeoExt.tree.LayerLoader.prototype.createNode.apply(this,arguments)}}),singleClickExpand:!0,allowDrag:!1,listeners:{append:function(a,b){b.expand()}}},e)));return{xtype:"treepanel",root:a,rootVisible:!1,shortTitle:this.shortTitle,border:!1,enableDD:!0,selModel:new Ext.tree.DefaultSelectionModel({listeners:{beforeselect:this.handleBeforeSelect,scope:this}}),contextMenu:new Ext.menu.Menu({items:[]})}},configureLayerNode:function(a,b){b.uiProvider=this.treeNodeUI;var c=b.layer,d=b.layerStore;if(c&&d){var e=d.getAt(d.findBy(function(a){return a.getLayer()===c}));e&&(b.qtip=e.get("abstract"),e.get("queryable")||b.iconCls||(b.iconCls="gxp-tree-rasterlayer-icon"),e.get("fixed")&&(b.allowDrag=!1),b.listeners={rendernode:function(a){e===this.target.selectedLayer&&a.select(),this.target.on("layerselectionchange",function(b){this.selectionChanging||b!==e||a.select()},this)},scope:this})}},handleBeforeSelect:function(a,b){var e,c=!0,d=b&&b.layer;if(d){var f=b.layerStore;e=f.getAt(f.findBy(function(a){return a.getLayer()===d}))}return this.selectionChanging=!0,c=this.target.selectLayer(e),this.selectionChanging=!1,c},handleTreeContextMenu:function(a,b){if(a&&a.layer){a.select();var c=a.getOwnerTree();if(c.getSelectionModel().getSelectedNode()===a){var d=c.contextMenu;d.contextNode=a,d.items.getCount()>0&&d.showAt(b.getXY())}}},handleBeforeMoveNode:function(a,b,c,d,e){if(c!==d){var f=d.loader.store,g=f.findBy(function(a){return a.getLayer()===b.layer}),h=f.getAt(g);h.set("group",d.attributes.group)}}}),Ext.preg(gxp.plugins.LayerTree.prototype.ptype,gxp.plugins.LayerTree),Ext.namespace("GeoExt.plugins"),GeoExt.plugins.TreeNodeComponent=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this.initialConfig,Ext.apply({},a)),Ext.apply(this,a),GeoExt.plugins.TreeNodeComponent.superclass.constructor.apply(this,arguments)},init:function(a){a.on({rendernode:this.onRenderNode,beforedestroy:this.onBeforeDestroy,scope:this})},onRenderNode:function(a){var b=a.rendered,c=a.attributes,d=c.component||this.component;if(!b&&d){var e=Ext.DomHelper.append(a.ui.elNode,[{tag:"div"}]);"function"==typeof d?d=d(a,e):"object"==typeof d&&"function"==typeof d.fn&&(d=d.fn.apply(d.scope,[a,e])),"object"==typeof d&&"string"==typeof d.xtype&&(d=Ext.ComponentMgr.create(d)),d instanceof Ext.Component&&(d.render(e),a.component=d)}},onBeforeDestroy:function(a){a.un("rendernode",this.onRenderNode,this),a.un("beforedestroy",this.onBeforeDestroy,this)}}),Ext.preg("gx_treenodecomponent",GeoExt.plugins.TreeNodeComponent),Ext.namespace("gxp.plugins"),gxp.plugins.LayerManager=Ext.extend(gxp.plugins.LayerTree,{ptype:"gxp_layermanager",baseNodeText:"Base Maps",createOutputConfig:function(){var a=gxp.plugins.LayerManager.superclass.createOutputConfig.apply(this,arguments);return Ext.applyIf(a,Ext.apply({cls:"gxp-layermanager-tree",lines:!1,useArrows:!0,plugins:[{ptype:"gx_treenodecomponent"}]},this.treeConfig)),a},configureLayerNode:function(a,b){gxp.plugins.LayerManager.superclass.configureLayerNode.apply(this,arguments);var c;if(OpenLayers.Layer.WMS&&b.layer instanceof OpenLayers.Layer.WMS?c="gx_wmslegend":OpenLayers.Layer.Vector&&b.layer instanceof OpenLayers.Layer.Vector&&(c="gx_vectorlegend"),c){var d;a&&a.baseAttrs&&a.baseAttrs.baseParams&&(d=a.baseAttrs.baseParams),Ext.apply(b,{component:{xtype:c,hidden:!b.layer.getVisibility(),baseParams:Ext.apply({transparent:!0,format:"image/png",legend_options:"fontAntiAliasing:true;fontSize:11;fontName:Arial"},d),layerRecord:this.target.mapPanel.layers.getByLayer(b.layer),showTitle:!1,cls:"legend"}})}}}),Ext.preg(gxp.plugins.LayerManager.prototype.ptype,gxp.plugins.LayerManager),Ext.namespace("gxp"),gxp.NewSourceDialog=Ext.extend(Ext.Panel,{title:"Add New Server...",cancelText:"Cancel",addServerText:"Add Server",invalidURLText:"Enter a valid URL to a WMS/TMS/REST endpoint (e.g. http://example.com/geoserver/wms)",contactingServerText:"Contacting Server...",bodyStyle:"padding: 0px",error:null,initComponent:function(){this.addEvents("urlselected"),this.urlTextField=new Ext.form.TextField({fieldLabel:"URL",allowBlank:!1,width:240,msgTarget:"under",validator:this.urlValidator.createDelegate(this),listeners:{specialkey:function(a,b){b.getKey()===b.ENTER&&this.addServer()},scope:this}}),this.form=new Ext.form.FormPanel({items:[{xtype:"combo",width:240,name:"type",fieldLabel:"Type",value:"WMS",mode:"local",triggerAction:"all",store:[["WMS","Web Map Service (WMS)"],["TMS","Tiled Map Service (TMS)"],["REST","ArcGIS REST Service (REST)"]]},this.urlTextField],border:!1,labelWidth:30,bodyStyle:"padding: 5px",autoWidth:!0,autoHeight:!0,listeners:{afterrender:function(){this.urlTextField.focus(!1,!0)},scope:this}}),this.bbar=[new Ext.Button({text:this.cancelText,handler:this.hide,scope:this}),new Ext.Toolbar.Fill,new Ext.Button({text:this.addServerText,iconCls:"add",handler:this.addServer,scope:this})],this.items=this.form,gxp.NewSourceDialog.superclass.initComponent.call(this),this.form.on("render",function(){this.loadMask=new Ext.LoadMask(this.form.getEl(),{msg:this.contactingServerText})},this),this.on({hide:this.reset,removed:this.reset,scope:this}),this.on("urlselected",function(a,b){this.setLoading();var c=function(){this.setError(this.sourceLoadFailureMessage)};this.addSource(b,this.hide,c,this)},this)},addServer:function(){this.error=null,this.urlTextField.validate()&&this.fireEvent("urlselected",this,this.urlTextField.getValue(),this.form.getForm().findField("type").getValue())},reset:function(){this.error=null,this.urlTextField.reset(),this.loadMask.hide()},urlRegExp:/^(http(s)?:)?\/\/([\w%]+:[\w%]+@)?([^@\/:]+)(:\d+)?\//i,urlValidator:function(a){var b;return b=this.urlRegExp.test(a)?!this.error||this.error:this.invalidURLText,this.error=null,b},setLoading:function(){this.loadMask.show()},setError:function(a){this.loadMask.hide(),this.error=a,this.urlTextField.validate()},addSource:function(a,b,c,d){}}),Ext.reg("gxp_newsourcedialog",gxp.NewSourceDialog),Ext.namespace("gxp.plugins"),gxp.plugins.FeedGetFeatureInfo=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_getfeedfeatureinfo",init:function(a){gxp.plugins.FeedGetFeatureInfo.superclass.init.apply(this,arguments),this.target.mapPanel.layers.on({add:this.addLayer,remove:this.removeLayer,scope:this})},addLayer:function(a,b,c){for(var d=0,e=b.length;d<e;++d){var f=b[d],g=this.target.getSource(f),h=f.getLayer();if(g instanceof gxp.plugins.FeedSource)if(null==this.target.selectControl)this.target.selectControl=new OpenLayers.Control.SelectFeature(h,{clickout:!0,listeners:{clickoutFeature:function(){}},scope:this}),this.target.mapPanel.map.addControl(this.target.selectControl);else{var i=this.target.selectControl.layers?this.target.selectControl.layers:this.target.selectControl.layer?[this.target.selectControl.layer]:[];i.push(h),this.target.selectControl.setLayer(i)}}this.target.selectControl&&this.target.selectControl.activate()},removeLayer:function(a,b,c){b.length||(b=[b]);for(var d=0,e=b.length;d<e;++d){var f=b[d].getLayer(),g=this.target.selectControl;if(null!=g)if(g.layers)for(var h=0;h<g.layers.length;h++){var i=g.layers[h],j=g.layers;i.id===f.id&&(j.splice(h,1),g.setLayer(j))}else null!=g.layer&&f.id===g.layer.id&&g.setLayer([])}}}),Ext.preg(gxp.plugins.FeedGetFeatureInfo.prototype.ptype,gxp.plugins.FeedGetFeatureInfo),OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:!1,createGeometryFromItem:function(a){var b=this.getElementsByTagNameNS(a,this.georssns,"point"),c=this.getElementsByTagNameNS(a,this.geons,"lat"),d=this.getElementsByTagNameNS(a,this.geons,"long"),e=this.getElementsByTagNameNS(a,this.georssns,"line"),f=this.getElementsByTagNameNS(a,this.georssns,"polygon"),g=this.getElementsByTagNameNS(a,this.georssns,"where"),h=this.getElementsByTagNameNS(a,this.georssns,"box");if(b.length>0||c.length>0&&d.length>0){var i;b.length>0?(i=OpenLayers.String.trim(b[0].firstChild.nodeValue).split(/\s+/),2!=i.length&&(i=OpenLayers.String.trim(b[0].firstChild.nodeValue).split(/\s*,\s*/))):i=[parseFloat(c[0].firstChild.nodeValue),parseFloat(d[0].firstChild.nodeValue)];var j=new OpenLayers.Geometry.Point(i[1],i[0])}else if(e.length>0){for(var b,k=OpenLayers.String.trim(this.getChildValue(e[0])).split(/\s+/),l=[],m=0,n=k.length;m<n;m+=2)b=new OpenLayers.Geometry.Point(k[m+1],k[m]),l.push(b);j=new OpenLayers.Geometry.LineString(l)}else if(f.length>0){for(var b,k=OpenLayers.String.trim(this.getChildValue(f[0])).split(/\s+/),l=[],m=0,n=k.length;m<n;m+=2)b=new OpenLayers.Geometry.Point(k[m+1],k[m]),l.push(b);j=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(l)])}else if(g.length>0){this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML({xy:this.xy}));var o=this.gmlParser.parseFeature(g[0]);j=o.geometry}else if(h.length>0){var b,k=OpenLayers.String.trim(h[0].firstChild.nodeValue).split(/\s+/),l=[];k.length>3&&(b=new OpenLayers.Geometry.Point(k[1],k[0]),l.push(b),b=new OpenLayers.Geometry.Point(k[1],k[2]),l.push(b),b=new OpenLayers.Geometry.Point(k[3],k[2]),l.push(b),b=new OpenLayers.Geometry.Point(k[3],k[0]),l.push(b),b=new OpenLayers.Geometry.Point(k[1],k[0]),l.push(b)),j=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(l)])}return j&&this.internalProjection&&this.externalProjection&&j.transform(this.externalProjection,this.internalProjection),j},createFeatureFromItem:function(a){var b=this.createGeometryFromItem(a),c=this._getChildValue(a,"*","title",this.featureTitle),d=this._getChildValue(a,"*","description",this._getChildValue(a,"*","content",this._getChildValue(a,"*","summary",this.featureDescription))),e=this._getChildValue(a,"*","link");if(!e)try{e=this.getElementsByTagNameNS(a,"*","link")[0].getAttribute("href")}catch(a){e=null}var f=this._getChildValue(a,"*","id",null),g={title:c,description:d,link:e},h=new OpenLayers.Feature.Vector(b,g);return h.fid=f,h},_getChildValue:function(a,b,c,d){var e,f=this.getElementsByTagNameNS(a,b,c);return e=f&&f[0]&&f[0].firstChild&&f[0].firstChild.nodeValue?this.getChildValue(f[0]):void 0==d?"":d},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=null;b=this.getElementsByTagNameNS(a,"*","item"),0==b.length&&(b=this.getElementsByTagNameNS(a,"*","entry"));for(var c=b.length,d=new Array(c),e=0;e<c;e++)d[e]=this.createFeatureFromItem(b[e]);return d},write:function(a){var b;if(OpenLayers.Util.isArray(a)){b=this.createElementNS(this.rssns,"rss");for(var c=0,d=a.length;c<d;c++)b.appendChild(this.createFeatureXML(a[c]))}else b=this.createFeatureXML(a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.rssns,"item"),d=this.createElementNS(this.rssns,"title");d.appendChild(this.createTextNode(a.attributes.title?a.attributes.title:""));var e=this.createElementNS(this.rssns,"description");if(e.appendChild(this.createTextNode(a.attributes.description?a.attributes.description:"")),c.appendChild(d),c.appendChild(e),a.attributes.link){var f=this.createElementNS(this.rssns,"link");f.appendChild(this.createTextNode(a.attributes.link)),c.appendChild(f)}for(var g in a.attributes)if("link"!=g&&"title"!=g&&"description"!=g){var h=this.createTextNode(a.attributes[g]),i=g;g.search(":")!=-1&&(i=g.split(":")[1]);var j=this.createElementNS(this.featureNS,"feature:"+i);j.appendChild(h),c.appendChild(j)}return c.appendChild(b),c},buildGeometryNode:function(a){this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b;if("OpenLayers.Geometry.Polygon"==a.CLASS_NAME)b=this.createElementNS(this.georssns,"georss:polygon"),b.appendChild(this.buildCoordinatesNode(a.components[0]));else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME)b=this.createElementNS(this.georssns,"georss:line"),b.appendChild(this.buildCoordinatesNode(a));else{if("OpenLayers.Geometry.Point"!=a.CLASS_NAME)throw"Couldn't parse "+a.CLASS_NAME;b=this.createElementNS(this.georssns,"georss:point"),b.appendChild(this.buildCoordinatesNode(a))}return b},buildCoordinatesNode:function(a){var b=null;a.components&&(b=a.components);var c;if(b){for(var d=b.length,e=new Array(d),f=0;f<d;f++)e[f]=b[f].y+" "+b[f].x;c=e.join(" ")}else c=a.y+" "+a.x;return this.createTextNode(c)},CLASS_NAME:"OpenLayers.Format.GeoRSS"}),OpenLayers.Format.QueryStringFilter=function(){function b(a){return a=a.replace(/%/g,"\\%"),a=a.replace(/\\\\\.(\*)?/g,function(a,b){return b?a:"\\\\_"}),a=a.replace(/\\\\\.\*/g,"\\\\%"),a=a.replace(/(\\)?\.(\*)?/g,function(a,b,c){return b||c?a:"_"}),a=a.replace(/(\\)?\.\*/g,function(a,b){return b?a:"%"}),a=a.replace(/\\\./g,"."),a=a.replace(/(\\)?\\\*/g,function(a,b){return b?a:"*"})}var a={};return a[OpenLayers.Filter.Comparison.EQUAL_TO]="eq",a[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne",a[OpenLayers.Filter.Comparison.LESS_THAN]="lt",a[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte",a[OpenLayers.Filter.Comparison.GREATER_THAN]="gt",a[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte",a[OpenLayers.Filter.Comparison.LIKE]="ilike",OpenLayers.Class(OpenLayers.Format,{wildcarded:!1,srsInBBOX:!1,write:function(c,d){d=d||{};var e=c.CLASS_NAME,f=e.substring(e.lastIndexOf(".")+1);switch(f){case"Spatial":switch(c.type){case OpenLayers.Filter.Spatial.BBOX:d.bbox=c.value.toArray(),this.srsInBBOX&&c.projection&&d.bbox.push(c.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:d.tolerance=c.distance;case OpenLayers.Filter.Spatial.WITHIN:d.lon=c.value.x,d.lat=c.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+c.type)}break;case"Comparison":var g=a[c.type];if(void 0!==g){var h=c.value;c.type==OpenLayers.Filter.Comparison.LIKE&&(h=b(h),this.wildcarded&&(h="%"+h+"%")),d[c.property+"__"+g]=h,d.queryable=d.queryable||[],d.queryable.push(c.property)}else OpenLayers.Console.warn("Unknown comparison filter type "+c.type);break;case"Logical":if(c.type===OpenLayers.Filter.Logical.AND)for(var i=0,j=c.filters.length;i<j;i++)d=this.write(c.filters[i],d);else OpenLayers.Console.warn("Unsupported logical filter type "+c.type);break;default:OpenLayers.Console.warn("Unknown filter type "+f)}return d},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})}(),OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(a){OpenLayers.Util.extend(this,a),this.options=a,this.active=!1},destroy:function(){this.deactivate(),this.layer=null,this.options=null},setLayer:function(a){this.layer=a},activate:function(){return!this.active&&(this.active=!0,!0)},deactivate:function(){return!!this.active&&(this.active=!1,!0)},CLASS_NAME:"OpenLayers.Strategy"}),OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&(this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),this.update()),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),a},update:function(a){var b=this.getMapBounds();null!==b&&(a&&a.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(b))&&(this.calculateBounds(b),this.resolution=this.layer.map.getResolution(),this.triggerRead(a))},getMapBounds:function(){if(null===this.layer.map)return null;var a=this.layer.map.getExtent();return a&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(a=a.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)),a},invalidBounds:function(a){a||(a=this.getMapBounds());var b=!this.bounds||!this.bounds.containsBounds(a);if(!b&&this.resFactor){var c=this.resolution/this.layer.map.getResolution();b=c>=this.resFactor||c<=1/this.resFactor}return b},calculateBounds:function(a){a||(a=this.getMapBounds());var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio,d=a.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(b.lon-c/2,b.lat-d/2,b.lon+c/2,b.lat+d/2)},triggerRead:function(a){!this.response||a&&a.noAbort===!0||(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend"));var b={filter:this.createFilter()};this.layer.events.triggerEvent("loadstart",b),this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:b.filter,callback:this.merge,scope:this},a))},createFilter:function(){var a=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});return this.layer.filter&&(a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,a]})),a},merge:function(a){if(this.layer.destroyFeatures(),a.success()){var b=a.features;if(b&&b.length>0){var c=this.layer.projection,d=this.layer.map.getProjectionObject();if(!d.equals(c))for(var e,f=0,g=b.length;f<g;++f)e=b[f].geometry,e&&e.transform(c,d);this.layer.addFeatures(b)}}else this.bounds=null;this.response=null,this.layer.events.triggerEvent("loadend",{response:a})},CLASS_NAME:"OpenLayers.Strategy.BBOX"}),OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return a&&(this.layer.events.on({refresh:this.load,scope:this}),1==this.layer.visibility||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this})),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this}),a},load:function(a){var b=this.layer;b.events.triggerEvent("loadstart",{filter:b.filter}),b.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:b.filter,scope:this},a)),b.events.un({visibilitychanged:this.load,scope:this})},merge:function(a){var b=this.layer;b.destroyFeatures();var c=a.features;if(c&&c.length>0){var d=b.projection,e=b.map.getProjectionObject();if(!e.equals(d))for(var f,g=0,h=c.length;g<h;++g)f=c[g].geometry,f&&f.transform(d,e);b.addFeatures(c)}b.events.triggerEvent("loadend",{response:a})},CLASS_NAME:"OpenLayers.Strategy.Fixed"}),Ext.namespace("gxp.plugins"),gxp.plugins.FeedSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_feedsource",title:"Feed Source",format:"OpenLayers.Format.GeoRSS",popupTemplate:'<a target="_blank" href="{link}">{description}</a>',fixed:!0,createLayerRecord:function(a){var b,c=new OpenLayers.Layer.Vector(a.name,{projection:"projection"in a?a.projection:"EPSG:4326",visibility:!("visibility"in a)||a.visibility,strategies:[this.fixed?new OpenLayers.Strategy.Fixed:new OpenLayers.Strategy.BBOX({resFactor:1,ratio:1})],protocol:new OpenLayers.Protocol.HTTP({url:this.url,params:a.params,format:this.getFormat(a)
}),styleMap:this.getStyleMap(a)});this.configureInfoPopup(c);var d=GeoExt.data.LayerRecord.create([{name:"name",type:"string"},{name:"source",type:"string"},{name:"group",type:"string"},{name:"fixed",type:"boolean"},{name:"selected",type:"boolean"},{name:"visibility",type:"boolean"},{name:"format",type:"string"},{name:"defaultStyle"},{name:"selectStyle"},{name:"params"}]),e="format"in a?a.format:this.format,f={layer:c,name:a.name,source:a.source,group:a.group,fixed:"fixed"in a&&a.fixed,selected:"selected"in a&&a.selected,params:"params"in a?a.params:{},visibility:"visibility"in a&&a.visibility,format:e instanceof String?e:null,defaultStyle:"defaultStyle"in a?a.defaultStyle:{},selectStyle:"selectStyle"in a?a.selectStyle:{}};return b=new d(f,c.id)},getConfigForRecord:function(a){var b=gxp.plugins.FeedSource.superclass.getConfigForRecord.apply(this,arguments);return Ext.apply(b,{name:a.get("name"),group:a.get("group"),fixed:a.get("fixed"),selected:a.get("selected"),params:a.get("params"),visibility:a.getLayer().getVisibility(),format:a.get("format"),defaultStyle:a.getLayer().styleMap.styles.default.defaultStyle,selectStyle:a.getLayer().styleMap.styles.select.defaultStyle})},getFormat:function(a){var b=window,c="format"in a?a.format:this.format;if(!("string"==typeof c||c instanceof String))return c;for(var d=c.split("."),e=0,f=d.length;e<f&&(b=b[d[e]],b);++e);if(b&&b.prototype&&b.prototype.initialize){var g=function(){b.prototype.initialize.apply(this)};g.prototype=b.prototype;var h=new g;return h}},configureInfoPopup:function(a){var b=new Ext.XTemplate(this.popupTemplate);a.events.on({featureselected:function(a){var c=a.feature;c.geometry;this.target.selectControl&&(this.target.selectControl.popup&&this.target.selectControl.popup.close(),this.target.selectControl.popup=new GeoExt.Popup({title:c.attributes.title,closeAction:"destroy",location:c,html:b.apply(c.attributes)}),this.target.selectControl.popup.show())},featureunselected:function(){this.target.selectControl&&this.target.selectControl.popup&&this.target.selectControl.popup.close()},scope:this})},getStyleMap:function(a){return new OpenLayers.StyleMap({default:new OpenLayers.Style("defaultStyle"in a?a.defaultStyle:{graphicName:"circle",pointRadius:5,fillOpacity:.7,fillColor:"Red"},{title:a.name}),select:new OpenLayers.Style("selectStyle"in a?a.selectStyle:{graphicName:"circle",pointRadius:10,fillOpacity:1,fillColor:"Yellow"})})}}),Ext.preg(gxp.plugins.FeedSource.prototype.ptype,gxp.plugins.FeedSource),Ext.namespace("gxp.plugins"),gxp.plugins.PicasaFeedSource=Ext.extend(gxp.plugins.FeedSource,{ptype:"gxp_picasasource",url:"http://picasaweb.google.com/data/feed/base/all?thumbsize=160c&",format:"OpenLayers.Format.Picasa",title:"Picasa Photos",pointRadius:14,popupTemplate:'<tpl for="."><a target="_blank" href="{link}"><img  title="{title}" src="{thumbnail}"/></a></tpl>',fixed:!1,createLayerRecord:function(a){Ext.isEmpty(a.params["max-results"])&&(a.params["max-results"]=50),a.url=this.url,this.format=new OpenLayers.Format.GeoRSS({createFeatureFromItem:function(a){var b=OpenLayers.Format.GeoRSS.prototype.createFeatureFromItem.apply(this,arguments);return b.attributes.thumbnail=this.getElementsByTagNameNS(a,"http://search.yahoo.com/mrss/","thumbnail")[0].getAttribute("url"),b.attributes.content=OpenLayers.Util.getXmlNodeValue(this.getElementsByTagNameNS(a,"*","summary")[0]),b}});var b=gxp.plugins.PicasaFeedSource.superclass.createLayerRecord.apply(this,arguments),c=b.getLayer();return c.protocol.filterToParams=function(a,b){if(a.type===OpenLayers.Filter.Spatial.BBOX){var c=a.value.toArray();b.bbox=[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]}return b},b},configureInfoPopup:function(a){var b=new Ext.XTemplate(this.popupTemplate);a.events.on({featureselected:function(a){var c=a.feature;c.geometry;null!=this.target.selectControl.popup&&this.target.selectControl.popup.close();var e=document.createElement("div");e.innerHTML=c.attributes.content;var f={link:e.getElementsByTagName("a")[0].getAttribute("href"),title:c.attributes.title,thumbnail:c.attributes.thumbnail};this.target.selectControl.popup=new GeoExt.Popup({title:c.attributes.title,closeAction:"destroy",location:c,width:175,height:200,html:b.apply(f)}),this.target.selectControl.popup.show()},featureunselected:function(a){this.target.selectControl&&this.target.selectControl.popup&&this.target.selectControl.popup.close()},scope:this})},getStyleMap:function(a){return new OpenLayers.StyleMap({default:new OpenLayers.Style({externalGraphic:"${thumbnail}",pointRadius:this.pointRadius},{title:this.title}),select:new OpenLayers.Style({pointRadius:this.pointRadius+5})})}}),Ext.preg(gxp.plugins.PicasaFeedSource.prototype.ptype,gxp.plugins.PicasaFeedSource),Ext.namespace("gxp.plugins"),gxp.plugins.YouTubeFeedSource=Ext.extend(gxp.plugins.FeedSource,{ptype:"gxp_youtubesource",url:"http://gdata.youtube.com/feeds/api/videos?v=2&prettyprint=true&",format:"OpenLayers.Format.YouTube",title:"Youtube Videos",pointRadius:24,popupTemplate:'<tpl for="."><a target="_blank" href="{link}"><img height="180"  width="240" title="{title}" src="{thumbnail}"/></a></tpl>',fixed:!1,createLayerRecord:function(a){Ext.isEmpty(a.params["max-results"])?a.params["max-results"]=50:a.params["max-results"]=Math.min(a.params["max-results"],50),a.url=this.url,this.format=new OpenLayers.Format.GeoRSS({createFeatureFromItem:function(a){var b=OpenLayers.Format.GeoRSS.prototype.createFeatureFromItem.apply(this,arguments);return b.attributes.thumbnail=this.getElementsByTagNameNS(a,"http://search.yahoo.com/mrss/","thumbnail")[4].getAttribute("url"),b.attributes.content=OpenLayers.Util.getXmlNodeValue(this.getElementsByTagNameNS(a,"*","summary")[0]),b}});var b=gxp.plugins.YouTubeFeedSource.superclass.createLayerRecord.apply(this,arguments),c=b.getLayer();return c.protocol.filterToParams=function(a,b){if(a.type===OpenLayers.Filter.Spatial.BBOX){var c=a.value,d=c.getCenterLonLat(),e=6378.137,f=3.1415926,g=e*c.left/180/f,h=e*c.right/180/f,i=Math.min((h-g)/2*2,1e3);Ext.apply(b,{location:""+d.lat+","+d.lon,"location-radius":i+"km"})}return b},b},configureInfoPopup:function(a){var b=new Ext.XTemplate(this.popupTemplate);a.events.on({featureselected:function(a){var c=a.feature;c.geometry;null!=this.target.selectControl.popup&&this.target.selectControl.popup.close(),this.target.selectControl.popup=new GeoExt.Popup({title:c.attributes.title,location:c,width:240,height:220,closeAction:"destroy",html:b.apply(c.attributes)}),this.target.selectControl.popup.show()},featureunselected:function(a){this.target.selectControl&&this.target.selectControl.popup&&this.target.selectControl.popup.close()},scope:this})},getStyleMap:function(a){return new OpenLayers.StyleMap({default:new OpenLayers.Style({externalGraphic:"${thumbnail}",pointRadius:24},{title:this.title}),select:new OpenLayers.Style({pointRadius:this.pointRadius+5})})}}),Ext.preg(gxp.plugins.YouTubeFeedSource.prototype.ptype,gxp.plugins.YouTubeFeedSource),Ext.namespace("gxp"),gxp.FeedSourceDialog=Ext.extend(Ext.Container,{feedTypeText:"Source",addPicasaText:"Picasa Photos",addYouTubeText:"YouTube Videos",addRSSText:"GeoRSS Feed",addFeedText:"Add to Map",addTitleText:"Title",keywordText:"Keyword",doneText:"Done",titleText:"Add Feeds",maxResultsText:"Max Items",width:300,autoHeight:!0,closeAction:"destroy",initComponent:function(){this.addEvents("addfeed"),this.feedTypes||(this.feedTypes=[[gxp.plugins.PicasaFeedSource.ptype,this.addPicasaText],[gxp.plugins.YouTubeFeedSource.ptype,this.addYouTubeText],[gxp.plugins.FeedSource.ptype,this.addRSSText]]);var a=new Ext.data.ArrayStore({fields:["type","name"],data:this.feedTypes}),b=new Ext.form.ComboBox({store:a,fieldLabel:this.feedTypeText,displayField:"name",valueField:"type",typeAhead:!0,width:180,mode:"local",triggerAction:"all",emptyText:"Select a feed source...",selectOnFocus:!0,listeners:{select:function(a){a.value==gxp.plugins.FeedSource.ptype?(c.show(),d.hide(),f.hide(),g.show()):(c.hide(),d.show(),f.show(),g.hide()),h.setDisabled(null==a.value)},scope:this}}),c=new Ext.form.TextField({fieldLabel:"URL",allowBlank:!1,width:180,msgTarget:"right",validator:this.urlValidator.createDelegate(this)}),d=new Ext.form.TextField({fieldLabel:this.keywordText,allowBlank:!0,hidden:!0,width:180,msgTarget:"right"}),e=new Ext.form.TextField({fieldLabel:this.addTitleText,allowBlank:!0,width:180,msgTarget:"right"}),f=new Ext.form.ComboBox({fieldLabel:this.maxResultsText,hidden:!0,hiddenName:"max-results",store:new Ext.data.ArrayStore({fields:["max-results"],data:[[10],[25],[50],[100]]}),displayField:"max-results",mode:"local",triggerAction:"all",emptyText:"Choose number...",labelWidth:70,width:180,defaults:{labelWidth:70,width:180}}),g=new gxp.PointSymbolizer({bodyStyle:{padding:"10px"},width:280,border:!1,hidden:!0,labelWidth:70,defaults:{labelWidth:70},symbolizer:{pointGraphics:"circle",pointRadius:"5"}});g.find("name","rotation")[0].hidden=!0,"Point"===this.symbolType&&this.pointGraphics&&(cfg.pointGraphics=this.pointGraphics);var h=new Ext.Button({text:this.addFeedText,iconCls:"gxp-icon-addlayers",disabled:!0,handler:function(){var a=b.getValue(),h={name:e.getValue()};if("gxp_feedsource"!=a)h.params={q:d.getValue(),"max-results":f.getValue()};else{h.url=c.getValue();var i=g.symbolizer;h.defaultStyle={},h.selectStyle={},Ext.apply(h.defaultStyle,i),Ext.apply(h.selectStyle,i),Ext.apply(h.selectStyle,{fillColor:"Yellow",pointRadius:parseInt(i.pointRadius)+2})}this.fireEvent("addfeed",a,h)},scope:this}),i=["->",h,new Ext.Button({text:this.doneText,handler:function(){this.hide()},scope:this})];this.panel=new Ext.Panel({bbar:i,autoScroll:!0,items:[b,e,c,d,f,g],layout:"form",border:!1,labelWidth:100,bodyStyle:"padding: 5px",autoWidth:!0,autoHeight:!0}),this.items=this.panel,gxp.FeedSourceDialog.superclass.initComponent.call(this)},urlRegExp:/^(http(s)?:)?\/\/([\w%]+:[\w%]+@)?([^@\/:]+)(:\d+)?\//i,urlValidator:function(a){var b;return b=this.urlRegExp.test(a)?!this.error||this.error:this.invalidURLText,this.error=null,b}}),Ext.reg("gxp_feedsourcedialog",gxp.FeedSourceDialog),Ext.namespace("gxp.plugins"),gxp.plugins.GeoNodeCatalogueSource=Ext.extend(gxp.plugins.CatalogueSource,{ptype:"gxp_geonodecataloguesource",rootProperty:"results",baseParams:null,fields:[{name:"title",convert:function(a){return[a]}},{name:"abstract",mapping:"description"},{name:"bounds",mapping:"bbox",convert:function(a){return{left:a.minx,right:a.maxx,bottom:a.miny,top:a.maxy}}},{name:"URI",mapping:"links",convert:function(a){var b=[];for(var c in a)b.push({value:a[c].url});return b}}],createStore:function(){this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy(Ext.apply({url:this.url,method:"GET"},this.proxyOptions||{})),baseParams:Ext.apply({type:"layer"},this.baseParams),reader:new Ext.data.JsonReader({root:this.rootProperty},this.fields)}),gxp.plugins.LayerSource.prototype.createStore.apply(this,arguments)},getPagingStart:function(){return 0},getPagingParamNames:function(){return{start:"startIndex",limit:"limit"}},filter:function(a){var b=void 0;if(void 0!==a.filters)for(var c=0,d=a.filters.length;c<d;++c){var e=a.filters[c];if(e instanceof OpenLayers.Filter.Spatial){b=e.value.toBBOX();break}}Ext.apply(this.store.baseParams,{q:a.queryString}),void 0!==a.limit&&Ext.apply(this.store.baseParams,{limit:a.limit}),void 0!==b?Ext.apply(this.store.baseParams,{bbox:b}):delete this.store.baseParams.bbox,this.store.load()},createLayerRecord:function(a){return a.restUrl=this.restUrl,a.queryable=!0,gxp.plugins.GeoNodeCatalogueSource.superclass.createLayerRecord.apply(this,arguments)}}),Ext.preg(gxp.plugins.GeoNodeCatalogueSource.prototype.ptype,gxp.plugins.GeoNodeCatalogueSource),Ext.namespace("gxp.form"),gxp.form.CSWFilterField=Ext.extend(Ext.form.CompositeField,{clearTooltip:"Clear the filter for this category",emptyText:"Select filter",property:null,map:null,type:OpenLayers.Filter.Comparison.EQUAL_TO,name:null,comboFieldLabel:null,comboStoreData:null,target:null,getFilter:function(){return"BoundingBox"===this.property?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:this.property,projection:"EPSG:4326",value:this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326"))}):new OpenLayers.Filter.Comparison({type:this.type,property:this.property,value:this.combo.getValue()})},initComponent:function(){this.items=[{ref:"combo",xtype:"combo",fieldLabel:this.comboFieldLabel,store:new Ext.data.ArrayStore({fields:["id","value"],data:this.comboStoreData}),displayField:"value",valueField:"id",mode:"local",listeners:{select:function(a,b){return this.filter&&this.target.removeFilter(this.filter),this.filter=this.getFilter(),this.target.addFilter(this.filter),!1},scope:this},emptyText:this.emptyText,triggerAction:"all"},{xtype:"button",iconCls:"gxp-icon-removelayers",tooltip:this.clearTooltip,handler:function(a){this.target.removeFilter(this.filter),this.hide()},scope:this}],this.hidden=!0,gxp.form.CSWFilterField.superclass.initComponent.apply(this,arguments)},destroy:function(){this.filter=null,this.target=null,this.map=null,gxp.form.CSWFilterField.superclass.destroy.call(this)}}),Ext.reg("gxp_cswfilterfield",gxp.form.CSWFilterField),Ext.namespace("gxp"),gxp.CatalogueSearchPanel=Ext.extend(Ext.Panel,{border:!1,maxRecords:10,map:null,selectedSource:null,sources:null,searchFieldEmptyText:"Search",searchButtonText:"Search",addTooltip:"Create filter",addMapTooltip:"Add to map",advancedTitle:"Advanced",datatypeLabel:"Data type",extentLabel:"Spatial extent",categoryLabel:"Category",datasourceLabel:"Data source",filterLabel:"Filter search by",removeSourceTooltip:"Switch back to original source",initComponent:function(){var a=this;this.addEvents("addlayer"),this.filters=[];var b=[];for(var c in this.sources)b.push([c,this.sources[c].title]);b.length>=1&&(this.selectedSource=b[0][0]);var d=[["datatype","data type"],["extent","spatial extent"],["category","category"]];b.length>1&&d.push(["csw","data source"]),this.sources[this.selectedSource].store.on("loadexception",function(a,b,c,d){c.success()&&Ext.Msg.show({title:d.message,msg:gxp.util.getOGCExceptionText(d.arg.exceptionReport),icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK})}),this.items=[{xtype:"form",border:!1,ref:"form",hideLabels:!0,autoHeight:!0,style:"margin-left: 5px; margin-right: 5px; margin-bottom: 5px; margin-top: 5px",items:[{xtype:"compositefield",items:[{xtype:"textfield",emptyText:this.searchFieldEmptyText,ref:"../../search",name:"search",listeners:{specialkey:function(a,b){b.getKey()==b.ENTER&&this.performQuery()},scope:this},width:250},{xtype:"button",text:this.searchButtonText,handler:this.performQuery,scope:this}]},{xtype:"fieldset",collapsible:!0,collapsed:!0,hideLabels:!1,hidden:!0,title:this.advancedTitle,items:[{xtype:"gxp_cswfilterfield",name:"datatype",property:"apiso:Type",comboFieldLabel:this.datatypeLabel,comboStoreData:[["dataset","Dataset"],["datasetcollection","Dataset collection"],["application","Application"],["service","Service"]],target:this},{xtype:"gxp_cswfilterfield",name:"extent",property:"BoundingBox",map:this.map,comboFieldLabel:this.extentLabel,comboStoreData:[["map","spatial extent of the map"]],target:this},{xtype:"gxp_cswfilterfield",name:"category",property:"apiso:TopicCategory",comboFieldLabel:this.categoryLabel,comboStoreData:[["farming","Farming"],["biota","Biota"],["boundaries","Boundaries"],["climatologyMeteorologyAtmosphere","Climatology/Meteorology/Atmosphere"],["economy","Economy"],["elevation","Elevation"],["environment","Environment"],["geoscientificinformation","Geoscientific Information"],["health","Health"],["imageryBaseMapsEarthCover","Imagery/Base Maps/Earth Cover"],["intelligenceMilitary","Intelligence/Military"],["inlandWaters","Inland Waters"],["location","Location"],["oceans","Oceans"],["planningCadastre","Planning Cadastre"],["society","Society"],["structure","Structure"],["transportation","Transportation"],["utilitiesCommunications","Utilities/Communications"]],target:this},{xtype:"compositefield",id:"csw",ref:"../../cswCompositeField",hidden:!0,items:[{xtype:"combo",ref:"../../../sourceCombo",fieldLabel:this.datasourceLabel,store:new Ext.data.ArrayStore({fields:["id","value"],data:b}),displayField:"value",valueField:"id",mode:"local",listeners:{select:function(a,b){this.setSource(a.getValue())},render:function(){this.sourceCombo.setValue(this.selectedSource)},scope:this},triggerAction:"all"},{xtype:"button",iconCls:"gxp-icon-removelayers",tooltip:this.removeSourceTooltip,handler:function(a){this.setSource(this.initialConfig.selectedSource),this.sourceCombo.setValue(this.initialConfig.selectedSource),this.cswCompositeField.hide()},scope:this}]},{xtype:"compositefield",items:[{xtype:"combo",fieldLabel:this.filterLabel,store:new Ext.data.ArrayStore({fields:["id","value"],data:d}),displayField:"value",valueField:"id",mode:"local",triggerAction:"all"},{xtype:"button",iconCls:"gxp-icon-addlayers",tooltip:this.addTooltip,handler:function(a){a.ownerCt.items.each(function(a){if("combo"===a.getXType()){var b=a.getValue();a.clearValue();var c=this.form.getForm().findField(b);c&&c.show()}},this)},scope:this}]}]},{xtype:"grid",width:"100%",anchor:"99%",viewConfig:{scrollOffset:0,forceFit:!0},border:!1,ref:"../grid",bbar:new Ext.PagingToolbar({listeners:{beforechange:function(b,c){var d=a.sources[a.selectedSource].getPagingStart();c.startPosition&&(c.startPosition+=d)}},onLoad:function(b,c,d){var e=a.sources[a.selectedSource].getPagingStart();if(!this.rendered)return void(this.dsLoaded=[b,c,d]);var f=this.getParams();this.cursor=d.params&&d.params[f.start]?d.params[f.start]-e:0;var g=this.getPageData(),h=g.activePage,i=g.pages;this.afterTextItem.setText(String.format(this.afterPageText,g.pages)),this.inputItem.setValue(h),this.first.setDisabled(1==h),this.prev.setDisabled(1==h),this.next.setDisabled(h==i),this.last.setDisabled(h==i),this.refresh.enable(),this.updateInfo(),this.fireEvent("change",this,g)},paramNames:this.sources[this.selectedSource].getPagingParamNames(),store:this.sources[this.selectedSource].store,pageSize:this.maxRecords}),loadMask:!0,hideHeaders:!0,store:this.sources[this.selectedSource].store,columns:[{id:"title",xtype:"templatecolumn",tpl:new Ext.XTemplate("<b>{title}</b><br/>{abstract}"),sortable:!0},{xtype:"actioncolumn",width:30,items:[{getClass:function(a,b,c){if(this.findWMS(c.get("URI"))!==!1||this.findWMS(c.get("references"))!==!1)return"gxp-icon-addlayers"},tooltip:this.addMapTooltip,handler:function(a,b,c){var d=this.grid.store.getAt(b);this.addLayer(d)},scope:this}]}],autoExpandColumn:"title",autoHeight:!0}]}],gxp.CatalogueSearchPanel.superclass.initComponent.apply(this,arguments)},destroy:function(){this.sources=null,this.map=null,gxp.CatalogueSearchPanel.superclass.destroy.call(this)},setSource:function(a){this.selectedSource=a;var b=this.sources[a].store;this.grid.reconfigure(b,this.grid.getColumnModel()),this.grid.getBottomToolbar().bindStore(b)},performQuery:function(){var a=this.sources[this.selectedSource];a.filter({queryString:this.search.getValue(),limit:this.maxRecords,filters:this.filters})},addFilter:function(a){this.filters.push(a)},removeFilter:function(a){this.filters.remove(a)},findWMS:function(a){var e,f,g,b=["OGC:WMS-1.1.1-HTTP-GET-MAP","OGC:WMS"],c=null,d=null;for(e=0,f=a.length;e<f;++e)if(g=a[e],g.protocol&&b.indexOf(g.protocol.toUpperCase())!==-1&&g.value&&g.name){c=g.value,d=g.name;break}if(null===c)for(e=0,f=a.length;e<f;++e){g=a[e];var h=g.value?g.value:g;if(h.toLowerCase().indexOf("service=wms")>0){var i=OpenLayers.Util.createUrlObject(h);c=i.protocol+"//"+i.host+":"+i.port+i.pathname,d=i.args.layers;break}}return null!==c&&null!==d&&{url:c,name:d}},addLayer:function(a){var b=a.get("URI"),c=a.get("bounds"),d=c.left,e=c.right,f=c.bottom,g=c.top,h=Math.min(d,e),i=Math.max(d,e),j=Math.min(f,g),k=Math.max(f,g),l=this.findWMS(b);if(l===!1){var m=a.get("references");l=this.findWMS(m)}l!==!1&&this.fireEvent("addlayer",this,this.selectedSource,Ext.apply({title:a.get("title")[0],bbox:[h,j,i,k],srs:"EPSG:4326",projection:a.get("projection")},l))}}),Ext.reg("gxp_cataloguesearchpanel",gxp.CatalogueSearchPanel),OpenLayers.Format.TMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML,{defaultPrefix:"tms",readers:{tms:{Services:function(a,b){b.services=[],this.readChildNodes(a,b)},TileMapService:function(a,b){b.services?b.services.push({service:"TMS",version:a.getAttribute("version"),title:a.getAttribute("title"),href:a.getAttribute("href")}):this.readChildNodes(a,b)},TileMaps:function(a,b){b.tileMaps=[],this.readChildNodes(a,b)},TileMap:function(a,b){b.tileMaps?b.tileMaps.push({href:a.getAttribute("href"),srs:a.getAttribute("srs"),title:a.getAttribute("title"),profile:a.getAttribute("profile")}):(b.version=a.getAttribute("version"),b.tileMapService=a.getAttribute("tilemapservice"),this.readChildNodes(a,b))},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.abstract=this.getChildValue(a)},SRS:function(a,b){b.srs=this.getChildValue(a)},BoundingBox:function(a,b){b.bbox=new OpenLayers.Bounds(a.getAttribute("minx"),a.getAttribute("miny"),a.getAttribute("maxx"),a.getAttribute("maxy"))},Origin:function(a,b){b.origin=new OpenLayers.LonLat(a.getAttribute("x"),a.getAttribute("y"))},TileFormat:function(a,b){b.tileFormat={width:parseInt(a.getAttribute("width"),10),height:parseInt(a.getAttribute("height"),10),mimeType:a.getAttribute("mime-type"),extension:a.getAttribute("extension")}},TileSets:function(a,b){b.tileSets=[],this.readChildNodes(a,b)},TileSet:function(a,b){b.tileSets.push({href:a.getAttribute("href"),unitsPerPixel:parseFloat(a.getAttribute("units-per-pixel")),order:parseInt(a.getAttribute("order"),10)})},TileMapServerError:function(a,b){b.error=!0},Message:function(a,b){b.message=this.getChildValue(a)}}},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var c={};return this.readNode(a,c),c},CLASS_NAME:"OpenLayers.Format.TMSCapabilities"}),Ext.ns("gxp.data","gxp.plugins"),gxp.data.TMSCapabilitiesReader=Ext.extend(Ext.data.DataReader,{constructor:function(a,b){a=a||{},a.format||(a.format=new OpenLayers.Format.TMSCapabilities),"function"!=typeof b&&(b=GeoExt.data.LayerRecord.create(b||a.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"tileMapUrl",type:"string"}])),gxp.data.TMSCapabilitiesReader.superclass.constructor.call(this,a,b)},read:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),this.readRecords(b)},readRecords:function(a){var c,d,e,f,b=[];if("string"==typeof a||a.nodeType)if(a=this.meta.format.read(a),this.raw=a,a.tileMaps)for(c=0,d=a.tileMaps.length;c<d;++c){var i=a.tileMaps[c];if(f=new OpenLayers.Projection(i.srs),this.meta.mapProjection.equals(f)){e=i.href;var j=e.substring(e.indexOf(this.meta.version+"/")+6);b.push(new this.recordType({layer:new OpenLayers.Layer.TMS(i.title,this.meta.baseUrl.indexOf(this.meta.version)!==-1?this.meta.baseUrl.replace(this.meta.version+"/",""):this.meta.baseUrl,{layername:j}),title:i.title,name:i.title,tileMapUrl:e}))}}else if(a.tileSets&&(f=new OpenLayers.Projection(a.srs),this.meta.mapProjection.equals(f))){var g=[];for(c=0,d=a.tileSets.length;c<d;++c)g.push(a.tileSets[c].unitsPerPixel);e=this.meta.baseUrl;var h=e.substring(e.indexOf(this.meta.version)+this.meta.version.length+1,e.lastIndexOf("/"));b.push(new this.recordType({layer:new OpenLayers.Layer.TMS(a.title,a.tileMapService.replace("/"+this.meta.version,""),{serverResolutions:g,type:a.tileFormat.extension,layername:h}),title:a.title,name:a.title,tileMapUrl:this.meta.baseUrl}))}return{totalRecords:b.length,success:!0,records:b}}}),gxp.plugins.TMSSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_tmssource",version:"1.0.0",constructor:function(a){gxp.plugins.TMSSource.superclass.constructor.apply(this,arguments),this.format=new OpenLayers.Format.TMSCapabilities,"/"!==this.url.slice(-1)&&(this.url=this.url+"/")},createStore:function(){this.format;this.store=new Ext.data.Store({autoLoad:!0,listeners:{load:function(){this.title=this.store.reader.raw.title,this.fireEvent("ready",this)},exception:function(){var a="Trouble creating TMS layer store from response.",b="Unable to handle response.";this.fireEvent("failure",this,a,b)},scope:this},proxy:new Ext.data.HttpProxy({url:this.url.indexOf(this.version)===-1?this.url+this.version:this.url,disableCaching:!1,method:"GET"}),reader:new gxp.data.TMSCapabilitiesReader({baseUrl:this.url,version:this.version,mapProjection:this.getMapProjection()})})},createLayerRecord:function(a,b,c){var d=this.store.findExact("name",a.name);if(d>-1){var e=this.store.getAt(d),f=e.getLayer();if(null!==f.serverResolutions)return e;Ext.Ajax.request({url:e.get("tileMapUrl"),success:function(d){for(var e=[],g=this.format.read(d.responseText),h=0,i=g.tileSets.length;h<i;++h)e.push(g.tileSets[h].unitsPerPixel);f.addOptions({serverResolutions:e,type:g.tileFormat.extension}),this.target.createLayerRecord({source:this.id,name:a.name},b,c)},scope:this})}}}),Ext.preg(gxp.plugins.TMSSource.prototype.ptype,gxp.plugins.TMSSource),OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:!0,initialize:function(a,b,c,d){var e=[];c=OpenLayers.Util.upperCaseObject(c),e.push(a,b,c,d),OpenLayers.Layer.Grid.prototype.initialize.apply(this,e),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=d&&d.isBaseLayer||(this.isBaseLayer=!1),"jpg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"))},clone:function(a){return null==a&&(a=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=this.projection.getCode().split(":"),c=b[b.length-1],d=this.getImageSize(),e={BBOX:a.toBBOX(),SIZE:d.w+","+d.h,F:"image",BBOXSR:c,IMAGESR:c};if(this.layerDefs){var g,f=[];for(g in this.layerDefs)this.layerDefs.hasOwnProperty(g)&&this.layerDefs[g]&&(f.push(g),f.push(":"),f.push(this.layerDefs[g]),f.push(";"));f.length>0&&(e.LAYERDEFS=f.join(""))}var h=this.getFullRequestString(e);return h},setLayerFilter:function(a,b){this.layerDefs||(this.layerDefs={}),b?this.layerDefs[a]=b:delete this.layerDefs[a]},clearLayerFilter:function(a){a?delete this.layerDefs[a]:delete this.layerDefs},mergeNewParams:function(a){var b=OpenLayers.Util.upperCaseObject(a),c=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,c)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"}),Ext.namespace("gxp.plugins"),gxp.plugins.ArcRestSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_arcrestsource",requiredProperties:["name"],constructor:function(a){this.config=a,gxp.plugins.ArcRestSource.superclass.constructor.apply(this,arguments)},createStore:function(){var a=this.url.split("?")[0],b=this,c=function(c){var e=Ext.decode(c.responseText),f=b.getArcProjection(e.spatialReference.wkid),g=[];if(null!=f)for(var h=0;h<e.layers.length;h++){var i=e.layers[h],j="show:"+i.id;g.push(new OpenLayers.Layer.ArcGIS93Rest(i.name,a+"/export",{layers:j,TRANSPARENT:!0},{isBaseLayer:!1,ratio:1,displayInLayerSwitcher:!0,visibility:!0,projection:f,queryable:e.capabilities&&e.capabilities.Identify}))}else d(c);b.title=e.documentInfo.Title,b.store=new GeoExt.data.LayerStore({layers:g,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"name"},{name:"layerid",type:"string"},{name:"group",type:"string",defaultValue:this.title},{name:"fixed",type:"boolean",defaultValue:!0},{name:"tiled",type:"boolean",defaultValue:!0},{name:"queryable",type:"boolean",defaultValue:!0},{name:"selected",type:"boolean"}]}),b.fireEvent("ready",b)},d=function(a){Ext.Msg.alert("No ArcGIS Layers","Could not find any compatible layers  at "+b.config.url),b.fireEvent("failure",b)};this.lazy=this.isLazy(),this.lazy?this.fireEvent("ready"):Ext.Ajax.request({url:a,params:{f:"json",pretty:"false",keepPostParams:"true"},method:"POST",success:c,failure:d})},isLazy:function(){var a=!0,b=!1,c=this.target.initialConfig.map;if(c&&c.layers)for(var d,e=0,f=c.layers.length;e<f&&(d=c.layers[e],d.source!==this.id||(b=!0,a=this.layerConfigComplete(d),a!==!1));++e);return a&&b},layerConfigComplete:function(a){for(var b=!0,c=this.requiredProperties,d=c.length-1;d>=0&&(b=!!a[c[d]],b!==!1);--d);return b},createLayerRecord:function(a){var b,c,d=function(b){return b.get("name")===a.name},e=this.lazy||this.store&&this.store.findBy(d)>-1;if(this.target.mapPanel.layers.findBy(d)==-1&&e){b=!this.lazy&&this.store.findBy(d)>-1?this.store.getAt(this.store.findBy(d)).clone():this.createLazyLayerRecord(a),c=b.getLayer(),a.title&&(c.setName(a.title),b.set("title",a.title)),"visibility"in a&&(c.visibility=a.visibility),"opacity"in a&&(c.opacity=a.opacity),"format"in a&&(c.params.FORMAT=a.format,b.set("format",a.format));var f=!1;"tiled"in a&&(f=!a.tiled),b.set("tiled",!f),b.set("selected",a.selected||!1),b.set("queryable",a.queryable||!0),b.set("source",a.source),b.set("name",a.name),b.set("layerid",a.layerid),b.set("properties","gxp_wmslayerpanel"),"group"in a&&b.set("group",a.group),b.commit()}return b},getArcProjection:function(a){var b=this.getMapProjection(),c=b,d="EPSG:"+a;return d!==b.getCode()&&(c=null,(p=new OpenLayers.Projection(d)).equals(b)&&(c=p)),c},createLazyLayerRecord:function(a){var b=a.srs||this.target.map.projection;a.srs={},a.srs[b]=!0;var c=a.bbox||this.target.map.maxExtent||OpenLayers.Projection.defaults[b].maxExtent;a.bbox={},a.bbox[b]={bbox:c};var d=new GeoExt.data.LayerRecord(a);return d.set("name",a.name),d.set("layerid",a.layerid||"show:0"),d.set("format",a.format||"png"),d.set("tiled",!("tiled"in a)||a.tiled),d.setLayer(new OpenLayers.Layer.ArcGIS93Rest(a.name,this.url.split("?")[0]+"/export",{layers:a.layerid,TRANSPARENT:!0,FORMAT:"format"in a?a.format:"png"},{isBaseLayer:!1,displayInLayerSwitcher:!0,projection:b,singleTile:"tiled"in a&&!a.tiled,queryable:"queryable"in a&&a.queryable})),d},getConfigForRecord:function(a){var b=a.getLayer();return{source:a.get("source"),name:a.get("name"),title:a.get("title"),tiled:a.get("tiled"),visibility:b.getVisibility(),layerid:b.params.LAYERS,format:b.params.FORMAT,opacity:b.opacity||void 0,group:a.get("group"),fixed:a.get("fixed"),selected:a.get("selected")}}}),Ext.preg(gxp.plugins.ArcRestSource.prototype.ptype,gxp.plugins.ArcRestSource),Ext.namespace("gxp.plugins"),gxp.plugins.AddLayers=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_addlayers",addActionMenuText:"Add layers",findActionMenuText:"Find layers",addFeedActionMenuText:"Add feeds",addActionTip:"Add layers",addServerText:"Add a New Server",addButtonText:"Add layers",untitledText:"Untitled",addLayerSourceErrorText:"Error getting {type} capabilities ({msg}).\nPlease check the url and try again.",availableLayersText:"Available Layers",searchText:"Search for layers",expanderTemplateText:"<p><b>Abstract:</b> {abstract}</p>",panelTitleText:"Title",layerSelectionText:"View available data from:",doneText:"Done",uploadRoles:["ROLE_ADMINISTRATOR"],uploadText:"Upload layers",relativeUploadOnly:!0,startSourceId:null,catalogSourceKey:null,selectedSource:null,addServerId:null,constructor:function(a){this.addEvents("sourceselected"),gxp.plugins.AddLayers.superclass.constructor.apply(this,arguments)},addActions:function(){var b,c,a={tooltip:this.addActionTip,text:this.addActionText,menuText:this.addActionMenuText,disabled:!0,iconCls:"gxp-icon-addlayers"};if(this.initialConfig.search||this.uploadSource){var d=[new Ext.menu.Item({iconCls:"gxp-icon-addlayers",text:this.addActionMenuText,handler:this.showCapabilitiesGrid,scope:this})];if(this.initialConfig.search&&this.initialConfig.search.selectedSource&&this.target.sources[this.initialConfig.search.selectedSource]){var e=new Ext.menu.Item({
iconCls:"gxp-icon-addlayers",text:this.findActionMenuText,handler:this.showCatalogueSearch,scope:this});d.push(e),Ext.Ajax.request({method:"GET",url:this.target.sources[this.initialConfig.search.selectedSource].url,callback:function(a,b,c){b===!1&&(this.target.layerSources[this.initialConfig.search.selectedSource].disable(),e.hide())},scope:this})}this.initialConfig.feeds&&d.push(new Ext.menu.Item({iconCls:"gxp-icon-addlayers",text:this.addFeedActionMenuText,handler:this.showFeedDialog,scope:this})),this.uploadSource&&(c=this.createUploadButton(Ext.menu.Item),c&&d.push(c)),b=Ext.apply(a,{menu:new Ext.menu.Menu({items:d})})}else b=Ext.apply(a,{handler:this.showCapabilitiesGrid,scope:this});var f=gxp.plugins.AddLayers.superclass.addActions.apply(this,[b]);return this.target.on("ready",function(){if(this.uploadSource){var a=this.target.layerSources[this.uploadSource];a?this.setSelectedSource(a):(delete this.uploadSource,c&&c.hide())}f[0].enable()},this),f},showCatalogueSearch:function(){var a=this.initialConfig.search.selectedSource,b={},c=!1;for(var d in this.target.layerSources){var e=this.target.layerSources[d];if(e instanceof gxp.plugins.CatalogueSource){var f={};f[d]=e,Ext.apply(b,f),c=!0}}if(c===!1)return void(window.console&&window.console.debug("No catalogue source specified"));var g=gxp.plugins.AddLayers.superclass.addOutput.apply(this,[{sources:b,title:this.searchText,height:300,width:315,selectedSource:a,xtype:"gxp_cataloguesearchpanel",map:this.target.mapPanel.map}]);g.on({addlayer:function(a,b,c){var d=this.target.layerSources[b],e=OpenLayers.Bounds.fromArray(c.bbox,d.yx&&d.yx[c.projection]===!0),f=this.target.mapPanel.map.getProjection(),g=e.transform(c.srs,f);c.srs=f,c.bbox=g.toArray(),c.source=null!==this.initialConfig.catalogSourceKey?this.initialConfig.catalogSourceKey:b;var h=d.createLayerRecord(c);this.target.mapPanel.layers.add(h),g&&this.target.mapPanel.map.zoomToExtent(g)},scope:this});var h=g.findParentByType("window");return h&&h.center(),g},showCapabilitiesGrid:function(){this.capGrid?this.capGrid instanceof Ext.Window||this.addOutput(this.capGrid):this.initCapGrid(),this.capGrid.show()},showFeedDialog:function(){if(!this.feedDialog){var a=this.outputTarget?Ext.Panel:Ext.Window;this.feedDialog=new a(Ext.apply({closeAction:"hide",autoScroll:!0,title:this.addFeedActionMenuText,items:[{xtype:"gxp_feedsourcedialog",target:this.target,listeners:{addfeed:function(a,b){var c={config:{ptype:a}};b.url&&(c.config.url=b.url);var d=this.target.addLayerSource(c);b.source=d.id;var e=d.createLayerRecord(b);this.target.mapPanel.layers.add([e]),this.feedDialog.hide()},scope:this}}]},this.initialConfig.outputConfig)),a===Ext.Panel&&this.addOutput(this.feedDialog)}this.feedDialog instanceof Ext.Window||this.addOutput(this.feedDialog),this.feedDialog.show()},initCapGrid:function(){function g(){function e(a){c&&c.push(a),d--,0===d&&this.addLayers(c)}for(var a=this.selectedSource,b=i.getSelectionModel().getSelections(),c=[],d=b.length,f=0,g=b.length;f<g;++f){var h=a.createLayerRecord({name:b[f].get("name"),source:a.id},e,this);h&&e.call(this,h)}}function o(){n.outputTarget?n.addOutput(m):new Ext.Window({title:gxp.NewSourceDialog.prototype.title,modal:!0,hideBorders:!0,width:300,items:m}).show()}var a,b=[],c=this.target;for(var d in c.layerSources)a=c.layerSources[d],a.store&&!a.hidden&&b.push([d,a.title||d,a.url]);var e=new Ext.data.ArrayStore({fields:["id","title","url"],data:b}),f=this.createExpander(),h=0;null!==this.startSourceId&&e.each(function(a){a.get("id")===this.startSourceId&&(h=e.indexOf(a))},this),a=this.target.layerSources[b[h][0]];var l,i=new Ext.grid.GridPanel({store:a.store,autoScroll:!0,autoExpandColumn:"title",plugins:[f],loadMask:!0,colModel:new Ext.grid.ColumnModel([f,{id:"title",header:this.panelTitleText,dataIndex:"title",sortable:!0},{header:"Id",dataIndex:"name",width:120,sortable:!0}]),listeners:{rowdblclick:g,scope:this}}),j=new Ext.form.ComboBox({ref:"../../sourceComboBox",width:165,store:e,valueField:"id",displayField:"title",tpl:'<tpl for="."><div ext:qtip="{url}" class="x-combo-list-item">{title}</div></tpl>',triggerAction:"all",editable:!1,allowBlank:!1,forceSelection:!0,mode:"local",value:b[h][0],listeners:{select:function(a,b,c){var d=b.get("id");if(d===this.addServerId)return o(),void j.reset();var e=this.target.layerSources[d];i.reconfigure(e.store,i.getColumnModel()),i.getView().focusRow(0),this.setSelectedSource(e),function(){a.triggerBlur(),a.el.blur()}.defer(100)},focus:function(a){c.proxy&&a.reset()},scope:this}}),k=null;(this.target.proxy||b.length>1)&&(l=new Ext.Container({cls:"gxp-addlayers-sourceselect",items:[new Ext.Toolbar.TextItem({text:this.layerSelectionText}),j]}),k=[l]),this.target.proxy&&(this.addServerId=Ext.id(),e.loadData([[this.addServerId,this.addServerText+"..."]],!0));var m={xtype:"gxp_newsourcedialog",header:!1,listeners:{hide:function(a){this.outputTarget||a.ownerCt.hide()},urlselected:function(a,b,c){a.setLoading();var d;switch(c){case"TMS":d="gxp_tmssource";break;case"REST":d="gxp_arcrestsource";break;default:d="gxp_wmscsource"}this.target.addLayerSource({config:{url:b,ptype:d},callback:function(b){var c=new e.recordType({id:b,title:this.target.layerSources[b].title||this.untitledText});e.insert(0,[c]),j.onSelect(c,0),a.hide()},fallback:function(b,d){a.setError(new Ext.Template(this.addLayerSourceErrorText).apply({type:c,msg:d}))},scope:this})},scope:this}},n=this,p={xtype:"container",region:"center",layout:"fit",hideBorders:!0,items:[i]};this.instructionsText&&p.items.push({xtype:"box",autoHeight:!0,autoEl:{tag:"p",cls:"x-form-item",style:"padding-left: 5px; padding-right: 5px"},html:this.instructionsText});var r,q=["->",new Ext.Button({text:this.addButtonText,iconCls:"gxp-icon-addlayers",handler:g,scope:this}),new Ext.Button({text:this.doneText,handler:function(){this.capGrid.hide()},scope:this})];this.uploadSource||(r=this.createUploadButton(),r&&q.unshift(r));var s=this.outputTarget?Ext.Panel:Ext.Window;this.capGrid=new s(Ext.apply({title:this.availableLayersText,closeAction:"hide",layout:"border",height:300,width:315,modal:!0,items:p,tbar:k,bbar:q,listeners:{hide:function(a){i.getSelectionModel().clearSelections()},show:function(a){null===this.selectedSource?this.setSelectedSource(this.target.layerSources[b[h][0]]):this.setSelectedSource(this.selectedSource)},scope:this}},this.initialConfig.outputConfig)),s===Ext.Panel&&this.addOutput(this.capGrid)},addLayers:function(a,b){for(var e,f,g,c=this.selectedSource,d=this.target.mapPanel.layers,h=0,i=a.length;h<i;++h)f=c.createLayerRecord({name:a[h].get("name"),source:c.id})||a[h],f&&(g=f.getLayer(),g.maxExtent&&(e?e.extend(f.getLayer().maxExtent):e=f.getLayer().maxExtent.clone()),"background"===f.get("group")?d.insert(1,[f]):d.add([f]));if(e&&this.target.mapPanel.map.zoomToExtent(e),1===a.length&&f&&(this.target.selectLayer(f),b&&this.postUploadAction)){var j,k=this.postUploadAction;Ext.isString(k)||(j=k.outputConfig,k=k.plugin),this.target.tools[k].addOutput(j)}},setSelectedSource:function(a,b){this.selectedSource=a;a.store;this.fireEvent("sourceselected",this,a),this.capGrid&&a.lazy&&a.store.load({callback:function(){var a=this.capGrid.sourceComboBox,b=a.store,c=a.valueField,d=b.findExact(c,a.getValue()),e=b.getAt(d),f=this.target.layerSources[e.get("id")];f?f.title===e.get("title")||Ext.isEmpty(f.title)||(e.set("title",f.title),a.setValue(e.get(c))):b.remove(e)}.createDelegate(this)})},createUploadButton:function(a){function f(a,b,c){a in e?window.setTimeout(function(){b.call(c,e[a])},0):Ext.Ajax.request({url:a,disableCaching:!1,callback:function(d,f,g){var h=g.status;e[a]=h,b.call(c,h)}})}a=a||Ext.Button;var b,d,c=this.initialConfig.upload||!!this.initialConfig.uploadSource;if(c){"boolean"==typeof c&&(c={}),b=new a({text:this.uploadText,iconCls:"gxp-icon-filebrowse",hidden:!this.uploadSource,handler:function(){this.target.doAuthorized(this.uploadRoles,function(){var b,a=new gxp.LayerUploadPanel(Ext.apply({title:this.outputTarget?this.uploadText:void 0,url:d,width:300,border:!1,bodyStyle:"padding: 10px 10px 0 10px;",labelWidth:65,autoScroll:!0,defaults:{anchor:"99%",allowBlank:!1,msgTarget:"side"},listeners:{uploadcomplete:function(a,c){for(var e,d=c.import.tasks,f={},i=0,j=d.length;i<j;++i){if(e=d[i],"ERROR"===e.state)return void Ext.Msg.alert(e.layer.originalName,e.errorMessage);var k;e.target.dataStore?k=e.target.dataStore.workspace.name:e.target.coverageStore&&(k=e.target.coverageStore.workspace.name),f[k+":"+e.layer.name]=!0}this.selectedSource.store.load({params:{_dc:Math.random()},callback:function(a,b,c){var d,e;this.capGrid&&this.capGrid.isVisible()&&(d=this.capGrid.get(0).get(0),e=d.getSelectionModel(),e.clearSelections());var g=[],h=0;this.selectedSource.store.each(function(a,b){a.get("name")in f&&(h=b,g.push(a))}),d?window.setTimeout(function(){e.selectRecords(g),d.getView().focusRow(h)},100):this.addLayers(g,!0)},scope:this}),this.outputTarget?a.hide():b.close()},scope:this}},c));this.outputTarget?this.addOutput(a):(b=new Ext.Window({title:this.uploadText,modal:!0,resizable:!1,items:[a]}),b.show())},this)},scope:this});var e={};this.on({sourceselected:function(a,c){b[this.uploadSource?"show":"hide"]();this.isEligibleForUpload(c)&&(d=this.getGeoServerRestUrl(c.url),this.target.isAuthorized()&&f(d+"/imports",function(a){b.setVisible(200===a)},this))},scope:this})}return b},getGeoServerRestUrl:function(a){var b=a.split("/");return b.pop(),b.push("rest"),b.join("/")},isEligibleForUpload:function(a){return a.url&&(!this.relativeUploadOnly||"/"===a.url.charAt(0))&&(this.nonUploadSources||[]).indexOf(a.id)===-1},createExpander:function(){return new Ext.grid.RowExpander({tpl:new Ext.Template(this.expanderTemplateText)})}}),Ext.preg(gxp.plugins.AddLayers.prototype.ptype,gxp.plugins.AddLayers),Ext.namespace("gxp.plugins"),gxp.plugins.RemoveLayer=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_removelayer",removeMenuText:"Remove layer",removeActionTip:"Remove layer",addActions:function(){var a,b=gxp.plugins.RemoveLayer.superclass.addActions.apply(this,[{menuText:this.removeMenuText,iconCls:"gxp-icon-removelayers",disabled:!0,tooltip:this.removeActionTip,handler:function(){var b=a;b&&this.target.mapPanel.layers.remove(b)},scope:this}]),c=b[0];this.target.on("layerselectionchange",function(b){a=b,c.setDisabled(this.target.mapPanel.layers.getCount()<=1||!b)},this);var d=function(b){c.setDisabled(!a||b.getCount()<=1)};return this.target.mapPanel.layers.on({add:d,remove:d}),b}}),Ext.preg(gxp.plugins.RemoveLayer.prototype.ptype,gxp.plugins.RemoveLayer),Ext.namespace("gxp.plugins"),gxp.plugins.LayerProperties=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_layerproperties",menuText:"Layer Properties",toolTip:"Layer Properties",constructor:function(a){gxp.plugins.LayerProperties.superclass.constructor.apply(this,arguments),this.outputConfig||(this.outputConfig={width:325,autoHeight:!0})},addActions:function(){var a=gxp.plugins.LayerProperties.superclass.addActions.apply(this,[{menuText:this.menuText,iconCls:"gxp-icon-layerproperties",disabled:!0,tooltip:this.toolTip,handler:function(){this.removeOutput(),this.addOutput()},scope:this}]),b=a[0];return this.target.on("layerselectionchange",function(a){b.setDisabled(!a||!a.get("properties"))},this),a},addOutput:function(a){a=a||{};var b=this.target.selectedLayer,c=this.initialConfig.outputConfig||{};this.outputConfig.title=c.title||this.menuText+": "+b.get("title"),this.outputConfig.shortTitle=b.get("title");var d=b.get("properties")||"gxp_layerpanel",e=this.layerPanelConfig;e&&e[d]&&Ext.apply(a,e[d]);var f=gxp.plugins.LayerProperties.superclass.addOutput.call(this,Ext.apply({xtype:d,authorized:this.target.isAuthorized(),layerRecord:b,source:this.target.getSource(b),defaults:{style:"padding: 10px",autoHeight:this.outputConfig.autoHeight}},a));return f.on({added:function(a){this.outputTarget||a.on("afterrender",function(){a.ownerCt.ownerCt.center()},this,{single:!0})},scope:this}),f}}),Ext.preg(gxp.plugins.LayerProperties.prototype.ptype,gxp.plugins.LayerProperties),Ext.namespace("gxp.plugins"),gxp.plugins.ZoomToLayerExtent=Ext.extend(gxp.plugins.ZoomToExtent,{ptype:"gxp_zoomtolayerextent",menuText:"Zoom to layer extent",tooltip:"Zoom to layer extent",iconCls:"gxp-icon-zoom-to",destroy:function(){this.selectedRecord=null,gxp.plugins.ZoomToLayerExtent.superclass.destroy.apply(this,arguments)},extent:function(){var b,a=this.selectedRecord.getLayer();return OpenLayers.Layer.Vector&&(b=a instanceof OpenLayers.Layer.Vector&&a.getDataExtent()),a.restrictedExtent||b||a.maxExtent||map.maxExtent},addActions:function(){var a=gxp.plugins.ZoomToLayerExtent.superclass.addActions.apply(this,arguments);return a[0].disable(),this.target.on("layerselectionchange",function(b){this.selectedRecord=b,a[0].setDisabled(!b||!b.get("layer"))},this),a}}),Ext.preg(gxp.plugins.ZoomToLayerExtent.prototype.ptype,gxp.plugins.ZoomToLayerExtent),Ext.namespace("gxp.plugins"),gxp.plugins.ZoomToSelectedFeatures=Ext.extend(gxp.plugins.ZoomToExtent,{ptype:"gxp_zoomtoselectedfeatures",menuText:"Zoom to selected features",tooltip:"Zoom to selected features",closest:!1,layer:null,iconCls:"gxp-icon-zoom-to",extent:function(){for(var b,c,d,a=this.target.tools[this.featureManager].featureLayer,e=a.selectedFeatures,f=e.length-1;f>=0;--f)c=e[f].geometry,c&&(d=c.getBounds(),b?b.extend(d):b=d.clone());return b},addActions:function(){function d(){this.layer&&this.layer.events.un(b),this.layer=c.featureLayer,this.layer&&this.layer.events.on(b)}var a=gxp.plugins.ZoomToSelectedFeatures.superclass.addActions.apply(this,arguments);a[0].disable();var b={featureselected:function(b){a[0].isDisabled()&&null!==b.feature.geometry&&a[0].enable()},featureunselected:function(){0===this.layer.selectedFeatures.length&&a[0].disable()},scope:this},c=this.target.tools[this.featureManager];return this.target.on("layerselectionchange",d),c.on("query",function(){a[0].disable()}),d.call(this),a}}),Ext.preg(gxp.plugins.ZoomToSelectedFeatures.prototype.ptype,gxp.plugins.ZoomToSelectedFeatures),Ext.namespace("gxp.plugins"),gxp.plugins.Legend=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_legend",menuText:"Legend",tooltip:"Show Legend",actionTarget:null,constructor:function(a){gxp.plugins.Legend.superclass.constructor.apply(this,arguments),this.outputConfig||(this.outputConfig={width:300,height:400}),Ext.applyIf(this.outputConfig,{title:this.menuText})},addActions:function(){var a=[{menuText:this.menuText,iconCls:"gxp-icon-legend",tooltip:this.tooltip,handler:function(){this.removeOutput(),this.addOutput(this.outputConfig)},scope:this}];return gxp.plugins.Legend.superclass.addActions.apply(this,[a])},getLegendPanel:function(){return this.output[0]},addOutput:function(a){return gxp.plugins.Legend.superclass.addOutput.call(this,Ext.apply({xtype:"gx_legendpanel",ascending:!1,border:!1,hideMode:"offsets",layerStore:this.target.mapPanel.layers,defaults:{cls:"gxp-legend-item"}},a))}}),Ext.preg(gxp.plugins.Legend.prototype.ptype,gxp.plugins.Legend),Ext.namespace("gxp.plugins"),gxp.plugins.Print=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_print",printService:null,printCapabilities:null,customParams:null,includeLegend:!1,menuText:"Print Map",tooltip:"Print Map",buttonText:"Print",notAllNotPrintableText:"Not All Layers Can Be Printed",nonePrintableText:"None of your current map layers can be printed",previewText:"Print Preview",openInNewWindow:!1,constructor:function(a){gxp.plugins.Print.superclass.constructor.apply(this,arguments)},addActions:function(){function e(){if(d){try{var a=d.items.first();a.printMapPanel.printPage.destroy()}catch(a){}d=null}}function g(){var a=[];return f.layers.each(function(b){var c=b.getLayer();h(c)&&a.push(c)}),a}function h(a){return a.getVisibility()===!0&&(a instanceof OpenLayers.Layer.WMS||a instanceof OpenLayers.Layer.OSM)}function i(){var b=null;if(this.includeLegend===!0){var c,g;for(c in this.target.tools)if(g=this.target.tools[c],"gxp_legend"===g.ptype){b=g.getLegendPanel();break}if(null===b)for(c in this.target.tools)if(g=this.target.tools[c],"gxp_layermanager"===g.ptype){b=g;break}}return d=new Ext.Window({title:this.previewText,modal:!0,border:!1,autoHeight:!0,resizable:!1,width:360,items:[new GeoExt.ux.PrintPreview({minWidth:336,mapTitle:this.target.about&&this.target.about.title,comment:this.target.about&&this.target.about.abstract,printMapPanel:{autoWidth:!0,height:Math.min(420,Ext.get(document.body).getHeight()-150),limitScales:!0,map:Ext.applyIf({controls:[new OpenLayers.Control.Navigation({zoomWheelEnabled:!1,zoomBoxEnabled:!1}),new OpenLayers.Control.PanPanel,new OpenLayers.Control.ZoomPanel,new OpenLayers.Control.Attribution],eventListeners:{preaddlayer:function(a){return h(a.layer)}}},f.initialConfig.map),items:[{xtype:"gx_zoomslider",vertical:!0,height:100,aggressive:!0}],listeners:{afterlayout:function(a){d.setWidth(Math.max(360,this.getWidth()+24)),d.center()}}},printProvider:a,includeLegend:this.includeLegend,legend:b,sourceMap:f})],listeners:{beforedestroy:e}})}function j(){d.show(),d.setWidth(0);var a=d.items.get(0).items.get(0),b=0;a.items.each(function(a){a.getEl()&&(b+=a.getWidth())}),d.setWidth(Math.max(d.items.get(0).printMapPanel.getWidth(),b+20)),d.center()}if(null!==this.printService||null!=this.printCapabilities){var d,a=new GeoExt.data.PrintProvider({capabilities:this.printCapabilities,url:this.printService,customParams:this.customParams,autoLoad:!1,listeners:{beforedownload:function(a,b){if(this.openInNewWindow===!0)return window.open(b),!1},beforeencodelegend:function(a,b,c){if(c&&"gxp_layermanager"===c.ptype){var d=[],e=c.output;return e&&e[0]&&e[0].getRootNode().cascade(function(a){if(a.component&&!a.component.hidden){var c=a.component,e=this.encoders.legends[c.getXType()];d=d.concat(e.call(this,c,b.pages[0].scale))}},a),b.legends=d,!1}},beforeprint:function(){d.items.get(0).printMapPanel.layers.each(function(a){var b=a.get("layer").params;for(var c in b)b[c]instanceof Array&&(b[c]=b[c].join(","))})},loadcapabilities:function(){c&&(c.initialConfig.disabled=!1,c.enable())},print:function(){try{d.close()}catch(a){}},printException:function(a,b){this.target.displayXHRTrouble&&this.target.displayXHRTrouble(b)},scope:this}}),b=gxp.plugins.Print.superclass.addActions.call(this,[{menuText:this.menuText,buttonText:this.buttonText,tooltip:this.tooltip,iconCls:"gxp-icon-print",disabled:null===this.printCapabilities,handler:function(){var a=g();if(a.length>0){var b=i.call(this);return j.call(this),b}Ext.Msg.alert(this.notAllNotPrintableText,this.nonePrintableText)},scope:this,listeners:{render:function(){a.loadCapabilities()}}}]),c=b[0].items[0],f=this.target.mapPanel;return b}}}),Ext.preg(gxp.plugins.Print.prototype.ptype,gxp.plugins.Print),Ext.namespace("gxp.plugins"),gxp.plugins.WMSRasterStylesDialog={isRaster:null,init:function(a){Ext.apply(a,gxp.plugins.WMSRasterStylesDialog)},createRule:function(){var a=[new OpenLayers.Symbolizer[this.isRaster?"Raster":this.symbolType]];return new OpenLayers.Rule({symbolizers:a})},addRule:function(){var a=this.items.get(2).items.get(0);this.isRaster?(a.rules.push(this.createPseudoRule()),1==a.rules.length&&a.rules.push(this.createPseudoRule()),this.savePseudoRules()):(this.selectedStyle.get("userStyle").rules.push(this.createRule()),a.update(),this.selectedStyle.store.afterEdit(this.selectedStyle)),this.updateRuleRemoveButton()},removeRule:function(){if(this.isRaster){var a=this.items.get(2).items.get(0),b=this.selectedRule;a.unselect(),a.rules.remove(b),1==a.rules.length&&a.rules.remove(a.rules[0]),this.savePseudoRules()}else gxp.WMSStylesDialog.prototype.removeRule.apply(this,arguments)},duplicateRule:function(){var a=this.items.get(2).items.get(0);if(this.isRaster)a.rules.push(this.createPseudoRule({quantity:this.selectedRule.name,label:this.selectedRule.title,color:this.selectedRule.symbolizers[0].fillColor,opacity:this.selectedRule.symbolizers[0].fillOpacity})),this.savePseudoRules();else{var b=this.selectedRule.clone();b.name=gxp.util.uniqueName((b.title||b.name)+" (copy)"),delete b.title,this.selectedStyle.get("userStyle").rules.push(b),a.update()}this.updateRuleRemoveButton()},editRule:function(){this.isRaster?this.editPseudoRule():gxp.WMSStylesDialog.prototype.editRule.apply(this,arguments)},editPseudoRule:function(){var a=this,b=this.selectedRule,c=new Ext.Window({title:"Color Map Entry: "+b.name,width:340,autoHeight:!0,modal:!0,items:[{bodyStyle:"padding-top: 5px",border:!1,defaults:{autoHeight:!0,hideMode:"offsets"},items:[{xtype:"form",border:!1,labelAlign:"top",defaults:{border:!1},style:{padding:"0.3em 0 0 1em"},items:[{layout:"column",defaults:{border:!1,style:{"padding-right":"1em"}},items:[{layout:"form",width:70,items:[{xtype:"numberfield",anchor:"95%",value:b.name,allowBlank:!1,fieldLabel:"Quantity",validator:function(c){for(var d=a.items.get(2).items.get(0).rules,e=d.length-1;e>=0;e--)if(b!==d[e]&&d[e].name==c)return"Quantity "+c+" is already defined";return!0},listeners:{valid:function(a){this.selectedRule.name=String(a.getValue()),this.savePseudoRules()},scope:this}}]},{layout:"form",width:130,items:[{xtype:"textfield",fieldLabel:"Label",anchor:"95%",value:b.title,listeners:{valid:function(a){this.selectedRule.title=a.getValue(),this.savePseudoRules()},scope:this}}]},{layout:"form",width:70,items:[new GeoExt.FeatureRenderer({symbolType:this.symbolType,symbolizers:[b.symbolizers[0]],isFormField:!0,fieldLabel:"Appearance"})]}]}]},{xtype:"gxp_polygonsymbolizer",symbolizer:b.symbolizers[0],bodyStyle:{padding:"10px"},border:!1,labelWidth:70,defaults:{labelWidth:70},listeners:{change:function(a){var b=c.findByType(GeoExt.FeatureRenderer)[0];b.setSymbolizers([a],{draw:b.rendered}),this.selectedRule.symbolizers[0]=a,this.savePseudoRules()},scope:this}}]}]}),d=c.findByType("gxp_strokesymbolizer")[0];d.ownerCt.remove(d),c.show()},savePseudoRules:function(){var a=this.selectedStyle,b=this.items.get(2).items.get(0),c=a.get("userStyle"),d=b.rules;d.sort(function(a,b){var c=parseFloat(a.name),d=parseFloat(b.name);return c===d?0:c<d?-1:1});var e=c.rules[0].symbolizers[0];e.colorMap=d.length>0?new Array(d.length):void 0;for(var f,g=0,h=d.length;g<h;++g)f=d[g],e.colorMap[g]={quantity:parseFloat(f.name),label:f.title||void 0,color:f.symbolizers[0].fillColor||void 0,opacity:0==f.symbolizers[0].fill?0:f.symbolizers[0].fillOpacity};this.afterRuleChange(this.selectedRule)},createLegend:function(a,b){var c=OpenLayers.Symbolizer.Raster;c&&a[0]&&a[0].symbolizers[0]instanceof c?(this.getComponent("rulesfieldset").setTitle("Color Map Entries"),this.isRaster=!0,this.addRasterLegend(a,b)):(this.isRaster=!1,this.addVectorLegend(a))},addRasterLegend:function(a,b){b=b||{};for(var c=a[0].symbolizers[0],d=c.colorMap||[],e=[],g=0,h=d.length;g<h;g++)e.push(this.createPseudoRule(d[g]));return this.selectedRule=null!=b.selectedRuleIndex?e[b.selectedRuleIndex]:null,this.addVectorLegend(e,{symbolType:"Polygon",enableDD:!1})},createPseudoRule:function(a){var b=-1;if(!a){var c=this.items.get(2);if(c.items){rules=c.items.get(0).rules;for(var d=rules.length-1;d>=0;d--)b=Math.max(b,parseFloat(rules[d].name))}}return a=Ext.applyIf(a||{},{quantity:++b,color:"#000000",opacity:1}),new OpenLayers.Rule({title:a.label,name:String(a.quantity),symbolizers:[new OpenLayers.Symbolizer.Polygon({fillColor:a.color,fillOpacity:a.opacity,stroke:!1,fill:0!==a.opacity})]})},updateRuleRemoveButton:function(){this.items.get(3).items.get(1).setDisabled(!this.selectedRule||this.isRaster===!1&&this.items.get(2).items.get(0).rules.length<=1)}},Ext.preg("gxp_wmsrasterstylesdialog",gxp.plugins.WMSRasterStylesDialog),Ext.namespace("gxp.plugins"),gxp.plugins.Styler=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_styler",menuText:"Edit Styles",tooltip:"Manage layer styles",roles:["ROLE_ADMINISTRATOR"],sameOriginStyling:!0,rasterStyling:!1,requireDescribeLayer:!0,constructor:function(a){gxp.plugins.Styler.superclass.constructor.apply(this,arguments),this.outputConfig||(this.outputConfig={autoHeight:!0,width:265}),Ext.applyIf(this.outputConfig,{closeAction:"close"})},init:function(a){gxp.plugins.Styler.superclass.init.apply(this,arguments),this.target.on("authorizationchange",this.enableOrDisable,this)},destroy:function(){this.target.un("authorizationchange",this.enableOrDisable,this),gxp.plugins.Styler.superclass.destroy.apply(this,arguments)},enableOrDisable:function(){this.target&&null!==this.target.selectedLayer&&this.handleLayerChange(this.target.selectedLayer)},addActions:function(){var b=gxp.plugins.Styler.superclass.addActions.apply(this,[{menuText:this.menuText,iconCls:"gxp-icon-palette",disabled:!0,tooltip:this.tooltip,handler:function(){this.target.doAuthorized(this.roles,this.addOutput,this)},scope:this}]);return this.launchAction=b[0],this.target.on({layerselectionchange:this.handleLayerChange,scope:this}),b},handleLayerChange:function(a){if(this.launchAction.disable(),a){var b=this.target.getSource(a);b instanceof gxp.plugins.WMSSource&&b.describeLayer(a,function(b){this.checkIfStyleable(a,b)},this)}},checkIfStyleable:function(a,b){if(b){var c=["WFS"];this.rasterStyling===!0&&c.push("WCS")}if(b?c.indexOf(b.get("owsType"))!==-1:!this.requireDescribeLayer){var f,d=!1,e=this.target.layerSources[a.get("source")],g=a.get("restUrl");if(f=g?g+"/styles":e.url.split("?").shift().replace(/\/(wms|ows)\/?$/,"/rest/styles"),this.sameOriginStyling){if(d="/"===f.charAt(0),this.target.authenticate&&d)return void this.launchAction.enable()}else d=!0;d&&this.target.isAuthorized()&&this.enableActionIfAvailable(f)}},enableActionIfAvailable:function(a){Ext.Ajax.request({method:"PUT",url:a,callback:function(a,b,c){this.launchAction.setDisabled(405!==c.status)},scope:this})},addOutput:function(a){a=a||{};var b=this.target.selectedLayer,c=this.initialConfig.outputConfig||{};this.outputConfig.title=c.title||this.menuText+": "+b.get("title"),this.outputConfig.shortTitle=b.get("title"),Ext.apply(a,gxp.WMSStylesDialog.createGeoServerStylerConfig(b)),this.rasterStyling===!0&&a.plugins.push({ptype:"gxp_wmsrasterstylesdialog"}),Ext.applyIf(a,{style:"padding: 10px"});var d=gxp.plugins.Styler.superclass.addOutput.call(this,a);d.ownerCt.ownerCt instanceof Ext.Window||(d.dialogCls=Ext.Panel,d.showDlg=function(a){a.layout="fit",a.autoHeight=!1,d.ownerCt.add(a)}),d.stylesStore.on("load",function(){!this.outputTarget&&d.ownerCt.ownerCt instanceof Ext.Window&&d.ownerCt.ownerCt.center()})}}),Ext.preg(gxp.plugins.Styler.prototype.ptype,gxp.plugins.Styler),Ext.namespace("gxp.plugins"),gxp.plugins.GoogleEarth=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_googleearth",timeout:7e3,menuText:"3D Viewer",tooltip:"Switch to 3D Viewer",tooltipMap:"Switch back to normal map view",constructor:function(a){gxp.plugins.GoogleEarth.superclass.constructor.apply(this,arguments)},addActions:function(){var a=[{menuText:this.menuText,enableToggle:!0,iconCls:"gxp-icon-googleearth",tooltip:this.tooltip,toggleHandler:function(a,b){this.actions[0].each(function(a){a.toggle&&a.toggle(!1,!0)}),this.togglePanelDisplay(b)},scope:this}];return gxp.plugins.GoogleEarth.superclass.addActions.apply(this,[a])},togglePanelDisplay:function(a){var b=this.target.mapPanel.ownerCt,c=b&&b.getLayout();c&&c instanceof Ext.layout.CardLayout&&(a===!0?gxp.plugins.GoogleEarth.loader.onLoad({callback:function(){c.setActiveItem(1),this.actions[0].enable(),this.actions[0].items[0].setTooltip(this.tooltipMap),this.actions[0].each(function(a){a.toggle&&a.toggle(!0,!0)})},scope:this}):(c.setActiveItem(0),this.actions[0].items[0].setTooltip(this.tooltip)))},getHost:function(){var a=window.location.host.split(":").shift(),b=window.location.port||"80";return a+":"+b}}),gxp.plugins.GoogleEarth.loader=new(Ext.extend(Ext.util.Observable,{ready:!(!window.google||!window.google.earth),loading:!1,constructor:function(){return this.addEvents("ready","failure"),Ext.util.Observable.prototype.constructor.apply(this,arguments)},onScriptLoad:function(){var a=gxp.plugins.GoogleEarth.loader;a.ready||(a.ready=!0,a.loading=!1,a.fireEvent("ready"))},onLoad:function(a){this.ready?window.setTimeout(function(){a.callback.call(a.scope)},0):this.loading?this.on({ready:a.callback,failure:a.errback||Ext.emptyFn,scope:a.scope}):this.loadScript(a)},loadScript:function(a){function f(){document.getElementsByTagName("head")[0].appendChild(c)}window.google&&delete google.loader;var b={autoload:Ext.encode({modules:[{name:"earth",version:"1",callback:"gxp.plugins.GoogleEarth.loader.onScriptLoad"}]})},c=document.createElement("script");c.src="//www.google.com/jsapi?"+Ext.urlEncode(b);var e=(a.errback||Ext.emptyFn,a.timeout||gxp.plugins.GoogleSource.prototype.timeout);window.setTimeout(function(){gxp.plugins.GoogleEarth.loader.ready||(this.fireEvent("failure"),this.unload())}.createDelegate(this),e),this.on({ready:a.callback,failure:a.errback||Ext.emptyFn,scope:a.scope}),this.loading=!0,document.body?f():Ext.onReady(f),this.script=c},unload:function(){this.purgeListeners(),this.script&&(document.getElementsByTagName("head")[0].removeChild(this.script),delete this.script),this.loading=!1,this.ready=!1,delete google.loader,delete google.earth}})),Ext.preg(gxp.plugins.GoogleEarth.prototype.ptype,gxp.plugins.GoogleEarth),Ext.ns("Ext.ux.form"),Ext.ux.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:"Browse...",buttonOnly:!1,buttonOffset:3,readOnly:!0,autoSize:Ext.emptyFn,initComponent:function(){Ext.ux.form.FileUploadField.superclass.initComponent.call(this),this.addEvents("fileselected")},onRender:function(a,b){Ext.ux.form.FileUploadField.superclass.onRender.call(this,a,b),this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"}),this.el.addClass("x-form-file-text"),this.el.dom.removeAttribute("name"),this.createFileInput();var c=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(c,{renderTo:this.wrap,cls:"x-form-file-btn"+(c.iconCls?" x-btn-icon":"")})),this.buttonOnly&&(this.el.hide(),this.wrap.setWidth(this.button.getEl().getWidth())),this.bindListeners(),this.resizeEl=this.positionEl=this.wrap},bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.button.addClass(["x-btn-over","x-btn-focus"])},mouseleave:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},mousedown:function(){this.button.addClass("x-btn-click")},mouseup:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},change:function(){var a=this.fileInput.dom.value;this.setValue(a),this.fireEvent("fileselected",this,a)}})},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1})},reset:function(){this.fileInput.remove(),this.createFileInput(),this.bindListeners(),Ext.ux.form.FileUploadField.superclass.reset.call(this)},getFileInputId:function(){return this.id+"-file"},onResize:function(a,b){if(Ext.ux.form.FileUploadField.superclass.onResize.call(this,a,b),this.wrap.setWidth(a),!this.buttonOnly){var a=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(a)}},onDestroy:function(){Ext.ux.form.FileUploadField.superclass.onDestroy.call(this),Ext.destroy(this.fileInput,this.button,this.wrap)},onDisable:function(){Ext.ux.form.FileUploadField.superclass.onDisable.call(this),this.doDisable(!0)},onEnable:function(){Ext.ux.form.FileUploadField.superclass.onEnable.call(this),this.doDisable(!1)},doDisable:function(a){this.fileInput.dom.disabled=a,this.button.setDisabled(a)},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])}}),Ext.reg("fileuploadfield",Ext.ux.form.FileUploadField),Ext.form.FileUploadField=Ext.ux.form.FileUploadField,Ext.grid.RowExpander=function(a){Ext.apply(this,a),this.addEvents({beforeexpand:!0,expand:!0,beforecollapse:!0,collapse:!0}),Ext.grid.RowExpander.superclass.constructor.call(this),this.tpl&&("string"==typeof this.tpl&&(this.tpl=new Ext.Template(this.tpl)),this.tpl.compile()),this.state={},this.bodyContent={}},Ext.extend(Ext.grid.RowExpander,Ext.util.Observable,{
header:"",width:20,sortable:!1,fixed:!0,menuDisabled:!0,dataIndex:"",id:"expander",lazyRender:!0,enableCaching:!0,getRowClass:function(a,b,c,d){c.cols=c.cols-1;var e=this.bodyContent[a.id];return e||this.lazyRender||(e=this.getBodyContent(a,b)),e&&(c.body=e),this.state[a.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"},init:function(a){this.grid=a;var b=a.getView();b.getRowClass=this.getRowClass.createDelegate(this),b.enableRowBody=!0,a.on("render",function(){b.mainBody.on("mousedown",this.onMouseDown,this)},this)},getBodyContent:function(a,b){if(!this.enableCaching)return this.tpl.apply(a.data);var c=this.bodyContent[a.id];return c||(c=this.tpl.apply(a.data),this.bodyContent[a.id]=c),c},onMouseDown:function(a,b){if("x-grid3-row-expander"==b.className){a.stopEvent();var c=a.getTarget(".x-grid3-row");this.toggleRow(c)}},renderer:function(a,b,c){return b.cellAttr='rowspan="2"','<div class="x-grid3-row-expander">&#160;</div>'},beforeExpand:function(a,b,c){return this.fireEvent("beforeexpand",this,a,b,c)!==!1&&(this.tpl&&this.lazyRender&&(b.innerHTML=this.getBodyContent(a,c)),!0)},toggleRow:function(a){"number"==typeof a&&(a=this.grid.view.getRow(a)),this[Ext.fly(a).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](a)},expandRow:function(a){"number"==typeof a&&(a=this.grid.view.getRow(a));var b=this.grid.store.getAt(a.rowIndex),c=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",a);this.beforeExpand(b,c,a.rowIndex)&&(this.state[b.id]=!0,Ext.fly(a).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded"),this.fireEvent("expand",this,b,c,a.rowIndex))},collapseRow:function(a){"number"==typeof a&&(a=this.grid.view.getRow(a));var b=this.grid.store.getAt(a.rowIndex),c=Ext.fly(a).child("tr:nth(1) div.x-grid3-row-body",!0);this.fireEvent("beforecollapse",this,b,c,a.rowIndex)!==!1&&(this.state[b.id]=!1,Ext.fly(a).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed"),this.fireEvent("collapse",this,b,c,a.rowIndex))}}),Ext.namespace("Ext.ux"),Ext.ux.ColorPicker=function(a){a.bodyStyle={padding:"3px"},Ext.ux.ColorPicker.superclass.constructor.call(this,a),this.initialize(a)},Ext.extend(Ext.ux.ColorPicker,Ext.util.Observable,{HCHARS:"0123456789ABCDEF",initialize:function(a){this.events={},this.config=this.config||a,this.config.captions=this.config.captions||{},this.config.pickerHotPoint=this.config.pickerHotPoint||{x:3,y:3},this._HSV={h:0,s:100,v:100},this._RGB={r:255,g:255,b:255},this._HEX="000000",this.lastXYRgb={x:0,y:0},this.lastYHue=0,this.domElement=this.config.renderTo||Ext.DomHelper.append(document.body,{},!0),this.domElement.addClass("x-cp-panel"),this.cpCreateDomObjects(),this.config.hidePanel&&this.formContainer.hide(),this.rgbPicker.on("mousedown",this.rgbPickerClick.createDelegate(this),this),this.huePicker.on("mousedown",this.huePickerClick.createDelegate(this),this),this.wsColorContainer.on("mousedown",this.setColorFromWebsafe.createDelegate(this),this),this.inColorContainer.on("mousedown",this.setColorFromInvert.createDelegate(this),this),Ext.getCmp("redValue"+this.domElement.id).on("change",this.changeRGBField.createDelegate(this)),Ext.getCmp("greenValue"+this.domElement.id).on("change",this.changeRGBField.createDelegate(this)),Ext.getCmp("blueValue"+this.domElement.id).on("change",this.changeRGBField.createDelegate(this)),Ext.getCmp("hueValue"+this.domElement.id).on("change",this.changeHSVField.createDelegate(this)),Ext.getCmp("saturationValue"+this.domElement.id).on("change",this.changeHSVField.createDelegate(this)),Ext.getCmp("brightnessValue"+this.domElement.id).on("change",this.changeHSVField.createDelegate(this)),Ext.getCmp("colorValue"+this.domElement.id).on("change",this.changeHexaField.createDelegate(this)),Ext.getCmp("redValue"+this.domElement.id).on("specialkey",this.changeRGBField.createDelegate(this)),Ext.getCmp("greenValue"+this.domElement.id).on("specialkey",this.changeRGBField.createDelegate(this)),Ext.getCmp("blueValue"+this.domElement.id).on("specialkey",this.changeRGBField.createDelegate(this)),Ext.getCmp("hueValue"+this.domElement.id).on("specialkey",this.changeHSVField.createDelegate(this)),Ext.getCmp("saturationValue"+this.domElement.id).on("specialkey",this.changeHSVField.createDelegate(this)),Ext.getCmp("brightnessValue"+this.domElement.id).on("specialkey",this.changeHSVField.createDelegate(this)),Ext.getCmp("colorValue"+this.domElement.id).on({specialkey:function(a,b){b.getKey()===b.ENTER&&this.changeHexaField(a,a.getValue())},scope:this}),this.checkConfig(),this.addEvents({pickcolor:!0,changergb:!0,changehsv:!0,changehexa:!0})},cpCreateDomObjects:function(){this.rgbPicker=Ext.DomHelper.append(this.domElement,{tag:"div",cls:"x-cp-rgb-msk"},!0),this.rgbPointer=Ext.DomHelper.append(this.rgbPicker,{tag:"div",cls:"x-cp-rgb-picker"},!0),this.rgbPointer.setXY([this.rgbPicker.getLeft()-this.config.pickerHotPoint.x,this.rgbPicker.getTop()-this.config.pickerHotPoint.y]),this.huePicker=Ext.DomHelper.append(this.domElement,{tag:"div",cls:"x-cp-hue-msk"},!0),this.huePointer=Ext.DomHelper.append(this.huePicker,{tag:"div",cls:"x-cp-hue-picker"},!0),this.huePointer.setXY([this.huePicker.getLeft()+this.huePointer.getWidth()/2+1,this.huePicker.getTop()-this.config.pickerHotPoint.y]),this.formContainer=Ext.DomHelper.append(Ext.DomHelper.append(this.domElement,{tag:"div",cls:"x-cp-control-container x-unselectable"},!0),{tag:"div",cls:"x-cp-rgb-container x-unselectable",style:"clear:both"},!0),this.colorContainer=Ext.DomHelper.append(this.formContainer,{cls:"x-cp-coloro-container x-unselectable"},!0).update(this.config.captions.color||"Color"),this.form=new Ext.FormPanel({frame:!0,width:"auto",height:227,cls:"x-cp-form",labelWidth:12,items:[{xtype:"fieldset",title:"RGB",autoHeight:!0,style:"padding: 2px",defaultType:"numberfield",items:[{fieldLabel:"Red",id:"redValue"+this.domElement.id},{fieldLabel:"Green",id:"greenValue"+this.domElement.id},{fieldLabel:"Blue",id:"blueValue"+this.domElement.id}]},{xtype:"fieldset",title:"HSV",autoHeight:!0,style:"padding: 2px",defaultType:"numberfield",items:[{fieldLabel:"Hue",id:"hueValue"+this.domElement.id},{fieldLabel:"Satur.",id:"saturationValue"+this.domElement.id},{fieldLabel:"Bright.",id:"brightnessValue"+this.domElement.id}]},{xtype:"fieldset",title:"Color",autoHeight:!0,style:"padding: 2px",defaultType:"textfield",items:[{fieldLabel:"Color",id:"colorValue"+this.domElement.id}]}]}),this.form.render(this.formContainer);var a=Ext.DomHelper.append(this.form.body,{cls:"x-cp-colors-container x-unselectable"},!0);this.wsColorContainer=Ext.DomHelper.append(a,{cls:"x-cp-color-container x-unselectable"},!0).update(this.config.captions.websafe||"Websafe"),this.inColorContainer=Ext.DomHelper.append(a,{cls:"x-cp-color-container x-unselectable"},!0).update(this.config.captions.inverse||"Inverse"),Ext.DomHelper.append(a,{tag:"div",style:"height:0px;border:none;clear:both;font-size:1px;"}),this.form.render(this.formContainer),Ext.DomHelper.append(this.domElement,{tag:"div",style:"height:0px;border:none;clear:both;font-size:1px;"})},realToDec:function(a){return Math.min(255,Math.round(256*a))},hsvToRgb:function(a,b,c){if(a instanceof Array)return this.hsvToRgb.call(this,a[0],a[1],a[2]);var d,e,f,g,h,i,j,k;switch(g=Math.floor(a/60%6),h=a/60-g,i=c*(1-b),j=c*(1-h*b),k=c*(1-(1-h)*b),g){case 0:d=c,e=k,f=i;break;case 1:d=j,e=c,f=i;break;case 2:d=i,e=c,f=k;break;case 3:d=i,e=j,f=c;break;case 4:d=k,e=i,f=c;break;case 5:d=c,e=i,f=j}return[this.realToDec(d),this.realToDec(e),this.realToDec(f)]},rgbToHsv:function(a,b,c){if(a instanceof Array)return this.rgbToHsv.call(this,a[0],a[1],a[2]);a/=255,b/=255,c/=255;var d,e,f,g,h;switch(d=Math.min(Math.min(a,b),c),e=Math.max(Math.max(a,b),c),f=e-d,e){case d:g=0;break;case a:g=60*(b-c)/f,b<c&&(g+=360);break;case b:g=60*(c-a)/f+120;break;case c:g=60*(a-b)/f+240}return h=0===e?0:1-d/e,[Math.round(g),h,e]},rgbToHex:function(a,b,c){return a instanceof Array?this.rgbToHex.call(this,a[0],a[1],a[2]):this.decToHex(a)+this.decToHex(b)+this.decToHex(c)},decToHex:function(a){return a=parseInt(a,10),a=isNaN(a)?0:a,a=a>255||a<0?0:a,this.HCHARS.charAt((a-a%16)/16)+this.HCHARS.charAt(a%16)},getHCharPos:function(a){return this.HCHARS.indexOf(a.toUpperCase())},hexToDec:function(a){var b=a.split("");return 16*this.getHCharPos(b[0])+this.getHCharPos(b[1])},hexToRgb:function(a){return[this.hexToDec(a.substr(0,2)),this.hexToDec(a.substr(2,2)),this.hexToDec(a.substr(4,2))]},checkSafeNumber:function(a){if(!isNaN(a)){a=Math.min(Math.max(0,a),255);var b,c;for(b=0;b<256;b+=51)if(c=b+51,a>=b&&a<=c)return a-b>25?c:b}return a},websafe:function(a,b,c){return a instanceof Array?this.websafe.call(this,a[0],a[1],a[2]):[this.checkSafeNumber(a),this.checkSafeNumber(b),this.checkSafeNumber(c)]},invert:function(a,b,c){return a instanceof Array?this.invert.call(this,a[0],a[1],a[2]):[255-a,255-b,255-c]},getHue:function(a){var b=360-Math.round((this.huePicker.getHeight()-a)/this.huePicker.getHeight()*360);return 360===b?0:b},getHPos:function(a){return a*(this.huePicker.getHeight()/360)},getSaturation:function(a){return a/this.rgbPicker.getWidth()},getSPos:function(a){return a*this.rgbPicker.getWidth()},getValue:function(a){return(this.rgbPicker.getHeight()-a)/this.rgbPicker.getHeight()},getVPos:function(a){return this.rgbPicker.getHeight()-a*this.rgbPicker.getHeight()},updateColorsFromRGBPicker:function(){this._HSV={h:this._HSV.h,s:this.getSaturation(this.lastXYRgb.x),v:this.getValue(this.lastXYRgb.y)}},updateColorsFromHUEPicker:function(){this._HSV.h=this.getHue(this.lastYHue);var a=this.hsvToRgb(this._HSV.h,1,1);a=this.rgbToHex(a[0],a[1],a[2]),this.rgbPicker.setStyle({backgroundColor:"#"+a})},updateColorsFromRGBFields:function(){var a=this.rgbToHsv(Ext.getCmp("redValue"+this.domElement.id).getValue(),Ext.getCmp("greenValue"+this.domElement.id).getValue(),Ext.getCmp("blueValue"+this.domElement.id).getValue());this._HSV={h:a[0],s:a[1],v:a[2]}},updateColorsFromHexaField:function(){var a=this.hexToRgb(this._HEX);this._RGB={r:a[0],g:a[1],b:a[2]},a=this.rgbToHsv(a[0],a[1],a[2]),this._HSV={h:a[0],s:a[1],v:a[2]}},updateColorsFromHSVFields:function(){var a=this.hsvToRgb(this._HSV.h,this._HSV.s,this._HSV.v);this._RGB={r:a[0],g:a[1],b:a[2]}},updateRGBFromHSV:function(){var a=this.hsvToRgb(this._HSV.h,this._HSV.s,this._HSV.v);this._RGB={r:a[0],g:a[1],b:a[2]}},updateInputFields:function(){Ext.getCmp("redValue"+this.domElement.id).setValue(this._RGB.r),Ext.getCmp("greenValue"+this.domElement.id).setValue(this._RGB.g),Ext.getCmp("blueValue"+this.domElement.id).setValue(this._RGB.b),Ext.getCmp("hueValue"+this.domElement.id).setValue(this._HSV.h),Ext.getCmp("saturationValue"+this.domElement.id).setValue(Math.round(100*this._HSV.s)),Ext.getCmp("brightnessValue"+this.domElement.id).setValue(Math.round(100*this._HSV.v)),Ext.getCmp("colorValue"+this.domElement.id).setValue(this._HEX)},updateColor:function(){this._HEX=this.rgbToHex(this._RGB.r,this._RGB.g,this._RGB.b),this.colorContainer.setStyle({backgroundColor:"#"+this._HEX}),this.colorContainer.set({title:"#"+this._HEX});var a=this.rgbToHex(this.websafe(this._RGB.r,this._RGB.g,this._RGB.b));this.wsColorContainer.setStyle({backgroundColor:"#"+a}),this.wsColorContainer.set({title:"#"+a}),this.wsColorContainer.setStyle({color:"#"+this.rgbToHex(this.invert(this.websafe(this._RGB.r,this._RGB.g,this._RGB.b)))});var a=this.rgbToHex(this.invert(this._RGB.r,this._RGB.g,this._RGB.b));this.inColorContainer.setStyle({backgroundColor:"#"+a}),this.inColorContainer.setStyle({color:"#"+this._HEX}),this.inColorContainer.set({title:"#"+a}),this.colorContainer.setStyle({color:"#"+a}),this.updateInputFields(),this.fireEvent("pickcolor",this,this._HEX)},updatePickers:function(){this.lastXYRgb={x:this.getSPos(this._HSV.s),y:this.getVPos(this._HSV.v)},this.rgbPointer.setXY([this.lastXYRgb.x-this.config.pickerHotPoint.x+this.rgbPicker.getLeft(),this.lastXYRgb.y-this.config.pickerHotPoint.y+this.rgbPicker.getTop()],this.config.animate),this.lastYHue=this.getHPos(this._HSV.h),this.huePointer.setXY([this.huePicker.getLeft()+this.huePointer.getWidth()/2+1,this.lastYHue+this.huePicker.getTop()-this.config.pickerHotPoint.y],this.config.animate);var a=this.hsvToRgb(this._HSV.h,1,1);a=this.rgbToHex(a[0],a[1],a[2]),this.rgbPicker.setStyle({backgroundColor:"#"+a})},rgbPickerClick:function(a,b){this.lastXYRgb={x:a.getPageX()-this.rgbPicker.getLeft(),y:a.getPageY()-this.rgbPicker.getTop()},this.rgbPointer.setXY([a.getPageX()-this.config.pickerHotPoint.x,a.getPageY()-this.config.pickerHotPoint.y],this.config.animate),this.updateColorsFromRGBPicker(),this.updateRGBFromHSV(),this.updateColor()},huePickerClick:function(a,b){this.lastYHue=a.getPageY()-this.huePicker.getTop(),this.huePointer.setY([a.getPageY()-3],this.config.animate),this.updateColorsFromHUEPicker(),this.updateRGBFromHSV(),this.updateColor()},changeRGBField:function(a,b,c){b instanceof String||(b=a.getValue()),b<0&&(b=0),b>255&&(b=255),a==Ext.getCmp("redValue"+this.domElement.id)?this._RGB.r=b:a==Ext.getCmp("greenValue"+this.domElement.id)?this._RGB.g=b:a==Ext.getCmp("blueValue"+this.domElement.id)&&(this._RGB.b=b),this.updateColorsFromRGBFields(),this.updateColor(),this.updatePickers(),this.fireEvent("changergb",this,this._RGB)},changeHSVField:function(a,b,c){b instanceof String||(b=a.getValue()),a==Ext.getCmp("hueValue"+this.domElement.id)?(b<0&&(b=0),b>360&&(b=360),this._HSV.h=b):(b<0&&(b=0),b>100&&(b=100),a==Ext.getCmp("saturationValue"+this.domElement.id)?this._HSV.s=b/100:a==Ext.getCmp("brightnessValue"+this.domElement.id)&&(this._HSV.v=b/100)),this.updateColorsFromHSVFields(),this.updateColor(),this.updatePickers(),this.fireEvent("changehsv",this,this._HSV)},changeHexaField:function(a,b,c){b=b.trim().substring(0,6),3===b.length&&(b=b[0]+b[0]+b[1]+b[1]+b[2]+b[2]),b.match(/^[0-9a-f]{6}$/i)||(b="000000"),this._HEX=b,this.updateColorsFromHexaField(),this.updateColor(),this.updatePickers(),this.fireEvent("changehexa",this,this._HEX)},setColorFromWebsafe:function(){this.setColor(this.wsColorContainer.getColor("backgroundColor","",""))},setColorFromInvert:function(){this.setColor(this.inColorContainer.getColor("backgroundColor","",""))},checkConfig:function(){this.config&&(this.config.color?this.setColor(this.config.color):this.config.hsv?this.setHSV(this.config.hsv):this.config.rgb&&this.setRGB(this.config.rgb))},setColor:function(a){var b=this.hexToRgb(a);this._RGB={r:b[0],g:b[1],b:b[2]};var b=this.rgbToHsv(b);this._HSV={h:b[0],s:b[1],v:b[2]},this.updateColor(),this.updatePickers()},setRGB:function(a){this._RGB=a;var b=this.rgbToHsv(a.r,a.g,a.b);this._HSV={h:b[0],s:b[1],v:b[2]},this.updateColor(),this.updatePickers()},setHSV:function(a){this._HSV={h:a.h,s:a.s/100,v:a.v/100};var b=this.hsvToRgb(a.h,a.s/100,a.v/100);this._RGB={r:b[0],g:b[1],b:b[2]},this.updateColor(),this.updatePickers()},getColor:function(a){return(a?"":"#")+this._HEX},getRGB:function(){return this._RGB},getHSV:function(){return this._HSV},setPanelVisible:function(a,b){return this.formContainer.setVisible(a,b)},isPanelVisible:function(){return this.formContainer.isDisplayed()},showPicker:function(){this.domElement.show()},hidePicker:function(){this.domElement.hide()}}),Ext.ux.ColorPanel=function(a){this.config=a,this.config.renderTo=this.config.renderTo||Ext.DomHelper.append(document.body,{},!0),Ext.ux.ColorPanel.superclass.constructor.call(this,a),this.domElement=Ext.get(this.config.renderTo),this.render(this.domElement),this.config.renderTo=this.body,this.initialize(this.config),this.getEl().addClass("x-cp-panel"),this.domElement.removeClass("x-cp-panel"),this.body.setStyle({padding:"5px"})},Ext.extend(Ext.ux.ColorPanel,Ext.Panel),Ext.applyIf(Ext.ux.ColorPanel.prototype,Ext.ux.ColorPicker.prototype),Ext.ux.ColorDialog=function(a){this.config=a,this.config.resizable=!1,this.config.renderTo=this.config.renderTo||Ext.DomHelper.append(document.body,{},!0),Ext.ux.ColorDialog.superclass.constructor.call(this,a),this.domElement=Ext.get(this.config.renderTo),this.render(this.domElement),this.config.renderTo=this.body,this.initialize(this.config),this.body.addClass("x-cp-panel"),this.body.setStyle({padding:"5px"}),this.setSize(398,300)},Ext.extend(Ext.ux.ColorDialog,Ext.Window),Ext.applyIf(Ext.ux.ColorDialog.prototype,Ext.ux.ColorPicker.prototype),Ext.namespace("Styler"),Styler.ColorManager=function(a){Ext.apply(this,a)},Ext.apply(Styler.ColorManager.prototype,{field:null,init:function(a){this.register(a)},destroy:function(){this.field&&this.unregister(this.field)},register:function(a){this.field&&this.unregister(this.field),this.field=a,a.on({focus:this.fieldFocus,destroy:this.destroy,scope:this})},unregister:function(a){a.un("focus",this.fieldFocus,this),a.un("destroy",this.destroy,this),Styler.ColorManager.picker&&a==this.field&&Styler.ColorManager.picker.un("pickcolor",this.setFieldValue,this),this.field=null},fieldFocus:function(a){Styler.ColorManager.pickerWin||(Styler.ColorManager.picker=new Ext.ux.ColorPanel({hidePanel:!1,autoHeight:!1}),Styler.ColorManager.pickerWin=new Ext.Window({title:"Color Picker",layout:"fit",closeAction:"hide",width:405,height:300,plain:!0,items:Styler.ColorManager.picker})),Styler.ColorManager.picker.purgeListeners(),this.setPickerValue(),Styler.ColorManager.picker.on({pickcolor:this.setFieldValue,scope:this}),Styler.ColorManager.pickerWin.show()},setFieldValue:function(a,b){this.field.isVisible()&&this.field.setValue("#"+b)},setPickerValue:function(){var a=this.field,b=a.getHexValue?a.getHexValue():a.getValue();b&&Styler.ColorManager.picker.setColor(b.substring(1))}}),function(){Ext.util.Observable.observeClass(gxp.form.ColorField),gxp.form.ColorField.on({render:function(a){var b=new Styler.ColorManager;b.register(a)}})}(),Styler.ColorManager.picker=null,Styler.ColorManager.pickerWin=null,Ext.namespace("GeoExt.ux"),GeoExt.ux.PrintPreview=Ext.extend(Ext.Container,{paperSizeText:"Paper size:",resolutionText:"Resolution:",printText:"Print",emptyTitleText:"Enter map title here.",includeLegendText:"Include legend?",emptyCommentText:"Enter comments here.",creatingPdfText:"Creating PDF...",printProvider:null,sourceMap:null,printMapPanel:null,mapTitleField:"mapTitle",commentField:"comment",legend:null,includeLegend:!1,mapTitle:null,comment:null,addMapOverlay:!0,busyMask:null,form:null,autoEl:"center",cls:"x-panel-body x-panel-body-noheader",initComponent:function(){var a={sourceMap:this.sourceMap,printProvider:this.printProvider};this.printMapPanel?this.printMapPanel instanceof GeoExt.PrintMapPanel||(a.xtype="gx_printmappanel",this.printMapPanel=new GeoExt.PrintMapPanel(Ext.applyIf(this.printMapPanel,a))):this.printMapPanel=new GeoExt.PrintMapPanel(a),this.sourceMap=this.printMapPanel.sourceMap,this.printProvider=this.printMapPanel.printProvider,this.form=this.createForm(),this.items||(this.items=[]),this.items.push(this.createToolbar(),{xtype:"container",cls:"gx-printpreview",autoHeight:this.autoHeight,autoWidth:this.autoWidth,items:[this.form,this.printMapPanel]}),GeoExt.ux.PrintPreview.superclass.initComponent.call(this),this.addMapOverlay&&this.printMapPanel.add(this.createMapOverlay()),this.printMapPanel.on({resize:this.updateSize,scope:this}),this.on({render:function(){this.busyMask||(this.busyMask=new Ext.LoadMask(this.getEl(),{msg:this.creatingPdfText})),this.printProvider.on({beforeprint:this.busyMask.show,print:this.busyMask.hide,printexception:this.busyMask.hide,scope:this.busyMask})},scope:this})},createToolbar:function(){var a=[];return this.printProvider.layouts.getCount()>1&&a.push(this.paperSizeText,{xtype:"combo",width:98,plugins:new GeoExt.plugins.PrintProviderField({printProvider:this.printProvider}),store:this.printProvider.layouts,displayField:"name",typeAhead:!0,mode:"local",forceSelection:!0,triggerAction:"all",selectOnFocus:!0},"&nbsp;"),this.printProvider.dpis.getCount()>1&&a.push(this.resolutionText,{xtype:"combo",width:62,plugins:new GeoExt.plugins.PrintProviderField({printProvider:this.printProvider}),store:this.printProvider.dpis,displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item">{name} dpi</div></tpl>',typeAhead:!0,mode:"local",forceSelection:!0,triggerAction:"all",selectOnFocus:!0,setValue:function(a){a=parseInt(a)+" dpi",Ext.form.ComboBox.prototype.setValue.apply(this,arguments)}},"&nbsp;"),a.push("->",{text:this.printText,iconCls:"icon-print",handler:function(){this.printMapPanel.print(this.includeLegend&&{legend:this.legend})},scope:this}),{xtype:"toolbar",items:a}},createForm:function(){var a={xtype:"textfield",name:this.mapTitleField,value:this.mapTitle,emptyText:this.emptyTitleText,margins:"0 5 0 0",flex:1,anchor:"100%",hideLabel:!0,plugins:new GeoExt.plugins.PrintProviderField({printProvider:this.printProvider})};if(this.legend)var b=new Ext.form.Checkbox({name:"legend",checked:this.includeLegend,boxLabel:this.includeLegendText,hideLabel:!0,ctCls:"gx-item-nowrap",handler:function(a,b){this.includeLegend=b},scope:this});return new Ext.form.FormPanel({autoHeight:!0,border:!1,defaults:{anchor:"100%"},items:[this.legend?{xtype:"container",layout:"hbox",cls:"x-form-item",items:[a,b]}:a,{xtype:"textarea",name:this.commentField,value:this.comment,emptyText:this.emptyCommentText,hideLabel:!0,plugins:new GeoExt.plugins.PrintProviderField({printProvider:this.printProvider})}]})},createMapOverlay:function(){var a=this.printMapPanel.map,b=new OpenLayers.Control.ScaleLine({geodesic:!(a.getProjectionObject()||new OpenLayers.Projection(a.projection||"EPSG:4326")).equals("EPSG:4326")});return a.addControl(b),b.activate(),new Ext.Panel({cls:"gx-map-overlay",layout:"column",width:235,bodyStyle:"padding:5px",items:[{xtype:"box",el:b.div,width:b.maxWidth},{xtype:"container",layout:"form",style:"padding: .2em 5px 0 0;",columnWidth:1,cls:"x-small-editor x-form-item",items:{xtype:"combo",name:"scale",anchor:"100%",hideLabel:!0,store:this.printMapPanel.previewScales,displayField:"name",typeAhead:!0,mode:"local",forceSelection:!0,triggerAction:"all",selectOnFocus:!0,getListParent:function(){return this.el.up(".x-window")||document.body},plugins:new GeoExt.plugins.PrintPageField({printPage:this.printMapPanel.printPage})}},{xtype:"box",autoEl:{tag:"div",cls:"gx-northarrow"}}],listeners:{render:function(){function a(a){a.stopPropagation()}this.getEl().on({click:a,dblclick:a,mousedown:a})}}})},updateSize:function(){this.suspendEvents();var a=this.printMapPanel.getWidth();this.form.setWidth(a),this.form.items.get(0).setWidth(a);var b=this.initialConfig.minWidth||0;this.items.get(0).setWidth(this.form.ownerCt.el.getPadding("lr")+Math.max(a,b));var c=this.ownerCt;c&&c instanceof Ext.Window&&this.ownerCt.syncShadow(),this.resumeEvents()},beforeDestroy:function(){this.busyMask&&(this.printProvider.un("beforeprint",this.busyMask.show,this.busyMask),this.printProvider.un("print",this.busyMask.hide,this.busyMask)),this.printMapPanel.un("resize",this.updateSize,this),GeoExt.ux.PrintPreview.superclass.beforeDestroy.apply(this,arguments)}}),Ext.reg("gxux_printpreview",GeoExt.ux.PrintPreview),Ext.USE_NATIVE_JSON=!0,Ext.override(Ext.dd.DragTracker,{onMouseMove:function(a,b){if(this.active&&Ext.isIE&&!Ext.isIE9&&!a.browserEvent.button)return a.preventDefault(),void this.onMouseUp(a);a.preventDefault();var c=a.getXY(),d=this.startXY;if(this.lastXY=c,!this.active){if(!(Math.abs(d[0]-c[0])>this.tolerance||Math.abs(d[1]-c[1])>this.tolerance))return;this.triggerStart(a)}this.fireEvent("mousemove",this,a),this.onDrag(a),this.fireEvent("drag",this,a)}}),function(){Ext.preg("gx_wmssource",gxp.plugins.WMSSource),Ext.preg("gx_olsource",gxp.plugins.OLSource),Ext.preg("gx_googlesource",gxp.plugins.GoogleSource),Ext.preg("gx_bingsource",gxp.plugins.BingSource),Ext.preg("gx_osmsource",gxp.plugins.OSMSource),Ext.preg("gxp_layertree",gxp.plugins.LayerManager)}();var GeoExplorer=Ext.extend(gxp.Viewer,{zoomSliderText:"<div>Zoom Level: {zoom}</div><div>Scale: 1:{scale}</div>",loadConfigErrorText:"Trouble reading saved configuration: <br />",loadConfigErrorDefaultText:"Server Error.",xhrTroubleText:"Communication Trouble: Status ",layersText:"Layers",titleText:"Title",bookmarkText:"Bookmark URL",permakinkText:"Permalink",appInfoText:"GeoExplorer",aboutText:"About GeoExplorer",mapInfoText:"Map Info",descriptionText:"Description",contactText:"Contact",aboutThisMapText:"About this Map",aboutUrl:"../about.html",mapPanel:null,constructor:function(a){this.mapItems=[{xtype:"gxp_scaleoverlay"},{xtype:"gx_zoomslider",vertical:!0,height:100,plugins:new GeoExt.ZoomSliderTip({template:this.zoomSliderText})}],a.viewerTools=[{hidden:!0,actions:["layerchooser"],checked:!0},{hidden:!0,actions:["-"],checked:!0},{leaf:!0,text:gxp.plugins.Print.prototype.tooltip,ptype:"gxp_print",iconCls:"gxp-icon-print",customParams:{outputFilename:"GeoExplorer-print"},printService:a.printService,checked:!0},{leaf:!0,text:gxp.plugins.Navigation.prototype.tooltip,checked:!0,iconCls:"gxp-icon-pan",ptype:"gxp_navigation",toggleGroup:"navigation"},{leaf:!0,text:gxp.plugins.WMSGetFeatureInfo.prototype.infoActionTip,checked:!0,iconCls:"gxp-icon-getfeatureinfo",ptype:"gxp_wmsgetfeatureinfo",format:"grid",toggleGroup:"interaction"},{leaf:!0,text:gxp.plugins.Measure.prototype.measureTooltip,checked:!0,iconCls:"gxp-icon-measure-length",ptype:"gxp_measure",controlOptions:{immediate:!0},toggleGroup:"interaction"},{leaf:!0,text:gxp.plugins.Zoom.prototype.zoomInTooltip+" / "+gxp.plugins.Zoom.prototype.zoomOutTooltip,checked:!0,iconCls:"gxp-icon-zoom-in",ptype:"gxp_zoom"},{leaf:!0,text:gxp.plugins.NavigationHistory.prototype.previousTooltip+" / "+gxp.plugins.NavigationHistory.prototype.nextTooltip,checked:!0,iconCls:"gxp-icon-zoom-previous",ptype:"gxp_navigationhistory"},{leaf:!0,text:gxp.plugins.ZoomToExtent.prototype.tooltip,checked:!0,iconCls:gxp.plugins.ZoomToExtent.prototype.iconCls,ptype:"gxp_zoomtoextent"},{leaf:!0,text:gxp.plugins.Legend.prototype.tooltip,checked:!0,iconCls:"gxp-icon-legend",ptype:"gxp_legend"},{leaf:!0,text:gxp.plugins.GoogleEarth.prototype.tooltip,checked:!0,iconCls:"gxp-icon-googleearth",ptype:"gxp_googleearth"},{hidden:!0,actions:["->"],checked:!0},{hidden:!0,actions:["aboutbutton"],checked:!0}],GeoExplorer.superclass.constructor.apply(this,arguments)},loadConfig:function(a){var b=window.location.hash.substr(1),c=b.match(/^maps\/(\d+)$/);if(c)this.id=Number(c[1]),Ext.Ajax.request({url:"../"+b,success:function(b){var c=Ext.util.JSON.decode(b.responseText);delete c.tools,this.applyConfig(Ext.applyIf(c,a))},failure:function(b){var c;try{c=Ext.util.JSON.decode(b.responseText)}catch(a){}var d=this.loadConfigErrorText;d+=c&&c.error?c.error:this.loadConfigErrorDefaultText,this.on({ready:function(){this.displayXHRTrouble(d,b.status)},scope:this}),delete this.id,window.location.hash="",this.applyConfig(a)},scope:this});else{var d=Ext.urlDecode(document.location.search.substr(1));if(d){if(d.q){var e=Ext.util.JSON.decode(d.q);Ext.apply(a,e)}if(d.layers)for(var f=d.layers.split(/\s*,\s*/),g=0,h=f.length;g<h;++g)a.map.layers.push({source:"local",name:f[g],visibility:!0,bbox:d.lazy&&d.bbox?d.bbox.split(","):void 0});d.bbox&&(delete a.map.zoom,delete a.map.center,a.map.extent=d.bbox.split(/\s*,\s*/)),d.lazy&&a.sources.local&&(a.sources.local.requiredProperties=[])}this.applyConfig(a)}},displayXHRTrouble:function(a,b){Ext.Msg.show({title:this.xhrTroubleText+b,msg:a,icon:Ext.MessageBox.WARNING})},initPortal:function(){this.createTools(),GeoExplorer.superclass.initPortal.apply(this,arguments)},createTools:function(){new Ext.Button({id:"aboutbutton",text:this.appInfoText,iconCls:"icon-geoexplorer",handler:this.displayAppInfo,scope:this})},showUrl:function(a){if(200==a.status){var b=new Ext.Window({title:this.bookmarkText,layout:"form",labelAlign:"top",modal:!0,bodyStyle:"padding: 5px",width:300,items:[{xtype:"textfield",fieldLabel:this.permakinkText,readOnly:!0,anchor:"100%",selectOnFocus:!0,value:window.location.href}]});b.show(),b.items.first().selectText()}else{var c=Ext.util.JSON.decode(a.responseText);this.displayXHRTrouble(c.error,a.status)}},getBookmark:function(){var a=Ext.apply(OpenLayers.Util.getParameters(),{q:Ext.util.JSON.encode(this.getState())}),b=document.location.href.split("?").shift()+"?"+Ext.urlEncode(a);return b},displayAppInfo:function(){var a=new Ext.Panel({title:this.appInfoText,html:"<iframe style='border: none; height: 100%; width: 100%' src='"+this.aboutUrl+"' frameborder='0' border='0'><a target='_blank' href='"+this.aboutUrl+"'>"+this.aboutText+"</a> </iframe>"}),b=Ext.applyIf(this.about,{title:"",abstract:"",contact:""}),c=new Ext.Panel({title:this.mapInfoText,html:'<div class="gx-info-panel"><h2>'+this.titleText+"</h2><p>"+b.title+"</p><h2>"+this.descriptionText+"</h2><p>"+b.abstract+"</p> <h2>"+this.contactText+"</h2><p>"+b.contact+"</p></div>",height:"auto",width:"auto"}),d=new Ext.TabPanel({activeTab:0,items:[c,a]}),e=new Ext.Window({title:this.aboutThisMapText,modal:!0,layout:"fit",width:300,height:300,items:[d]});e.show()},getState:function(){var a=GeoExplorer.superclass.getState.apply(this,arguments);return delete a.tools,a}});GeoExplorer.Composer=Ext.extend(GeoExplorer,{cookieParamName:"geoexplorer-user",mapText:"Map",saveMapText:"Save map",exportMapText:"Export map",toolsTitle:"Choose tools to include in the toolbar:",previewText:"Preview",backText:"Back",nextText:"Next",loginText:"Login",logoutText:"Logout, {user}",loginErrorText:"Invalid username or password.",userFieldText:"User",passwordFieldText:"Password",tableText:"Table",queryText:"Query",logoutConfirmTitle:"Warning",logoutConfirmMessage:"Logging out will undo any unsaved changes, remove any layers you may have added, and reset the map composition. Do you want to save your composition first?",constructor:function(a){401===a.authStatus?this.authorizedRoles=[]:404!==a.authStatus&&(this.authorizedRoles=["ROLE_ADMINISTRATOR"]),delete a.authStatus,a.tools=[{ptype:"gxp_layermanager",outputConfig:{id:"layers",tbar:[],autoScroll:!0},outputTarget:"tree"},{ptype:"gxp_addlayers",actionTarget:"layers.tbar",outputTarget:"tree",uploadSource:"local",postUploadAction:{plugin:"styler"},catalogSourceKey:"local",search:{selectedSource:"csw"}},{ptype:"gxp_removelayer",actionTarget:["layers.tbar","layers.contextMenu"]},{ptype:"gxp_layerproperties",id:"layerproperties",outputConfig:{defaults:{autoScroll:!0},width:320},actionTarget:["layers.tbar","layers.contextMenu"],outputTarget:"tree"},{ptype:"gxp_styler",id:"styler",outputConfig:{autoScroll:!0,width:320},actionTarget:["layers.tbar","layers.contextMenu"],outputTarget:"tree"},{ptype:"gxp_zoomtolayerextent",actionTarget:{target:"layers.contextMenu",index:0}},{ptype:"gxp_googleearth",actionTarget:["map.tbar","globe.tbar"]},{ptype:"gxp_navigation",toggleGroup:"navigation"},{ptype:"gxp_zoom",toggleGroup:"navigation",showZoomBoxAction:!0,controlOptions:{zoomOnClick:!1}},{ptype:"gxp_navigationhistory"},{ptype:"gxp_zoomtoextent"},{actions:["aboutbutton"],actionTarget:"paneltbar"},{actions:["-"],actionTarget:"paneltbar"},{actions:["mapmenu"],actionTarget:"paneltbar"},{ptype:"gxp_print",customParams:{outputFilename:"GeoExplorer-print"},printService:a.printService,actionTarget:"paneltbar",showButtonText:!0},{actions:["-"],actionTarget:"paneltbar"},{ptype:"gxp_wmsgetfeatureinfo",format:"grid",toggleGroup:"interaction",showButtonText:!0,actionTarget:"paneltbar"},{ptype:"gxp_featuremanager",id:"querymanager",selectStyle:{cursor:""},autoLoadFeatures:!0,maxFeatures:50,paging:!0,pagingType:gxp.plugins.FeatureManager.WFS_PAGING},{ptype:"gxp_queryform",featureManager:"querymanager",autoExpand:"query",actionTarget:"paneltbar",outputTarget:"query"},{ptype:"gxp_featuregrid",featureManager:"querymanager",showTotalResults:!0,autoLoadFeature:!1,alwaysDisplayOnMap:!0,controlOptions:{multiple:!0},displayMode:"selected",outputTarget:"table",outputConfig:{id:"featuregrid",columnsSortable:!1}},{ptype:"gxp_zoomtoselectedfeatures",featureManager:"querymanager",actionTarget:["featuregrid.contextMenu","featuregrid.bbar"]},{ptype:"gxp_measure",toggleGroup:"interaction",controlOptions:{immediate:!0},showButtonText:!0,actionTarget:"paneltbar"
},{ptype:"gxp_featuremanager",id:"featuremanager",maxFeatures:20,paging:!1},{ptype:"gxp_featureeditor",featureManager:"featuremanager",autoLoadFeature:!0,splitButton:!0,showButtonText:!0,toggleGroup:"interaction",actionTarget:"paneltbar"},{actions:["->"],actionTarget:"paneltbar"},{actions:["loginbutton"],actionTarget:"paneltbar"}],GeoExplorer.Composer.superclass.constructor.apply(this,arguments)},loadConfig:function(a){GeoExplorer.Composer.superclass.loadConfig.apply(this,arguments);var b=Ext.urlDecode(document.location.search.substr(1));if(b&&b.styler){for(var c=a.map.layers.length-1;c>=0;--c)delete a.map.layers[c].selected;a.map.layers.push({source:"local",name:b.styler,selected:!0,bbox:b.lazy&&b.bbox?b.bbox.split(","):void 0}),this.on("layerselectionchange",function(a){var c=this.tools.styler,d=a.getLayer(),e=d.maxExtent;e&&!b.bbox&&this.mapPanel.map.zoomToExtent(e),this.doAuthorized(c.roles,c.addOutput,c)},this,{single:!0})}},setCookieValue:function(a,b){document.cookie=a+"="+escape(b)},clearCookieValue:function(a){document.cookie=a+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"},getCookieValue:function(a){var b,c,d,e=document.cookie.split(";");for(b=0;b<e.length;b++)if(c=e[b].substr(0,e[b].indexOf("=")),d=e[b].substr(e[b].indexOf("=")+1),c=c.replace(/^\s+|\s+$/g,""),c==a)return unescape(d);return null},logout:function(){var a=function(){this.clearCookieValue("JSESSIONID"),this.clearCookieValue(this.cookieParamName),this.setAuthorizedRoles([]),window.location.reload()};Ext.Msg.show({title:this.logoutConfirmTitle,msg:this.logoutConfirmMessage,buttons:Ext.Msg.YESNOCANCEL,icon:Ext.MessageBox.WARNING,fn:function(b){"yes"===b?this.save(a,this):"no"===b&&a.call(this)},scope:this})},authenticate:function(){function b(){a.buttons[0].disable(),a.getForm().submit({success:function(a,b){Ext.getCmp("paneltbar").items.each(function(a){a.needsAuthorization===!0&&a.enable()});var d=a.findField("username").getValue();this.setCookieValue(this.cookieParamName,d),this.setAuthorizedRoles(["ROLE_ADMINISTRATOR"]),this.showLogout(d),c.un("beforedestroy",this.cancelAuthentication,this),c.close()},failure:function(b,c){this.authorizedRoles=[],a.buttons[0].enable(),b.markInvalid({username:this.loginErrorText,password:this.loginErrorText})},scope:this})}var a=new Ext.FormPanel({url:"../login/",frame:!0,labelWidth:60,defaultType:"textfield",errorReader:{read:function(a){var b=!1,c=[];return 200===a.status?b=!0:c=[{data:{id:"username",msg:this.loginErrorText}},{data:{id:"password",msg:this.loginErrorText}}],{success:b,records:c}}},items:[{fieldLabel:this.userFieldText,name:"username",width:137,allowBlank:!1,listeners:{render:function(){this.focus(!0,100)}}},{fieldLabel:this.passwordFieldText,name:"password",width:137,inputType:"password",allowBlank:!1}],buttons:[{text:this.loginText,formBind:!0,handler:b,scope:this}],keys:[{key:[Ext.EventObject.ENTER],handler:b,scope:this}]}),c=new Ext.Window({title:this.loginText,layout:"fit",width:235,height:130,plain:!0,border:!1,modal:!0,items:[a],listeners:{beforedestroy:this.cancelAuthentication,scope:this}});c.show()},applyLoginState:function(a,b,c,d){var e=Ext.getCmp("loginbutton");e.setIconClass(a),e.setText(b),e.setHandler(c,d)},showLogin:function(){var a=this.loginText,b=this.authenticate;this.applyLoginState("login",a,b,this)},showLogout:function(a){var b=new Ext.Template(this.logoutText).applyTemplate({user:a}),c=this.logout;this.applyLoginState("logout",b,c,this)},initPortal:function(){var a=new gxp.CrumbPanel({id:"tree",region:"west",width:320,split:!0,collapsible:!0,collapseMode:"mini",hideCollapseTool:!0,header:!1}),b=new Ext.Panel({region:"south",id:"south",height:220,border:!1,split:!0,collapsible:!0,collapseMode:"mini",collapsed:!0,hideCollapseTool:!0,header:!1,layout:"border",items:[{region:"center",id:"table",title:this.tableText,layout:"fit"},{region:"west",width:320,id:"query",title:this.queryText,split:!0,collapsible:!0,collapseMode:"mini",collapsed:!0,hideCollapseTool:!0,layout:"fit"}]}),c=new Ext.Toolbar({disabled:!0,id:"paneltbar",items:[]});this.on("ready",function(){var a=c.items.filterBy(function(a){return a.initialConfig&&a.initialConfig.disabled});c.enable(),a.each(function(a){a.disable()})});var d=new gxp.GoogleEarthPanel({mapPanel:this.mapPanel,id:"globe",tbar:[],listeners:{beforeadd:function(a){return"background"!==a.get("group")}}}),e=[];d.on("show",function(){e.length=0,c.items.each(function(a){a.disabled&&e.push(a)}),c.disable();for(var a in this.tools){var b=this.tools[a];"map"===b.outputTarget&&b.removeOutput()}var d=Ext.getCmp("tree"),f=d&&d.getTopToolbar();f&&(f.items.each(function(a){a.disabled&&e.push(a)}),f.disable())},this),d.on("hide",function(){c.enable();var a=Ext.getCmp("tree"),b=a&&a.getTopToolbar();b&&b.enable();for(var d=0,f=e.length;d<f;++d)e[d].disable()},this),this.mapPanelContainer=new Ext.Panel({layout:"card",region:"center",defaults:{border:!1},items:[this.mapPanel,d],activeItem:0}),this.portalItems=[{region:"center",layout:"border",tbar:c,items:[this.mapPanelContainer,a,b]}],GeoExplorer.Composer.superclass.initPortal.apply(this,arguments)},createTools:function(){if(GeoExplorer.Composer.superclass.createTools.apply(this,arguments),new Ext.Button({id:"loginbutton"}),this.authorizedRoles)if(0===this.authorizedRoles.length)this.showLogin();else{var a=this.getCookieValue(this.cookieParamName);null===a&&(a="unknown"),this.showLogout(a)}new Ext.Button({id:"mapmenu",text:this.mapText,iconCls:"icon-map",menu:new Ext.menu.Menu({items:[{text:this.exportMapText,handler:function(){this.doAuthorized(["ROLE_ADMINISTRATOR"],function(){this.save(this.showEmbedWindow)},this)},scope:this,iconCls:"icon-export"},{text:this.saveMapText,handler:function(){this.doAuthorized(["ROLE_ADMINISTRATOR"],function(){this.save(this.showUrl)},this)},scope:this,iconCls:"icon-save"}]})})},openPreview:function(a){var b=new Ext.Window({title:this.previewText,layout:"fit",resizable:!1,items:[{border:!1,html:a.getIframeHTML()}]});b.show();var c=b.items.get(0).body,d=c.dom.firstChild,e=new Ext.LoadMask(c);e.show(),Ext.get(d).on("load",function(){e.hide()})},showEmbedWindow:function(){var a=new Ext.tree.TreePanel({title:this.toolsTitle,autoScroll:!0,root:{nodeType:"async",expanded:!0,children:this.viewerTools},rootVisible:!1,id:"geobuilder-0"}),b=function(a){var b=Ext.getCmp("geobuilder-wizard-panel").getLayout(),c=b.activeItem.id.split("geobuilder-")[1],d=parseInt(c,10)+a;b.setActiveItem(d),Ext.getCmp("wizard-prev").setDisabled(0==d),Ext.getCmp("wizard-next").setDisabled(1==d),1==a&&this.save()},c=new gxp.EmbedMapDialog({id:"geobuilder-1",url:"../viewer/#maps/"+this.id}),d={id:"geobuilder-wizard-panel",border:!1,layout:"card",activeItem:0,defaults:{border:!1,hideMode:"offsets"},bbar:[{id:"preview",text:this.previewText,handler:function(){this.save(this.openPreview.createDelegate(this,[c]))},scope:this},"->",{id:"wizard-prev",text:this.backText,handler:b.createDelegate(this,[-1]),scope:this,disabled:!0},{id:"wizard-next",text:this.nextText,handler:b.createDelegate(this,[1]),scope:this}],items:[a,c]};new Ext.Window({layout:"fit",width:500,height:300,title:this.exportMapText,items:[d]}).show()}}),Ext.namespace("GeoExplorer"),GeoExplorer.Viewer=Ext.extend(GeoExplorer,{applyConfig:function(a){for(var d,b=a.viewerTools||this.viewerTools,c=[],e=0,f=b.length;e<f;e++){var g=b[e];if(g.checked===!0){var h=["checked","iconCls","id","leaf","loader","text"];for(var i in h)delete g[h[i]];d=Ext.applyIf({actionTarget:"paneltbar"},g),c.push(d)}}a.tools=c,GeoExplorer.Viewer.superclass.applyConfig.call(this,a)},initPortal:function(){this.toolbar=new Ext.Toolbar({disabled:!0,id:"paneltbar"}),this.on("ready",function(){this.toolbar.enable()},this),this.mapPanelContainer=new Ext.Panel({layout:"card",region:"center",defaults:{border:!1},items:[this.mapPanel,new gxp.GoogleEarthPanel({mapPanel:this.mapPanel,listeners:{beforeadd:function(a){return"background"!==a.get("group")}}})],activeItem:0}),this.portalItems=[{region:"center",layout:"border",tbar:this.toolbar,items:[this.mapPanelContainer]}],GeoExplorer.Viewer.superclass.initPortal.apply(this,arguments)},createTools:function(){GeoExplorer.Viewer.superclass.createTools.apply(this,arguments),Ext.getCmp("aboutbutton").setText(null).setIconClass("icon-about"),new Ext.Button({id:"layerchooser",tooltip:"Layer Switcher",iconCls:"icon-layer-switcher",menu:new gxp.menu.LayerMenu({layers:this.mapPanel.layers})})}}),Ext.namespace("GeoExt"),GeoExt.Lang=new(Ext.extend(Ext.util.Observable,{locale:navigator.language||navigator.userLanguage,dict:null,constructor:function(){this.addEvents("localize"),this.dict={},Ext.util.Observable.constructor.apply(this,arguments)},add:function(a,b){var c=this.dict[a];if(c)for(var d in b)c[d]=Ext.apply(c[d]||{},b[d]);else this.dict[a]=Ext.apply({},b);a&&a!==this.locale?0===this.locale.indexOf(a+"-")&&this.set(this.locale):this.set(a)},set:function(a){for(var e,b=a?a.split("-"):[],c="",d={},f=0,g=b.length;f<g;++f)if(c+=(c&&"-"||"")+b[f],c in this.dict){e=this.dict[c];for(var h in e)h in d?Ext.apply(d[h],e[h]):d[h]=Ext.apply({},e[h])}for(var h in d){for(var i=window,j=h.split("."),k=!1,f=0,g=j.length;f<g;++f){var l=j[f];if(!(l in i)){k=!0;break}i=i[l]}k||Ext.apply(i,d[h])}this.locale=a,this.fireEvent("localize",a)}})),GeoExt.Lang.add("ca",{"GeoExplorer.prototype":{zoomSliderText:"<div>Grau de detall: {zoom}</div><div>Escala: 1:{scale}</div>",loadConfigErrorText:"Problemes llegint la configuració desada: <br />",loadConfigErrorDefaultText:"Error del servidor.",xhrTroubleText:"Problemes de comunicació. Estat ",layersText:"Capes",titleText:"Títol",bookmarkText:"URL del marcador",permakinkText:"Enllaç permanent",appInfoText:"GeoExplorer",aboutText:"Quant a GeoExplorer",mapInfoText:"Informació del mapa",descriptionText:"Descripció",contactText:"Contacte",aboutThisMapText:"Quant a aquest mapa"},"GeoExplorer.Composer.prototype":{mapText:"Mapa",tableText:"Table",queryText:"Query",exportMapText:"Exporta el Mapa",saveMapText:"Desa el Mapa",toolsTitle:"Escolliu els elements que desitgeu incloure a la barra d'eines:",previewText:"Vista prèvia",backText:"Anterior",nextText:"Següent",loginText:"Login",loginErrorText:"Invalid username or password.",userFieldText:"User",passwordFieldText:"Password",logoutConfirmTitle:"Warning",logoutConfirmMessage:"Logging out will undo any unsaved changes, remove any layers you may have added, and reset the map composition. Do you want to save your composition first?"}}),GeoExt.Lang.add("de",{"GeoExplorer.prototype":{zoomSliderText:"<div>Zoomstufe: {zoom}</div><div>Maßstab: 1:{scale}</div>",loadConfigErrorText:"Gespeicherte Konfiguration kann nicht gelesen werden: <br />",loadConfigErrorDefaultText:"Server Fehler.",xhrTroubleText:"Kommunikationsfehler: Status ",layersText:"Layer",titleText:"Titel",zoomLevelText:"Zoomstufe",bookmarkText:"Bookmark URL",permakinkText:"Permalink",appInfoText:"GeoExplorer",aboutText:"Über GeoExplorer",mapInfoText:"Karteninfo",descriptionText:"Beschreibung",contactText:"Kontakt",aboutThisMapText:"Über diese Karte"},"GeoExplorer.Composer.prototype":{mapText:"Karte",tableText:"Tabelle",queryText:"Abfrage",exportMapText:"Karte veröffentlichen",saveMapText:"Karte speichern",toolsTitle:"Werkzeuge, die in der Werkzeugleiste zur Verfügung stehen sollen:",previewText:"Vorschau",backText:"Zurück",nextText:"Weiter",loginText:"Login",loginErrorText:"Ungültiger Benutzername oder ungültiges Kennwort.",userFieldText:"Benutzer",passwordFieldText:"Kennwort",logoutConfirmTitle:"Warning",logoutConfirmMessage:"Logging out will undo any unsaved changes, remove any layers you may have added, and reset the map composition. Do you want to save your composition first?"}}),GeoExt.Lang.add("en",{"GeoExplorer.prototype":{zoomSliderText:"<div>Zoom Level: {zoom}</div><div>Scale: 1:{scale}</div>",loadConfigErrorText:"Trouble reading saved configuration: <br />",loadConfigErrorDefaultText:"Server Error.",xhrTroubleText:"Communication Trouble: Status ",layersText:"Layers",titleText:"Title",zoomLevelText:"Zoom level",bookmarkText:"Bookmark URL",permakinkText:"Permalink",appInfoText:"GeoExplorer",aboutText:"About GeoExplorer",mapInfoText:"Map info",descriptionText:"Description",contactText:"Contact",aboutThisMapText:"About this map"},"GeoExplorer.Composer.prototype":{mapText:"Map",tableText:"Table",queryText:"Query",exportMapText:"Publish map",saveMapText:"Save map",toolsTitle:"Choose tools to include in the toolbar:",previewText:"Preview",backText:"Back",nextText:"Next",loginText:"Login",loginErrorText:"Invalid username or password.",userFieldText:"User",passwordFieldText:"Password",logoutConfirmTitle:"Warning",logoutConfirmMessage:"Logging out will undo any unsaved changes, remove any layers you may have added, and reset the map composition. Do you want to save your composition first?"}}),GeoExt.Lang.add("es",{"GeoExplorer.prototype":{zoomSliderText:"<div>Nivel de detalle: {zoom}</div><div>Escala: 1:{scale}</div>",loadConfigErrorText:"Problemas leyendo la configuración guardada: <br />",loadConfigErrorDefaultText:"Error del servidor.",xhrTroubleText:"Problemas de comunicación: Estado ",layersText:"Capas",titleText:"Título",bookmarkText:"URL del marcador",permakinkText:"Enlace permanente",appInfoText:"GeoExplorer",aboutText:"Acerca de GeoExplorer",mapInfoText:"Información del mapa",descriptionText:"Descripción",contactText:"Contacto",aboutThisMapText:"Acerca de este mapa"},"GeoExplorer.Composer.prototype":{mapText:"Mapa",tableText:"Table",queryText:"Query",exportMapText:"Exportar Mapa",saveMapText:"Guardar Mapa",toolsTitle:"Escoja los elementos que desea incluir en la barra de herramientas:",previewText:"Vista previa",backText:"Anterior",nextText:"Siguiente",loginText:"Login",loginErrorText:"Invalid username or password.",userFieldText:"User",passwordFieldText:"Password",logoutConfirmTitle:"Warning",logoutConfirmMessage:"Logging out will undo any unsaved changes, remove any layers you may have added, and reset the map composition. Do you want to save your composition first?"}}),GeoExt.Lang.add("fr",{"GeoExplorer.prototype":{zoomSliderText:"<div> Niveau de zoom: {zoom}</div><div Echelle: 1:{scale}</div>",loadConfigErrorText:"Difficulté à lire configuration enregistrée: <br>",loadConfigErrorDefaultText:"Erreur du serveur.",xhrTroubleText:"Trouble de la communication: état",layersText:"Layers",titleText:"Titre",bookmarkText:"Mettre en favori URL",permakinkText:"Permalink",appInfoText:"GeoExplorer",aboutText:"À propos de GeoExplorer",mapInfoText:"Info carte",descriptionText:"Description",contactText:"Contact",aboutThisMapText:"À propos de cette carte"},"GeoExplorer.Composer.prototype":{mapText:"Carte",tableText:"Table",queryText:"Query",exportMapText:"Carte Export",saveMapText:"Enregistrez la carte",toolsTitle:"Choose tools to include in the toolbar:",previewText:"Preview",backText:"Back",nextText:"Next",loginText:"Login",loginErrorText:"Invalid username or password.",userFieldText:"User",passwordFieldText:"Password",logoutConfirmTitle:"Warning",logoutConfirmMessage:"Logging out will undo any unsaved changes, remove any layers you may have added, and reset the map composition. Do you want to save your composition first?"}}),GeoExt.Lang.add("no",{"GeoExplorer.prototype":{zoomSliderText:"<div>Zoom nivå: {zoom}</div><div>Målestokk: 1:{scale}</div>",loadConfigErrorText:"Problemer med å lese lagret konfigurasjon: <br />",loadConfigErrorDefaultText:"Server Feil.",xhrTroubleText:"Kommunikasjons Problem: Status ",layersText:"Kartlag",titleText:"Titel",zoomLevelText:"Zoom nivå",bookmarkText:"Bokmerk URL",permakinkText:"Permalenke",appInfoText:"GeoExplorer",aboutText:"Om GeoExplorer",mapInfoText:"Kart Info",descriptionText:"Beskrivelse",contactText:"Kontakt",aboutThisMapText:"Om dette kartet"},"GeoExplorer.Composer.prototype":{mapText:"Kart",tableText:"Tabell",queryText:"Spørring",exportMapText:"Publiser kart",saveMapText:"Lagre kart",toolsTitle:"Velg verktøy og legge til i verktøyslinjen:",previewText:"Forhåndsvisning",backText:"Tilbake",nextText:"Neste",loginText:"Login",loginErrorText:"Ugylding brukernavn eller passord.",userFieldText:"Bruker",passwordFieldText:"Passord",logoutConfirmTitle:"Advarsel",logoutConfirmMessage:"Logge ut vil fjerne siste endringer, fjerne kartlag du har lagt til, og tilbakestille kart komposisjonen. Vil du lagre din komposisjon først?"}}),GeoExt.Lang.add("ca",{"gxp.menu.LayerMenu.prototype":{layerText:"Capa"},"gxp.plugins.AddLayers.prototype":{addActionMenuText:"Afegeix Capes",addActionTip:"Afegeix Capes",addServerText:"Afegeix servidor",addButtonText:"Afegeix Capes",untitledText:"Sense Títol",addLayerSourceErrorText:"Error obtenint les capabilities del WMS ({msg}).\nSi us plau, comproveu la URL i torneu-ho a intentar.",availableLayersText:"Capes disponibles",expanderTemplateText:"<p><b>Resum:</b> {abstract}</p>",panelTitleText:"Títol",layerSelectionText:"Veure dades disponibles de:",doneText:"Fet",uploadText:"Puja dades",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},"gxp.plugins.BingSource.prototype":{title:"Capes Bing",roadTitle:"Bing Carrerer",aerialTitle:"Bing Fotografia Aèria",labeledAerialTitle:"Bing Fotografia Aèria amb Etiquetes"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Edit",createFeatureActionText:"Create",editFeatureActionText:"Modify",createFeatureActionTip:"Crea nou element",editFeatureActionTip:"Edita element existent",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Mostra al mapa",firstPageTip:"Primera pàgina",previousPageTip:"Pàgina anterior",zoomPageExtentTip:"Ajusta vista a l'extensió de la pàgina",nextPageTip:"Pàgina següent",lastPageTip:"Pàgina anterior",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"Vista 3D",tooltip:"Vista 3D"},"gxp.plugins.GoogleSource.prototype":{title:"Capes Google",roadmapAbstract:"Mostra carrerer",satelliteAbstract:"Mostra imatges de satèl·lit",hybridAbstract:"Mostra imatges amb noms de carrer",terrainAbstract:"Mostra carrerer amb terreny"},"gxp.plugins.LayerProperties.prototype":{menuText:"Propietats de la capa",toolTip:"Propietats de la capa"},"gxp.plugins.LayerTree.prototype":{shortTitle:"Capes",rootNodeText:"Capes",overlayNodeText:"Capes addicionals",baseNodeText:"Capa base"},"gxp.plugins.LayerManager.prototype":{baseNodeText:"Capa base"},"gxp.plugins.Legend.prototype":{menuText:"Mostra Llegenda",tooltip:"Mostra Llegenda"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Loading Map..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.Measure.prototype":{buttonText:"Mesura",lengthMenuText:"Longitud",areaMenuText:"Àrea",lengthTooltip:"Mesura Longitud",areaTooltip:"Mesura Àrea",measureTooltip:"Mesura"},"gxp.plugins.Navigation.prototype":{menuText:"Desplaça mapa",tooltip:"Desplaça mapa"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Vista anterior",nextMenuText:"Vista següent",previousTooltip:"Vista anterior",nextTooltip:"Vista següent"},"gxp.plugins.OSMSource.prototype":{title:"Capes OpenStreetMap",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Daded CC-By-SA de <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:"Imprimeix",menuText:"Imprimeix mapa",tooltip:"Imprimeix mapa",previewText:"Vista prèvia",notAllNotPrintableText:"No es poden imprimir totes les capes",nonePrintableText:"No es pot imprimir cap de les capes del mapa"},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest Layers",osmAttribution:"Tessel·les cortesia de <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tessel·les cortesia de <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest Imatge"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Consulta",queryMenuText:"Consulta layer",queryActionTip:"Consulta la capa sel·leccionada",queryByLocationText:"Query by current map extent",queryByAttributesText:"Consulta per atributs",queryMsg:"Consultant...",cancelButtonText:"Cancel·la",noFeaturesTitle:"Sense coincidències",noFeaturesMessage:"La vostra consulta no ha produït resultats."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Elimina Capa",removeActionTip:"Elimina Capa"},"gxp.plugins.Styler.prototype":{menuText:"Edita Estils",tooltip:"Gestiona els estils de les capes"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identify",infoActionTip:"Consulta elements",popupTitle:"Informació dels elements"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom Box",zoomInMenuText:"Apropa",zoomOutMenuText:"Allunya",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"Apropa",zoomOutTooltip:"Allunya"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Mostra l'extensió total",tooltip:"Mostra l'extensió total"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Mostra tota la capa",tooltip:"Mostra tota la capa"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Mostra tota la capa",tooltip:"Mostra tota la capa"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Mostra els elements seleccionats",tooltip:"Mostra els elements seleccionats"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Desitgeu desar els canvis?",closeMsg:"Els canvis en aquest element no s'han desat. Desitja desar-los?",deleteMsgTitle:"Desitgeu esborrar l'element?",deleteMsg:"Esteu segurs de voler esborrar aquest element?",editButtonText:"Edita",editButtonTooltip:"Fes que aquest element sigui editable",deleteButtonText:"Esborra",deleteButtonTooltip:"Esborra aquest element",cancelButtonText:"Cancel·la",cancelButtonTooltip:"Deixa d'editar, descarta els canvis",saveButtonText:"Desa",saveButtonTooltip:"Desa els canvis"},"gxp.FillSymbolizer.prototype":{fillText:"Farcit",colorText:"Color",opacityText:"Opacitat"},"gxp.FilterBuilder.prototype":{builderTypeNames:["alguna de","totes","cap de","no totes"],preComboText:"Acompleix",postComboText:"les condicions següents:",addConditionText:"afegeix condició",addGroupText:"afegeix grup",removeConditionText:"treu condició"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Nom",titleHeaderText:"Títol",queryableHeaderText:"Consultable",layerSelectionLabel:"Llista les capes de:",layerAdditionLabel:"o afegeix un altre servidor.",expanderTemplateText:"<p><b>Resum:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"cercle",graphicSquareText:"quadrat",graphicTriangleText:"triangle",graphicStarText:"estrella",graphicCrossText:"creu",graphicXText:"x",graphicExternalText:"extern",urlText:"URL",opacityText:"opacitat",symbolText:"Símbol",sizeText:"Mides",rotationText:"Gir"},"gxp.QueryPanel.prototype":{queryByLocationText:"Consulta per lloc",currentTextText:"Vista actual",queryByAttributesText:"Consulta per atributs",layerText:"Capa"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Escala 1:{scale}",labelFeaturesText:"Etiqueta elements",labelsText:"Etiquetes",basicText:"Bàsic",advancedText:"Avançat",limitByScaleText:"Restringeix per escala",limitByConditionText:"Restringeix per condició",symbolText:"Símbol",nameText:"Nom"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Escala 1:{scale}",minScaleLimitText:"Escala mínima",maxScaleLimitText:"Escala màxima"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"continu",dashStrokeName:"guions",dotStrokeName:"punts",titleText:"Traç",styleText:"Estil",colorText:"Color",widthText:"Amplada",opacityText:"Opacitad"},"gxp.StylePropertiesDialog.prototype":{titleText:"General",nameFieldText:"Nom",titleFieldText:"Títol",abstractFieldText:"Resum"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Etiquetatge",haloText:"Halo",sizeText:"Mida"},"gxp.WMSLayerPanel.prototype":{attributionText:"Attribution",aboutText:"Quant a",titleText:"Títol",nameText:"Nom",descriptionText:"Descripció",displayText:"Mostra",opacityText:"Opacitat",formatText:"Format",transparentText:"Transparent",cacheText:"Caché",cacheFieldText:"Utiliza la versió en caché",stylesText:"Estils disponibles",infoFormatText:"Info format",infoFormatEmptyText:"Select a format",displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Ja podeu incloure el vostre mapa a altres webs! Simplement copieu el següent codi HTML allà on desitgeu incrustar-ho:",heightLabel:"Alçària",widthLabel:"Amplada",mapSizeLabel:"Mida",miniSizeLabel:"Mínima",smallSizeLabel:"Petita",premiumSizeLabel:"Premium",largeSizeLabel:"Gran"},"gxp.WMSStylesDialog.prototype":{addStyleText:"Afegeix",addStyleTip:"Afegeix nou estil",chooseStyleText:"Escull estil",deleteStyleText:"Treu",deleteStyleTip:"Esborra l'estil sel·leccionat",editStyleText:"Canvia",editStyleTip:"Edita l'estil sel·leccionat",duplicateStyleText:"Clona",duplicateStyleTip:"Duplica l'estil sel·leccionat",addRuleText:"Afegeix",addRuleTip:"Afegeix nova regla",newRuleText:"Nova regla",deleteRuleText:"Treu",deleteRuleTip:"Esborra la regla sel·leccionada",editRuleText:"Edita",editRuleTip:"Edita la regla sel·leccionada",duplicateRuleText:"Clona",duplicateRuleTip:"Duplica la regla sel·leccionada",cancelText:"Cancel·la",saveText:"Desa",styleWindowTitle:"Estil: {0}",ruleWindowTitle:"Regla: {0}",stylesFieldsetTitle:"Estils",rulesFieldsetTitle:"Regles"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Títol",titleEmptyText:"Títol de la capa",abstractLabel:"Descripció",abstractEmptyText:"Descripció de la capa",fileLabel:"Dades",fieldEmptyText:"Navegueu per les dades...",uploadText:"Puja",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",waitMsgText:"Pugeu les vostres dades...",invalidFileExtensionText:"L'extensió del fitxer ha de ser alguna d'aquestes: ",optionsText:"Opcions",workspaceLabel:"Espai de treball",workspaceEmptyText:"Espai de treball per defecte",dataStoreLabel:"Magatzem",dataStoreEmptyText:"Create new store",defaultDataStoreEmptyText:"Magatzem de dades per defecte"},"gxp.NewSourceDialog.prototype":{title:"Afegeix Servidor...",cancelText:"Cancel·la",addServerText:"Afegeix Servidor",invalidURLText:"Enter a valid URL to a WMS endpoint (e.g. http://example.com/geoserver/wms)",contactingServerText:"Connectant amb el Servidor..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Escala"},"gxp.Viewer.prototype":{saveErrorText:"Problemes desant: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Font",addPicasaText:"Picasa fotos",addYouTubeText:"YouTube Videos",addRSSText:"Feed GeoRSS Un altre",addFeedText:"Afegeix a Mapa",addTitleText:"Títol",keywordText:"Paraula clau",doneText:"Fet",titleText:"Afegir Feeds",maxResultsText:"Productes Max"}}),GeoExt.Lang.add("de",{"gxp.menu.LayerMenu.prototype":{layerText:"Layer"},"gxp.plugins.AddLayers.prototype":{addActionMenuText:"Layer hinzufügen",addActionTip:"Layer hinzufügen",addServerText:"Server hinzufügen",addButtonText:"Layer hinzufügen",untitledText:"ohne Titel",addLayerSourceErrorText:"Fehler beim Abfragen der WMS Capabilities ({msg}).\nBitte URL prüfen und erneut versuchen.",availableLayersText:"verfügbare Layer",expanderTemplateText:"<p><b>Kurzbeschreibung:</b> {abstract}</p>",panelTitleText:"Titel",layerSelectionText:"Verfügbare Daten anzeigen von:",doneText:"Fertig",uploadText:"Daten hochladen",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},"gxp.plugins.BingSource.prototype":{title:"Bing Layer",roadTitle:"Bing Strassen",aerialTitle:"Bing Luftbilder",labeledAerialTitle:"Bing Luftbilder mit Beschriftung"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Editieren",createFeatureActionText:"Erzeugen",editFeatureActionText:"Bearbeiten",createFeatureActionTip:"neues Objekt erstellen",editFeatureActionTip:"bestehendes Objekt bearbeiten",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"auf der Karte darstellen",firstPageTip:"erste Seite",previousPageTip:"vorherige Seite",zoomPageExtentTip:"Zoom zur max. Ausdehnung",nextPageTip:"nächste Seite",lastPageTip:"letzte Seite",totalMsg:"{1} bis {2} von {0} Datensätzen"},"gxp.plugins.GoogleEarth.prototype":{menuText:"3D Viewer",tooltip:"zum 3D Viewer wechseln"},"gxp.plugins.GoogleSource.prototype":{title:"Google Layers",roadmapAbstract:"Strassenkarte zeigen",satelliteAbstract:"Luftbilder zeigen",hybridAbstract:"Luftbilder mit Strassennamen zeigen",terrainAbstract:"Strassenkarte mit Gelände zeigen"},"gxp.plugins.LayerProperties.prototype":{menuText:"Layer Eigenschaften",toolTip:"Layer Eigenschaften"},"gxp.plugins.LayerTree.prototype":{shortTitle:"Layer",rootNodeText:"Layer",overlayNodeText:"überlagernde Layer",baseNodeText:"Basiskarten"},"gxp.plugins.LayerManager.prototype":{baseNodeText:"Basiskarte"},"gxp.plugins.Legend.prototype":{menuText:"Legende zeigen",tooltip:"Legende zeigen"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Karte laden..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.Measure.prototype":{buttonText:"Messen",lengthMenuText:"Länge",areaMenuText:"Fläche",lengthTooltip:"Länge messen",areaTooltip:"Fläche messen",measureTooltip:"Messen"},"gxp.plugins.Navigation.prototype":{menuText:"Kartenausschnitt verschieben",tooltip:"Kartenausschnitt verschieben"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Kartenausschnitt zurück",nextMenuText:"Kartenausschnitt vorwärts",previousTooltip:"Vorherigen Kartenausschnitt anzeigen",nextTooltip:"Nächsten Kartenausschnit anzeigen"},"gxp.plugins.OSMSource.prototype":{title:"OpenStreetMap Layer",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:"Drucken",menuText:"Karte drucken",tooltip:"Karte drucken",previewText:"Druckansicht",notAllNotPrintableText:"Es können nicht alle Layer gedruckt werden.",nonePrintableText:"Keiner der aktuellen Kartenlayer kann gedruckt werden."},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest Layers",osmAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",
osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest Imagery"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Abfrage",queryMenuText:"Abfrage Layer",queryActionTip:"selektierten Layer abfragen",queryByLocationText:"Abfrage nach aktuellem Kartenauscchnitt",queryByAttributesText:"Attributabfrage",queryMsg:"Abfrage wird ausgeführt",cancelButtonText:"Abbrechen",noFeaturesTitle:"keine Übereinstimmung",noFeaturesMessage:"Ihre Abfrage liefert keine Resultate."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Layer löschen",removeActionTip:"Layer löschen"},"gxp.plugins.Styler.prototype":{menuText:"Style bearbeiten",tooltip:"Layer Styles verwalten"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Objektinformation",infoActionTip:"Objektinformation abfragen",popupTitle:"Objektinformation"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom Box",zoomInMenuText:"Vergrössern",zoomOutMenuText:"Verkleinern",zoomTooltip:"Box aufziehen zum Zoomen",zoomInTooltip:"Vergrössern",zoomOutTooltip:"Verkleinern"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Maximale Ausdehnung",tooltip:"Maximale Ausdehnung anzeigen"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Auf Layer zoomen",tooltip:"Auf Layer zoomen"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Auf Layer zoomen",tooltip:"Auf Layer zoomen"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Auf selektierte Objekte zoomen",tooltip:"Auf selektierte Objekte zoomen"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Änderung speichern?",closeMsg:"Ungespeicherte Änderungen. Möchten Sie die Änderungen speichern?",deleteMsgTitle:"Objekt löschen?",deleteMsg:"Sind Sie sicher, dass Sie dieses Objekt löschen möchten?",editButtonText:"Bearbeiten",editButtonTooltip:"Objekt editieren",deleteButtonText:"Löschen",deleteButtonTooltip:"Objekt löschen",cancelButtonText:"Abbrechen",cancelButtonTooltip:"Bearbeitung beenden, Änderungen verwerfen.",saveButtonText:"Speichern",saveButtonTooltip:"Änderungen speichern"},"gxp.FillSymbolizer.prototype":{fillText:"Füllung",colorText:"Farbe",opacityText:"Transparenz"},"gxp.FilterBuilder.prototype":{builderTypeNames:["beliebige","alle","keine","nicht alle"],preComboText:"Match",postComboText:"der folgenden:",addConditionText:"Bedingung hinzufügen",addGroupText:"Gruppe hinzufügen",removeConditionText:"Bedingung entfernen"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Name",titleHeaderText:"Titel",queryableHeaderText:"abfragbar",layerSelectionLabel:"Verfügbare Daten anzeigen von:",layerAdditionLabel:"oder neuen Server hinzufügen.",expanderTemplateText:"<p><b>Kurzbeschreibung:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"Kreis",graphicSquareText:"Rechteck",graphicTriangleText:"Dreieck",graphicStarText:"Stern",graphicCrossText:"Kreuz",graphicXText:"x",graphicExternalText:"extern",urlText:"URL",opacityText:"Transparenz",symbolText:"Symbol",sizeText:"Grösse",rotationText:"Rotation"},"gxp.QueryPanel.prototype":{queryByLocationText:"lagebezogene Abfrage",currentTextText:"aktuelle Ausdehnung",queryByAttributesText:"Attributabfrage",layerText:"Layer"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Massstab 1:{scale}",labelFeaturesText:"Objekte beschriften",labelsText:"Beschriftung",basicText:"Basic",advancedText:"Erweitert",limitByScaleText:"Massstabsbeschränkung",limitByConditionText:"Einschränkung durch Bedingung",symbolText:"Symbol",nameText:"Name"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Massstab 1:{scale}",minScaleLimitText:"Minimale Massstabsgrenze",maxScaleLimitText:"Maximale Massstabsgrenze"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"ausgezogen",dashStrokeName:"gestrichelt",dotStrokeName:"gepunktet",titleText:"Linie",styleText:"Style",colorText:"Farbe",widthText:"Breite",opacityText:"Transparenz"},"gxp.StylePropertiesDialog.prototype":{titleText:"Allgemein",nameFieldText:"Name",titleFieldText:"Titel",abstractFieldText:"Kurzbeschreibung"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Label values",haloText:"Halo",sizeText:"Grösse"},"gxp.WMSLayerPanel.prototype":{attributionText:"Attribution",aboutText:"Über",titleText:"Titel",nameText:"Name",descriptionText:"Beschreibung",displayText:"Anzeige",opacityText:"Transparenz",formatText:"Format",transparentText:"transparent",cacheText:"Cache",cacheFieldText:"Version aus dem Cache benützen",stylesText:"Verfügbare Styles",infoFormatText:"Info Format",infoFormatEmptyText:"Format auswählen",displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Ihre Karte ist für die Publikation im Web bereit. Kopieren Sie einfach den folgenden HTML-Code, um die Karte in Ihre Webseite einzubinden:",heightLabel:"Höhe",widthLabel:"Breite",mapSizeLabel:"Kartengrösse",miniSizeLabel:"Mini",smallSizeLabel:"Klein",premiumSizeLabel:"Premium",largeSizeLabel:"Gross"},"gxp.WMSStylesDialog.prototype":{addStyleText:"Hinzufügen",addStyleTip:"neuen Style hinzufügen",chooseStyleText:"Style auswählen",deleteStyleText:"Löschen",deleteStyleTip:"selektierten Style löschen",editStyleText:"Bearbeiten",editStyleTip:"selektierten Style bearbeiten",duplicateStyleText:"Duplizieren",duplicateStyleTip:"selektierten Style duplizieren",addRuleText:"Hinzufügen",addRuleTip:"neue Regel hinzufügen",newRuleText:"neue Regel",deleteRuleText:"Entfernen",deleteRuleTip:"selektierte Regel löschen",editRuleText:"Bearbeiten",editRuleTip:"selektierte Regel bearbeiten",duplicateRuleText:"Duplizieren",duplicateRuleTip:"selektierte Regel duplizieren",cancelText:"Abbrechen",saveText:"Speichern",styleWindowTitle:"User Style: {0}",ruleWindowTitle:"Style Regel: {0}",stylesFieldsetTitle:"Styles",rulesFieldsetTitle:"Regeln"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Titel",titleEmptyText:"Layertitel",abstractLabel:"Beschreibung",abstractEmptyText:"Layerbeschreibung",fileLabel:"Daten",fieldEmptyText:"Datenarchiv durchsuchen...",uploadText:"Hochladen",uploadFailedText:"Hochladen fehlgeschlagen",processingUploadText:"Upload wird bearbeitet",waitMsgText:"Ihre Daten werden hochgeladen...",invalidFileExtensionText:"Dateierweiterung muss eine sein von: ",optionsText:"Optionen",workspaceLabel:"Workspace",workspaceEmptyText:"Standard Workspace",dataStoreLabel:"Store",dataStoreEmptyText:"Neuen Store erzeugen",defaultDataStoreEmptyText:"Default Datastore"},"gxp.NewSourceDialog.prototype":{title:"neuen Server hinzufügen...",cancelText:"Abbrechen",addServerText:"Server hinzufügen",invalidURLText:"Fügen Sie eine gültige URL zu einem WMS ein (z.B. http://example.com/geoserver/wms)",contactingServerText:"Server wird kontaktiert..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Zoomstufe"},"gxp.Viewer.prototype":{saveErrorText:"Beim Speichern ist ein Problem aufgetreten: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Source",addPicasaText:"Picasa Fotos",addYouTubeText:"YouTube Videos",addRSSText:"Andere GeoRSS Feed",addFeedText:"zur Karte hinzufügen",addTitleText:"Titel",keywordText:"Keyword",doneText:"Fertig",titleText:"Add-Feeds",maxResultsText:"Max Items"}}),GeoExt.Lang.add("el",{"gxp.menu.LayerMenu.prototype":{layerText:"Επιφάνεια"},"gxp.plugins.AddLayers.prototype":{addActionMenuText:"Προσθέστε επιφάνειες",addActionTip:"Προσθέστε επιφάνειες",addServerText:"Προσθέστε ένα Νέο Διακομιστή",addButtonText:"Προσθέστε επιφάνειες",untitledText:"Χωρίς τίτλο",addLayerSourceErrorText:"Σφάλμα στην ανάκτηση δυνατοτήτων WMS ({msg}).\nΠαρακαλώ ελέγξτε το url και δοκιμάστε ξανά.",availableLayersText:"Διαθέσιμες Επιφάνειες",expanderTemplateText:"<p><b>Περίληψη:</b> {abstract}</p>",panelTitleText:"Τίτλος",layerSelectionText:"Δείτε διαθέσιμα δεδομένα από:",doneText:"Ολοκληρώθηκε",uploadText:"Ανεβάστε Δεδομένα",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},"gxp.plugins.BingSource.prototype":{title:"Επιφάνειες Bing",roadTitle:"Δρόμοι Bing",aerialTitle:"Εναέριες Bing",labeledAerialTitle:"Εναέριες Bing με Ετικέτες"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Edit",createFeatureActionText:"Create",editFeatureActionText:"Modify",createFeatureActionTip:"Δημιουργήστε ένα νέο χαρακτηριστικό",editFeatureActionTip:"Τροποποιήστε υπάρχον χαρακτηριστικό",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Προβολή στον χάρτη",firstPageTip:"Πρώτη σελίδα",previousPageTip:"Προηγούμενη σελίδα",zoomPageExtentTip:"Ζουμ στο εύρος της σελίδας",nextPageTip:"Επόμενη σελίδα",nextPageTip:"Τελευταία σελίδα",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{apiKeyPrompt:"Παρακαλώ εισάγετε το Google API κλειδί για ",menuText:"3D Προβολή",tooltip:"Αλλάξτε σε 3D Προβολή"},"gxp.plugins.GoogleSource.prototype":{title:"Επιφάνειες Google",roadmapAbstract:"Προβολή οδικού χάρτη",satelliteAbstract:"Προβολή εικόνων από δορυφόρο",hybridAbstract:"Προβολή εικόνων με ονόματα οδών",terrainAbstract:"Προβολή οδικού χάρτη με ανάγλυφο εδάφους"},"gxp.plugins.LayerProperties.prototype":{menuText:"Επιλογές Επιφάνειας",toolTip:"Επιλογές Επιφάνειας"},"gxp.plugins.LayerTree.prototype":{rootNodeText:"Επιφάνειες",overlayNodeText:"Επιστρώματα",baseNodeText:"Υπόβαθρα"},"gxp.plugins.Legend.prototype":{menuText:"Προβολή Υπομνήματος",tooltip:"Προβολή Υπομνήματος"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Φόρτωση Χάρτη..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.Measure.prototype":{buttonText:"Μέτρο",lengthMenuText:"Απόσταση",areaMenuText:"Εμβαδόν",lengthTooltip:"Υπολογίστε απόσταση",areaTooltip:"Υπολογίστε εμβαδόν",measureTooltip:"Μέτρο"},"gxp.plugins.Navigation.prototype":{menuText:"Μετακινήστε Χάρτη",tooltip:"Μετακινήστε Χάρτη"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Ζουμ Στο Προηγούμενο Επίπεδο",nextMenuText:"Ζουμ Στο Επόμενο Επίπεδο",previousTooltip:"Ζουμ Στο Προηγούμενο Επίπεδο",nextTooltip:"Ζουμ Στο Επόμενο Επίπεδο"},"gxp.plugins.OSMSource.prototype":{title:"Επιφάνειες OpenStreetMap",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Δεδομένα CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:"Εκτύπωση",menuText:"Εκτύπωση Χάρτη",tooltip:"Εκτύπωση Χάρτη",previewText:"Προεπισκόπηση Εκτύπωσης",notAllNotPrintableText:"Δεν Μπορούν Να Εκτυπωθούν Όλες Οι Επιφάνειες",nonePrintableText:"Καμία από τις επιφάνειες του τρέχοντος χάρτη δεν μπορεί να εκτυπωθεί"},"gxp.plugins.MapQuestSource.prototype":{title:"Επιφάνειες MapQuest",osmAttribution:"Πλακίδια Προσφορά Των <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Πλακίδια Προσφορά Των of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"Εικόνες MapQuest"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Επερώτηση",queryMenuText:"Επιφάνεια επερώτησης",queryActionTip:"Κάντε επερώτηση στην επιλεγμένη επιφάνεια",queryByLocationText:"Query by current map extent",queryByAttributesText:"Επερώτηση βάσει χαρακτηριστικών",queryMsg:"Γίνεται επερώτηση...",cancelButtonText:"Ακύρωση",noFeaturesTitle:"Κανένα Αποτέλεσμα",noFeaturesMessage:"Η επερώτηση σας δεν επέστρεψε αποτελέσματα."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Κατάργηση επιφάνειας",removeActionTip:"Κατάργηση επιφάνειας"},"gxp.plugins.Styler.prototype":{menuText:"Επεξεργασία Στυλ",tooltip:"Επεξεργασία στυλ επιφάνειας"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identify",infoActionTip:"Πάρτε Πληροφορίες Χαρακτηριστικού",popupTitle:"Πληροφορίες Χαρακτηριστικού"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom Box",zoomInMenuText:"Ζουμ Μέσα",zoomOutMenuText:"Ζουμ Έξω",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"Ζουμ Μέσα",zoomOutTooltip:"Ζουμ Έξω"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Ζουμ Στο Μέγιστο Εύρος",tooltip:"Ζουμ Στο Μέγιστο Εύρος"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Ζουμ στο εύρος επιφάνειας",tooltip:"Ζουμ στο εύρος επιφάνειας"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Ζουμ στο εύρος επιφάνειας",tooltip:"Ζουμ στο εύρος επιφάνειας"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Ζουμ στα συγκεκριμένα χαρακτηριστικά",tooltip:"Ζουμ στα συγκεκριμένα χαρακτηριστικά"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Αποθήκευση Αλλαγών;",closeMsg:"Αυτό το χαρακτηριστικό έχει τροποποιήσεις που δεν έχουν αποθηκευτεί. Θέλετε να φυλάξετε τις αλλαγές σας;",deleteMsgTitle:"Διαγραφή Χαρακτηριστικού",deleteMsg:"Είστε σίγουροι οτι θέλετε να διαγράψετε το συγκεκριμένο χαρακτηριστικό",editButtonText:"Τροποποίηση",editButtonTooltip:"Κάντε αυτό το χαρακτηριστικό τροποποιήσιμο",deleteButtonText:"Διαγραφή",deleteButtonTooltip:"Διαγράψτε αυτό το χαρακτηριστικό",cancelButtonText:"Ακύρωση",cancelButtonTooltip:"Σταματήστε την τροποποίηση, απορρίπτοντας οποιεσδήποτε αλλαγές",saveButtonText:"Αποθήκευση",saveButtonTooltip:"Αποθήκευση αλλαγών"},"gxp.FillSymbolizer.prototype":{fillText:"Γέμισμα",colorText:"Χρώμα",opacityText:"Αδιαφάνεια"},"gxp.FilterBuilder.prototype":{builderTypeNames:["οποιοδήποτε","όλα","κανένα","όχι όλα"],preComboText:"Ταύτιση",postComboText:"των ακόλουθων:",addConditionText:"προσθήκη συνθήκης",addGroupText:"προσθήκη ομάδας",removeConditionText:"κατάργηση συνθήκης"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Όνομα",titleHeaderText:"Τίτλος",queryableHeaderText:"Μπορούν να γίνουν επερωτήσεις",layerSelectionLabel:"Δείτε διαθέσιμα δεδομένα από:",layerAdditionLabel:"ή προσθέστε νέο διακομιστή.",expanderTemplateText:"<p><b>Περιγραφή:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"κύκλος",graphicSquareText:"τετράγωνο",graphicTriangleText:"τρίγωνο",graphicStarText:"αστέρι",graphicCrossText:"σταυρός",graphicXText:"χ",graphicExternalText:"εξωτερικό",urlText:"URL",opacityText:"αδιαφάνεια",symbolText:"Σύμβολο",sizeText:"Εύρος",rotationText:"Περιστροφή"},"gxp.QueryPanel.prototype":{queryByLocationText:"Επερώτηση βάσει τοποθεσίας",currentTextText:"Τρέχον εύρος",queryByAttributesText:"Επερώτηση βάσει χαρακτηριστικών",layerText:"Επιφάνεια"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Κλίμακα 1:{scale}",labelFeaturesText:"Χαρακτηριστικά Επιφάνειας",labelsText:"Ετικέτες",basicText:"Απλή",advancedText:"Προηγμένη",limitByScaleText:"Περιορισμός βάσει κλίμακας",limitByConditionText:"Περιορισμός βάσει συνθήκης",symbolText:"Σύμβολο",nameText:"Όνομα"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Κλίμακα 1:{scale}",minScaleLimitText:"Όριο ελάχιστης κλίμακας",maxScaleLimitText:"Όριο μέγιστης κλίμακας"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"συμπαγής",dashStrokeName:"με παύλες",dotStrokeName:"με κουκίδες",titleText:"Πέρασμα",styleText:"Στύλο",colorText:"Χρώμα",widthText:"Πλάτος",opacityText:"Αδιαφάνεια"},"gxp.StylePropertiesDialog.prototype":{titleText:"Γενικά",nameFieldText:"Όνομα",titleFieldText:"Τίτλος",abstractFieldText:"Περίληψη"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Τιμές ετικέτας",haloText:"Φωτοστέφανο",sizeText:"Μέγεθος"},"gxp.WMSLayerPanel.prototype":{aboutText:"Σχετικά με",titleText:"Τίτλος",nameText:"Όνομα",descriptionText:"Περιγραφή",displayText:"Προβολή",opacityText:"Αδιαφάνεια",formatText:"Τύπος",transparentText:"Διαφανές",cacheText:"Cache",cacheFieldText:"Χρησιμοποίησε την cached έκδοση",stylesText:"Διαθέσιμες Στυλ",infoFormatText:"Info format",infoFormatEmptyText:"Select a format",displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Ο χάρτης σας είναι έτοιμος να δημοσιευτεί στο διαδίκτυο! Απλά αντιγράψτε τον ακόλουθο HTML κώδικα για να ενσωματώσετε τον χάρτη στην ιστοσελίδα σας:",heightLabel:"Ύψος",widthLabel:"Πλάτος",mapSizeLabel:"Μέγεθος Χάρτη",miniSizeLabel:"Μικρογραφία",smallSizeLabel:"Μικρό",premiumSizeLabel:"Εξαιρετικά ποιοτικό",largeSizeLabel:"Μεγάλος"},"gxp.WMSStylesDialog.prototype":{addStyleText:"Προσθήκη",addStyleTip:"Προσθήκη νέου στυλ",chooseStyleText:"Επιλογή στυλ",deleteStyleText:"Αφαίρεση",deleteStyleTip:"Διαγραφή του επιλεγμένου στυλ",editStyleText:"Επεξεργασία",editStyleTip:"Επεξεργασία του επιλεγμένου στυλ",duplicateStyleText:"Διπλότυπο",duplicateStyleTip:"Φτιάξτε διπλότυπο του επιλεγμένου στύλ",addRuleText:"Προσθήκη",addRuleTip:"Προσθήκη νέου κανόνα",newRuleText:"Νέος Κανόνας",deleteRuleText:"Αφαίρεση",deleteRuleTip:"Διαγράψτε τον επιλεγμένο κανόνα",editRuleText:"Επεξεργασία",editRuleTip:"Επεξεργαστείτε τον επιλεγμένο κανόνα",duplicateRuleText:"Διπλότυπο",duplicateRuleTip:"Φτιάξτε διπλότυπο του επιλεγμένου κανόνα",cancelText:"Ακύρωση",saveText:"Αποθήκευση",styleWindowTitle:"Στυλ Χρήστη: {0}",ruleWindowTitle:"Κανόνες Στυλ: {0}",stylesFieldsetTitle:"Στυλ",rulesFieldsetTitle:"Κανόνες"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Τίτλος",titleEmptyText:"Τίτλος επιφάνειας",abstractLabel:"Περιγραφή",abstractEmptyText:"Περιγραφή επιφάνειας",fileLabel:"Δεδομένα",fieldEmptyText:"Βρείτε το μονοπάτι για ένα αρχείο δεδομένων...",uploadText:"Ανέβασμα",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",waitMsgText:"Τα δεδομένα σας ανεβαίνουν...",invalidFileExtensionText:"Ο τύπος αρχείου πρέπει να είναι ένας από τους: ",optionsText:"Επιλογές",workspaceLabel:"Χώρος εργασίας",workspaceEmptyText:"Προεπιλεγμένος χώρος εργασίας",dataStoreLabel:"Αποθήκη",dataStoreEmptyText:"Create new store",defaultDataStoreEmptyText:"Προεπιλεγμένη αποθήκη"},"gxp.NewSourceWindow.prototype":{title:"Προσθήκη Νέου Διακομιστή...",cancelText:"Ακύρωση",addServerText:"Προσθήκη Διακομιστή",invalidURLText:"Είσαγετε ένα έγκυρο URL για ένα WMS endpoint (e.g. http://example.com/geoserver/wms)",contactingServerText:"Επικοινωνία με Διακομιστή..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Επίπεδο ζουμ"},"gxp.Viewer.prototype":{saveErrorText:"Trouble saving: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Πηγή",addPicasaText:"Φωτογραφίες Picasa",addYouTubeText:"YouTube βίντεο",addRSSText:"Άλλα Feed GeoRSS",addFeedText:"Προσθήκη στο χάρτη",addTitleText:"Τίτλος",keywordText:"Λέξη-κλειδί",doneText:"Done",titleText:"Προσθήκη ροής",maxResultsText:"Max Είδη"}}),GeoExt.Lang.add("en",{"gxp.menu.LayerMenu.prototype":{layerText:"Layer"},"gxp.plugins.AddLayers.prototype":{addActionMenuText:"Add layers",addActionTip:"Add layers",addServerText:"Add a New Server",addButtonText:"Add layers",untitledText:"Untitled",addLayerSourceErrorText:"Error getting WMS capabilities ({msg}).\nPlease check the url and try again.",availableLayersText:"Available Layers",expanderTemplateText:"<p><b>Abstract:</b> {abstract}</p>",panelTitleText:"Title",layerSelectionText:"View available data from:",doneText:"Done",uploadText:"Upload layers",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},"gxp.plugins.BingSource.prototype":{title:"Bing Layers",roadTitle:"Bing Roads",aerialTitle:"Bing Aerial",labeledAerialTitle:"Bing Aerial With Labels"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Edit",createFeatureActionText:"Create",editFeatureActionText:"Modify",createFeatureActionTip:"Create a new feature",editFeatureActionTip:"Edit existing feature",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Display on map",firstPageTip:"First page",previousPageTip:"Previous page",zoomPageExtentTip:"Zoom to page extent",nextPageTip:"Next page",lastPageTip:"Last page",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"3D Viewer",tooltip:"Switch to 3D Viewer"},"gxp.plugins.GoogleSource.prototype":{title:"Google Layers",roadmapAbstract:"Show street map",satelliteAbstract:"Show satellite imagery",hybridAbstract:"Show imagery with street names",terrainAbstract:"Show street map with terrain"},"gxp.plugins.LayerProperties.prototype":{menuText:"Layer Properties",toolTip:"Layer Properties"},"gxp.plugins.LayerTree.prototype":{shortTitle:"Layers",rootNodeText:"Layers",overlayNodeText:"Overlays",baseNodeText:"Base Layers"},"gxp.plugins.LayerManager.prototype":{baseNodeText:"Base Maps"},"gxp.plugins.Legend.prototype":{menuText:"Show legend",tooltip:"Show legend"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Loading map..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.Measure.prototype":{buttonText:"Measure",lengthMenuText:"Length",areaMenuText:"Area",lengthTooltip:"Measure length",areaTooltip:"Measure area",measureTooltip:"Measure"},"gxp.plugins.Navigation.prototype":{menuText:"Pan map",tooltip:"Pan map"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Zoom to previous extent",nextMenuText:"Zoom to next extent",previousTooltip:"Zoom to previous extent",nextTooltip:"Zoom to next extent"},"gxp.plugins.OSMSource.prototype":{title:"OpenStreetMap Layers",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:"Print",menuText:"Print map",tooltip:"Print map",previewText:"Print Preview",notAllNotPrintableText:"Not All Layers Can Be Printed",nonePrintableText:"None of your current map layers can be printed"},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest Layers",osmAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest Imagery"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Query",queryMenuText:"Query layer",queryActionTip:"Query the selected layer",queryByLocationText:"Query by current map extent",queryByAttributesText:"Query by attributes",queryMsg:"Querying...",cancelButtonText:"Cancel",noFeaturesTitle:"No Match",noFeaturesMessage:"Your query did not return any results."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Remove layer",removeActionTip:"Remove layer"},"gxp.plugins.Styler.prototype":{menuText:"Layer Styles",tooltip:"Layer Styles"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identify",infoActionTip:"Get Feature Info",popupTitle:"Feature Info"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom box",zoomInMenuText:"Zoom in",zoomOutMenuText:"Zoom out",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"Zoom in",zoomOutTooltip:"Zoom out"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Zoom to max extent",tooltip:"Zoom to max extent"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Zoom to layer extent",tooltip:"Zoom to layer extent"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Zoom to layer extent",tooltip:"Zoom to layer extent"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Zoom to selected features",tooltip:"Zoom to selected features"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Save Changes?",closeMsg:"This feature has unsaved changes. Would you like to save your changes?",deleteMsgTitle:"Delete Feature?",deleteMsg:"Are you sure you want to delete this feature?",editButtonText:"Edit",editButtonTooltip:"Make this feature editable",deleteButtonText:"Delete",deleteButtonTooltip:"Delete this feature",cancelButtonText:"Cancel",cancelButtonTooltip:"Stop editing, discard changes",saveButtonText:"Save",saveButtonTooltip:"Save changes"},"gxp.FillSymbolizer.prototype":{fillText:"Fill",colorText:"Color",opacityText:"Opacity"},"gxp.FilterBuilder.prototype":{builderTypeNames:["any","all","none","not all"],preComboText:"Match",postComboText:"of the following:",addConditionText:"add condition",addGroupText:"add group",removeConditionText:"remove condition"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Name",titleHeaderText:"Title",queryableHeaderText:"Queryable",layerSelectionLabel:"View available data from:",layerAdditionLabel:"or add a new server.",expanderTemplateText:"<p><b>Abstract:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"circle",graphicSquareText:"square",graphicTriangleText:"triangle",graphicStarText:"star",graphicCrossText:"cross",graphicXText:"x",graphicExternalText:"external",urlText:"URL",opacityText:"opacity",symbolText:"Symbol",sizeText:"Size",rotationText:"Rotation"},"gxp.QueryPanel.prototype":{queryByLocationText:"Query by location",currentTextText:"Current extent",queryByAttributesText:"Query by attributes",layerText:"Layer"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Scale 1:{scale}",labelFeaturesText:"Label Features",labelsText:"Labels",basicText:"Basic",advancedText:"Advanced",limitByScaleText:"Limit by scale",limitByConditionText:"Limit by condition",symbolText:"Symbol",nameText:"Name"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Scale 1:{scale}",minScaleLimitText:"Min scale limit",maxScaleLimitText:"Max scale limit"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"solid",dashStrokeName:"dash",dotStrokeName:"dot",titleText:"Stroke",styleText:"Style",colorText:"Color",widthText:"Width",opacityText:"Opacity"},"gxp.StylePropertiesDialog.prototype":{titleText:"General",nameFieldText:"Name",titleFieldText:"Title",abstractFieldText:"Abstract"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Label values",haloText:"Halo",sizeText:"Size"},"gxp.WMSLayerPanel.prototype":{attributionText:"Attribution",aboutText:"About",titleText:"Title",nameText:"Name",descriptionText:"Description",displayText:"Display",opacityText:"Opacity",formatText:"Format",transparentText:"Transparent",cacheText:"Cache",cacheFieldText:"Use cached version",stylesText:"Available Styles",infoFormatText:"Info format",infoFormatEmptyText:"Select a format",displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Your map is ready to be published to the web! Simply copy the following HTML to embed the map in your website:",heightLabel:"Height",widthLabel:"Width",mapSizeLabel:"Map Size",miniSizeLabel:"Mini",smallSizeLabel:"Small",premiumSizeLabel:"Premium",largeSizeLabel:"Large"},"gxp.WMSStylesDialog.prototype":{addStyleText:"Add",addStyleTip:"Add a new style",chooseStyleText:"Choose style",deleteStyleText:"Remove",deleteStyleTip:"Delete the selected style",editStyleText:"Edit",editStyleTip:"Edit the selected style",duplicateStyleText:"Duplicate",duplicateStyleTip:"Duplicate the selected style",addRuleText:"Add",addRuleTip:"Add a new rule",newRuleText:"New Rule",deleteRuleText:"Remove",deleteRuleTip:"Delete the selected rule",editRuleText:"Edit",editRuleTip:"Edit the selected rule",duplicateRuleText:"Duplicate",duplicateRuleTip:"Duplicate the selected rule",cancelText:"Cancel",saveText:"Save",styleWindowTitle:"User Style: {0}",ruleWindowTitle:"Style Rule: {0}",stylesFieldsetTitle:"Styles",rulesFieldsetTitle:"Rules"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Title",titleEmptyText:"Layer title",abstractLabel:"Description",abstractEmptyText:"Layer description",fileLabel:"Data",fieldEmptyText:"Browse for data archive...",uploadText:"Upload",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",waitMsgText:"Uploading your data...",invalidFileExtensionText:"File extension must be one of: ",optionsText:"Options",workspaceLabel:"Workspace",workspaceEmptyText:"Default workspace",dataStoreLabel:"Store",dataStoreEmptyText:"Choose a store",dataStoreNewText:"Create new store",crsLabel:"CRS",crsEmptyText:"Coordinate Reference System ID",invalidCrsText:"CRS identifier should be an EPSG code (e.g. EPSG:4326)"},"gxp.NewSourceDialog.prototype":{title:"Add new server...",cancelText:"Cancel",addServerText:"Add Server",invalidURLText:"Enter a valid URL to a WMS endpoint (e.g. http://example.com/geoserver/wms)",contactingServerText:"Contacting Server..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Zoom level"},"gxp.Viewer.prototype":{saveErrorText:"Trouble saving: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Source",addPicasaText:"Picasa Photos",addYouTubeText:"YouTube Videos",addRSSText:"Other GeoRSS Feed",addFeedText:"Add to Map",addTitleText:"Title",keywordText:"Keyword",doneText:"Done",titleText:"Add Feeds",maxResultsText:"Max Items"}}),GeoExt.Lang.add("es",{"gxp.menu.LayerMenu.prototype":{layerText:"Capa"},"gxp.plugins.AddLayers.prototype":{addActionMenuText:"Añadir Capas",addActionTip:"Añadir Capas",addServerText:"Añadir servidor",addButtonText:"Añadir Capas",untitledText:"Sin Título",addLayerSourceErrorText:"Error obteniendo capabilities de WMS ({msg}).\nPor favor, compruebe la URL y vuelva a intentarlo.",availableLayersText:"Capas disponibles",expanderTemplateText:"<p><b>Resumen:</b> {abstract}</p>",panelTitleText:"Título",layerSelectionText:"Ver datos disponibles de:",doneText:"Hecho",uploadText:"Subir Datos",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},"gxp.plugins.BingSource.prototype":{title:"Capas Bing",roadTitle:"Bing Carreteras",aerialTitle:"Bing Foto Aérea",labeledAerialTitle:"Bing Híbrido"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Edit",createFeatureActionText:"Create",editFeatureActionText:"Modify",createFeatureActionTip:"Crear nuevo elemento",editFeatureActionTip:"Editar elemento existente",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Mostrar en el mapa",firstPageTip:"Primera página",
previousPageTip:"Página anterior",zoomPageExtentTip:"Zoom a la extensión de la página",nextPageTip:"Página siguiente",lastPageTip:"Última página",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"Vista 3D",tooltip:"Vista 3D"},"gxp.plugins.GoogleSource.prototype":{title:"Capas Google",roadmapAbstract:"Mostrar Callejero",satelliteAbstract:"Mostrar imágenes aéreas",hybridAbstract:"Mostrar imágenes con nombres de calle",terrainAbstract:"Mostrar callejero con terreno"},"gxp.plugins.LayerProperties.prototype":{menuText:"Propiedades de la capa",toolTip:"Propiedades de la capa"},"gxp.plugins.LayerTree.prototype":{shortTitle:"Capas",rootNodeText:"Capas",overlayNodeText:"Capas superpuestas",baseNodeText:"Capa base"},"gxp.plugins.LayerManager.prototype":{baseNodeText:"Capa base"},"gxp.plugins.Legend.prototype":{menuText:"Leyenda",tooltip:"Leyenda"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Loading Map..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.Measure.prototype":{buttonText:"Medir",lengthMenuText:"Longitud",areaMenuText:"Área",lengthTooltip:"Medir Longitud",areaTooltip:"Medir Área",measureTooltip:"Medir"},"gxp.plugins.Navigation.prototype":{menuText:"Desplazar mapa",tooltip:"Desplazar mapa"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Vista anterior",nextMenuText:"Vista siguiente",previousTooltip:"Vista anterior",nextTooltip:"Vista siguiente"},"gxp.plugins.OSMSource.prototype":{title:"Capas OpenStreetMap",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Datos CC-By-SA de <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:"Imprimir",menuText:"Imprimir mapa",tooltip:"Imprimir mapa",previewText:"Vista previa",notAllNotPrintableText:"No se pueden imprimir todas las capas",nonePrintableText:"No se puede imprimir ninguna de las capas del mapa"},"gxp.plugins.MapQuestSource.prototype":{title:"Capas MapQuest",osmAttribution:"Teselas cortesía de <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Teselas cortesía de <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest Imágenes"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Consultar",queryMenuText:"Consultar capa",queryActionTip:"Consultar la capa seleccionada",queryByLocationText:"Query by current map extent",queryByAttributesText:"Consultar por atributos",queryMsg:"Consultando...",cancelButtonText:"Cancelar",noFeaturesTitle:"Sin coincidencias",noFeaturesMessage:"Su consulta no produjo resultados."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Eliminar Capa",removeActionTip:"Eliminar Capa"},"gxp.plugins.Styler.prototype":{menuText:"Editar estilos",tooltip:"Gestionar estilos de capa"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identify",infoActionTip:"Consultar elementos",popupTitle:"Información de elementos"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom Box",zoomInMenuText:"Acercar",zoomOutMenuText:"Alejar",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"Acercar",zoomOutTooltip:"Alejar"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Ver extensión total",tooltip:"Ver extensión total"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Ver toda la capa",tooltip:"Ver toda la capa"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Ver toda la la capa",tooltip:"Ver toda la capa"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Ver los elementos seleccionados",tooltip:"Ver los elementos seleccionados"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"¿Desea guardar los cambios?",closeMsg:"Los cambios en este elemento no se han guardado. ¿Desea guardar los cambios?",deleteMsgTitle:"¿Desea borrar el elemento?",deleteMsg:"¿Está seguro de querer borrar este elemento?",editButtonText:"Editar",editButtonTooltip:"Hacer editable este elemento",deleteButtonText:"Borrar",deleteButtonTooltip:"Borrar este elemento",cancelButtonText:"Cancelar",cancelButtonTooltip:"Dejar de editar, descartar cambios",saveButtonText:"Guardar",saveButtonTooltip:"Guardar cambios"},"gxp.FillSymbolizer.prototype":{fillText:"Relleno",colorText:"Color",opacityText:"Opacidad"},"gxp.FilterBuilder.prototype":{builderTypeNames:["cualquiera de","todas","ninguna de","no todas"],preComboText:"Cumplir",postComboText:"las condiciones siguientes:",addConditionText:"añadir condición",addGroupText:"añadir grupo",removeConditionText:"eliminar condición"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Nombre",titleHeaderText:"Título",queryableHeaderText:"Consultable",layerSelectionLabel:"Ver datos disponibles de:",layerAdditionLabel:"o añadir otro servidor.",expanderTemplateText:"<p><b>Resumen:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"círculo",graphicSquareText:"cuadrado",graphicTriangleText:"triángulo",graphicStarText:"estrella",graphicCrossText:"cruz",graphicXText:"x",graphicExternalText:"externo",urlText:"URL",opacityText:"opacidad",symbolText:"Símbolo",sizeText:"Tamaño",rotationText:"Giro"},"gxp.QueryPanel.prototype":{queryByLocationText:"Consultar por localización",currentTextText:"Extensión actual",queryByAttributesText:"Consultar por atributo",layerText:"Capa"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Escala 1:{scale}",labelFeaturesText:"Etiquetado de elementos",labelsText:"Etiquetas",basicText:"Básico",advancedText:"Advanzado",limitByScaleText:"Limitar por escala",limitByConditionText:"Limitar por condición",symbolText:"Símbolo",nameText:"Nombre"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Escala 1:{scale}",minScaleLimitText:"Escala mínima",maxScaleLimitText:"Escala máxima"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"continuo",dashStrokeName:"guiones",dotStrokeName:"puntos",titleText:"Trazo",styleText:"Estilo",colorText:"Color",widthText:"Ancho",opacityText:"Opacidad"},"gxp.StylePropertiesDialog.prototype":{titleText:"General",nameFieldText:"Nombre",titleFieldText:"Título",abstractFieldText:"Resumen"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Etiquetado",haloText:"Halo",sizeText:"Tamaño"},"gxp.WMSLayerPanel.prototype":{attributionText:"Attribution",aboutText:"Acerca de",titleText:"Título",nameText:"Nombre",descriptionText:"Descripción",displayText:"Mostrar",opacityText:"Opacidad",formatText:"Formato",transparentText:"Transparente",cacheText:"Caché",cacheFieldText:"Usar la versión en caché",stylesText:"Estilos disponibles",infoFormatText:"Info format",infoFormatEmptyText:"Select a format",displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"¡Ya puede publicar su mapa en otras webs! Simplemente copie el siguiente código HTML en el lugar donde desee incrustarlo:",heightLabel:"Alto",widthLabel:"Ancho",mapSizeLabel:"Tamaño",miniSizeLabel:"Mínimo",smallSizeLabel:"Pequeño",premiumSizeLabel:"Premium",largeSizeLabel:"Grande"},"gxp.WMSStylesDialog.prototype":{addStyleText:"Añadir",addStyleTip:"Añadir un estilo",chooseStyleText:"Escoger estilo",deleteStyleText:"Quitar",deleteStyleTip:"Borrar el estilo seleccionado",editStyleText:"Cambiar",editStyleTip:"Editar el estilo seleccionado",duplicateStyleText:"Clonar",duplicateStyleTip:"Duplicar el estilo seleccionado",addRuleText:"Añadir",addRuleTip:"Añadir una regla",newRuleText:"Nueva regla",deleteRuleText:"Quitar",deleteRuleTip:"Borrar la regla seleccionada",editRuleText:"Cambiar",editRuleTip:"Editar la regla seleccionada",duplicateRuleText:"Duplicar",duplicateRuleTip:"Duplicar la regla seleccionada",cancelText:"Cancelar",saveText:"Guardar",styleWindowTitle:"Estilo: {0}",ruleWindowTitle:"Regla: {0}",stylesFieldsetTitle:"Estilos",rulesFieldsetTitle:"Reglas"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Título",titleEmptyText:"Título de la capa",abstractLabel:"Descripción",abstractEmptyText:"Descripción de la capa",fileLabel:"Datos",fieldEmptyText:"Navegue por los datos...",uploadText:"Subir",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",waitMsgText:"Suba sus datos data...",invalidFileExtensionText:"El fichero debe tener alguna de estas extensiones: ",optionsText:"Opciones",workspaceLabel:"Espacio de trabajo",workspaceEmptyText:"Espacio de trabajo por defecto",dataStoreLabel:"Almacén de datos",dataStoreEmptyText:"Create new store",defaultDataStoreEmptyText:"Almacén de datos por defecto"},"gxp.NewSourceDialog.prototype":{title:"Añadir Servidor...",cancelText:"Cancelar",addServerText:"Añadir Servidor",invalidURLText:"Enter a valid URL to a WMS endpoint (e.g. http://example.com/geoserver/wms)",contactingServerText:"Conectando con el Servidor..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Escala"},"gxp.Viewer.prototype":{saveErrorText:"Problemas guardando: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Fuente",addPicasaText:"Picasa fotos",addYouTubeText:"YouTube Videos",addRSSText:"Feed GeoRSS Otro",addFeedText:"Agregar al Mapa",addTitleText:"Título",keywordText:"Palabra clave",doneText:"Hecho",titleText:"Agregar Feeds",maxResultsText:"Productos Max"}}),GeoExt.Lang.add("fr",{"gxp.plugins.AddLayers.prototype":{addActionMenuText:"Ajouter des calques",addActionTip:"Ajouter des calques",addServerText:"Ajouter un nouveau serveur",untitledText:"Sans titre",addLayerSourceErrorText:"Impossible d'obtenir les capacités WMS ({msg}).\nVeuillez vérifier l'URL et essayez à nouveau.",availableLayersText:"Couches disponibles",doneText:"Terminé",uploadText:"Télécharger des données",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},"gxp.plugins.BingSource.prototype":{title:"Calques Bing",roadTitle:"Bing routes",aerialTitle:"Bing images aériennes",labeledAerialTitle:"Bing images aériennes avec étiquettes"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Edit",createFeatureActionText:"Create",editFeatureActionText:"Modify",createFeatureActionTip:"Créer un nouvel objet",editFeatureActionTip:"Modifier un objet existant",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Afficher sur la carte",firstPageTip:"Première page",previousPageTip:"Page précédente",zoomPageExtentTip:"Zoom sur la page",nextPageTip:"Page suivante",lastPageTip:"Dernière page",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"Passer à la visionneuse 3D",tooltip:"Passer à la visionneuse 3D"},"gxp.plugins.GoogleSource.prototype":{title:"Calques Google",roadmapAbstract:"Carte routière",satelliteAbstract:"Images satellite",hybridAbstract:"Images avec routes",terrainAbstract:"Carte routière avec le terrain"},"gxp.plugins.LayerProperties.prototype":{menuText:"Propriétés de la couche",toolTip:"Afficher les propriétés de la couche"},"gxp.plugins.LayerTree.prototype":{shortTitle:"Layers",rootNodeText:"Layers",overlayNodeText:"Surimpressions",baseNodeText:"Couches"},"gxp.plugins.LayerManager.prototype":{baseNodeText:"Couche"},"gxp.plugins.Legend.prototype":{menuText:"Légende",tooltip:"Afficher la légende"},"gxp.plugins.Measure.prototype":{buttonText:"Mesure",lengthMenuText:"Longueur",areaMenuText:"Surface",lengthTooltip:"Mesurer une longueur",areaTooltip:"Mesurer une surface",measureTooltip:"Mesurer"},"gxp.plugins.Navigation.prototype":{menuText:"Panner",tooltip:"Faire glisser la carte"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Position précédente",nextMenuText:"Position suivante",previousTooltip:"Retourner à la position précédente",nextTooltip:"Aller à la position suivante"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Chargement de la carte..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.OSMSource.prototype":{title:"Calques OpenStreetMap",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Données CC-By-SA par <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:"Imprimer",menuText:"Imprimer la carte",tooltip:"Imprimer la carte",previewText:"Aperçu avant impression",notAllNotPrintableText:"Non, toutes les couches peuvent être imprimées",nonePrintableText:"Aucune de vos couches ne peut être imprimée"},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest Layers",osmAttribution:"Avec la permission de tuiles <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Avec la permission de tuiles <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest Imagery"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Interrogation",queryMenuText:"Couche de requêtes",queryActionTip:"Interroger la couche sélectionnée",queryByLocationText:"Query by current map extent",queryByAttributesText:"Requête par attributs"},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Enlever la couche",removeActionTip:"Enlever la couche"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identify",infoActionTip:"Get Feature Info",popupTitle:"Info sur l'objet"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom Box",zoomInMenuText:"Zoom avant",zoomOutMenuText:"Zoom arrière",zoomTooltip:"Zoomer en dessinant un rectangle",zoomInTooltip:"Zoomer",zoomOutTooltip:"Dézoomer"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Zoomer sur la carte max",tooltip:"Zoomer sur la carte max"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Zoomer sur la couche",tooltip:"Zoomer sur la couche"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Zoomer sur la couche",tooltip:"Zoomer sur la couche"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Zoomer sur les objets sélectionnés",tooltip:"Zoomer sur les objets sélectionnés"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Enregistrer les modifications ?",closeMsg:"Cet objet a des modifications non enregistrées. Voulez-vous enregistrer vos modifications ?",deleteMsgTitle:"Supprimer l'objet ?",deleteMsg:"Etes-vous sûr de vouloir supprimer cet objet ?",editButtonText:"Modifier",editButtonTooltip:"Modifier cet objet",deleteButtonText:"Supprimer",deleteButtonTooltip:"Supprimer cet objet",cancelButtonText:"Annuler",cancelButtonTooltip:"Arrêter de modifier, annuler les modifications",saveButtonText:"Enregistrer",saveButtonTooltip:"Enregistrer les modifications"},"gxp.FillSymbolizer.prototype":{fillText:"Remplir",colorText:"Couleur",opacityText:"Opacité"},"gxp.FilterBuilder.prototype":{builderTypeNames:["Tout","tous","aucun","pas tout"],preComboText:"Match",postComboText:"de ce qui suit:",addConditionText:"Ajouter la condition",addGroupText:"Ajouter un groupe",removeConditionText:"Supprimer la condition"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Nom",titleHeaderText:"Titre",queryableHeaderText:"Interrogeable",layerSelectionLabel:"Voir les données disponibles à partir de :",layerAdditionLabel:"ou ajouter un nouveau serveur.",expanderTemplateText:"<p><b>Résumé:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"Cercle",graphicSquareText:"Carré",graphicTriangleText:"Triangle",graphicStarText:"Étoile",graphicCrossText:"Croix",graphicXText:"x",graphicExternalText:"Externe",urlText:"URL",opacityText:"Opacité",symbolText:"Symbole",sizeText:"Taille",rotationText:"Rotation"},"gxp.QueryPanel.prototype":{queryByLocationText:"Interrogation selon le lieu",currentTextText:"Mesure actuelle",queryByAttributesText:"Requête par attributs",layerText:"Calque"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} échelle 1:{scale}",labelFeaturesText:"Label Caractéristiques",advancedText:"Avancé",limitByScaleText:"Limiter par l'échelle",limitByConditionText:"Limiter par condition",symbolText:"Symbole",nameText:"Nom"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} échelle 1:{scale}",maxScaleLimitText:"Échelle maximale"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Label valeurs",haloText:"Halo",sizeText:"Taille"},"gxp.WMSLayerPanel.prototype":{attributionText:"Attribution",aboutText:"A propos",titleText:"Titre",nameText:"Nom",descriptionText:"Description",displayText:"Affichage",opacityText:"Opacité",formatText:"Format",transparentText:"Transparent",cacheText:"Cache",cacheFieldText:"Utiliser la version mise en cache",stylesText:"Available styles",infoFormatText:"Info format",infoFormatEmptyText:"Choisissez un format",displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Votre carte est prête à être publiée sur le web. Il suffit de copier le code HTML suivant pour intégrer la carte dans votre site Web :",heightLabel:"Hauteur",widthLabel:"Largeur",mapSizeLabel:"Taille de la carte",miniSizeLabel:"Mini",smallSizeLabel:"Petit",premiumSizeLabel:"Premium",largeSizeLabel:"Large"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Titre",titleEmptyText:"Titre de la couche",abstractLabel:"Description",abstractEmptyText:"Description couche",fileLabel:"Données",fieldEmptyText:"Parcourir pour ...",uploadText:"Upload",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",waitMsgText:"Transfert de vos données ...",invalidFileExtensionText:"L'extension du fichier doit être : ",optionsText:"Options",workspaceLabel:"Espace de travail",workspaceEmptyText:"Espace de travail par défaut",dataStoreLabel:"Magasin de données",dataStoreEmptyText:"Create new store",defaultDataStoreEmptyText:"Magasin de données par défaut"},"gxp.NewSourceDialog.prototype":{title:"Ajouter un nouveau serveur...",cancelText:"Annuler",addServerText:"Ajouter un serveur",invalidURLText:"Indiquez l'URL valide d'un serveur WMS (e.g. http://example.com/geoserver/wms)",contactingServerText:"Interrogation du serveur..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Niveau de zoom"},"gxp.Viewer.prototype":{saveErrorText:"Sauver Trouble: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Source",addPicasaText:"Picasa Photos",addYouTubeText:"YouTube Vidéos",addRSSText:"GeoRSS Autre",addFeedText:"Ajouter à la carte",addTitleText:"Titre",keywordText:"Mot-clé",doneText:"Terminé",titletext:"Ajouter RSS",maxResultsText:"Articles Max"}}),GeoExt.Lang.add("id",{"gxp.menu.LayerMenu.prototype":{layerText:"Layer"},"gxp.plugins.AddLayers.prototype":{addActionMenuText:"Tambahkan layer",addActionTip:"Tambahkan layer",addServerText:"Tambahkan server baru",addButtonText:"Add layers",untitledText:"Untitled",addLayerSourceErrorText:"Kesalahan mendapatkan kemampuan WMS ({msg}). \nSilakan cek url dan coba lagi.",availableLayersText:"Layer tersedia",expanderTemplateText:"<p><b>Abstract:</b> {abstract}</p>",panelTitleText:"Title",layerSelectionText:"View available data from:",doneText:"Selesai",uploadText:"Unggah data",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},"gxp.plugins.BingSource.prototype":{title:"Layers Bing",roadTitle:"Jalan Bing",aerialTitle:"Udara Bing",labeledAerialTitle:"Udara Bing dengan label"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Edit",createFeatureActionText:"Create",editFeatureActionText:"Modify",createFeatureActionTip:"Membuat sebuah fitur",editFeatureActionTip:"Edit fitur",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Tampilkan pada peta",firstPageTip:"Halaman pertama",previousPageTip:"Halaman sebelumnya",zoomPageExtentTip:"Zoom sampai batas halaman",nextPageTip:"Halaman berikut",lastPageTip:"Halaman terakhir",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"3D Viewer",tooltip:"Switch to 3D Viewer"},"gxp.plugins.GoogleSource.prototype":{title:"Google Layers",roadmapAbstract:"Tampilkan peta jalan",satelliteAbstract:"Tampilkan citra satelit",hybridAbstract:"Tampilkan citra dengan nama jalan",terrainAbstract:"Tampilkan peta jalan dengan peta medan"},"gxp.plugins.LayerProperties.prototype":{menuText:"Properti layer",toolTip:"Properti layer"},"gxp.plugins.LayerTree.prototype":{shortTitle:"Layer-layer",rootNodeText:"Layer-layer",overlayNodeText:"Superimposisi",baseNodeText:"Layer dasar"},"gxp.plugins.LayerManager.prototype":{baseNodeText:"Layer dasar"},"gxp.plugins.Legend.prototype":{menuText:"Tampilkan legend",tooltip:"Tampilkan legend"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Loading Map..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.Measure.prototype":{buttonText:"Pengukuran",lengthMenuText:"Panjang",areaMenuText:"Luas",lengthTooltip:"Pengukuran panjang",areaTooltip:"Pengukuran luas",measureTooltip:"Pengukuran"},"gxp.plugins.Navigation.prototype":{menuText:"Pan peta",tooltip:"Pan peta"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Zoom ke luas sebelumnya",nextMenuText:"Zoom ke luas setelahnya",previousTooltip:"Zoom ke luas sebelumnya",nextTooltip:"Zoom ke luas setelahnya"},"gxp.plugins.OSMSource.prototype":{title:"OpenStreetMap Layers",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:"Cetak",menuText:"Cetak peta",tooltip:"Cetak peta",previewText:"Preview cetak",notAllNotPrintableText:"Tidak semua layer dapat dicetak",nonePrintableText:"Tidak ada peta yang dapat dicetak"},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest Layers",osmAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"Citra MapQuest"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Query",queryMenuText:"Queryable Layer",queryActionTip:"Query layer yang dipilih",queryByLocationText:"Query by current map extent",queryByAttributesText:"Query atribut",queryMsg:"Querying...",cancelButtonText:"Batal",noFeaturesTitle:"Tidak sesuai",noFeaturesMessage:"Permintaan anda tidak berhasil."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Hapus layer",removeActionTip:"Hapus layer"},"gxp.plugins.Styler.prototype":{menuText:"Edit Styles",tooltip:"Manage layer styles"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identify",infoActionTip:"Get Feature Info",popupTitle:"Info fitur"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom Box",zoomInMenuText:"Memperbesar",zoomOutMenuText:"Memperkecil",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"Memperbesar",zoomOutTooltip:"Memperkecil"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Pembesaran maksimum",tooltip:"Pembesaran maksimum"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Pembesaran batas layer",tooltip:"Pembesaran batas layer"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Pembesaran batas layer",tooltip:"Pembesaran batas layer"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Pembesaran pada fitur terpilih",tooltip:"Pembesaran pada fitur terpilih"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Simpan update?",closeMsg:"Fitur belum di simpan. Apakah ingin disimpan?",deleteMsgTitle:"Hapus Fitur?",deleteMsg:"Anda yakin untuk menghapus fitur ini?",editButtonText:"Edit",editButtonTooltip:"Jadikan fitur dapat diedit",deleteButtonText:"Hapus",deleteButtonTooltip:"Hapus fitur ini",cancelButtonText:"Batal",cancelButtonTooltip:"Berhenti mengedit, batalkan perubahan",saveButtonText:"Simpan",saveButtonTooltip:"Simpan Update"},"gxp.FillSymbolizer.prototype":{fillText:"Isikan warna",colorText:"Warna",opacityText:"Kepekatan"},"gxp.FilterBuilder.prototype":{builderTypeNames:["any","all","none","not all"],preComboText:"Sesuai",postComboText:"of the following:",addConditionText:"tambahkan kondisi",addGroupText:"tambahkan grup",removeConditionText:"Hilangkan kondisi"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Nama",titleHeaderText:"Judul",queryableHeaderText:"Queryable",layerSelectionLabel:"Melihat data dari:",layerAdditionLabel:"atau tambahkan sebagai server baru.",expanderTemplateText:"<p><b>Abstract:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"Lingkaran",graphicSquareText:"square",graphicTriangleText:"Segitiga",graphicStarText:"Bintang",graphicCrossText:"Silang",graphicXText:"x",graphicExternalText:"dari luar",urlText:"URL",opacityText:"Kepekatan",symbolText:"Simbol",sizeText:"Ukuran",rotationText:"Rotasi"},"gxp.QueryPanel.prototype":{queryByLocationText:"Query lokasi",currentTextText:"Sejauh ini",queryByAttributesText:"Query atribut",layerText:"Layer"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Scale 1:{scale}",labelFeaturesText:"Label Fitur",labelsText:"Labels",basicText:"Basic",advancedText:"Tingkat lanjut",limitByScaleText:"Batasan oleh skala",limitByConditionText:"Batasan oleh kondisi",symbolText:"Simbol",nameText:"Nama"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Scale 1:{scale}",minScaleLimitText:"Min scale limit",maxScaleLimitText:"Batas skala maksimum"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"solid",dashStrokeName:"dash",dotStrokeName:"dot",titleText:"Stroke",styleText:"Style",colorText:"Color",widthText:"Width",opacityText:"Opacity"},"gxp.StylePropertiesDialog.prototype":{titleText:"General",nameFieldText:"Name",titleFieldText:"Title",abstractFieldText:"Abstract"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Label nilai",haloText:"Halo",sizeText:"Ukuran"},"gxp.WMSLayerPanel.prototype":{attributionText:"Attribution",aboutText:"Tentang Program",titleText:"Judul",nameText:"Nama",descriptionText:"Deskripsi",displayText:"Tampilan",opacityText:"Kecerahan",formatText:"Format",transparentText:"Transparent",cacheText:"Cache",cacheFieldText:"Menggunakan versi cached",stylesText:"Styles tersedia",infoFormatText:"Info format",infoFormatEmptyText:"Select a format",displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Peta anda siap dipublikasikan melalui web! Cukup salin HTML berikut untuk meletakkan peta dalam situs web Anda:",heightLabel:"Tinggi",widthLabel:"Lebar",mapSizeLabel:"Ukuran peta",miniSizeLabel:"Mini",smallSizeLabel:"Kecil",premiumSizeLabel:"Premium",largeSizeLabel:"Besar"},"gxp.WMSStylesDialog.prototype":{addStyleText:"Tambah",addStyleTip:"Tambah style baru",chooseStyleText:"Choose style",deleteStyleText:"Hilangkan",deleteStyleTip:"Hapus style yang dipilih",editStyleText:"Edit",editStyleTip:"Edit style yang dipilih",duplicateStyleText:"Duplikat",duplicateStyleTip:"Duplikat style yang dipilih",addRuleText:"Tambah",addRuleTip:"Tambah Rule baru",newRuleText:"New Rule",deleteRuleText:"Hilangkan",deleteRuleTip:"Hapus Rule yang dipilih",editRuleText:"Edit",editRuleTip:"Edit ule yang dipilih",duplicateRuleText:"Duplikat",duplicateRuleTip:"Duplikat style yang dipilih",cancelText:"Batal",saveText:"Save",styleWindowTitle:"User Style: {0}",ruleWindowTitle:"Style Rule: {0}",stylesFieldsetTitle:"Styles",rulesFieldsetTitle:"Rules"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Judul",titleEmptyText:"Judul Layer",abstractLabel:"Deskripsi",abstractEmptyText:"Deskripsi Layer",fileLabel:"Data",fieldEmptyText:"Pencarian arsip data...",uploadText:"Pengisian",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",waitMsgText:"Mengisi Data anda...",invalidFileExtensionText:"Ekstensi file harus salah satu: ",optionsText:"Pilihan",workspaceLabel:"Ruang Kerja",workspaceEmptyText:"Ruang kerja Default",dataStoreLabel:"Penyimpanan",dataStoreEmptyText:"Create new store",defaultDataStoreEmptyText:"Penyimpanan data Default"},"gxp.NewSourceDialog.prototype":{title:"Add New Server...",cancelText:"Cancel",addServerText:"Add Server",invalidURLText:"Enter a valid URL to a WMS endpoint (e.g. http://example.com/geoserver/wms)",contactingServerText:"Contacting Server..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Zoom level"},"gxp.Viewer.prototype":{saveErrorText:"Trouble saving: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Sumber",addPicasaText:"Picasa Foto",addYouTubeText:"YouTube Video",addRSSText:"GeoRSS Pakan lain",addFeedText:"Tambah ke Peta",addTitleText:"Judul",keywordText:"Kata Kunci",doneText:"Selesai",titleText:"Tambah Blog",maxResultsText:"Produk Max"}}),GeoExt.Lang.add("nl",{"gxp.plugins.AddLayers.prototype":{addActionMenuText:"Voeg kaartlagen toe",addActionTip:"Voeg kaartlagen toe",addServerText:"Voeg service toe",untitledText:"Onbekend",addLayerSourceErrorText:"Probleem bij het ophalen van de Error WMS GetCapabilities ({msg}).\nControleer de URL en probeer opnieuw.",availableLayersText:"Beschikbare kaartlagen",doneText:"Klaar",addFeedActionMenuText:"Add feeds",searchText:"Zoek naar kaartlagen"},"gxp.plugins.BingSource.prototype":{
title:"Bing kaartlagen",roadTitle:"Bing wegen",aerialTitle:"Bing luchtfoto's",labeledAerialTitle:"Bing luchtfoto's met labels"},"gxp.plugins.FeatureEditor.prototype":{createFeatureActionTip:"Maak een nieuw object",editFeatureActionTip:"Wijzig een bestand object",commitTitle:"Wijzingsbeschrijving",commitText:"Voor a.u.b. een beschrijving in voor de wijziging:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Toon op kaart",firstPageTip:"Eerste pagina",previousPageTip:"Vorige pagina",zoomPageExtentTip:"Zoom naar de uitsnede van de pagina",nextPageTip:"Volgende pagina",lastPageTip:"Laatste pagina",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"3D weergave",tooltip:"Bekijk kaart in 3D"},"gxp.plugins.GoogleSource.prototype":{title:"Google Maps kaartlagen",roadmapAbstract:"Toon stratenkaart",satelliteAbstract:"Toon satellietbeeld",hybridAbstract:"Toon rasterbeelden met labels",terrainAbstract:"Toon stratenkaart met terrein"},"gxp.plugins.LayerProperties.prototype":{menuText:"Kaartlaag eigenschappen",toolTip:"Kaartlaag eigenschappen"},"gxp.plugins.LayerTree.prototype":{shortTitle:"Kaartlagen",rootNodeText:"Kaartlagen",overlayNodeText:"Kaart overlays",baseNodeText:"Basis Kaarten"},"gxp.plugins.LayerManager.prototype":{baseNodeText:"Basis Kaart"},"gxp.plugins.Legend.prototype":{menuText:"Toon legenda",tooltip:"Toon legenda"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Laden van de kaart..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.Measure.prototype":{splitButtonText:"Edit",createFeatureActionText:"Create",editFeatureActionText:"Modify",buttonText:"Meten",lengthMenuText:"Lengte",areaMenuText:"Oppervlakte",lengthTooltip:"Meet lengte",areaTooltip:"Meet oppervlakte",measureTooltip:"Meten"},"gxp.plugins.Navigation.prototype":{menuText:"Verschuif kaart",tooltip:"Verschuif kaart"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Zoom naar de vorige uitsnede",nextMenuText:"Zoom naar de volgende uitsnede",previousTooltip:"Zoom naar de vorige uitsnede",nextTooltip:"Zoom naar de volgende uitsnede"},"gxp.plugins.OSMSource.prototype":{title:"OpenStreetMap kaartlagen",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:"Afdrukken",menuText:"Afdrukken kaart",tooltip:"Afdrukken kaart",previewText:"Voorvertoning",notAllNotPrintableText:"Niet alle lagen kunnen worden afgedrukt",nonePrintableText:"Geen van de huidige lagen kunnen worden afgedrukt"},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest kaartlagen",osmAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest Rasterbeelden"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Bevraag",queryMenuText:"Bevraag kaartlaag",queryActionTip:"Bevraag de geselecteerde kaartlaag",queryByLocationText:"Query by current map extent",queryByAttributesText:"Bevraag middels attributen",queryMsg:"Bevragen...",cancelButtonText:"Annuleren",noFeaturesTitle:"Niks gevonden",noFeaturesMessage:"De bevraging heeft geen resultaten opgeleverd."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Verwijder kaartlaag",removeActionTip:"Verwijder kaartlaag"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identify",infoActionTip:"Attribuut-informatie",popupTitle:"Attribuut-informatie"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom Box",zoomInMenuText:"Inzoomen",zoomOutMenuText:"Uitzoomen",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"Inzoomen",zoomOutTooltip:"Uitzoomen"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Zoom naar de maximale uitsnede",tooltip:"Zoom naar de maximale uitsnede"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Zoom naar de uitsnede van de kaartlaag",tooltip:"Zoom naar de uitsnede van de kaartlaag"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Zoom naar de uitsnede van de kaartlaag",tooltip:"Zoom naar de uitsnede van de kaartlaag"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Zoom naar de geselecteerde objecten",tooltip:"Zoom naar de geselecteerde objecten"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Wijzigingen opslaan?",closeMsg:"Het object is gewijzigd. Wilt u de wijzigingen opslaan?",deleteMsgTitle:"Verwijder object?",deleteMsg:"Weet u zeker dat u dit object wilt verwijderen?",editButtonText:"Wijzigen",editButtonTooltip:"Wijzig dit object",deleteButtonText:"Verwijderen",deleteButtonTooltip:"Verwijder dit object",cancelButtonText:"Annuleren",cancelButtonTooltip:"Stop met wijzigen, wijzigingen worden ongedaan gemaakt",saveButtonText:"Opslaan",saveButtonTooltip:"Wijzigingen opslaan"},"gxp.FillSymbolizer.prototype":{fillText:"Opvulling",colorText:"Kleur",opacityText:"Opaciteit"},"gxp.FilterBuilder.prototype":{builderTypeNames:["om het even welk","alle","geen","niet alle"],preComboText:"Overeenkomst",postComboText:"van de volgende:",addConditionText:"voeg voorwaarde toe",addGroupText:"voeg groep toe",removeConditionText:"verwijder voorwaarde"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Naam",titleHeaderText:"Titel",queryableHeaderText:"Bevraagbaar",layerSelectionLabel:"Bekijk beschikbare data van:",layerAdditionLabel:"of voeg een nieuwe server toe.",expanderTemplateText:"<p><b>Samenvatting:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"cirkel",graphicSquareText:"vierkant",graphicTriangleText:"driehoek",graphicStarText:"ster",graphicCrossText:"kruis",graphicXText:"x",graphicExternalText:"extern",urlText:"URL",opacityText:"opaciteit",symbolText:"Symbool",sizeText:"Grootte",rotationText:"Rotatie"},"gxp.QueryPanel.prototype":{queryByLocationText:"Bevraag middels locatie",currentTextText:"Huidige uitsnede",queryByAttributesText:"Bevraag middels attributen",layerText:"Kaartlaag"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Schaal 1:{scale}",labelFeaturesText:"Label objecten",advancedText:"Geavanceerd",limitByScaleText:"Beperk middels schaal",limitByConditionText:"Beperk middels voorwaarde",symbolText:"Symbool",nameText:"Naam"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Schaal 1:{scale}",maxScaleLimitText:"Maximale schaal"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Label waardes",haloText:"Halo",sizeText:"Grootte"},"gxp.WMSLayerPanel.prototype":{attributionText:"Bronvermelding",aboutText:"Informatie",titleText:"Titel",nameText:"Naam",descriptionText:"Omschrijving",displayText:"Toon",opacityText:"Opaciteit",formatText:"Formaat",transparentText:"Transparant",cacheText:"Cache",cacheFieldText:"Gebruik de versie vanuit de cache",stylesText:"Beschikbare Stijlen",infoFormatText:"Info formaat",infoFormatEmptyText:"Selecteer een formaat",displayOptionsText:"Weergave opties",queryText:"Begrens d.m.v. query",scaleText:"Bregens d.m.v. schaal",minScaleText:"Minimum schaal",maxScaleText:"Maximum schaal",switchToFilterBuilderText:"Terug naar de querybuilder",cqlPrefixText:"of ",cqlText:"gebruik een CQL filter",singleTileText:"Enkele kaarttegel",singleTileFieldText:"Gebruik 1 kaarttegel"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Uw map is klaar voor publicatie! Kopieer de volgende HTML in uw website om de kaart in te voegen:",heightLabel:"Hoogte",widthLabel:"Breedte",mapSizeLabel:"Kaartgrootte",miniSizeLabel:"Mini",smallSizeLabel:"Klein",premiumSizeLabel:"Extra groot",largeSizeLabel:"Groot"},"gxp.WMSStylesDialog.prototype":{addStyleText:"Voeg toe",addStyleTip:"Voeg een nieuwe stijl toe",deleteStyleText:"Verwijder",deleteStyleTip:"Verwijder de geselecteerde stijl",editStyleText:"Wijzig",editStyleTip:"Wijzig de geselecteerde stijl",duplicateStyleText:"Dupliceer",duplicateStyleTip:"Dupliceer de geselecteerde stijl",addRuleText:"Voeg toe",addRuleTip:"Voeg een nieuwe klasse toe",deleteRuleText:"Verwijder",deleteRuleTip:"Verwijder de geselecteerde klasse",editRuleText:"Wijzig",editRuleTip:"Wijzig de geselecteerde klasse",duplicateRuleText:"Dupliceer",duplicateRuleTip:"Dupliceer de geselecteerde klasse",cancelText:"Annuleer",styleWindowTitle:"Kaartstijl: {0}",ruleWindowTitle:"Klasse: {0}",stylesFieldsetTitle:"Kaartstijlen",rulesFieldsetTitle:"Klassen"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Titel",titleEmptyText:"Kaartlaag titel",abstractLabel:"Omschrijving",abstractEmptyText:"Kaartlaag omschrijving",fileLabel:"Data",fieldEmptyText:"Kies data archief...",uploadText:"Upload",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",waitMsgText:"Bezig met uploaden van de data...",invalidFileExtensionText:"Bestandsextensie is een van: ",optionsText:"Opties",workspaceLabel:"Werkruimte",workspaceEmptyText:"Standaard werkruimte",dataStoreLabel:"Archief",dataStoreEmptyText:"Create new store",defaultDataStoreEmptyText:"Standaard archief"},"gxp.NewSourceDialog.prototype":{title:"Add New Server...",cancelText:"Cancel",addServerText:"Add Server",invalidURLText:"Enter a valid URL to a WMS endpoint (e.g. http://example.com/geoserver/wms)",contactingServerText:"Contacting Server..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Zoom niveau"},"gxp.Viewer.prototype":{saveErrorText:"Problemen bij het opslaan: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Bron",addPicasaText:"Picasa Foto's",addYouTubeText:"YouTube video's",addRSSText:"Andere GeoRSS Feed",addFeedText:"Voeg toe aan Map",addTitleText:"Titel",keywordText:"Trefwoord",doneText:"Klaar",titleText:"Voeg Feeds",maxResultsText:"Max Items"}}),GeoExt.Lang.add("no",{"gxp.menu.LayerMenu.prototype":{layerText:"Kartlag"},"gxp.plugins.AddLayers.prototype":{addActionMenuText:"Legg til kartlag",addActionTip:"Legg til kartlag",addServerText:"Legg til en ny server",addButtonText:"Legg til kartlag",untitledText:"Uten titel",addLayerSourceErrorText:"Feil ved henting av WMS capabilities ({msg}).\nSjekk urlen og prøv igjen.",availableLayersText:"Tilgjengelige kartlag",expanderTemplateText:"<p><b>Abstrakt:</b> {abstract}</p>",panelTitleText:"Titel",layerSelectionText:"Vis tilgjengelige data fra:",doneText:"Ferdig",uploadText:"Last opp kartlag",addFeedActionMenuText:"Legg til feeds",searchText:"Søk etter kartlag"},"gxp.plugins.BingSource.prototype":{title:"Bing kartlag",roadTitle:"Bing Roads",aerialTitle:"Bing Aerial",labeledAerialTitle:"Bing Aerial med Etikett"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Editer",createFeatureActionText:"Lag",editFeatureActionText:"Modifiser",createFeatureActionTip:"Lag en ny feature",editFeatureActionTip:"Editer eksisterende feature",commitTitle:"Sjekk inn melding",commitText:"Skriv in en innsjekkingsmelding for denne editeringen:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Vis på kart",firstPageTip:"Første side",previousPageTip:"Neste side",zoomPageExtentTip:"Zoom til side utstrekning",nextPageTip:"Neste side",lastPageTip:"Siste side",totalMsg:"Features {1} til {2} av {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"3D Visning",tooltip:"Bytt til 3D Visning"},"gxp.plugins.GoogleSource.prototype":{title:"Google kartlag",roadmapAbstract:"Vis street map",satelliteAbstract:"Vis satelitt bilder",hybridAbstract:"Vis bilder med gatenavn",terrainAbstract:"Vis street map med terreng"},"gxp.plugins.LayerProperties.prototype":{menuText:"Kartlag Egenskaper",toolTip:"Kartlag Egenskaper"},"gxp.plugins.LayerTree.prototype":{shortTitle:"kartlag",rootNodeText:"Kartlag",overlayNodeText:"Kartlag",baseNodeText:"Bakgrunnskart"},"gxp.plugins.LayerManager.prototype":{baseNodeText:"Bakgrunnskart"},"gxp.plugins.Legend.prototype":{menuText:"Vis tegnforklaring",tooltip:"Vis tegnforklaring"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Laster kart..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox kartlag",blueMarbleTopoBathyJanTitle:"Blue Marble Topografi & Batymetri (januar)",blueMarbleTopoBathyJulTitle:"Blue Marble Topografi & Batymetri (Juli)",blueMarbleTopoJanTitle:"Blue Marble Topografi (januar)",blueMarbleTopoJulTitle:"Blue Marble Topografi (Juli)",controlRoomTitle:"Kontrollrom",geographyClassTitle:"Geografi Klasse",naturalEarthHypsoTitle:"Naturlig Jordklode Hypsometri",naturalEarthHypsoBathyTitle:"Naturlig Jordklode  Hypsometri & Batymetri",naturalEarth1Title:"Naturlig Jordklode I",naturalEarth2Title:"Naturlig Jordklode II",worldDarkTitle:"Verden Mørk",worldLightTitle:"Verden Lys",worldPrintTitle:"Verden utskrift"},"gxp.plugins.Measure.prototype":{buttonText:"Mål",lengthMenuText:"Lengde",areaMenuText:"Areal",lengthTooltip:"Mål lengde",areaTooltip:"Mål areal",measureTooltip:"Mål"},"gxp.plugins.Navigation.prototype":{menuText:"Panorer kart",tooltip:"Panorer kart"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Zoom til forrige utstrekning",nextMenuText:"Zoom til neste utstrekning",previousTooltip:"Zoom til forrige utstrekning",nextTooltip:"Zoom til neste utstrekning"},"gxp.plugins.OSMSource.prototype":{title:"OpenStreetMap Kartlag",mapnikAttribution:"&kopier; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> bidragsytere",osmarenderAttribution:"Data CC-By-SA av <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:"Skriv ut",menuText:"Skriv ut kart",tooltip:"Skriv ut kart",previewText:"Forhåndsvinsning av utskrift",notAllNotPrintableText:"Ikke alle kartlag kan skrives ut",nonePrintableText:"Ingen av dine valgte kartlag kan skrives ut"},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest Kartlag",osmAttribution:"Titler levert av <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tutker levert av <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest bilder"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Spør",queryMenuText:"Spør kartlag",queryActionTip:"Spør det valgte kartlaget",queryByLocationText:"Spør ved valgt kartlags utstrekning",queryByAttributesText:"Spør ved attributter",queryMsg:"Spørring...",cancelButtonText:"Kanseler",noFeaturesTitle:"Ingen treff",noFeaturesMessage:"Din spørring gav ingen treff."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Fjern kartlag",removeActionTip:"Fjern kartlag"},"gxp.plugins.Styler.prototype":{menuText:"Kartlag Stiler",tooltip:"Kartlag Stiler"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identifiser",infoActionTip:"Hent Feature Info",popupTitle:"Feature Info"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom firkant",zoomInMenuText:"Zoom inn",zoomOutMenuText:"Zoom ut",zoomTooltip:"Zoom ved å tegne en firkant",zoomInTooltip:"Zoom inn",zoomOutTooltip:"Zoom ut"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Zoom til maks utstrekning",tooltip:"Zoom til maks utstrekning"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Zoom til kartlagets utstrekning",tooltip:"Zoom til kartlagets utstrekning"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Zoom til kartlagets utstrekning",tooltip:"Zoom til kartlagets utstrekning"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Zoom til valgte features",tooltip:"Zoom til valgte features"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Lagre Endringer?",closeMsg:"Denne featuren har nye endringer som ikke er lagret. Vill du lagre endringene?",deleteMsgTitle:"Slett Feature?",deleteMsg:"Er du sikker på at du vil slette denne featuren?",editButtonText:"Editer",editButtonTooltip:"Gjør denne featuren editerbar",deleteButtonText:"Slett",deleteButtonTooltip:"Slett denne featuren",cancelButtonText:"Kanseler",cancelButtonTooltip:"Stopp editering, forkast endringer",saveButtonText:"Lagre",saveButtonTooltip:"Lagre endringer"},"gxp.FillSymbolizer.prototype":{fillText:"Fyll ut",colorText:"Farge",opacityText:"Gjennomskinnelighet"},"gxp.FilterBuilder.prototype":{builderTypeNames:["en","alle","ingen","ikke alle"],preComboText:"Treff",postComboText:"av følgende:",addConditionText:"legg til betingelse",addGroupText:"Legg til gruppe",removeConditionText:"fjern betingelse"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Navn",titleHeaderText:"Tittel",queryableHeaderText:"Mulig å spørre",layerSelectionLabel:"Vis tilgjengelig data fra:",layerAdditionLabel:"eller legg til en ny server.",expanderTemplateText:"<p><b>Abstrakt:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"sirkel",graphicSquareText:"firkant",graphicTriangleText:"triangel",graphicStarText:"stjerne",graphicCrossText:"kryss",graphicXText:"x",graphicExternalText:"ekstern",urlText:"URL",opacityText:"gjennomskinnelighet",symbolText:"Symbol",sizeText:"Størrelse",rotationText:"Rotasjon"},"gxp.QueryPanel.prototype":{queryByLocationText:"Spør etter plassering",currentTextText:"Nåværende utstrekning",queryByAttributesText:"Spør etter attributter",layerText:"Kartlag"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Målestokk 1:{scale}",labelFeaturesText:"Etikett Features",labelsText:"Etiketter",basicText:"Grunnleggende",advancedText:"Avansert",limitByScaleText:"Målestokksbegrensning",limitByConditionText:"Begrensning på tilstand",symbolText:"Symbol",nameText:"Navn"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Målestokk 1:{scale}",minScaleLimitText:"Minimum målestokksgrense",maxScaleLimitText:"Maximum målestokksgrense"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"solid",dashStrokeName:"dash",dotStrokeName:"dot",titleText:"Strek",styleText:"Stil",colorText:"Farge",widthText:"Bredde",opacityText:"gjennomskinnelighet"},"gxp.StylePropertiesDialog.prototype":{titleText:"Generel",nameFieldText:"Navn",titleFieldText:"Tittel",abstractFieldText:"Abstrakt"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Etikett verdier",haloText:"Halo",sizeText:"Størrelse"},"gxp.WMSLayerPanel.prototype":{attributionText:"Tilskrivende",aboutText:"Om",titleText:"Tittel",nameText:"Navn",descriptionText:"Beskrivelse",displayText:"Visning",opacityText:"Gjennomskinnelighet",formatText:"Format",transparentText:"Gjennomskinnelighet",cacheText:"Cache",cacheFieldText:"Bruk cachet versjon",stylesText:"Tilgjengelige Stiler",infoFormatText:"Info format",infoFormatEmptyText:"Velg et format",displayOptionsText:"Visningsvalg",queryText:"Begrensning ved filter",scaleText:"Begrensning ved målestokk",minScaleText:"Minimum målestokk",maxScaleText:"Maximum målestokk",switchToFilterBuilderText:"Bytt tilbake til filter bygger",cqlPrefixText:"eller ",cqlText:"bruk CQL filter istedenfor",singleTileText:"Enkel tile",singleTileFieldText:"Bruk enkel tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Ditt kartlag kan publisers til web!! Kopier følgende HTML for å legge ditt kartlag til din webside:",heightLabel:"Høyde",widthLabel:"Bredde",mapSizeLabel:"Kart størrelse",miniSizeLabel:"Mini",smallSizeLabel:"Liten",premiumSizeLabel:"Premium",largeSizeLabel:"Stor"},"gxp.WMSStylesDialog.prototype":{addStyleText:"Legg til",addStyleTip:"Legg til en ny stil",chooseStyleText:"Velg en stil",deleteStyleText:"Fjern",deleteStyleTip:"Slett den valgte stilen",editStyleText:"Editer",editStyleTip:"Editer den valgte stilen",duplicateStyleText:"Reproduser",duplicateStyleTip:"Reproduser den valgte stilen",addRuleText:"Legg til",addRuleTip:"Legg til ny regel",newRuleText:"Ny Regel",deleteRuleText:"Fjern",deleteRuleTip:"Slett den valgte regelen",editRuleText:"Editer",editRuleTip:"Editer den valgte regelen",duplicateRuleText:"Reproduser",duplicateRuleTip:"Reproduser den valgte regelen",cancelText:"Kanseler",saveText:"Lagre",styleWindowTitle:"Bruker Stil: {0}",ruleWindowTitle:"Stil regel: {0}",stylesFieldsetTitle:"Stiler",rulesFieldsetTitle:"Regler"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Titel",titleEmptyText:"Kartlags titel",abstractLabel:"Beskrivelse",abstractEmptyText:"Kartlag beskrivelse",fileLabel:"Data",fieldEmptyText:"Bla igjennom data arkiv...",uploadText:"Last opp",uploadFailedText:"Opplasting feilet",processingUploadText:"Prosesserer opplasting...",waitMsgText:"Laster opp dataene...",invalidFileExtensionText:"Filtype må være en av: ",optionsText:"Valt",workspaceLabel:"arbeidsområde",workspaceEmptyText:"standard arbeidsområde",dataStoreLabel:"Lagre",dataStoreEmptyText:"Velg et lagringsmedium",dataStoreNewText:"Velg et nytt lagringsmedium",crsLabel:"KRS",crsEmptyText:"Koordinat Referanse System ID",invalidCrsText:"KRS identifikatorer må være en EPSG kode (e.g. EPSG:4326)"},"gxp.NewSourceDialog.prototype":{title:"Legg til ny Server...",cancelText:"Kanseler",addServerText:"Legg til Server",invalidURLText:"Skriv inn en gyldig URL til et WMS endepunkt (f.eks. http://example.com/geoserver/wms)",contactingServerText:"Kontakter Server..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Zoom nivå"},"gxp.Viewer.prototype":{saveErrorText:"Problemer med å lagre: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Kilde",addPicasaText:"Picasa Foto",addYouTubeText:"YouTube Videoer",addRSSText:"Andre GeoRSS Feed",addFeedText:"Legg til Kart",addTitleText:"Tittel",keywordText:"Nøkkelord",doneText:"Ferdig",titleText:"Legg til Feeds",maxResultsText:"Max elementer"}}),GeoExt.Lang.add("pl",{"gxp.menu.LayerMenu.prototype":{layerText:"Warstwa"},"gxp.plugins.AddLayers.prototype":{addMenuText:"Dodaj warstwy",addActionTip:"Dodaj warstwy",addServerText:"Dodaj serwer",addButtonText:"Dodaj warstwy",untitledText:"Bez tytułu",addLayerSourceErrorText:"Błąd w czasie pobierania parametrów serwera WMS ({msg}).\nProszę sprawdzić adres.",availableLayersText:"Dostępne warstwy",expanderTemplateText:"<p><b>Opis:</b> {abstract}</p>",panelTitleText:"Tytuł",layerSelectionText:"Pokaż dostępne warstwy z:",doneText:"Gotowe",uploadText:"Wyślij dane",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},"gxp.plugins.BingSource.prototype":{title:"Bing Maps",roadTitle:"Bing - drogi",aerialTitle:"Bing - ortofoto",labeledAerialTitle:"Bing - ortofoto z etykietami"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Edit",createFeatureActionText:"Create",editFeatureActionText:"Modify",createFeatureActionTip:"Utwórz nowy obiekt",editFeatureActionTip:"Edytuj istniejący obiekt",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Pokaż na mapie",firstPageTip:"Pierwsza strona",previousPageTip:"Poprzednia strona",zoomPageExtentTip:"Powiększ do zasięgu strony",nextPageTip:"Następna strona",lastPageTip:"Ostatnia strona",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"Przeglądarka 3D",tooltip:"Przełącz do widoku 3D"},"gxp.plugins.GoogleSource.prototype":{title:"Google Maps",roadmapAbstract:"Mapa drogowa",satelliteAbstract:"Zdjęcia satelitarne",hybridAbstract:"Zdjęcia satelitarne z etykietami",terrainAbstract:"Mapa terenowa z etykietami"},"gxp.plugins.LayerProperties.prototype":{menuText:"Właściwości",toolTip:"Właściwości"},"gxp.plugins.LayerTree.prototype":{shortTitle:"Mapa",rootNodeText:"Mapa",overlayNodeText:"Warstwy",baseNodeText:"Mapa referencyjna"},"gxp.plugins.LayerManager.prototype":{baseNodeText:"Mapa referencyjna"},"gxp.plugins.Legend.prototype":{menuText:"Legenda mapy",tooltip:"Legenda mapy"},"gxp.plugins.Measure.prototype":{buttonText:"Pomiary",lengthMenuText:"Długość",areaMenuText:"Powierzchnia",lengthTooltip:"Pomiar odległości",areaTooltip:"Pomiar powierzchni",measureTooltip:"Pomiary"},"gxp.plugins.Navigation.prototype":{menuText:"Przesuń mapę",tooltip:"Przesuń mapę"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Poprzedni widok",nextMenuText:"Kolejny widok",previousTooltip:"Poprzedni widok",nextTooltip:"Kolejny widok"},"gxp.plugins.OSMSource.prototype":{title:"OpenStreetMap",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:"Drukuj",menuText:"Drukuj",tooltip:"Drukuj",previewText:"Podgląd wydruku",notAllNotPrintableText:"Nie wszystkie warstwy mogą być wydrukowane",nonePrintableText:"Żadna z warstw nie może byc wydrukowana"},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest",osmAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest Imagery"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Wyszukaj",queryMenuText:"Przeszukaj warstwę",queryActionTip:"Przeszukaj zaznaczoną warstwę",queryByLocationText:"Query by current map extent",queryByAttributesText:"Przeszukaj po atrybutach",queryMsg:"Przeszukiwanie...",cancelButtonText:"Anuluj",noFeaturesTitle:"Brak danych",noFeaturesMessage:"Przeszukanie nie zwróciło żadnych danych."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Usuń warstwę",removeActionTip:"Usuń warstwę"},"gxp.plugins.Styler.prototype":{menuText:"Eycja styli",tooltip:"Zarządzanie stylami warstwy"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identify",infoActionTip:"Info o obiekcie",popupTitle:"Info o obiekcie"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom Box",zoomInMenuText:"Powiększ",zoomOutMenuText:"Pomniejsz",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"Powiększ",zoomOutTooltip:"Pomniejsz"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Cała mapa",tooltip:"Cała mapa"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Powiększ do zasięgu całej warstwy",tooltip:"Powiększ do zasięgu całej warstwy"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Powiększ do zasięgu całej warstwy",tooltip:"Powiększ do zasięgu całej warstwy"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Powiększ do wybranych obiektów",tooltip:"Powiększ do wybranych obiektów"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Zapisać zmiany?",closeMsg:"Istnieją nie zapisane zmiany. Chcesz je zapisać?",deleteMsgTitle:"Usunąć obiekt?",deleteMsg:"Jesteś pewien że chcesz usunąć ten obiekt?",editButtonText:"Edytuj",editButtonTooltip:"Edytuj ten obiekt",deleteButtonText:"Usuń",deleteButtonTooltip:"Usuń ten obiekt",cancelButtonText:"Anuluj",cancelButtonTooltip:"Anuluj edycję i nie zapisuj zmian",saveButtonText:"Zapisz",saveButtonTooltip:"Zapisz zmiany"},"gxp.FillSymbolizer.prototype":{fillText:"Wypełnienie",colorText:"Kolor",opacityText:"Prześwit"},"gxp.FilterBuilder.prototype":{builderTypeNames:["dowolny","wszystkie","żaden","odwrotność"],preComboText:"Dopasuj",postComboText:"sposród:",addConditionText:"dodaj warunek",addGroupText:"dodaj grupę",removeConditionText:"usuń warunek"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Nazwa",titleHeaderText:"Tytuł",queryableHeaderText:"Przeszukiwalna",layerSelectionLabel:"Zobacz dostępne dane z:",layerAdditionLabel:"lub dodaj serwer.",expanderTemplateText:"<p><b>Opis:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"koło",graphicSquareText:"kwadrat",graphicTriangleText:"trójkąt",graphicStarText:"gwiazda",graphicCrossText:"krzyż",graphicXText:"x",graphicExternalText:"inny",urlText:"URL",opacityText:"Prześwit",symbolText:"Symbol",sizeText:"Rozmiar",rotationText:"Obrót"},"gxp.QueryPanel.prototype":{queryByLocationText:"Zapytanie przestrzenne",currentTextText:"Aktualne powiększenie",queryByAttributesText:"Zapytanie atrybutowe",layerText:"Warstwa"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Skala 1:{scale}",labelFeaturesText:"Etykiety obiektów",labelsText:"Etykiety",basicText:"Podstawowa",advancedText:"Zaawansowana",limitByScaleText:"Ograniczenie skalowe",limitByConditionText:"Ograniczenie warunkowe",symbolText:"Symbol",nameText:"Nazwa"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Skala 1:{scale}",minScaleLimitText:"Skala min.",maxScaleLimitText:"Skala max"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"ciągły",dashStrokeName:"kreskowany",dotStrokeName:"kropkowany",titleText:"Obrys",styleText:"Styl",colorText:"Kolor",widthText:"Grubość",opacityText:"Prześwit"},"gxp.StylePropertiesDialog.prototype":{titleText:"Ogólny",nameFieldText:"Nazwa",titleFieldText:"Tytuł",abstractFieldText:"Opis"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Wartości etykiet",haloText:"Efekt Halo",sizeText:"Rozmiar"},"gxp.WMSLayerPanel.prototype":{attributionText:"Attribution",aboutText:"O",titleText:"Tytuł",nameText:"Nazwa",descriptionText:"Opis",displayText:"Wyświetlanie",opacityText:"Prześwit",formatText:"Format",transparentText:"Przeźr.",cacheText:"Cache",cacheFieldText:"Użyj wersji cache",stylesText:"Dostępne Style",infoFormatText:"Info format",infoFormatEmptyText:"Select a format",displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Twoja mapa jest gotowa do publikacji! Po prostu wklej poniższy kod na swojej witrynie:",heightLabel:"Wysokość",widthLabel:"Szerokość",mapSizeLabel:"Rozmiar mapy",miniSizeLabel:"Mini",smallSizeLabel:"Mały",premiumSizeLabel:"Średni",largeSizeLabel:"Duży"},"gxp.WMSStylesDialog.prototype":{addStyleText:"Dodaj",addStyleTip:"Dodaj nowy styl",chooseStyleText:"Wybierz styl",deleteStyleText:"Usuń",deleteStyleTip:"Usuń styl",editStyleText:"Edytuj",editStyleTip:"Edytuj wybrany styl",duplicateStyleText:"Stwórz kopię",duplicateStyleTip:"Stwórz kopię wybranego stylu",addRuleText:"Dodaj",addRuleTip:"Dodaj nową regułę",newRuleText:"Nowa reguła",deleteRuleText:"Usuń",deleteRuleTip:"Usuń wybraną regułę",editRuleText:"Edytuj",editRuleTip:"Edytuj wybraną regułę",duplicateRuleText:"Stwórz kopię",duplicateRuleTip:"Skopiuj wybraną regułę",cancelText:"Anuluj",saveText:"Zapisz",styleWindowTitle:"Styl użytkownika: {0}",ruleWindowTitle:"Reguła stylu: {0}",stylesFieldsetTitle:"Style",rulesFieldsetTitle:"Reguły"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Tytuł",titleEmptyText:"Tytuł warstwy",abstractLabel:"Opis",abstractEmptyText:"Opis warstwy",fileLabel:"Dane",fieldEmptyText:"Wskaż lokalizację danych...",uploadText:"Prześlij",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",importText:"Importing upload...",waitMsgText:"Przesyłanie danych...",invalidFileExtensionText:"Typ pliku musi być jednym z poniższych: ",optionsText:"Opcje",workspaceLabel:"Obszar roboczy",workspaceEmptyText:"Domyślny obszar roboczy",dataStoreLabel:"Magazyn danych",dataStoreEmptyText:"Create new store",defaultDataStoreEmptyText:"Domyślny magazyn danych"},"gxp.NewSourceDialog.prototype":{title:"Dodaj serwer...",
cancelText:"Anuluj",addServerText:"Dodaj serwer",invalidURLText:"Podaj prawidłowy adres URL usługi WMS (n.p. http://example.com/geoserver/wms)",contactingServerText:"Łączenie z serwerem..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Poziom powiększenia"},"gxp.Viewer.prototype":{saveErrorText:"Trouble saving: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Źródło",addPicasaText:"Picasa zdjęcia",addYouTubeText:"YouTube Videos",addRSSText:"Inne GeoRSS",addFeedText:"Dodaj do mapy",addTitleText:"Tytuł",keywordText:"Słowo",doneText:"Gotowe",titleText:"Dodaj kanały",maxResultsText:"Rzeczy Max"}});